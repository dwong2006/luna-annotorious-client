(function(L,le){typeof exports=="object"&&typeof module<"u"?module.exports=le():typeof define=="function"&&define.amd?define(le):(L=typeof globalThis<"u"?globalThis:L||self,L.LunaAnnotorious=le())})(this,function(){"use strict";function L(){}const le=e=>e;function Rt(e,t){for(const n in t)e[n]=t[n];return e}function qe(e){return e()}function Xe(){return Object.create(null)}function ee(e){e.forEach(qe)}function Ne(e){return typeof e=="function"}function se(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ft(e){return Object.keys(e).length===0}function Ot(e){return e&&Ne(e.destroy)?e.destroy:L}const Ge=typeof window<"u";let Ut=Ge?()=>window.performance.now():()=>Date.now(),Te=Ge?e=>requestAnimationFrame(e):L;const re=new Set;function Je(e){re.forEach(t=>{t.c(e)||(re.delete(t),t.f())}),re.size!==0&&Te(Je)}function Zt(e){let t;return re.size===0&&Te(Je),{promise:new Promise(n=>{re.add(t={c:e,f:n})}),abort(){re.delete(t)}}}function w(e,t){e.appendChild(t)}function Qe(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function It(e){const t=S("style");return Wt(Qe(e),t),t.sheet}function Wt(e,t){w(e.head||e,t)}function E(e,t,n){e.insertBefore(t,n||null)}function k(e){e.parentNode.removeChild(e)}function Kt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function S(e){return document.createElement(e)}function Yt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function M(e){return document.createTextNode(e)}function V(){return M(" ")}function ce(){return M("")}function F(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function A(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xe(e,t){for(const n in t)A(e,n,t[n])}function qt(e){return Array.from(e.childNodes)}function te(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function be(e,t,n){e.classList[n?"add":"remove"](t)}function et(e,t,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,i,t),r}const ve=new Map;let ye=0;function Xt(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function Gt(e,t){const n={stylesheet:It(t),rules:{}};return ve.set(e,n),n}function tt(e,t,n,i,r,o,l,s=0){const a=16.666/i;let c=`{
`;for(let b=0;b<=1;b+=a){const g=t+(n-t)*o(b);c+=b*100+`%{${l(g,1-g)}}
`}const d=c+`100% {${l(n,1-n)}}
}`,f=`__svelte_${Xt(d)}_${s}`,u=Qe(e),{stylesheet:p,rules:m}=ve.get(u)||Gt(u,e);m[f]||(m[f]=!0,p.insertRule(`@keyframes ${f} ${d}`,p.cssRules.length));const _=e.style.animation||"";return e.style.animation=`${_?`${_}, `:""}${f} ${i}ms linear ${r}ms 1 both`,ye+=1,f}function Jt(e,t){const n=(e.style.animation||"").split(", "),i=n.filter(t?o=>o.indexOf(t)<0:o=>o.indexOf("__svelte")===-1),r=n.length-i.length;r&&(e.style.animation=i.join(", "),ye-=r,ye||Qt())}function Qt(){Te(()=>{ye||(ve.forEach(e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}}),ve.clear())})}let ae;function fe(e){ae=e}function xt(){if(!ae)throw new Error("Function called outside component initialization");return ae}function Le(){const e=xt();return(t,n,{cancelable:i=!1}={})=>{const r=e.$$.callbacks[t];if(r){const o=et(t,n,{cancelable:i});return r.slice().forEach(l=>{l.call(e,o)}),!o.defaultPrevented}return!0}}function en(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const ue=[],Pe=[],ke=[],nt=[],it=Promise.resolve();let Me=!1;function rt(){Me||(Me=!0,it.then(ot))}function tn(){return rt(),it}function de(e){ke.push(e)}const De=new Set;let we=0;function ot(){const e=ae;do{for(;we<ue.length;){const t=ue[we];we++,fe(t),nn(t.$$)}for(fe(null),ue.length=0,we=0;Pe.length;)Pe.pop()();for(let t=0;t<ke.length;t+=1){const n=ke[t];De.has(n)||(De.add(n),n())}ke.length=0}while(ue.length);for(;nt.length;)nt.pop()();Me=!1,De.clear(),fe(e)}function nn(e){if(e.fragment!==null){e.update(),ee(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(de)}}let pe;function rn(){return pe||(pe=Promise.resolve(),pe.then(()=>{pe=null})),pe}function $e(e,t,n){e.dispatchEvent(et(`${t?"intro":"outro"}${n}`))}const Ee=new Set;let X;function G(){X={r:0,c:[],p:X}}function J(){X.r||ee(X.c),X=X.p}function C(e,t){e&&e.i&&(Ee.delete(e),e.i(t))}function N(e,t,n,i){if(e&&e.o){if(Ee.has(e))return;Ee.add(e),X.c.push(()=>{Ee.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}const on={duration:0};function lt(e,t,n,i){let r=t(e,n),o=i?0:1,l=null,s=null,a=null;function c(){a&&Jt(e,a)}function d(u,p){const m=u.b-o;return p*=Math.abs(m),{a:o,b:u.b,d:m,duration:p,start:u.start,end:u.start+p,group:u.group}}function f(u){const{delay:p=0,duration:m=300,easing:_=le,tick:b=L,css:g}=r||on,v={start:Ut()+p,b:u};u||(v.group=X,X.r+=1),l||s?s=v:(g&&(c(),a=tt(e,o,u,m,p,_,g)),u&&b(0,1),l=d(v,m),de(()=>$e(e,u,"start")),Zt(h=>{if(s&&h>s.start&&(l=d(s,m),s=null,$e(e,l.b,"start"),g&&(c(),a=tt(e,o,l.b,l.duration,0,_,r.css))),l){if(h>=l.end)b(o=l.b,1-o),$e(e,l.b,"end"),s||(l.b?c():--l.group.r||ee(l.group.c)),l=null;else if(h>=l.start){const T=h-l.start;o=l.a+l.d*_(T/l.duration),b(o,1-o)}}return!!(l||s)}))}return{run(u){Ne(r)?rn().then(()=>{r=r(),f(u)}):f(u)},end(){c(),l=s=null}}}function ln(e,t){const n={},i={},r={$$scope:1};let o=e.length;for(;o--;){const l=e[o],s=t[o];if(s){for(const a in l)a in s||(i[a]=1);for(const a in s)r[a]||(n[a]=s[a],r[a]=1);e[o]=s}else for(const a in l)r[a]=1}for(const l in i)l in n||(n[l]=void 0);return n}function Q(e){e&&e.c()}function K(e,t,n,i){const{fragment:r,on_mount:o,on_destroy:l,after_update:s}=e.$$;r&&r.m(t,n),i||de(()=>{const a=o.map(qe).filter(Ne);l?l.push(...a):ee(a),e.$$.on_mount=[]}),s.forEach(de)}function Y(e,t){const n=e.$$;n.fragment!==null&&(ee(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function sn(e,t){e.$$.dirty[0]===-1&&(ue.push(e),rt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function me(e,t,n,i,r,o,l,s=[-1]){const a=ae;fe(e);const c=e.$$={fragment:null,ctx:null,props:o,update:L,not_equal:r,bound:Xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Xe(),dirty:s,skip_bound:!1,root:t.target||a.$$.root};l&&l(c.root);let d=!1;if(c.ctx=n?n(e,t.props||{},(f,u,...p)=>{const m=p.length?p[0]:u;return c.ctx&&r(c.ctx[f],c.ctx[f]=m)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](m),d&&sn(e,f)),u}):[],c.update(),d=!0,ee(c.before_update),c.fragment=i?i(c.ctx):!1,t.target){if(t.hydrate){const f=qt(t.target);c.fragment&&c.fragment.l(f),f.forEach(k)}else c.fragment&&c.fragment.c();t.intro&&C(e.$$.fragment),K(e,t.target,t.anchor,t.customElement),ot()}fe(a)}class he{$destroy(){Y(this,1),this.$destroy=L}$on(t,n){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!Ft(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var Be={dragStart:!0},st=(e,t,n)=>Math.min(Math.max(e,t),n),He=e=>typeof e=="string",cn=([e,t],n,i)=>{const r=(o,l)=>l===0?0:Math.ceil(o/l)*l;return[r(n,e),r(i,t)]},ct=(e,t)=>e.some(n=>t.some(i=>n.contains(i)));function je(e,t){if(e===void 0)return;if(Ve(e))return e.getBoundingClientRect();if(typeof e=="object"){const{top:i=0,left:r=0,right:o=0,bottom:l=0}=e;return{top:i,right:window.innerWidth-o,bottom:window.innerHeight-l,left:r}}if(e==="parent")return t.parentNode.getBoundingClientRect();const n=document.querySelector(e);if(n===null)throw new Error("The selector provided for bound doesn't exists in the document.");return n.getBoundingClientRect()}var Ce=(e,t,n)=>e.style.setProperty(t,n),Ve=e=>e instanceof HTMLElement,an=(e,t={})=>{var Pt,Mt;let n,i,{bounds:r,axis:o="both",gpuAcceleration:l=!0,legacyTranslate:s=!0,transform:a,applyUserSelectHack:c=!0,disabled:d=!1,ignoreMultitouch:f=!1,recomputeBounds:u=Be,grid:p,position:m,cancel:_,handle:b,defaultClass:g="neodrag",defaultClassDragging:v="neodrag-dragging",defaultClassDragged:h="neodrag-dragged",defaultPosition:T={x:0,y:0},onDragStart:O,onDrag:H,onDragEnd:D}=t,U=!1,$=0,W=0,q=0,_e=0,Oe=0,Ue=0,{x:Ae,y:Se}=m?{x:(Pt=m==null?void 0:m.x)!=null?Pt:0,y:(Mt=m==null?void 0:m.y)!=null?Mt:0}:T;We(Ae,Se);let x,ie,ge,Ze,Ct,At="",ri=!!m;u={...Be,...u};const Ie=document.body.style,ne=e.classList;function We(y=$,B=W){if(!a){if(s){let Z=`${+y}px, ${+B}px`;return Ce(e,"transform",l?`translate3d(${Z}, 0)`:`translate(${Z})`)}return Ce(e,"translate",`${+y}px ${+B}px ${l?"1px":""}`)}const j=a({offsetX:y,offsetY:B,rootNode:e});He(j)&&Ce(e,"transform",j)}const Ke=(y,B)=>{const j={offsetX:$,offsetY:W,rootNode:e,currentNode:Ct};e.dispatchEvent(new CustomEvent(y,{detail:j})),B==null||B(j)},Ye=addEventListener;Ye("pointerdown",Nt,!1),Ye("pointerup",Tt,!1),Ye("pointermove",Lt,!1),Ce(e,"touch-action","none");const St=()=>{let y=e.offsetWidth/ie.width;return isNaN(y)&&(y=1),y};function Nt(y){if(d||y.button===2||f&&!y.isPrimary)return;if(u.dragStart&&(x=je(r,e)),He(b)&&He(_)&&b===_)throw new Error("`handle` selector can't be same as `cancel` selector");if(ne.add(g),ge=function(P,R){if(!P)return[R];if(Ve(P))return[P];if(Array.isArray(P))return P;const I=R.querySelectorAll(P);if(I===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(I.values())}(b,e),Ze=function(P,R){if(!P)return[];if(Ve(P))return[P];if(Array.isArray(P))return P;const I=R.querySelectorAll(P);if(I===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(I.values())}(_,e),n=/(both|x)/.test(o),i=/(both|y)/.test(o),ct(Ze,ge))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const B=y.composedPath()[0];if(!ge.some(P=>{var R;return P.contains(B)||((R=P.shadowRoot)==null?void 0:R.contains(B))})||ct(Ze,[B]))return;Ct=ge.length===1?e:ge.find(P=>P.contains(B)),U=!0,ie=e.getBoundingClientRect(),c&&(At=Ie.userSelect,Ie.userSelect="none"),Ke("neodrag:start",O);const{clientX:j,clientY:Z}=y,z=St();n&&(q=j-Ae/z),i&&(_e=Z-Se/z),x&&(Oe=j-ie.left,Ue=Z-ie.top)}function Tt(){U&&(u.dragEnd&&(x=je(r,e)),ne.remove(v),ne.add(h),c&&(Ie.userSelect=At),Ke("neodrag:end",D),n&&(q=$),i&&(_e=W),U=!1)}function Lt(y){if(!U)return;u.drag&&(x=je(r,e)),ne.add(v),y.preventDefault(),ie=e.getBoundingClientRect();let B=y.clientX,j=y.clientY;const Z=St();if(x){const z={left:x.left+Oe,top:x.top+Ue,right:x.right+Oe-ie.width,bottom:x.bottom+Ue-ie.height};B=st(B,z.left,z.right),j=st(j,z.top,z.bottom)}if(Array.isArray(p)){let[z,P]=p;if(isNaN(+z)||z<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+P)||P<0)throw new Error("2nd argument of `grid` must be a valid positive number");let R=B-q,I=j-_e;[R,I]=cn([z/Z,P/Z],R,I),B=q+R,j=_e+I}n&&($=Math.round((B-q)*Z)),i&&(W=Math.round((j-_e)*Z)),Ae=$,Se=W,Ke("neodrag",H),We()}return{destroy:()=>{const y=removeEventListener;y("pointerdown",Nt,!1),y("pointerup",Tt,!1),y("pointermove",Lt,!1)},update:y=>{var j,Z,z,P,R,I,Dt,$t,Bt,Ht,jt,Vt,zt;o=y.axis||"both",d=(j=y.disabled)!=null?j:!1,f=(Z=y.ignoreMultitouch)!=null?Z:!1,b=y.handle,r=y.bounds,u=(z=y.recomputeBounds)!=null?z:Be,_=y.cancel,c=(P=y.applyUserSelectHack)!=null?P:!0,p=y.grid,l=(R=y.gpuAcceleration)!=null?R:!0,s=(I=y.legacyTranslate)!=null?I:!0,a=y.transform;const B=ne.contains(h);ne.remove(g,h),g=(Dt=y.defaultClass)!=null?Dt:"neodrag",v=($t=y.defaultClassDragging)!=null?$t:"neodrag-dragging",h=(Bt=y.defaultClassDragged)!=null?Bt:"neodrag-dragged",ne.add(g),B&&ne.add(h),ri&&(Ae=$=(jt=(Ht=y.position)==null?void 0:Ht.x)!=null?jt:$,Se=W=(zt=(Vt=y.position)==null?void 0:Vt.y)!=null?zt:W,We())}}};function fn(e){let t,n=[{width:e[1]},{height:e[1]},{"stroke-width":"0"},{class:e[2]},e[0].a,e[4],{xmlns:"http://www.w3.org/2000/svg"}],i={};for(let r=0;r<n.length;r+=1)i=Rt(i,n[r]);return{c(){t=Yt("svg"),xe(t,i)},m(r,o){E(r,t,o),t.innerHTML=e[3]},p(r,[o]){o&8&&(t.innerHTML=r[3]),xe(t,i=ln(n,[o&2&&{width:r[1]},o&2&&{height:r[1]},{"stroke-width":"0"},o&4&&{class:r[2]},o&1&&r[0].a,o&16&&r[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:L,o:L,d(r){r&&k(t)}}}function un(e,t,n){let{src:i}=t,{size:r="1em"}=t,{color:o=void 0}=t,{title:l=void 0}=t,{className:s=""}=t,a,c;return e.$$set=d=>{"src"in d&&n(0,i=d.src),"size"in d&&n(1,r=d.size),"color"in d&&n(5,o=d.color),"title"in d&&n(6,l=d.title),"className"in d&&n(2,s=d.className)},e.$$.update=()=>{e.$$.dirty&33&&(n(4,c={}),o&&(i.a.stroke!=="none"&&n(4,c.stroke=o,c),i.a.fill!=="none"&&n(4,c.fill=o,c))),e.$$.dirty&65&&n(3,a=(l?`<title>${l}</title>`:"")+i.c)},[i,r,s,a,c,o,l]}class oe extends he{constructor(t){super(),me(this,t,un,fn,se,{src:0,size:1,color:5,title:6,className:2})}}const at={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'},dn={a:{viewBox:"0 0 448 512"},c:'<path d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path>'},pn={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="6 9 12 15 18 9"></polyline>'};var ze="__autosizeInputGhost",mn={" ":"nbsp","<":"lt",">":"gt"};function hn(e){return"&"+mn[e]+";"}function _n(e){return e.replace(/\s|<|>/g,hn)}function gn(){var e=document.createElement("div");return e.id=ze,e.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(e),e}var bn=function(e,t){var n=window.getComputedStyle(e),i="box-sizing:"+n.boxSizing+";border-left:"+n.borderLeftWidth+" solid red;border-right:"+n.borderRightWidth+" solid red;font-family:"+n.fontFamily+";font-feature-settings:"+n.fontFeatureSettings+";font-kerning:"+n.fontKerning+";font-size:"+n.fontSize+";font-stretch:"+n.fontStretch+";font-style:"+n.fontStyle+";font-variant:"+n.fontVariant+";font-variant-caps:"+n.fontVariantCaps+";font-variant-ligatures:"+n.fontVariantLigatures+";font-variant-numeric:"+n.fontVariantNumeric+";font-weight:"+n.fontWeight+";letter-spacing:"+n.letterSpacing+";margin-left:"+n.marginLeft+";margin-right:"+n.marginRight+";padding-left:"+n.paddingLeft+";padding-right:"+n.paddingRight+";text-indent:"+n.textIndent+";text-transform:"+n.textTransform;function r(){var l=e.value||e.getAttribute("placeholder")||"",s=document.getElementById(ze)||gn();s.style.cssText+=i,s.innerHTML=_n(l);var a=window.getComputedStyle(s).width;return e.style.width=a,a}e.addEventListener("input",r);var o=r();return t&&t.minWidth&&o!=="0px"&&(e.style.minWidth=o),function(){e.removeEventListener("input",r);var l=document.getElementById(ze);l&&l.parentNode.removeChild(l)}};const vn={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'},oi="";function yn(e){var d;let t,n=((d=e[0])==null?void 0:d.value)+"",i,r,o,l,s,a,c=e[2]&&ft();return{c(){t=S("span"),i=M(n),r=V(),c&&c.c(),o=ce(),A(t,"class","transcription svelte-jmvim5")},m(f,u){E(f,t,u),w(t,i),E(f,r,u),c&&c.m(f,u),E(f,o,u),l=!0,s||(a=F(t,"click",e[5]),s=!0)},p(f,u){var p;(!l||u&1)&&n!==(n=((p=f[0])==null?void 0:p.value)+"")&&te(i,n),f[2]?c?(c.p(f,u),u&4&&C(c,1)):(c=ft(),c.c(),C(c,1),c.m(o.parentNode,o)):c&&(G(),N(c,1,1,()=>{c=null}),J())},i(f){l||(C(c),l=!0)},o(f){N(c),l=!1},d(f){f&&k(t),f&&k(r),c&&c.d(f),f&&k(o),s=!1,a()}}}function kn(e){let t,n,i,r;return{c(){var o;t=S("input"),t.value=n=(o=e[0])==null?void 0:o.value,A(t,"spellcheck",!1),A(t,"class","svelte-jmvim5")},m(o,l){E(o,t,l),e[6](t),i||(r=F(t,"keyup",e[4]),i=!0)},p(o,l){var s;l&1&&n!==(n=(s=o[0])==null?void 0:s.value)&&t.value!==n&&(t.value=n)},i:L,o:L,d(o){o&&k(t),e[6](null),i=!1,r()}}}function ft(e){let t,n;return t=new oe({props:{className:"verified-mark",src:vn}}),{c(){Q(t.$$.fragment)},m(i,r){K(t,i,r),n=!0},p:L,i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){Y(t,i)}}}function wn(e){let t,n,i,r;const o=[kn,yn],l=[];function s(a,c){return a[1]?0:1}return t=s(e),n=l[t]=o[t](e),{c(){n.c(),i=ce()},m(a,c){l[t].m(a,c),E(a,i,c),r=!0},p(a,[c]){let d=t;t=s(a),t===d?l[t].p(a,c):(G(),N(l[d],1,1,()=>{l[d]=null}),J(),n=l[t],n?n.p(a,c):(n=l[t]=o[t](a),n.c()),C(n,1),n.m(i.parentNode,i))},i(a){r||(C(n),r=!0)},o(a){N(n),r=!1},d(a){l[t].d(a),a&&k(i)}}}function En(e,t,n){const i=Le();let{transcription:r}=t,{isEditable:o}=t,{isVerified:l}=t,s;const a=f=>{const{value:u}=s;f.key==="Enter"?i("save"):f.key==="Escape"?i("cancel"):i("change",u)};function c(f){en.call(this,e,f)}function d(f){Pe[f?"unshift":"push"](()=>{s=f,n(3,s)})}return e.$$set=f=>{"transcription"in f&&n(0,r=f.transcription),"isEditable"in f&&n(1,o=f.isEditable),"isVerified"in f&&n(2,l=f.isVerified)},e.$$.update=()=>{e.$$.dirty&10&&o&&tn().then(()=>{bn(s),s.focus(),s.select()})},[r,o,l,s,a,c,d]}class Cn extends he{constructor(t){super(),me(this,t,En,wn,se,{transcription:0,isEditable:1,isVerified:2})}}function An(e){const t=e-1;return t*t*t+1}function ut(e,{delay:t=0,duration:n=400,easing:i=An}={}){const r=getComputedStyle(e),o=+r.opacity,l=parseFloat(r.height),s=parseFloat(r.paddingTop),a=parseFloat(r.paddingBottom),c=parseFloat(r.marginTop),d=parseFloat(r.marginBottom),f=parseFloat(r.borderTopWidth),u=parseFloat(r.borderBottomWidth);return{delay:t,duration:n,easing:i,css:p=>`overflow: hidden;opacity: ${Math.min(p*20,1)*o};height: ${p*l}px;padding-top: ${p*s}px;padding-bottom: ${p*a}px;margin-top: ${p*c}px;margin-bottom: ${p*d}px;border-top-width: ${p*f}px;border-bottom-width: ${p*u}px;`}}var Sn=["second","minute","hour","day","week","month","year"];function Nn(e,t){if(t===0)return["just now","right now"];var n=Sn[Math.floor(t/2)];return e>1&&(n+="s"),[e+" "+n+" ago","in "+e+" "+n]}var Tn=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function Ln(e,t){if(t===0)return["\u521A\u521A","\u7247\u523B\u540E"];var n=Tn[~~(t/2)];return[e+" "+n+"\u524D",e+" "+n+"\u540E"]}var Re={},dt=function(e,t){Re[e]=t},Pn=function(e){return Re[e]||Re.en_US},Fe=[60,60,24,7,365/7/12,12];function pt(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function Mn(e,t){var n=e<0?1:0;e=Math.abs(e);for(var i=e,r=0;e>=Fe[r]&&r<Fe.length;r++)e/=Fe[r];return e=Math.floor(e),r*=2,e>(r===0?9:1)&&(r+=1),t(e,r,i)[n].replace("%s",e.toString())}function Dn(e,t){var n=t?pt(t):new Date;return(+n-+pt(e))/1e3}var mt=function(e,t,n){var i=Dn(e,n&&n.relativeDate);return Mn(i,Pn(t))};dt("en_US",Nn),dt("zh_CN",Ln);const li="";function ht(e,t,n){const i=e.slice();return i[2]=t[n],i}function _t(e){let t,n,i,r=e[0],o=[];for(let s=0;s<r.length;s+=1)o[s]=gt(ht(e,r,s));const l=s=>N(o[s],1,1,()=>{o[s]=null});return{c(){t=S("ul");for(let s=0;s<o.length;s+=1)o[s].c();A(t,"class","all-transcriptions svelte-f8q5bo")},m(s,a){E(s,t,a);for(let c=0;c<o.length;c+=1)o[c].m(t,null);i=!0},p(s,a){if(a&1){r=s[0];let c;for(c=0;c<r.length;c+=1){const d=ht(s,r,c);o[c]?(o[c].p(d,a),C(o[c],1)):(o[c]=gt(d),o[c].c(),C(o[c],1),o[c].m(t,null))}for(G(),c=r.length;c<o.length;c+=1)l(c);J()}},i(s){if(!i){for(let a=0;a<r.length;a+=1)C(o[a]);de(()=>{n||(n=lt(t,ut,{duration:120},!0)),n.run(1)}),i=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)N(o[a]);n||(n=lt(t,ut,{duration:120},!1)),n.run(0),i=!1},d(s){s&&k(t),Kt(o,s),s&&n&&n.end()}}}function $n(e){let t=e[2].creator.name+"",n;return{c(){n=M(t)},m(i,r){E(i,n,r)},p(i,r){r&1&&t!==(t=i[2].creator.name+"")&&te(n,t)},i:L,o:L,d(i){i&&k(n)}}}function Bn(e){let t,n,i;return t=new oe({props:{src:at}}),{c(){Q(t.$$.fragment),n=M(" mapKurator")},m(r,o){K(t,r,o),E(r,n,o),i=!0},p:L,i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){N(t.$$.fragment,r),i=!1},d(r){Y(t,r),r&&k(n)}}}function gt(e){let t,n=e[2].value+"",i,r,o,l=mt(e[2].created)+"",s,a,c,d,f,u;const p=[Bn,$n],m=[];function _(b,g){var v;return((v=b[2].creator)==null?void 0:v.type)==="Software"?0:1}return c=_(e),d=m[c]=p[c](e),{c(){t=S("li"),i=M(n),r=V(),o=S("span"),s=M(l),a=M(" by "),d.c(),f=V(),A(o,"class","transcribed-by"),A(t,"class","svelte-f8q5bo")},m(b,g){E(b,t,g),w(t,i),w(t,r),w(t,o),w(o,s),w(o,a),m[c].m(o,null),w(t,f),u=!0},p(b,g){(!u||g&1)&&n!==(n=b[2].value+"")&&te(i,n),(!u||g&1)&&l!==(l=mt(b[2].created)+"")&&te(s,l);let v=c;c=_(b),c===v?m[c].p(b,g):(G(),N(m[v],1,1,()=>{m[v]=null}),J(),d=m[c],d?d.p(b,g):(d=m[c]=p[c](b),d.c()),C(d,1),d.m(o,null))},i(b){u||(C(d),u=!0)},o(b){N(d),u=!1},d(b){b&&k(t),m[c].d()}}}function Hn(e){let t,n,i=e[1]&&_t(e);return{c(){i&&i.c(),t=ce()},m(r,o){i&&i.m(r,o),E(r,t,o),n=!0},p(r,[o]){r[1]?i?(i.p(r,o),o&2&&C(i,1)):(i=_t(r),i.c(),C(i,1),i.m(t.parentNode,t)):i&&(G(),N(i,1,1,()=>{i=null}),J())},i(r){n||(C(i),n=!0)},o(r){N(i),n=!1},d(r){i&&i.d(r),r&&k(t)}}}function jn(e,t,n){let{transcriptions:i}=t,{open:r}=t;return e.$$set=o=>{"transcriptions"in o&&n(0,i=o.transcriptions),"open"in o&&n(1,r=o.open)},[i,r]}class Vn extends he{constructor(t){super(),me(this,t,jn,Hn,se,{transcriptions:0,open:1})}}const zn={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path>'},si="";function Rn(e){let t;return{c(){t=M("Confirm Delete")},m(n,i){E(n,t,i)},p:L,d(n){n&&k(t)}}}function Fn(e){let t=e[0].deletePromptHeading+"",n;return{c(){n=M(t)},m(i,r){E(i,n,r)},p(i,r){r&1&&t!==(t=i[0].deletePromptHeading+"")&&te(n,t)},d(i){i&&k(n)}}}function On(e){let t;return{c(){t=M("Are you sure you want to delete this transcription?")},m(n,i){E(n,t,i)},p:L,d(n){n&&k(t)}}}function Un(e){let t=e[0].deletePromptText+"",n;return{c(){n=M(t)},m(i,r){E(i,n,r)},p(i,r){r&1&&t!==(t=i[0].deletePromptText+"")&&te(n,t)},d(i){i&&k(n)}}}function Zn(e){let t,n,i,r,o,l,s,a,c,d,f,u,p,m,_,b;r=new oe({props:{src:zn}});function g(D,U){return D[0].deletePromptHeading?Fn:Rn}let v=g(e),h=v(e);function T(D,U){return D[0].deletePromptText?Un:On}let O=T(e),H=O(e);return{c(){t=S("div"),n=S("div"),i=S("button"),Q(r.$$.fragment),o=V(),l=S("h1"),h.c(),s=V(),a=S("p"),H.c(),c=V(),d=S("div"),f=S("button"),f.textContent="Cancel",u=V(),p=S("button"),p.textContent="Delete",A(i,"class","close svelte-8tsm9c"),A(l,"class","svelte-8tsm9c"),A(a,"class","svelte-8tsm9c"),A(f,"class","cancel svelte-8tsm9c"),A(p,"class","delete svelte-8tsm9c"),A(d,"class","buttons svelte-8tsm9c"),A(n,"class","modal svelte-8tsm9c"),A(t,"class","modal-wrapper svelte-8tsm9c")},m(D,U){E(D,t,U),w(t,n),w(n,i),K(r,i,null),w(n,o),w(n,l),h.m(l,null),w(n,s),w(n,a),H.m(a,null),w(n,c),w(n,d),w(d,f),w(d,u),w(d,p),m=!0,_||(b=[F(i,"click",e[2]),F(f,"click",e[2]),F(p,"click",e[1])],_=!0)},p(D,[U]){v===(v=g(D))&&h?h.p(D,U):(h.d(1),h=v(D),h&&(h.c(),h.m(l,null))),O===(O=T(D))&&H?H.p(D,U):(H.d(1),H=O(D),H&&(H.c(),H.m(a,null)))},i(D){m||(C(r.$$.fragment,D),m=!0)},o(D){N(r.$$.fragment,D),m=!1},d(D){D&&k(t),Y(r),h.d(),H.d(),_=!1,ee(b)}}}function In(e,t,n){let{opts:i}=t;const r=Le(),o=()=>r("delete"),l=()=>r("cancel");return e.$$set=s=>{"opts"in s&&n(0,i=s.opts)},[i,o,l]}class Wn extends he{constructor(t){super(),me(this,t,In,Zn,se,{opts:0})}}const Kn=e=>(e.body?Array.isArray(e.body)?e.body:[e.body]:[]).filter(i=>!i.purpose||i.purpose==="transcribing").slice().sort((i,r)=>i.created<r.created?1:-1),Yn=e=>{let t;const n=e.slice().sort((r,o)=>r.created<o.created?1:-1),i=n.filter(r=>{var o;return((o=r.creator)==null?void 0:o.type)==="Person"});if(i.length>0)t=i[0];else{const r=n.find(o=>{var l,s;return((l=o.creator)==null?void 0:l.type)==="Software"&&((s=o.creator)==null?void 0:s.name)==="mapKurator:ocr"});r?t=r:t=n.length>0?n[0]:null}return t},qn=e=>{var t,n;return((t=e.creator)==null?void 0:t.type)==="Software"&&((n=e.creator)==null?void 0:n.name)=="mapKurator:ocr"},Xn=e=>{const n=(e.body?Array.isArray(e.body)?e.body:[e.body]:[]).find(i=>i.purpose==="verifying");return Boolean(n)},ci="";function Gn(e){let t,n,i,r,o=e[2].length-1+"",l,s,a,c,d,f,u,p;i=new oe({props:{src:pn}});let m=!e[1].readOnly&&bt(e);return d=new Vn({props:{open:e[4],transcriptions:e[2]}}),{c(){t=S("p"),n=S("button"),Q(i.$$.fragment),r=V(),l=M(o),s=M(" more transcriptions"),a=V(),m&&m.c(),c=V(),Q(d.$$.fragment),A(n,"class","show-all svelte-avjcue"),be(n,"open",e[4]),A(t,"class","transcription-details transcription-count svelte-avjcue")},m(_,b){E(_,t,b),w(t,n),K(i,n,null),w(n,r),w(n,l),w(n,s),w(t,a),m&&m.m(t,null),E(_,c,b),K(d,_,b),f=!0,u||(p=F(n,"click",e[18]),u=!0)},p(_,b){(!f||b&4)&&o!==(o=_[2].length-1+"")&&te(l,o),b&16&&be(n,"open",_[4]),_[1].readOnly?m&&(m.d(1),m=null):m?m.p(_,b):(m=bt(_),m.c(),m.m(t,null));const g={};b&16&&(g.open=_[4]),b&4&&(g.transcriptions=_[2]),d.$set(g)},i(_){f||(C(i.$$.fragment,_),C(d.$$.fragment,_),f=!0)},o(_){N(i.$$.fragment,_),N(d.$$.fragment,_),f=!1},d(_){_&&k(t),Y(i),m&&m.d(),_&&k(c),Y(d,_),u=!1,p()}}}function Jn(e){let t,n,i,r,o,l,s;const a=[xn,Qn],c=[];function d(u,p){var m;return p&64&&(i=null),i==null&&(i=!!qn(u[6])),i?0:(m=u[6].creator)!=null&&m.name?1:-1}~(r=d(e,-1))&&(o=c[r]=a[r](e));let f=!e[1].readOnly&&yt(e);return{c(){t=S("p"),n=M("Transcribed by "),o&&o.c(),l=ce(),f&&f.c(),A(t,"class","transcription-details transcribed-by svelte-avjcue")},m(u,p){E(u,t,p),w(t,n),~r&&c[r].m(t,null),w(t,l),f&&f.m(t,null),s=!0},p(u,p){let m=r;r=d(u,p),r===m?~r&&c[r].p(u,p):(o&&(G(),N(c[m],1,1,()=>{c[m]=null}),J()),~r?(o=c[r],o?o.p(u,p):(o=c[r]=a[r](u),o.c()),C(o,1),o.m(t,l)):o=null),u[1].readOnly?f&&(f.d(1),f=null):f?f.p(u,p):(f=yt(u),f.c(),f.m(t,null))},i(u){s||(C(o),s=!0)},o(u){N(o),s=!1},d(u){u&&k(t),~r&&c[r].d(),f&&f.d()}}}function bt(e){let t,n,i,r,o,l=!e[7]&&vt(e);return{c(){t=M(`\xB7 [ 
            `),n=S("button"),n.textContent="Edit",l&&l.c(),i=M(`
          ]`),A(n,"class","action add-transcription svelte-avjcue")},m(s,a){E(s,t,a),E(s,n,a),l&&l.m(s,a),E(s,i,a),r||(o=F(n,"click",e[12]),r=!0)},p(s,a){s[7]?l&&(l.d(1),l=null):l?l.p(s,a):(l=vt(s),l.c(),l.m(i.parentNode,i))},d(s){s&&k(t),s&&k(n),l&&l.d(s),s&&k(i),r=!1,o()}}}function vt(e){let t,n,i,r;return{c(){t=M("\xA0|\xA0"),n=S("button"),n.textContent="Confirm",A(n,"class","action confirm svelte-avjcue")},m(o,l){E(o,t,l),E(o,n,l),i||(r=F(n,"click",e[13]),i=!0)},p:L,d(o){o&&k(t),o&&k(n),i=!1,r()}}}function Qn(e){var r;let t=((r=e[6].creator)==null?void 0:r.name)+"",n,i;return{c(){n=M(t),i=V()},m(o,l){E(o,n,l),E(o,i,l)},p(o,l){var s;l&64&&t!==(t=((s=o[6].creator)==null?void 0:s.name)+"")&&te(n,t)},i:L,o:L,d(o){o&&k(n),o&&k(i)}}}function xn(e){let t,n,i;return t=new oe({props:{src:at}}),{c(){Q(t.$$.fragment),n=M(" mapKurator ")},m(r,o){K(t,r,o),E(r,n,o),i=!0},p:L,i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){N(t.$$.fragment,r),i=!1},d(r){Y(t,r),r&&k(n)}}}function yt(e){let t,n,i,r,o,l=!e[7]&&kt(e);return{c(){t=M(`\xB7 [ 
            `),n=S("button"),n.textContent="Edit",l&&l.c(),i=M(`
          ]`),A(n,"class","action add-transcription svelte-avjcue")},m(s,a){E(s,t,a),E(s,n,a),l&&l.m(s,a),E(s,i,a),r||(o=F(n,"click",e[12]),r=!0)},p(s,a){s[7]?l&&(l.d(1),l=null):l?l.p(s,a):(l=kt(s),l.c(),l.m(i.parentNode,i))},d(s){s&&k(t),s&&k(n),l&&l.d(s),s&&k(i),r=!1,o()}}}function kt(e){let t,n,i,r;return{c(){t=M("\xA0|\xA0"),n=S("button"),n.textContent="Confirm",A(n,"class","action confirm svelte-avjcue")},m(o,l){E(o,t,l),E(o,n,l),i||(r=F(n,"click",e[13]),i=!0)},p:L,d(o){o&&k(t),o&&k(n),i=!1,r()}}}function wt(e){let t,n,i,r,o,l,s,a,c,d,f,u;return r=new oe({props:{src:dn}}),{c(){t=S("div"),n=S("div"),i=S("button"),Q(r.$$.fragment),o=V(),l=S("div"),s=S("button"),s.textContent="Cancel",a=V(),c=S("button"),c.textContent="Save Edits",A(i,"class","delete svelte-avjcue"),A(n,"class","left"),A(s,"class","cancel svelte-avjcue"),A(c,"class","ok svelte-avjcue"),A(l,"class","right-slot"),A(t,"class","r8s-hover-buttons svelte-avjcue")},m(p,m){E(p,t,m),w(t,n),w(n,i),K(r,i,null),w(t,o),w(t,l),w(l,s),w(l,a),w(l,c),d=!0,f||(u=[F(i,"click",e[19]),F(s,"click",e[10]),F(c,"click",e[9])],f=!0)},p:L,i(p){d||(C(r.$$.fragment,p),d=!0)},o(p){N(r.$$.fragment,p),d=!1},d(p){p&&k(t),Y(r),f=!1,ee(u)}}}function Et(e){let t,n;return t=new Wn({props:{opts:e[1]}}),t.$on("cancel",e[20]),t.$on("delete",e[11]),{c(){Q(t.$$.fragment)},m(i,r){K(t,i,r),n=!0},p(i,r){const o={};r&2&&(o.opts=i[1]),t.$set(o)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){Y(t,i)}}}function ei(e){let t,n,i,r,o,l,s,a,c,d,f,u,p;i=new Cn({props:{isEditable:e[1].readOnly?!1:e[3],isVerified:e[7],transcription:e[6]}}),i.$on("click",e[17]),i.$on("change",e[8]),i.$on("save",e[9]),i.$on("cancel",e[10]);const m=[Jn,Gn],_=[];function b(h,T){return h[2].length===1?0:h[2].length>1?1:-1}~(o=b(e))&&(l=_[o]=m[o](e));let g=e[3]&&wt(e),v=e[5]&&Et(e);return{c(){t=S("div"),n=S("div"),Q(i.$$.fragment),r=V(),l&&l.c(),s=V(),g&&g.c(),c=V(),v&&v.c(),d=ce(),A(n,"class","r8s-hover-content svelte-avjcue"),A(t,"class","r8s-hover svelte-avjcue"),A(t,"style",a=`top: ${e[0].offsetY}px; left: ${e[0].offsetX}px`),be(t,"editable",e[3])},m(h,T){E(h,t,T),w(t,n),K(i,n,null),w(n,r),~o&&_[o].m(n,null),w(t,s),g&&g.m(t,null),E(h,c,T),v&&v.m(h,T),E(h,d,T),f=!0,u||(p=Ot(an.call(null,t)),u=!0)},p(h,[T]){const O={};T&10&&(O.isEditable=h[1].readOnly?!1:h[3]),T&128&&(O.isVerified=h[7]),T&64&&(O.transcription=h[6]),i.$set(O);let H=o;o=b(h),o===H?~o&&_[o].p(h,T):(l&&(G(),N(_[H],1,1,()=>{_[H]=null}),J()),~o?(l=_[o],l?l.p(h,T):(l=_[o]=m[o](h),l.c()),C(l,1),l.m(n,null)):l=null),h[3]?g?(g.p(h,T),T&8&&C(g,1)):(g=wt(h),g.c(),C(g,1),g.m(t,null)):g&&(G(),N(g,1,1,()=>{g=null}),J()),(!f||T&1&&a!==(a=`top: ${h[0].offsetY}px; left: ${h[0].offsetX}px`))&&A(t,"style",a),T&8&&be(t,"editable",h[3]),h[5]?v?(v.p(h,T),T&32&&C(v,1)):(v=Et(h),v.c(),C(v,1),v.m(d.parentNode,d)):v&&(G(),N(v,1,1,()=>{v=null}),J())},i(h){f||(C(i.$$.fragment,h),C(l),C(g),C(v),f=!0)},o(h){N(i.$$.fragment,h),N(l),N(g),N(v),f=!1},d(h){h&&k(t),Y(i),~o&&_[o].d(),g&&g.d(),h&&k(c),v&&v.d(h),h&&k(d),u=!1,p()}}}function ti(e,t,n){let i,r,o;const l=Le();let{annotation:s}=t,{originalEvent:a}=t,{env:c}=t,{opts:d}=t,f=!1,u=!1,p=s,m=!1;const _=$=>{const W=Array.isArray(p.body)?p.body:[p.body],q={type:"TextualBody",purpose:"transcribing",value:$.detail,creator:{type:"Person",name:"displayName"in c.currentUser?c.currentUser.displayName:c.currentUser.id},created:c.getCurrentTimeAdjusted()};n(14,s={...p,body:[...W,q]})},b=()=>{l("save",s),n(16,p=s),n(3,f=!1)},g=()=>{l("cancel",s),n(14,s=p),n(3,f=!1)},v=()=>l("delete"),h=()=>{n(3,f=!0),l("edit")},T=()=>{const $=Array.isArray(p.body)?p.body:[p.body],W={type:"TextualBody",purpose:"verifying",value:r==null?void 0:r.value,creator:{type:"Person",name:"displayName"in c.currentUser?c.currentUser.displayName:c.currentUser.id}},q={...p,body:[...$,W]};n(16,p=q),n(3,f=!1),l("confirm",q)},O=()=>n(4,u=!u),H=()=>n(4,u=!u),D=()=>n(5,m=!0),U=()=>n(5,m=!1);return e.$$set=$=>{"annotation"in $&&n(14,s=$.annotation),"originalEvent"in $&&n(0,a=$.originalEvent),"env"in $&&n(15,c=$.env),"opts"in $&&n(1,d=$.opts)},e.$$.update=()=>{e.$$.dirty&65536&&n(2,i=Kn(p)),e.$$.dirty&4&&n(6,r=Yn(i)),e.$$.dirty&65536&&n(7,o=Xn(p))},[a,d,i,f,u,m,r,o,_,b,g,v,h,T,s,c,p,O,H,D,U]}class ni extends he{constructor(t){super(),me(this,t,ti,ei,se,{annotation:14,originalEvent:0,env:15,opts:1})}}class ii{constructor(t,n={}){this.showPopup=(i,r)=>{this.popup&&this.hidePopup(),this.popup=new ni({target:document.body,props:{annotation:i,originalEvent:r,env:this.anno.env,opts:this.opts}}),this.popup.$on("confirm",o=>{this.isEditing=!1,this.hidePopup(),this.anno.updateAnnotation(o.detail.id,o.detail)}),this.popup.$on("save",o=>{this.isEditing=!1,this.hidePopup();const l=this.anno.getAnnotationById(i.id),s={...o.detail,target:{...l.target}};this.anno.updateAnnotation(o.detail.id,s)}),this.popup.$on("cancel",()=>{this.isEditing=!1,this.hidePopup(),this.anno.deselectAll()}),this.popup.$on("edit",()=>{this.isEditing=!0,this.anno.selectAnnotation(i)}),this.popup.$on("delete",()=>{this.isEditing=!1,this.hidePopup(),this.anno.removeAnnotation(i)})},this.hidePopup=()=>{this.popup&&(this.popup.$destroy(),this.popup=null)},this.anno=t,this.opts=n,t.on("pointerdown",(i,r)=>{this.isEditing||(i?this.showPopup(i,r):this.hidePopup())}),document.addEventListener("keydown",i=>{i.key==="Escape"&&(this.isEditing=!1,this.hidePopup(),this.anno.deselectAll())})}}const ai="";return ii});
//# sourceMappingURL=luna-annotorious.js.map
