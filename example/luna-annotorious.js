(function(C,ee){typeof exports=="object"&&typeof module<"u"?module.exports=ee():typeof define=="function"&&define.amd?define(ee):(C=typeof globalThis<"u"?globalThis:C||self,C.LunaAnnotorious=ee())})(this,function(){"use strict";function C(){}const ee=e=>e;function zt(e,t){for(const n in t)e[n]=t[n];return e}function Ue(e){return e()}function Ke(){return Object.create(null)}function K(e){e.forEach(Ue)}function Ce(e){return typeof e=="function"}function ue(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Bt(e){return Object.keys(e).length===0}function Rt(e){return e&&Ce(e.destroy)?e.destroy:C}const Ye=typeof window<"u";let qt=Ye?()=>window.performance.now():()=>Date.now(),Se=Ye?e=>requestAnimationFrame(e):C;const J=new Set;function Xe(e){J.forEach(t=>{t.c(e)||(J.delete(t),t.f())}),J.size!==0&&Se(Xe)}function Vt(e){let t;return J.size===0&&Se(Xe),{promise:new Promise(n=>{J.add(t={c:e,f:n})}),abort(){J.delete(t)}}}function w(e,t){e.appendChild(t)}function Ge(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function Ft(e){const t=L("style");return Ot(Ge(e),t),t.sheet}function Ot(e,t){w(e.head||e,t)}function k(e,t,n){e.insertBefore(t,n||null)}function y(e){e.parentNode.removeChild(e)}function jt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function L(e){return document.createElement(e)}function It(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function M(e){return document.createTextNode(e)}function q(){return M(" ")}function fe(){return M("")}function O(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function A(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xe(e,t){for(const n in t)A(e,n,t[n])}function Wt(e){return Array.from(e.childNodes)}function Q(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function de(e,t,n){e.classList[n?"add":"remove"](t)}function Je(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,r,t),i}const pe=new Map;let he=0;function Zt(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function Ut(e,t){const n={stylesheet:Ft(t),rules:{}};return pe.set(e,n),n}function Qe(e,t,n,r,i,o,l,a=0){const c=16.666/r;let s=`{
`;for(let h=0;h<=1;h+=c){const _=t+(n-t)*o(h);s+=h*100+`%{${l(_,1-_)}}
`}const u=s+`100% {${l(n,1-n)}}
}`,m=`__svelte_${Zt(u)}_${a}`,f=Ge(e),{stylesheet:d,rules:p}=pe.get(f)||Ut(f,e);p[m]||(p[m]=!0,d.insertRule(`@keyframes ${m} ${u}`,d.cssRules.length));const g=e.style.animation||"";return e.style.animation=`${g?`${g}, `:""}${m} ${r}ms linear ${i}ms 1 both`,he+=1,m}function Kt(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?o=>o.indexOf(t)<0:o=>o.indexOf("__svelte")===-1),i=n.length-r.length;i&&(e.style.animation=r.join(", "),he-=i,he||Yt())}function Yt(){Se(()=>{he||(pe.forEach(e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}}),pe.clear())})}let te;function ne(e){te=e}function Xt(){if(!te)throw new Error("Function called outside component initialization");return te}function et(){const e=Xt();return(t,n,{cancelable:r=!1}={})=>{const i=e.$$.callbacks[t];if(i){const o=Je(t,n,{cancelable:r});return i.slice().forEach(l=>{l.call(e,o)}),!o.defaultPrevented}return!0}}function Gt(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const re=[],Ae=[],me=[],tt=[],nt=Promise.resolve();let Te=!1;function rt(){Te||(Te=!0,nt.then(it))}function xt(){return rt(),nt}function ie(e){me.push(e)}const Ne=new Set;let ge=0;function it(){const e=te;do{for(;ge<re.length;){const t=re[ge];ge++,ne(t),Jt(t.$$)}for(ne(null),re.length=0,ge=0;Ae.length;)Ae.pop()();for(let t=0;t<me.length;t+=1){const n=me[t];Ne.has(n)||(Ne.add(n),n())}me.length=0}while(re.length);for(;tt.length;)tt.pop()();Te=!1,Ne.clear(),ne(e)}function Jt(e){if(e.fragment!==null){e.update(),K(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ie)}}let oe;function Qt(){return oe||(oe=Promise.resolve(),oe.then(()=>{oe=null})),oe}function Le(e,t,n){e.dispatchEvent(Je(`${t?"intro":"outro"}${n}`))}const _e=new Set;let V;function j(){V={r:0,c:[],p:V}}function I(){V.r||K(V.c),V=V.p}function v(e,t){e&&e.i&&(_e.delete(e),e.i(t))}function S(e,t,n,r){if(e&&e.o){if(_e.has(e))return;_e.add(e),V.c.push(()=>{_e.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}const en={duration:0};function ot(e,t,n,r){let i=t(e,n),o=r?0:1,l=null,a=null,c=null;function s(){c&&Kt(e,c)}function u(f,d){const p=f.b-o;return d*=Math.abs(p),{a:o,b:f.b,d:p,duration:d,start:f.start,end:f.start+d,group:f.group}}function m(f){const{delay:d=0,duration:p=300,easing:g=ee,tick:h=C,css:_}=i||en,T={start:qt()+d,b:f};f||(T.group=V,V.r+=1),l||a?a=T:(_&&(s(),c=Qe(e,o,f,p,d,g,_)),f&&h(0,1),l=u(T,p),ie(()=>Le(e,f,"start")),Vt($=>{if(a&&$>a.start&&(l=u(a,p),a=null,Le(e,l.b,"start"),_&&(s(),c=Qe(e,o,l.b,l.duration,0,g,i.css))),l){if($>=l.end)h(o=l.b,1-o),Le(e,l.b,"end"),a||(l.b?s():--l.group.r||K(l.group.c)),l=null;else if($>=l.start){const D=$-l.start;o=l.a+l.d*g(D/l.duration),h(o,1-o)}}return!!(l||a)}))}return{run(f){Ce(i)?Qt().then(()=>{i=i(),m(f)}):m(f)},end(){s(),l=a=null}}}function tn(e,t){const n={},r={},i={$$scope:1};let o=e.length;for(;o--;){const l=e[o],a=t[o];if(a){for(const c in l)c in a||(r[c]=1);for(const c in a)i[c]||(n[c]=a[c],i[c]=1);e[o]=a}else for(const c in l)i[c]=1}for(const l in r)l in n||(n[l]=void 0);return n}function Y(e){e&&e.c()}function W(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:l,after_update:a}=e.$$;i&&i.m(t,n),r||ie(()=>{const c=o.map(Ue).filter(Ce);l?l.push(...c):K(c),e.$$.on_mount=[]}),a.forEach(ie)}function Z(e,t){const n=e.$$;n.fragment!==null&&(K(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function nn(e,t){e.$$.dirty[0]===-1&&(re.push(e),rt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function be(e,t,n,r,i,o,l,a=[-1]){const c=te;ne(e);const s=e.$$={fragment:null,ctx:null,props:o,update:C,not_equal:i,bound:Ke(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:Ke(),dirty:a,skip_bound:!1,root:t.target||c.$$.root};l&&l(s.root);let u=!1;if(s.ctx=n?n(e,t.props||{},(m,f,...d)=>{const p=d.length?d[0]:f;return s.ctx&&i(s.ctx[m],s.ctx[m]=p)&&(!s.skip_bound&&s.bound[m]&&s.bound[m](p),u&&nn(e,m)),f}):[],s.update(),u=!0,K(s.before_update),s.fragment=r?r(s.ctx):!1,t.target){if(t.hydrate){const m=Wt(t.target);s.fragment&&s.fragment.l(m),m.forEach(y)}else s.fragment&&s.fragment.c();t.intro&&v(e.$$.fragment),W(e,t.target,t.anchor,t.customElement),it()}ne(c)}class ve{$destroy(){Z(this,1),this.$destroy=C}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!Bt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var Me={dragStart:!0},lt=(e,t,n)=>Math.min(Math.max(e,t),n),Pe=e=>typeof e=="string",rn=([e,t],n,r)=>{const i=(o,l)=>l===0?0:Math.ceil(o/l)*l;return[i(n,e),i(r,t)]},st=(e,t)=>e.some(n=>t.some(r=>n.contains(r)));function $e(e,t){if(e===void 0)return;if(De(e))return e.getBoundingClientRect();if(typeof e=="object"){const{top:r=0,left:i=0,right:o=0,bottom:l=0}=e;return{top:r,right:window.innerWidth-o,bottom:window.innerHeight-l,left:i}}if(e==="parent")return t.parentNode.getBoundingClientRect();const n=document.querySelector(e);if(n===null)throw new Error("The selector provided for bound doesn't exists in the document.");return n.getBoundingClientRect()}var ye=(e,t,n)=>e.style.setProperty(t,n),De=e=>e instanceof HTMLElement,on=(e,t={})=>{var At,Tt;let n,r,{bounds:i,axis:o="both",gpuAcceleration:l=!0,legacyTranslate:a=!0,transform:c,applyUserSelectHack:s=!0,disabled:u=!1,ignoreMultitouch:m=!1,recomputeBounds:f=Me,grid:d,position:p,cancel:g,handle:h,defaultClass:_="neodrag",defaultClassDragging:T="neodrag-dragging",defaultClassDragged:$="neodrag-dragged",defaultPosition:D={x:0,y:0},onDragStart:Re,onDrag:qe,onDragEnd:Zn}=t,we=!1,X=0,G=0,se=0,ae=0,Ve=0,Fe=0,{x:ke,y:Ee}=p?{x:(At=p==null?void 0:p.x)!=null?At:0,y:(Tt=p==null?void 0:p.y)!=null?Tt:0}:D;Ie(ke,Ee);let F,x,ce,Oe,yt,wt="",Un=!!p;f={...Me,...f};const je=document.body.style,U=e.classList;function Ie(b=X,N=G){if(!c){if(a){let B=`${+b}px, ${+N}px`;return ye(e,"transform",l?`translate3d(${B}, 0)`:`translate(${B})`)}return ye(e,"translate",`${+b}px ${+N}px ${l?"1px":""}`)}const P=c({offsetX:b,offsetY:N,rootNode:e});Pe(P)&&ye(e,"transform",P)}const We=(b,N)=>{const P={offsetX:X,offsetY:G,rootNode:e,currentNode:yt};e.dispatchEvent(new CustomEvent(b,{detail:P})),N==null||N(P)},Ze=addEventListener;Ze("pointerdown",Et,!1),Ze("pointerup",Ct,!1),Ze("pointermove",St,!1),ye(e,"touch-action","none");const kt=()=>{let b=e.offsetWidth/x.width;return isNaN(b)&&(b=1),b};function Et(b){if(u||b.button===2||m&&!b.isPrimary)return;if(f.dragStart&&(F=$e(i,e)),Pe(h)&&Pe(g)&&h===g)throw new Error("`handle` selector can't be same as `cancel` selector");if(U.add(_),ce=function(E,z){if(!E)return[z];if(De(E))return[E];if(Array.isArray(E))return E;const R=z.querySelectorAll(E);if(R===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(R.values())}(h,e),Oe=function(E,z){if(!E)return[];if(De(E))return[E];if(Array.isArray(E))return E;const R=z.querySelectorAll(E);if(R===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(R.values())}(g,e),n=/(both|x)/.test(o),r=/(both|y)/.test(o),st(Oe,ce))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const N=b.composedPath()[0];if(!ce.some(E=>{var z;return E.contains(N)||((z=E.shadowRoot)==null?void 0:z.contains(N))})||st(Oe,[N]))return;yt=ce.length===1?e:ce.find(E=>E.contains(N)),we=!0,x=e.getBoundingClientRect(),s&&(wt=je.userSelect,je.userSelect="none"),We("neodrag:start",Re);const{clientX:P,clientY:B}=b,H=kt();n&&(se=P-ke/H),r&&(ae=B-Ee/H),F&&(Ve=P-x.left,Fe=B-x.top)}function Ct(){we&&(f.dragEnd&&(F=$e(i,e)),U.remove(T),U.add($),s&&(je.userSelect=wt),We("neodrag:end",Zn),n&&(se=X),r&&(ae=G),we=!1)}function St(b){if(!we)return;f.drag&&(F=$e(i,e)),U.add(T),b.preventDefault(),x=e.getBoundingClientRect();let N=b.clientX,P=b.clientY;const B=kt();if(F){const H={left:F.left+Ve,top:F.top+Fe,right:F.right+Ve-x.width,bottom:F.bottom+Fe-x.height};N=lt(N,H.left,H.right),P=lt(P,H.top,H.bottom)}if(Array.isArray(d)){let[H,E]=d;if(isNaN(+H)||H<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+E)||E<0)throw new Error("2nd argument of `grid` must be a valid positive number");let z=N-se,R=P-ae;[z,R]=rn([H/B,E/B],z,R),N=se+z,P=ae+R}n&&(X=Math.round((N-se)*B)),r&&(G=Math.round((P-ae)*B)),ke=X,Ee=G,We("neodrag",qe),Ie()}return{destroy:()=>{const b=removeEventListener;b("pointerdown",Et,!1),b("pointerup",Ct,!1),b("pointermove",St,!1)},update:b=>{var P,B,H,E,z,R,Nt,Lt,Mt,Pt,$t,Dt,Ht;o=b.axis||"both",u=(P=b.disabled)!=null?P:!1,m=(B=b.ignoreMultitouch)!=null?B:!1,h=b.handle,i=b.bounds,f=(H=b.recomputeBounds)!=null?H:Me,g=b.cancel,s=(E=b.applyUserSelectHack)!=null?E:!0,d=b.grid,l=(z=b.gpuAcceleration)!=null?z:!0,a=(R=b.legacyTranslate)!=null?R:!0,c=b.transform;const N=U.contains($);U.remove(_,$),_=(Nt=b.defaultClass)!=null?Nt:"neodrag",T=(Lt=b.defaultClassDragging)!=null?Lt:"neodrag-dragging",$=(Mt=b.defaultClassDragged)!=null?Mt:"neodrag-dragged",U.add(_),N&&U.add($),Un&&(ke=X=($t=(Pt=b.position)==null?void 0:Pt.x)!=null?$t:X,Ee=G=(Ht=(Dt=b.position)==null?void 0:Dt.y)!=null?Ht:G,Ie())}}};function ln(e){let t,n=[{width:e[1]},{height:e[1]},{"stroke-width":"0"},{class:e[2]},e[0].a,e[4],{xmlns:"http://www.w3.org/2000/svg"}],r={};for(let i=0;i<n.length;i+=1)r=zt(r,n[i]);return{c(){t=It("svg"),xe(t,r)},m(i,o){k(i,t,o),t.innerHTML=e[3]},p(i,[o]){o&8&&(t.innerHTML=i[3]),xe(t,r=tn(n,[o&2&&{width:i[1]},o&2&&{height:i[1]},{"stroke-width":"0"},o&4&&{class:i[2]},o&1&&i[0].a,o&16&&i[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:C,o:C,d(i){i&&y(t)}}}function sn(e,t,n){let{src:r}=t,{size:i="1em"}=t,{color:o=void 0}=t,{title:l=void 0}=t,{className:a=""}=t,c,s;return e.$$set=u=>{"src"in u&&n(0,r=u.src),"size"in u&&n(1,i=u.size),"color"in u&&n(5,o=u.color),"title"in u&&n(6,l=u.title),"className"in u&&n(2,a=u.className)},e.$$.update=()=>{e.$$.dirty&33&&(n(4,s={}),o&&(r.a.stroke!=="none"&&n(4,s.stroke=o,s),r.a.fill!=="none"&&n(4,s.fill=o,s))),e.$$.dirty&65&&n(3,c=(l?`<title>${l}</title>`:"")+r.c)},[r,i,a,c,s,o,l]}class le extends ve{constructor(t){super(),be(this,t,sn,ln,ue,{src:0,size:1,color:5,title:6,className:2})}}const at={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'},an={a:{viewBox:"0 0 448 512"},c:'<path d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path>'},cn={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="6 9 12 15 18 9"></polyline>'};var He="__autosizeInputGhost",un={" ":"nbsp","<":"lt",">":"gt"};function fn(e){return"&"+un[e]+";"}function dn(e){return e.replace(/\s|<|>/g,fn)}function pn(){var e=document.createElement("div");return e.id=He,e.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(e),e}var hn=function(e,t){var n=window.getComputedStyle(e),r="box-sizing:"+n.boxSizing+";border-left:"+n.borderLeftWidth+" solid red;border-right:"+n.borderRightWidth+" solid red;font-family:"+n.fontFamily+";font-feature-settings:"+n.fontFeatureSettings+";font-kerning:"+n.fontKerning+";font-size:"+n.fontSize+";font-stretch:"+n.fontStretch+";font-style:"+n.fontStyle+";font-variant:"+n.fontVariant+";font-variant-caps:"+n.fontVariantCaps+";font-variant-ligatures:"+n.fontVariantLigatures+";font-variant-numeric:"+n.fontVariantNumeric+";font-weight:"+n.fontWeight+";letter-spacing:"+n.letterSpacing+";margin-left:"+n.marginLeft+";margin-right:"+n.marginRight+";padding-left:"+n.paddingLeft+";padding-right:"+n.paddingRight+";text-indent:"+n.textIndent+";text-transform:"+n.textTransform;function i(){var l=e.value||e.getAttribute("placeholder")||"",a=document.getElementById(He)||pn();a.style.cssText+=r,a.innerHTML=dn(l);var c=window.getComputedStyle(a).width;return e.style.width=c,c}e.addEventListener("input",i);var o=i();return t&&t.minWidth&&o!=="0px"&&(e.style.minWidth=o),function(){e.removeEventListener("input",i);var l=document.getElementById(He);l&&l.parentNode.removeChild(l)}};const mn={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'},Kn="";function gn(e){var u,m,f;let t,n=((u=e[0])==null?void 0:u.value)+"",r,i,o,l,a,c,s=((f=(m=e[0])==null?void 0:m.creator)==null?void 0:f.type)==="Person"&&ct();return{c(){t=L("span"),r=M(n),i=q(),s&&s.c(),o=fe(),A(t,"class","transcription svelte-jmvim5")},m(d,p){k(d,t,p),w(t,r),k(d,i,p),s&&s.m(d,p),k(d,o,p),l=!0,a||(c=O(t,"click",e[4]),a=!0)},p(d,p){var g,h,_;(!l||p&1)&&n!==(n=((g=d[0])==null?void 0:g.value)+"")&&Q(r,n),((_=(h=d[0])==null?void 0:h.creator)==null?void 0:_.type)==="Person"?s?(s.p(d,p),p&1&&v(s,1)):(s=ct(),s.c(),v(s,1),s.m(o.parentNode,o)):s&&(j(),S(s,1,1,()=>{s=null}),I())},i(d){l||(v(s),l=!0)},o(d){S(s),l=!1},d(d){d&&y(t),d&&y(i),s&&s.d(d),d&&y(o),a=!1,c()}}}function _n(e){let t,n,r,i;return{c(){var o;t=L("input"),t.value=n=(o=e[0])==null?void 0:o.value,A(t,"spellcheck",!1),A(t,"class","svelte-jmvim5")},m(o,l){k(o,t,l),e[5](t),r||(i=O(t,"keyup",e[3]),r=!0)},p(o,l){var a;l&1&&n!==(n=(a=o[0])==null?void 0:a.value)&&t.value!==n&&(t.value=n)},i:C,o:C,d(o){o&&y(t),e[5](null),r=!1,i()}}}function ct(e){let t,n;return t=new le({props:{className:"verified-mark",src:mn}}),{c(){Y(t.$$.fragment)},m(r,i){W(t,r,i),n=!0},p:C,i(r){n||(v(t.$$.fragment,r),n=!0)},o(r){S(t.$$.fragment,r),n=!1},d(r){Z(t,r)}}}function bn(e){let t,n,r,i;const o=[_n,gn],l=[];function a(c,s){return c[1]?0:1}return t=a(e),n=l[t]=o[t](e),{c(){n.c(),r=fe()},m(c,s){l[t].m(c,s),k(c,r,s),i=!0},p(c,[s]){let u=t;t=a(c),t===u?l[t].p(c,s):(j(),S(l[u],1,1,()=>{l[u]=null}),I(),n=l[t],n?n.p(c,s):(n=l[t]=o[t](c),n.c()),v(n,1),n.m(r.parentNode,r))},i(c){i||(v(n),i=!0)},o(c){S(n),i=!1},d(c){l[t].d(c),c&&y(r)}}}function vn(e,t,n){const r=et();let{transcription:i}=t,{isEditable:o}=t,l;const a=u=>{const{value:m}=l;u.key==="Enter"?r("save"):u.key==="Escape"?r("cancel"):r("change",m)};function c(u){Gt.call(this,e,u)}function s(u){Ae[u?"unshift":"push"](()=>{l=u,n(2,l)})}return e.$$set=u=>{"transcription"in u&&n(0,i=u.transcription),"isEditable"in u&&n(1,o=u.isEditable)},e.$$.update=()=>{e.$$.dirty&6&&o&&xt().then(()=>{hn(l),l.focus(),l.select()})},[i,o,l,a,c,s]}class yn extends ve{constructor(t){super(),be(this,t,vn,bn,ue,{transcription:0,isEditable:1})}}function wn(e){const t=e-1;return t*t*t+1}function ut(e,{delay:t=0,duration:n=400,easing:r=wn}={}){const i=getComputedStyle(e),o=+i.opacity,l=parseFloat(i.height),a=parseFloat(i.paddingTop),c=parseFloat(i.paddingBottom),s=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),f=parseFloat(i.borderBottomWidth);return{delay:t,duration:n,easing:r,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*o};height: ${d*l}px;padding-top: ${d*a}px;padding-bottom: ${d*c}px;margin-top: ${d*s}px;margin-bottom: ${d*u}px;border-top-width: ${d*m}px;border-bottom-width: ${d*f}px;`}}var kn=["second","minute","hour","day","week","month","year"];function En(e,t){if(t===0)return["just now","right now"];var n=kn[Math.floor(t/2)];return e>1&&(n+="s"),[e+" "+n+" ago","in "+e+" "+n]}var Cn=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function Sn(e,t){if(t===0)return["\u521A\u521A","\u7247\u523B\u540E"];var n=Cn[~~(t/2)];return[e+" "+n+"\u524D",e+" "+n+"\u540E"]}var ze={},ft=function(e,t){ze[e]=t},An=function(e){return ze[e]||ze.en_US},Be=[60,60,24,7,365/7/12,12];function dt(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function Tn(e,t){var n=e<0?1:0;e=Math.abs(e);for(var r=e,i=0;e>=Be[i]&&i<Be.length;i++)e/=Be[i];return e=Math.floor(e),i*=2,e>(i===0?9:1)&&(i+=1),t(e,i,r)[n].replace("%s",e.toString())}function Nn(e,t){var n=t?dt(t):new Date;return(+n-+dt(e))/1e3}var pt=function(e,t,n){var r=Nn(e,n&&n.relativeDate);return Tn(r,An(t))};ft("en_US",En),ft("zh_CN",Sn);const Yn="";function ht(e,t,n){const r=e.slice();return r[2]=t[n],r}function mt(e){let t,n,r,i=e[0],o=[];for(let a=0;a<i.length;a+=1)o[a]=gt(ht(e,i,a));const l=a=>S(o[a],1,1,()=>{o[a]=null});return{c(){t=L("ul");for(let a=0;a<o.length;a+=1)o[a].c();A(t,"class","all-transcriptions svelte-f8q5bo")},m(a,c){k(a,t,c);for(let s=0;s<o.length;s+=1)o[s].m(t,null);r=!0},p(a,c){if(c&1){i=a[0];let s;for(s=0;s<i.length;s+=1){const u=ht(a,i,s);o[s]?(o[s].p(u,c),v(o[s],1)):(o[s]=gt(u),o[s].c(),v(o[s],1),o[s].m(t,null))}for(j(),s=i.length;s<o.length;s+=1)l(s);I()}},i(a){if(!r){for(let c=0;c<i.length;c+=1)v(o[c]);ie(()=>{n||(n=ot(t,ut,{duration:120},!0)),n.run(1)}),r=!0}},o(a){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)S(o[c]);n||(n=ot(t,ut,{duration:120},!1)),n.run(0),r=!1},d(a){a&&y(t),jt(o,a),a&&n&&n.end()}}}function Ln(e){let t=e[2].creator.name+"",n;return{c(){n=M(t)},m(r,i){k(r,n,i)},p(r,i){i&1&&t!==(t=r[2].creator.name+"")&&Q(n,t)},i:C,o:C,d(r){r&&y(n)}}}function Mn(e){let t,n,r;return t=new le({props:{src:at}}),{c(){Y(t.$$.fragment),n=M(" mapKurator")},m(i,o){W(t,i,o),k(i,n,o),r=!0},p:C,i(i){r||(v(t.$$.fragment,i),r=!0)},o(i){S(t.$$.fragment,i),r=!1},d(i){Z(t,i),i&&y(n)}}}function gt(e){let t,n=e[2].value+"",r,i,o,l=pt(e[2].created)+"",a,c,s,u,m,f;const d=[Mn,Ln],p=[];function g(h,_){var T;return((T=h[2].creator)==null?void 0:T.type)==="Software"?0:1}return s=g(e),u=p[s]=d[s](e),{c(){t=L("li"),r=M(n),i=q(),o=L("span"),a=M(l),c=M(" by "),u.c(),m=q(),A(o,"class","transcribed-by"),A(t,"class","svelte-f8q5bo")},m(h,_){k(h,t,_),w(t,r),w(t,i),w(t,o),w(o,a),w(o,c),p[s].m(o,null),w(t,m),f=!0},p(h,_){(!f||_&1)&&n!==(n=h[2].value+"")&&Q(r,n),(!f||_&1)&&l!==(l=pt(h[2].created)+"")&&Q(a,l);let T=s;s=g(h),s===T?p[s].p(h,_):(j(),S(p[T],1,1,()=>{p[T]=null}),I(),u=p[s],u?u.p(h,_):(u=p[s]=d[s](h),u.c()),v(u,1),u.m(o,null))},i(h){f||(v(u),f=!0)},o(h){S(u),f=!1},d(h){h&&y(t),p[s].d()}}}function Pn(e){let t,n,r=e[1]&&mt(e);return{c(){r&&r.c(),t=fe()},m(i,o){r&&r.m(i,o),k(i,t,o),n=!0},p(i,[o]){i[1]?r?(r.p(i,o),o&2&&v(r,1)):(r=mt(i),r.c(),v(r,1),r.m(t.parentNode,t)):r&&(j(),S(r,1,1,()=>{r=null}),I())},i(i){n||(v(r),n=!0)},o(i){S(r),n=!1},d(i){r&&r.d(i),i&&y(t)}}}function $n(e,t,n){let{transcriptions:r}=t,{open:i}=t;return e.$$set=o=>{"transcriptions"in o&&n(0,r=o.transcriptions),"open"in o&&n(1,i=o.open)},[r,i]}class Dn extends ve{constructor(t){super(),be(this,t,$n,Pn,ue,{transcriptions:0,open:1})}}const Hn=e=>(e.body?Array.isArray(e.body)?e.body:[e.body]:[]).filter(r=>!r.purpose||r.purpose==="transcribing").slice().sort((r,i)=>r.created<i.created?1:-1),zn=e=>{let t;const n=e.slice().sort((i,o)=>i.created<o.created?1:-1),r=n.filter(i=>{var o;return((o=i.creator)==null?void 0:o.type)==="Person"});if(r.length>0)t=r[0];else{const i=n.find(o=>{var l,a;return((l=o.creator)==null?void 0:l.type)==="Software"&&((a=o.creator)==null?void 0:a.name)==="mapKurator:ocr"});i?t=i:t=n.length>0?n[0]:null}return t},Bn=e=>{var t,n;return((t=e.creator)==null?void 0:t.type)==="Software"&&((n=e.creator)==null?void 0:n.name)=="mapKurator:ocr"},Xn="";function Rn(e){let t,n,r,i,o=e[2].length-1+"",l,a,c,s,u,m,f,d;r=new le({props:{src:cn}});let p=!e[1]&&_t(e);return u=new Dn({props:{open:e[4],transcriptions:e[2]}}),{c(){t=L("p"),n=L("button"),Y(r.$$.fragment),i=q(),l=M(o),a=M(" more transcriptions"),c=q(),p&&p.c(),s=q(),Y(u.$$.fragment),A(n,"class","show-all svelte-1ghqb5r"),de(n,"open",e[4]),A(t,"class","transcription-details transcription-count svelte-1ghqb5r")},m(g,h){k(g,t,h),w(t,n),W(r,n,null),w(n,i),w(n,l),w(n,a),w(t,c),p&&p.m(t,null),k(g,s,h),W(u,g,h),m=!0,f||(d=O(n,"click",e[15]),f=!0)},p(g,h){(!m||h&4)&&o!==(o=g[2].length-1+"")&&Q(l,o),h&16&&de(n,"open",g[4]),g[1]?p&&(p.d(1),p=null):p?p.p(g,h):(p=_t(g),p.c(),p.m(t,null));const _={};h&16&&(_.open=g[4]),h&4&&(_.transcriptions=g[2]),u.$set(_)},i(g){m||(v(r.$$.fragment,g),v(u.$$.fragment,g),m=!0)},o(g){S(r.$$.fragment,g),S(u.$$.fragment,g),m=!1},d(g){g&&y(t),Z(r),p&&p.d(),g&&y(s),Z(u,g),f=!1,d()}}}function qn(e){let t,n,r,i,o,l,a;const c=[Fn,Vn],s=[];function u(f,d){var p;return d&32&&(r=null),r==null&&(r=!!Bn(f[5])),r?0:(p=f[5].creator)!=null&&p.name?1:-1}~(i=u(e,-1))&&(o=s[i]=c[i](e));let m=!e[1]&&bt(e);return{c(){t=L("p"),n=M("Transcribed by "),o&&o.c(),l=fe(),m&&m.c(),A(t,"class","transcription-details transcribed-by svelte-1ghqb5r")},m(f,d){k(f,t,d),w(t,n),~i&&s[i].m(t,null),w(t,l),m&&m.m(t,null),a=!0},p(f,d){let p=i;i=u(f,d),i===p?~i&&s[i].p(f,d):(o&&(j(),S(s[p],1,1,()=>{s[p]=null}),I()),~i?(o=s[i],o?o.p(f,d):(o=s[i]=c[i](f),o.c()),v(o,1),o.m(t,l)):o=null),f[1]?m&&(m.d(1),m=null):m?m.p(f,d):(m=bt(f),m.c(),m.m(t,null))},i(f){a||(v(o),a=!0)},o(f){S(o),a=!1},d(f){f&&y(t),~i&&s[i].d(),m&&m.d()}}}function _t(e){let t,n,r,i,o;return{c(){t=M("\xB7 [ "),n=L("button"),n.textContent="Edit",r=M(" ]"),A(n,"class","add-transcription svelte-1ghqb5r")},m(l,a){k(l,t,a),k(l,n,a),k(l,r,a),i||(o=O(n,"click",e[10]),i=!0)},p:C,d(l){l&&y(t),l&&y(n),l&&y(r),i=!1,o()}}}function Vn(e){var i;let t=((i=e[5].creator)==null?void 0:i.name)+"",n,r;return{c(){n=M(t),r=q()},m(o,l){k(o,n,l),k(o,r,l)},p(o,l){var a;l&32&&t!==(t=((a=o[5].creator)==null?void 0:a.name)+"")&&Q(n,t)},i:C,o:C,d(o){o&&y(n),o&&y(r)}}}function Fn(e){let t,n,r;return t=new le({props:{src:at}}),{c(){Y(t.$$.fragment),n=M(" mapKurator ")},m(i,o){W(t,i,o),k(i,n,o),r=!0},p:C,i(i){r||(v(t.$$.fragment,i),r=!0)},o(i){S(t.$$.fragment,i),r=!1},d(i){Z(t,i),i&&y(n)}}}function bt(e){let t,n,r,i,o;return{c(){t=M("\xB7 [ "),n=L("button"),n.textContent="Edit",r=M(" ]"),A(n,"class","add-transcription svelte-1ghqb5r")},m(l,a){k(l,t,a),k(l,n,a),k(l,r,a),i||(o=O(n,"click",e[10]),i=!0)},p:C,d(l){l&&y(t),l&&y(n),l&&y(r),i=!1,o()}}}function vt(e){let t,n,r,i,o,l,a,c,s,u,m,f;return i=new le({props:{src:an}}),{c(){t=L("div"),n=L("div"),r=L("button"),Y(i.$$.fragment),o=q(),l=L("div"),a=L("button"),a.textContent="Cancel",c=q(),s=L("button"),s.textContent="Save Edits",A(r,"class","delete svelte-1ghqb5r"),A(n,"class","left"),A(a,"class","cancel svelte-1ghqb5r"),A(s,"class","ok svelte-1ghqb5r"),A(l,"class","right-slot"),A(t,"class","r8s-hover-buttons svelte-1ghqb5r")},m(d,p){k(d,t,p),w(t,n),w(n,r),W(i,r,null),w(t,o),w(t,l),w(l,a),w(l,c),w(l,s),u=!0,m||(f=[O(r,"click",e[9]),O(a,"click",e[8]),O(s,"click",e[7])],m=!0)},p:C,i(d){u||(v(i.$$.fragment,d),u=!0)},o(d){S(i.$$.fragment,d),u=!1},d(d){d&&y(t),Z(i),m=!1,K(f)}}}function On(e){let t,n,r,i,o,l,a,c,s,u,m;r=new yn({props:{isEditable:e[1]?!1:e[3],transcription:e[5]}}),r.$on("click",e[14]),r.$on("change",e[6]),r.$on("save",e[7]),r.$on("cancel",e[8]);const f=[qn,Rn],d=[];function p(h,_){return h[2].length===1?0:h[2].length>1?1:-1}~(o=p(e))&&(l=d[o]=f[o](e));let g=e[3]&&vt(e);return{c(){t=L("div"),n=L("div"),Y(r.$$.fragment),i=q(),l&&l.c(),a=q(),g&&g.c(),A(n,"class","r8s-hover-content svelte-1ghqb5r"),A(t,"class","r8s-hover svelte-1ghqb5r"),A(t,"style",c=`top: ${e[0].offsetY}px; left: ${e[0].offsetX}px`),de(t,"editable",e[3])},m(h,_){k(h,t,_),w(t,n),W(r,n,null),w(n,i),~o&&d[o].m(n,null),w(t,a),g&&g.m(t,null),s=!0,u||(m=Rt(on.call(null,t)),u=!0)},p(h,[_]){const T={};_&10&&(T.isEditable=h[1]?!1:h[3]),_&32&&(T.transcription=h[5]),r.$set(T);let $=o;o=p(h),o===$?~o&&d[o].p(h,_):(l&&(j(),S(d[$],1,1,()=>{d[$]=null}),I()),~o?(l=d[o],l?l.p(h,_):(l=d[o]=f[o](h),l.c()),v(l,1),l.m(n,null)):l=null),h[3]?g?(g.p(h,_),_&8&&v(g,1)):(g=vt(h),g.c(),v(g,1),g.m(t,null)):g&&(j(),S(g,1,1,()=>{g=null}),I()),(!s||_&1&&c!==(c=`top: ${h[0].offsetY}px; left: ${h[0].offsetX}px`))&&A(t,"style",c),_&8&&de(t,"editable",h[3])},i(h){s||(v(r.$$.fragment,h),v(l),v(g),s=!0)},o(h){S(r.$$.fragment,h),S(l),S(g),s=!1},d(h){h&&y(t),Z(r),~o&&d[o].d(),g&&g.d(),u=!1,m()}}}function jn(e,t,n){let r,i;const o=et();let{annotation:l}=t,{originalEvent:a}=t,{env:c}=t,{readOnly:s}=t,u=!1,m=!1,f=l;const d=D=>{const Re=Array.isArray(f.body)?f.body:[f.body],qe={type:"TextualBody",purpose:"transcribing",value:D.detail,creator:{type:"Person",name:c.currentUser.id},created:c.getCurrentTimeAdjusted()};n(11,l={...f,body:[...Re,qe]})},p=()=>{o("save",l),n(13,f=l),n(3,u=!1)},g=()=>{o("cancel",l),n(11,l=f),n(3,u=!1)},h=()=>o("delete"),_=()=>{n(3,u=!0),o("edit")},T=()=>n(4,m=!m),$=()=>n(4,m=!m);return e.$$set=D=>{"annotation"in D&&n(11,l=D.annotation),"originalEvent"in D&&n(0,a=D.originalEvent),"env"in D&&n(12,c=D.env),"readOnly"in D&&n(1,s=D.readOnly)},e.$$.update=()=>{e.$$.dirty&8192&&n(2,r=Hn(f)),e.$$.dirty&4&&n(5,i=zn(r))},[a,s,r,u,m,i,d,p,g,h,_,l,c,f,T,$]}class In extends ve{constructor(t){super(),be(this,t,jn,On,ue,{annotation:11,originalEvent:0,env:12,readOnly:1})}}class Wn{constructor(t,n={}){this.showPopup=(r,i)=>{this.popup&&this.hidePopup(),this.popup=new In({target:document.body,props:{annotation:r,originalEvent:i,env:this.anno.env,readOnly:this.opts.readOnly}}),this.popup.$on("save",o=>{this.isEditing=!1,this.hidePopup();const l=this.anno.getAnnotationById(r.id),a={...o.detail,target:{...l.target}};this.anno.updateAnnotation(o.detail.id,a)}),this.popup.$on("cancel",()=>{this.isEditing=!1,this.hidePopup(),this.anno.deselectAll()}),this.popup.$on("edit",()=>{this.isEditing=!0,this.anno.selectAnnotation(r)}),this.popup.$on("delete",()=>{this.isEditing=!1,this.hidePopup(),this.anno.removeAnnotation(r)})},this.hidePopup=()=>{this.popup&&(this.popup.$destroy(),this.popup=null)},this.anno=t,this.opts=n,t.on("pointerdown",(r,i)=>{this.isEditing||(r?this.showPopup(r,i):this.hidePopup())}),document.addEventListener("keydown",r=>{r.key==="Escape"&&(this.isEditing=!1,this.hidePopup(),this.anno.deselectAll())})}}const Gn="";return Wn});
//# sourceMappingURL=luna-annotorious.js.map
