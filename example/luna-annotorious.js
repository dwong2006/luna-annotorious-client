(function(T,N){typeof exports=="object"&&typeof module<"u"?module.exports=N():typeof define=="function"&&define.amd?define(N):(T=typeof globalThis<"u"?globalThis:T||self,T.LunaAnnotorious=N())})(this,function(){"use strict";function T(){}const N=t=>t;function Dt(t,e){for(const n in e)t[n]=e[n];return t}function _t(t){return t()}function vt(){return Object.create(null)}function $(t){t.forEach(_t)}function ot(t){return typeof t=="function"}function X(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Rt(t){return Object.keys(t).length===0}const yt=typeof window<"u";let bt=yt?()=>window.performance.now():()=>Date.now(),st=yt?t=>requestAnimationFrame(t):T;const D=new Set;function wt(t){D.forEach(e=>{e.c(t)||(D.delete(e),e.f())}),D.size!==0&&st(wt)}function kt(t){let e;return D.size===0&&st(wt),{promise:new Promise(n=>{D.add(e={c:t,f:n})}),abort(){D.delete(e)}}}function m(t,e){t.appendChild(e)}function Et(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function Ot(t){const e=b("style");return jt(Et(t),e),e.sheet}function jt(t,e){m(t.head||t,e)}function R(t,e,n){t.insertBefore(e,n||null)}function P(t){t.parentNode.removeChild(t)}function b(t){return document.createElement(t)}function Bt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Tt(t){return document.createTextNode(t)}function V(){return Tt(" ")}function j(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function zt(t,e){for(const n in e)h(t,n,e[n])}function Ft(t){return Array.from(t.childNodes)}function Wt(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function St(t,e,n){t.classList[n?"add":"remove"](e)}function Mt(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,o,e),i}const Y=new Map;let q=0;function Gt(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function Ut(t,e){const n={stylesheet:Ot(e),rules:{}};return Y.set(t,n),n}function xt(t,e,n,o,i,s,r,c=0){const l=16.666/o;let a=`{
`;for(let u=0;u<=1;u+=l){const k=e+(n-e)*s(u);a+=u*100+`%{${r(k,1-k)}}
`}const f=a+`100% {${r(n,1-n)}}
}`,d=`__svelte_${Gt(f)}_${c}`,_=Et(t),{stylesheet:g,rules:w}=Y.get(_)||Ut(_,t);w[d]||(w[d]=!0,g.insertRule(`@keyframes ${d} ${f}`,g.cssRules.length));const v=t.style.animation||"";return t.style.animation=`${v?`${v}, `:""}${d} ${o}ms linear ${i}ms 1 both`,q+=1,d}function rt(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),i=n.length-o.length;i&&(t.style.animation=o.join(", "),q-=i,q||Xt())}function Xt(){st(()=>{q||(Y.forEach(t=>{const{stylesheet:e}=t;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.rules={}}),Y.clear())})}let B;function F(t){B=t}function Yt(){if(!B)throw new Error("Function called outside component initialization");return B}function at(){const t=Yt();return(e,n,{cancelable:o=!1}={})=>{const i=t.$$.callbacks[e];if(i){const s=Mt(e,n,{cancelable:o});return i.slice().forEach(r=>{r.call(t,s)}),!s.defaultPrevented}return!0}}const W=[],lt=[],K=[],Ct=[],At=Promise.resolve();let ct=!1;function Lt(){ct||(ct=!0,At.then($t))}function qt(){return Lt(),At}function C(t){K.push(t)}const ut=new Set;let J=0;function $t(){const t=B;do{for(;J<W.length;){const e=W[J];J++,F(e),Kt(e.$$)}for(F(null),W.length=0,J=0;lt.length;)lt.pop()();for(let e=0;e<K.length;e+=1){const n=K[e];ut.has(n)||(ut.add(n),n())}K.length=0}while(W.length);for(;Ct.length;)Ct.pop()();ct=!1,ut.clear(),F(t)}function Kt(t){if(t.fragment!==null){t.update(),$(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(C)}}let G;function Pt(){return G||(G=Promise.resolve(),G.then(()=>{G=null})),G}function Q(t,e,n){t.dispatchEvent(Mt(`${e?"intro":"outro"}${n}`))}const Z=new Set;let A;function Jt(){A={r:0,c:[],p:A}}function Qt(){A.r||$(A.c),A=A.p}function x(t,e){t&&t.i&&(Z.delete(t),t.i(e))}function L(t,e,n,o){if(t&&t.o){if(Z.has(t))return;Z.add(t),A.c.push(()=>{Z.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}const Vt={duration:0};function ft(t,e,n){let o=e(t,n),i=!1,s,r,c=0;function l(){s&&rt(t,s)}function a(){const{delay:d=0,duration:_=300,easing:g=N,tick:w=T,css:v}=o||Vt;v&&(s=xt(t,0,1,_,d,g,v,c++)),w(0,1);const u=bt()+d,k=u+_;r&&r.abort(),i=!0,C(()=>Q(t,!0,"start")),r=kt(E=>{if(i){if(E>=k)return w(1,0),Q(t,!0,"end"),l(),i=!1;if(E>=u){const p=g((E-u)/_);w(p,1-p)}}return i})}let f=!1;return{start(){f||(f=!0,rt(t),ot(o)?(o=o(),Pt().then(a)):a())},invalidate(){f=!1},end(){i&&(l(),i=!1)}}}function dt(t,e,n){let o=e(t,n),i=!0,s;const r=A;r.r+=1;function c(){const{delay:l=0,duration:a=300,easing:f=N,tick:d=T,css:_}=o||Vt;_&&(s=xt(t,1,0,a,l,f,_));const g=bt()+l,w=g+a;C(()=>Q(t,!1,"start")),kt(v=>{if(i){if(v>=w)return d(0,1),Q(t,!1,"end"),--r.r||$(r.c),!1;if(v>=g){const u=f((v-g)/a);d(1-u,u)}}return i})}return ot(o)?Pt().then(()=>{o=o(),c()}):c(),{end(l){l&&o.tick&&o.tick(1,0),i&&(s&&rt(t,s),i=!1)}}}function Zt(t,e){const n={},o={},i={$$scope:1};let s=t.length;for(;s--;){const r=t[s],c=e[s];if(c){for(const l in r)l in c||(o[l]=1);for(const l in c)i[l]||(n[l]=c[l],i[l]=1);t[s]=c}else for(const l in r)i[l]=1}for(const r in o)r in n||(n[r]=void 0);return n}function O(t){t&&t.c()}function H(t,e,n,o){const{fragment:i,on_mount:s,on_destroy:r,after_update:c}=t.$$;i&&i.m(e,n),o||C(()=>{const l=s.map(_t).filter(ot);r?r.push(...l):$(l),t.$$.on_mount=[]}),c.forEach(C)}function I(t,e){const n=t.$$;n.fragment!==null&&($(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function te(t,e){t.$$.dirty[0]===-1&&(W.push(t),Lt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function tt(t,e,n,o,i,s,r,c=[-1]){const l=B;F(t);const a=t.$$={fragment:null,ctx:null,props:s,update:T,not_equal:i,bound:vt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:vt(),dirty:c,skip_bound:!1,root:e.target||l.$$.root};r&&r(a.root);let f=!1;if(a.ctx=n?n(t,e.props||{},(d,_,...g)=>{const w=g.length?g[0]:_;return a.ctx&&i(a.ctx[d],a.ctx[d]=w)&&(!a.skip_bound&&a.bound[d]&&a.bound[d](w),f&&te(t,d)),_}):[],a.update(),f=!0,$(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){const d=Ft(e.target);a.fragment&&a.fragment.l(d),d.forEach(P)}else a.fragment&&a.fragment.c();e.intro&&x(t.$$.fragment),H(t,e.target,e.anchor,e.customElement),$t()}F(l)}class et{$destroy(){I(this,1),this.$destroy=T}$on(e,n){const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const i=o.indexOf(n);i!==-1&&o.splice(i,1)}}$set(e){this.$$set&&!Rt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function ee(t){let e,n=[{width:t[1]},{height:t[1]},{"stroke-width":"0"},{class:t[2]},t[0].a,t[4],{xmlns:"http://www.w3.org/2000/svg"}],o={};for(let i=0;i<n.length;i+=1)o=Dt(o,n[i]);return{c(){e=Bt("svg"),zt(e,o)},m(i,s){R(i,e,s),e.innerHTML=t[3]},p(i,[s]){s&8&&(e.innerHTML=i[3]),zt(e,o=Zt(n,[s&2&&{width:i[1]},s&2&&{height:i[1]},{"stroke-width":"0"},s&4&&{class:i[2]},s&1&&i[0].a,s&16&&i[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:T,o:T,d(i){i&&P(e)}}}function ne(t,e,n){let{src:o}=e,{size:i="1em"}=e,{color:s=void 0}=e,{title:r=void 0}=e,{className:c=""}=e,l,a;return t.$$set=f=>{"src"in f&&n(0,o=f.src),"size"in f&&n(1,i=f.size),"color"in f&&n(5,s=f.color),"title"in f&&n(6,r=f.title),"className"in f&&n(2,c=f.className)},t.$$.update=()=>{t.$$.dirty&33&&(n(4,a={}),s&&(o.a.stroke!=="none"&&n(4,a.stroke=s,a),o.a.fill!=="none"&&n(4,a.fill=s,a))),t.$$.dirty&65&&n(3,l=(r?`<title>${r}</title>`:"")+o.c)},[o,i,c,l,a,s,r]}class nt extends et{constructor(e){super(),tt(this,e,ne,ee,X,{src:0,size:1,color:5,title:6,className:2})}}const ie={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"></path>'};var ht="__autosizeInputGhost",oe={" ":"nbsp","<":"lt",">":"gt"};function se(t){return"&"+oe[t]+";"}function re(t){return t.replace(/\s|<|>/g,se)}function ae(){var t=document.createElement("div");return t.id=ht,t.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(t),t}var le=function(t,e){var n=window.getComputedStyle(t),o="box-sizing:"+n.boxSizing+";border-left:"+n.borderLeftWidth+" solid red;border-right:"+n.borderRightWidth+" solid red;font-family:"+n.fontFamily+";font-feature-settings:"+n.fontFeatureSettings+";font-kerning:"+n.fontKerning+";font-size:"+n.fontSize+";font-stretch:"+n.fontStretch+";font-style:"+n.fontStyle+";font-variant:"+n.fontVariant+";font-variant-caps:"+n.fontVariantCaps+";font-variant-ligatures:"+n.fontVariantLigatures+";font-variant-numeric:"+n.fontVariantNumeric+";font-weight:"+n.fontWeight+";letter-spacing:"+n.letterSpacing+";margin-left:"+n.marginLeft+";margin-right:"+n.marginRight+";padding-left:"+n.paddingLeft+";padding-right:"+n.paddingRight+";text-indent:"+n.textIndent+";text-transform:"+n.textTransform;function i(){var r=t.value||t.getAttribute("placeholder")||"",c=document.getElementById(ht)||ae();c.style.cssText+=o,c.innerHTML=re(r);var l=window.getComputedStyle(c).width;return t.style.width=l,l}t.addEventListener("input",i);var s=i();return e&&e.minWidth&&s!=="0px"&&(t.style.minWidth=s),function(){t.removeEventListener("input",i);var r=document.getElementById(ht);r&&r.parentNode.removeChild(r)}};const xe="";function ce(t){let e,n;return{c(){e=b("span"),n=Tt(t[0]),h(e,"class","transcription svelte-1p0avtw")},m(o,i){R(o,e,i),m(e,n)},p(o,i){i&1&&Wt(n,o[0])},d(o){o&&P(e)}}}function ue(t){let e,n,o,i;return{c(){e=b("form"),n=b("input"),n.value=t[0],h(n,"spellcheck",!1),h(n,"class","svelte-1p0avtw")},m(s,r){R(s,e,r),m(e,n),t[4](n),o||(i=j(e,"submit",t[3]),o=!0)},p(s,r){r&1&&n.value!==s[0]&&(n.value=s[0])},d(s){s&&P(e),t[4](null),o=!1,i()}}}function fe(t){let e;function n(s,r){return s[1]?ue:ce}let o=n(t),i=o(t);return{c(){e=b("div"),i.c()},m(s,r){R(s,e,r),i.m(e,null)},p(s,[r]){o===(o=n(s))&&i?i.p(s,r):(i.d(1),i=o(s),i&&(i.c(),i.m(e,null)))},i:T,o:T,d(s){s&&P(e),i.d()}}}function de(t,e,n){const o=at();let{value:i}=e,{editable:s}=e,r;const c=a=>{a.preventDefault(),o("change",r.value)};function l(a){lt[a?"unshift":"push"](()=>{r=a,n(2,r)})}return t.$$set=a=>{"value"in a&&n(0,i=a.value),"editable"in a&&n(1,s=a.editable)},t.$$.update=()=>{t.$$.dirty&6&&s&&qt().then(()=>{le(r),r.focus()})},[i,s,r,c,l]}class he extends et{constructor(e){super(),tt(this,e,de,fe,X,{value:0,editable:1})}}const pe={stiffness:.15,damping:.8,precision:.01},me=(t,e=!1)=>n=>{n=e?1-n:n;const o=n*t.length,i=o%1,s=Math.min(~~o,t.length-1),r=t[s],c=t[s+1]==null?r:t[s+1];return i?r+(c-r)*i:r};function pt(t,e,n){return Ht(!1,t,e,n)}function mt(t,e,n){return Ht(!0,t,e,n)}function Ht(t,e,n,o){const i=ge(e,n,o);return{duration:i.length*1e3/60,tickToValue:me(i,t)}}function It(t){return Object.prototype.toString.call(t)==="[object Date]"}function ge(t,e,n){n=Object.assign({},pe,n);let o=t,i=t,s=1;const r=[t];let c;do{c={inv_mass:1,opts:n,settled:!0,dt:s};const l=gt(c,i,o,e);r.push(l),i=o,o=l}while(!c.settled);return r}function gt(t,e,n,o){if(typeof n=="number"||It(n)){const i=o-n,s=(n-e)/(t.dt||1/60),r=t.opts.stiffness*i,c=t.opts.damping*s,l=(r-c)*t.inv_mass,a=(s+l)*t.dt;return Math.abs(a)<t.opts.precision&&Math.abs(i)<t.opts.precision?o:(t.settled=!1,It(n)?new Date(n.getTime()+a):n+a)}else{if(Array.isArray(n))return n.map((i,s)=>gt(t,e[s],n[s],o[s]));if(typeof n=="object"){const i={};for(const s in n)i[s]=gt(t,e[s],n[s],o[s]);return i}else throw new Error(`Cannot spring ${typeof n} values`)}}const _e={a:{viewBox:"0 0 24 24"},c:`<g><path fill="none" d="M0 0h24v24H0z"></path>
<path d="M5 8a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm14 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 14a3 3 0 1 1 0-6 3 3 0 0 1 0 6zM5 22a3 3 0 1 1 0-6 3 3 0 0 1 0 6zM9 4h6v2H9V4zm0 14h6v2H9v-2zM4 9h2v6H4V9zm14 0h2v6h-2V9z"></path></g>`},ve={a:{viewBox:"0 0 24 24"},c:`<g><path fill="none" d="M0 0h24v24H0z"></path>
<path d="M13 6v15h-2V6H5V4h14v2z"></path></g>`},ye={a:{},c:'<path d="M19 2H9c-1.103 0-2 .897-2 2v5.586l-4.707 4.707A1 1 0 0 0 3 16v5a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4c0-1.103-.897-2-2-2zm-8 18H5v-5.586l3-3 3 3V20zm8 0h-6v-4a.999.999 0 0 0 .707-1.707L9 9.586V4h10v16z"></path><path d="M11 6h2v2h-2zm4 0h2v2h-2zm0 4.031h2V12h-2zM15 14h2v2h-2zm-8 1h2v2H7z"></path>'},Ce="";function be(t){let e,n,o,i,s,r,c,l,a,f,d,_,g,w,v,u,k,E,p,y,z,M,U,it;return s=new nt({props:{src:_e}}),d=new nt({props:{src:ve}}),k=new nt({props:{src:ye}}),{c(){e=b("div"),n=b("ul"),o=b("li"),i=b("button"),O(s.$$.fragment),l=V(),a=b("li"),f=b("button"),O(d.$$.fragment),w=V(),v=b("li"),u=b("button"),O(k.$$.fragment),y=V(),z=b("div"),h(i,"class","action-button svelte-mmxoa5"),h(i,"id","action-edit-shape"),h(i,"data-tooltip","Edit Shape"),h(o,"class","svelte-mmxoa5"),h(f,"class","action-button svelte-mmxoa5"),h(f,"id","action-fix-transcription"),h(f,"data-tooltip","Fix Transcription"),h(a,"class","svelte-mmxoa5"),h(u,"class","action-button svelte-mmxoa5"),h(u,"id","action-change-type"),h(u,"data-tooltip","Change Feature Type"),h(v,"class","svelte-mmxoa5"),h(n,"class","svelte-mmxoa5"),h(z,"class","mousetrap svelte-mmxoa5"),h(e,"class","r8s-hover-hud svelte-mmxoa5")},m(S,Me){R(S,e,Me),m(e,n),m(n,o),m(o,i),H(s,i,null),m(n,l),m(n,a),m(a,f),H(d,f,null),m(n,w),m(n,v),m(v,u),H(k,u,null),m(e,y),m(e,z),M=!0,U||(it=[j(i,"click",t[7]),j(f,"click",t[8]),j(u,"click",t[9])],U=!0)},p:T,i(S){M||(x(s.$$.fragment,S),C(()=>{c&&c.end(1),r=ft(i,t[1],{}),r.start()}),x(d.$$.fragment,S),C(()=>{g&&g.end(1),_=ft(f,t[2],{}),_.start()}),x(k.$$.fragment,S),C(()=>{p&&p.end(1),E=ft(u,t[3],{}),E.start()}),M=!0)},o(S){L(s.$$.fragment,S),r&&r.invalidate(),c=dt(i,t[4],{}),L(d.$$.fragment,S),_&&_.invalidate(),g=dt(f,t[5],{}),L(k.$$.fragment,S),E&&E.invalidate(),p=dt(u,t[6],{}),M=!1},d(S){S&&P(e),I(s),S&&c&&c.end(),I(d),S&&g&&g.end(),I(k),S&&p&&p.end(),U=!1,$(it)}}}function we(t){const e={stiffness:.2,damping:.3},n={stiffness:.3,damping:.8},o=at(),i=(w,v,u,k,E)=>p=>{const{duration:y,tickToValue:z}=k(w,v,E);return{duration:y,css:M=>{const U=-z(M)*Math.sin(u),it=z(M)*Math.cos(u);return`transform: translate(${U}px, ${it}px)`}}},s=i(82,0,0,pt,e),r=i(82,0,Math.PI/4,pt,e),c=i(82,0,Math.PI/2,pt,e),l=i(0,82,0,mt,n),a=i(0,82,Math.PI/4,mt,n),f=i(0,82,Math.PI/2,mt,n);return[o,s,r,c,l,a,f,()=>o("editShape"),()=>o("fixTranscription"),()=>o("changeType")]}class ke extends et{constructor(e){super(),tt(this,e,we,be,X,{})}}const Ae="";function Nt(t){let e,n;return e=new ke({}),e.$on("fixTranscription",t[10]),e.$on("editShape",t[11]),{c(){O(e.$$.fragment)},m(o,i){H(e,o,i),n=!0},p:T,i(o){n||(x(e.$$.fragment,o),n=!0)},o(o){L(e.$$.fragment,o),n=!1},d(o){I(e,o)}}}function Ee(t){let e,n,o,i,s,r,c,l,a,f,d,_,g,w,v,u,k,E;i=new he({props:{value:t[4],editable:t[2]}}),i.$on("change",t[6]),a=new nt({props:{src:ie}});let p=t[1]&&Nt(t);return{c(){e=b("div"),n=b("div"),o=b("div"),O(i.$$.fragment),s=V(),r=b("div"),c=b("div"),l=b("button"),O(a.$$.fragment),f=V(),d=b("label"),d.textContent="Improve our data",_=V(),p&&p.c(),g=V(),w=b("div"),h(o,"class","r8s-hover-content svelte-169h443"),h(l,"id","r8s-button-improve"),h(l,"class","svelte-169h443"),h(d,"for","r8s-button-improve"),h(d,"class","svelte-169h443"),h(c,"class","r8s-hover-action r8s-hover-action-improve svelte-169h443"),h(r,"class","r8s-hover-actions svelte-169h443"),h(n,"class","r8s-hover-main svelte-169h443"),h(w,"class","mousetrap svelte-169h443"),h(e,"class","r8s-hover-container svelte-169h443"),h(e,"style",v=`top: ${t[0].offsetY}px; left: ${t[0].offsetX}px`),St(e,"ghost",t[3])},m(y,z){R(y,e,z),m(e,n),m(n,o),H(i,o,null),m(n,s),m(n,r),m(r,c),m(c,l),H(a,l,null),m(c,f),m(c,d),m(e,_),p&&p.m(e,null),m(e,g),m(e,w),u=!0,k||(E=j(l,"click",t[9]),k=!0)},p(y,[z]){const M={};z&16&&(M.value=y[4]),z&4&&(M.editable=y[2]),i.$set(M),y[1]?p?(p.p(y,z),z&2&&x(p,1)):(p=Nt(y),p.c(),x(p,1),p.m(e,g)):p&&(Jt(),L(p,1,1,()=>{p=null}),Qt()),(!u||z&1&&v!==(v=`top: ${y[0].offsetY}px; left: ${y[0].offsetX}px`))&&h(e,"style",v),z&8&&St(e,"ghost",y[3])},i(y){u||(x(i.$$.fragment,y),x(a.$$.fragment,y),x(p),u=!0)},o(y){L(i.$$.fragment,y),L(a.$$.fragment,y),L(p),u=!1},d(y){y&&P(e),I(i),I(a),p&&p.d(),k=!1,E()}}}function Te(t,e,n){const o=at();let{annotation:i}=e,{originalEvent:s}=e,{viewer:r}=e,c=!1,l=!1,a=!1,f;const d=()=>{o("editShape",i),n(3,a=!0)},_=u=>{const E=[...(Array.isArray(i.body)?i.body:[i.body]).filter(p=>p.purpose!=="transcribing"),{type:"TextualBody",purpose:"transcribing",value:u.detail}];n(7,i={...i,body:E}),o("transcriptionChanged",i),n(2,l=!1)},g=()=>n(1,c=!c),w=()=>n(2,l=!0),v=()=>d();return t.$$set=u=>{"annotation"in u&&n(7,i=u.annotation),"originalEvent"in u&&n(0,s=u.originalEvent),"viewer"in u&&n(8,r=u.viewer)},t.$$.update=()=>{var u;if(t.$$.dirty&128){const k=Array.isArray(i.body)?i.body:[i.body];n(4,f=(u=k.find(E=>E.purpose==="transcribing"))==null?void 0:u.value)}},[s,c,l,a,f,d,_,i,r,g,w,v]}class ze extends et{constructor(e){super(),tt(this,e,Te,Ee,X,{annotation:7,originalEvent:0,viewer:8})}}class Se{constructor(e,n){this.showPopup=(o,i)=>{this.popup=new ze({target:document.body,props:{annotation:o,originalEvent:i,viewer:this.viewer}}),this.popup.$on("transcriptionChanged",s=>this.anno.updateAnnotation(s.detail.id,s.detail)),this.popup.$on("editShape",s=>this.anno.selectAnnotation(s.detail.id))},this.hidePopup=()=>{this.popup.$destroy(),this.popup=null},this.anno=e,this.viewer=n,e.on("mouseEnterAnnotation",(o,i)=>{this.showPopup(o,i)}),e.on("mouseLeaveAnnotation",()=>{this.hidePopup()})}}return Se});
//# sourceMappingURL=luna-annotorious.js.map
