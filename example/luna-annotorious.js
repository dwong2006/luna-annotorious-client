(function(x,pe){typeof exports=="object"&&typeof module<"u"?module.exports=pe():typeof define=="function"&&define.amd?define(pe):(x=typeof globalThis<"u"?globalThis:x||self,x.LunaAnnotorious=pe())})(this,function(){"use strict";function x(){}const pe=r=>r;function tc(r,t){for(const e in t)r[e]=t[e];return r}function Zi(r){return r()}function Qi(){return Object.create(null)}function It(r){r.forEach(Zi)}function Kr(r){return typeof r=="function"}function He(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function ec(r){return Object.keys(r).length===0}function rc(r){return r&&Kr(r.destroy)?r.destroy:x}const to=typeof window<"u";let nc=to?()=>window.performance.now():()=>Date.now(),Zr=to?r=>requestAnimationFrame(r):x;const Wt=new Set;function eo(r){Wt.forEach(t=>{t.c(r)||(Wt.delete(t),t.f())}),Wt.size!==0&&Zr(eo)}function ic(r){let t;return Wt.size===0&&Zr(eo),{promise:new Promise(e=>{Wt.add(t={c:r,f:e})}),abort(){Wt.delete(t)}}}function C(r,t){r.appendChild(t)}function ro(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function oc(r){const t=W("style");return sc(ro(r),t),t.sheet}function sc(r,t){C(r.head||r,t)}function U(r,t,e){r.insertBefore(t,e||null)}function B(r){r.parentNode.removeChild(r)}function lc(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function W(r){return document.createElement(r)}function ac(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function P(r){return document.createTextNode(r)}function Ht(){return P(" ")}function no(){return P("")}function de(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function D(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function io(r,t){for(const e in t)D(r,e,t[e])}function cc(r){return Array.from(r.childNodes)}function Yt(r,t){t=""+t,r.wholeText!==t&&(r.data=t)}function oo(r,t,{bubbles:e=!1,cancelable:n=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(r,e,n,t),i}const Ye=new Map;let Ge=0;function uc(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function fc(r,t){const e={stylesheet:oc(t),rules:{}};return Ye.set(r,e),e}function so(r,t,e,n,i,o,s,l=0){const a=16.666/n;let c=`{
`;for(let g=0;g<=1;g+=a){const m=t+(e-t)*o(g);c+=g*100+`%{${s(m,1-m)}}
`}const u=c+`100% {${s(e,1-e)}}
}`,f=`__svelte_${uc(u)}_${l}`,p=ro(r),{stylesheet:h,rules:d}=Ye.get(p)||fc(p,r);d[f]||(d[f]=!0,h.insertRule(`@keyframes ${f} ${u}`,h.cssRules.length));const y=r.style.animation||"";return r.style.animation=`${y?`${y}, `:""}${f} ${n}ms linear ${i}ms 1 both`,Ge+=1,f}function hc(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?o=>o.indexOf(t)<0:o=>o.indexOf("__svelte")===-1),i=e.length-n.length;i&&(r.style.animation=n.join(", "),Ge-=i,Ge||pc())}function pc(){Zr(()=>{Ge||(Ye.forEach(r=>{const{stylesheet:t}=r;let e=t.cssRules.length;for(;e--;)t.deleteRule(e);r.rules={}}),Ye.clear())})}let ge;function ye(r){ge=r}function dc(){if(!ge)throw new Error("Function called outside component initialization");return ge}function lo(){const r=dc();return(t,e,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[t];if(i){const o=oo(t,e,{cancelable:n});return i.slice().forEach(s=>{s.call(r,o)}),!o.defaultPrevented}return!0}}const me=[],Qr=[],Ve=[],ao=[],co=Promise.resolve();let tn=!1;function uo(){tn||(tn=!0,co.then(fo))}function gc(){return uo(),co}function ve(r){Ve.push(r)}const en=new Set;let Xe=0;function fo(){const r=ge;do{for(;Xe<me.length;){const t=me[Xe];Xe++,ye(t),yc(t.$$)}for(ye(null),me.length=0,Xe=0;Qr.length;)Qr.pop()();for(let t=0;t<Ve.length;t+=1){const e=Ve[t];en.has(e)||(en.add(e),e())}Ve.length=0}while(me.length);for(;ao.length;)ao.pop()();tn=!1,en.clear(),ye(r)}function yc(r){if(r.fragment!==null){r.update(),It(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(ve)}}let be;function mc(){return be||(be=Promise.resolve(),be.then(()=>{be=null})),be}function rn(r,t,e){r.dispatchEvent(oo(`${t?"intro":"outro"}${e}`))}const ze=new Set;let ut;function Tt(){ut={r:0,c:[],p:ut}}function Mt(){ut.r||It(ut.c),ut=ut.p}function $(r,t){r&&r.i&&(ze.delete(r),r.i(t))}function N(r,t,e,n){if(r&&r.o){if(ze.has(r))return;ze.add(r),ut.c.push(()=>{ze.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}const vc={duration:0};function ho(r,t,e,n){let i=t(r,e),o=n?0:1,s=null,l=null,a=null;function c(){a&&hc(r,a)}function u(p,h){const d=p.b-o;return h*=Math.abs(d),{a:o,b:p.b,d,duration:h,start:p.start,end:p.start+h,group:p.group}}function f(p){const{delay:h=0,duration:d=300,easing:y=pe,tick:g=x,css:m}=i||vc,v={start:nc()+h,b:p};p||(v.group=ut,ut.r+=1),s||l?l=v:(m&&(c(),a=so(r,o,p,d,h,y,m)),p&&g(0,1),s=u(v,d),ve(()=>rn(r,p,"start")),ic(w=>{if(l&&w>l.start&&(s=u(l,d),l=null,rn(r,s.b,"start"),m&&(c(),a=so(r,o,s.b,s.duration,0,y,i.css))),s){if(w>=s.end)g(o=s.b,1-o),rn(r,s.b,"end"),l||(s.b?c():--s.group.r||It(s.group.c)),s=null;else if(w>=s.start){const _=w-s.start;o=s.a+s.d*y(_/s.duration),g(o,1-o)}}return!!(s||l)}))}return{run(p){Kr(i)?mc().then(()=>{i=i(),f(p)}):f(p)},end(){c(),s=l=null}}}function bc(r,t){const e={},n={},i={$$scope:1};let o=r.length;for(;o--;){const s=r[o],l=t[o];if(l){for(const a in s)a in l||(n[a]=1);for(const a in l)i[a]||(e[a]=l[a],i[a]=1);r[o]=l}else for(const a in s)i[a]=1}for(const s in n)s in e||(e[s]=void 0);return e}function qe(r){r&&r.c()}function we(r,t,e,n){const{fragment:i,on_mount:o,on_destroy:s,after_update:l}=r.$$;i&&i.m(t,e),n||ve(()=>{const a=o.map(Zi).filter(Kr);s?s.push(...a):It(a),r.$$.on_mount=[]}),l.forEach(ve)}function Se(r,t){const e=r.$$;e.fragment!==null&&(It(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function wc(r,t){r.$$.dirty[0]===-1&&(me.push(r),uo(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function nn(r,t,e,n,i,o,s,l=[-1]){const a=ge;ye(r);const c=r.$$={fragment:null,ctx:null,props:o,update:x,not_equal:i,bound:Qi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Qi(),dirty:l,skip_bound:!1,root:t.target||a.$$.root};s&&s(c.root);let u=!1;if(c.ctx=e?e(r,t.props||{},(f,p,...h)=>{const d=h.length?h[0]:p;return c.ctx&&i(c.ctx[f],c.ctx[f]=d)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](d),u&&wc(r,f)),p}):[],c.update(),u=!0,It(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const f=cc(t.target);c.fragment&&c.fragment.l(f),f.forEach(B)}else c.fragment&&c.fragment.c();t.intro&&$(r.$$.fragment),we(r,t.target,t.anchor,t.customElement),fo()}ye(a)}class on{$destroy(){Se(this,1),this.$destroy=x}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const i=n.indexOf(e);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!ec(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var sn={dragStart:!0},po=(r,t,e)=>Math.min(Math.max(r,t),e),ln=r=>typeof r=="string",Sc=([r,t],e,n)=>{const i=(o,s)=>s===0?0:Math.ceil(o/s)*s;return[i(e,r),i(n,t)]},go=(r,t)=>r.some(e=>t.some(n=>e.contains(n)));function an(r,t){if(r===void 0)return;if(cn(r))return r.getBoundingClientRect();if(typeof r=="object"){const{top:n=0,left:i=0,right:o=0,bottom:s=0}=r;return{top:n,right:window.innerWidth-o,bottom:window.innerHeight-s,left:i}}if(r==="parent")return t.parentNode.getBoundingClientRect();const e=document.querySelector(r);if(e===null)throw new Error("The selector provided for bound doesn't exists in the document.");return e.getBoundingClientRect()}var Je=(r,t,e)=>r.style.setProperty(t,e),cn=r=>r instanceof HTMLElement,_c=(r,t={})=>{var Ga,Va;let e,n,{bounds:i,axis:o="both",gpuAcceleration:s=!0,legacyTranslate:l=!0,transform:a,applyUserSelectHack:c=!0,disabled:u=!1,ignoreMultitouch:f=!1,recomputeBounds:p=sn,grid:h,position:d,cancel:y,handle:g,defaultClass:m="neodrag",defaultClassDragging:v="neodrag-dragging",defaultClassDragged:w="neodrag-dragged",defaultPosition:_={x:0,y:0},onDragStart:T,onDrag:q,onDragEnd:lt}=t,J=!1,tt=0,at=0,Ut=0,mt=0,ct=0,xt=0,{x:he,y:jt}=d?{x:(Ga=d==null?void 0:d.x)!=null?Ga:0,y:(Va=d==null?void 0:d.y)!=null?Va:0}:_;qi(he,jt);let vt,Ft,We,Xi,Ua,ja="",qg=!!d;p={...sn,...p};const zi=document.body.style,$t=r.classList;function qi(b=tt,M=at){if(!a){if(l){let K=`${+b}px, ${+M}px`;return Je(r,"transform",s?`translate3d(${K}, 0)`:`translate(${K})`)}return Je(r,"translate",`${+b}px ${+M}px ${s?"1px":""}`)}const F=a({offsetX:b,offsetY:M,rootNode:r});ln(F)&&Je(r,"transform",F)}const Ji=(b,M)=>{const F={offsetX:tt,offsetY:at,rootNode:r,currentNode:Ua};r.dispatchEvent(new CustomEvent(b,{detail:F})),M==null||M(F)},Ki=addEventListener;Ki("pointerdown",Wa,!1),Ki("pointerup",Ha,!1),Ki("pointermove",Ya,!1),Je(r,"touch-action","none");const Fa=()=>{let b=r.offsetWidth/Ft.width;return isNaN(b)&&(b=1),b};function Wa(b){if(u||b.button===2||f&&!b.isPrimary)return;if(p.dragStart&&(vt=an(i,r)),ln(g)&&ln(y)&&g===y)throw new Error("`handle` selector can't be same as `cancel` selector");if($t.add(m),We=function(O,X){if(!O)return[X];if(cn(O))return[O];if(Array.isArray(O))return O;const Z=X.querySelectorAll(O);if(Z===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(Z.values())}(g,r),Xi=function(O,X){if(!O)return[];if(cn(O))return[O];if(Array.isArray(O))return O;const Z=X.querySelectorAll(O);if(Z===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(Z.values())}(y,r),e=/(both|x)/.test(o),n=/(both|y)/.test(o),go(Xi,We))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const M=b.composedPath()[0];if(!We.some(O=>{var X;return O.contains(M)||((X=O.shadowRoot)==null?void 0:X.contains(M))})||go(Xi,[M]))return;Ua=We.length===1?r:We.find(O=>O.contains(M)),J=!0,Ft=r.getBoundingClientRect(),c&&(ja=zi.userSelect,zi.userSelect="none"),Ji("neodrag:start",T);const{clientX:F,clientY:K}=b,V=Fa();e&&(Ut=F-he/V),n&&(mt=K-jt/V),vt&&(ct=F-Ft.left,xt=K-Ft.top)}function Ha(){J&&(p.dragEnd&&(vt=an(i,r)),$t.remove(v),$t.add(w),c&&(zi.userSelect=ja),Ji("neodrag:end",lt),e&&(Ut=tt),n&&(mt=at),J=!1)}function Ya(b){if(!J)return;p.drag&&(vt=an(i,r)),$t.add(v),b.preventDefault(),Ft=r.getBoundingClientRect();let M=b.clientX,F=b.clientY;const K=Fa();if(vt){const V={left:vt.left+ct,top:vt.top+xt,right:vt.right+ct-Ft.width,bottom:vt.bottom+xt-Ft.height};M=po(M,V.left,V.right),F=po(F,V.top,V.bottom)}if(Array.isArray(h)){let[V,O]=h;if(isNaN(+V)||V<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+O)||O<0)throw new Error("2nd argument of `grid` must be a valid positive number");let X=M-Ut,Z=F-mt;[X,Z]=Sc([V/K,O/K],X,Z),M=Ut+X,F=mt+Z}e&&(tt=Math.round((M-Ut)*K)),n&&(at=Math.round((F-mt)*K)),he=tt,jt=at,Ji("neodrag",q),qi()}return{destroy:()=>{const b=removeEventListener;b("pointerdown",Wa,!1),b("pointerup",Ha,!1),b("pointermove",Ya,!1)},update:b=>{var F,K,V,O,X,Z,Xa,za,qa,Ja,Ka,Za,Qa;o=b.axis||"both",u=(F=b.disabled)!=null?F:!1,f=(K=b.ignoreMultitouch)!=null?K:!1,g=b.handle,i=b.bounds,p=(V=b.recomputeBounds)!=null?V:sn,y=b.cancel,c=(O=b.applyUserSelectHack)!=null?O:!0,h=b.grid,s=(X=b.gpuAcceleration)!=null?X:!0,l=(Z=b.legacyTranslate)!=null?Z:!0,a=b.transform;const M=$t.contains(w);$t.remove(m,w),m=(Xa=b.defaultClass)!=null?Xa:"neodrag",v=(za=b.defaultClassDragging)!=null?za:"neodrag-dragging",w=(qa=b.defaultClassDragged)!=null?qa:"neodrag-dragged",$t.add(m),M&&$t.add(w),qg&&(he=tt=(Ka=(Ja=b.position)==null?void 0:Ja.x)!=null?Ka:tt,jt=at=(Qa=(Za=b.position)==null?void 0:Za.y)!=null?Qa:at,qi())}}};function Ec(r){const t=r-1;return t*t*t+1}function yo(r,{delay:t=0,duration:e=400,easing:n=Ec}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),l=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),f=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:t,duration:e,easing:n,css:h=>`overflow: hidden;opacity: ${Math.min(h*20,1)*o};height: ${h*s}px;padding-top: ${h*l}px;padding-bottom: ${h*a}px;margin-top: ${h*c}px;margin-bottom: ${h*u}px;border-top-width: ${h*f}px;border-bottom-width: ${h*p}px;`}}function kc(r){let t,e=[{width:r[1]},{height:r[1]},{"stroke-width":"0"},{class:r[2]},r[0].a,r[4],{xmlns:"http://www.w3.org/2000/svg"}],n={};for(let i=0;i<e.length;i+=1)n=tc(n,e[i]);return{c(){t=ac("svg"),io(t,n)},m(i,o){U(i,t,o),t.innerHTML=r[3]},p(i,[o]){o&8&&(t.innerHTML=i[3]),io(t,n=bc(e,[o&2&&{width:i[1]},o&2&&{height:i[1]},{"stroke-width":"0"},o&4&&{class:i[2]},o&1&&i[0].a,o&16&&i[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:x,o:x,d(i){i&&B(t)}}}function Ac(r,t,e){let{src:n}=t,{size:i="1em"}=t,{color:o=void 0}=t,{title:s=void 0}=t,{className:l=""}=t,a,c;return r.$$set=u=>{"src"in u&&e(0,n=u.src),"size"in u&&e(1,i=u.size),"color"in u&&e(5,o=u.color),"title"in u&&e(6,s=u.title),"className"in u&&e(2,l=u.className)},r.$$.update=()=>{r.$$.dirty&33&&(e(4,c={}),o&&(n.a.stroke!=="none"&&e(4,c.stroke=o,c),n.a.fill!=="none"&&e(4,c.fill=o,c))),r.$$.dirty&65&&e(3,a=(s?`<title>${s}</title>`:"")+n.c)},[n,i,l,a,c,o,s]}class un extends on{constructor(t){super(),nn(this,t,Ac,kc,He,{src:0,size:1,color:5,title:6,className:2})}}const Oc={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'},mo={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'};var Cc=["second","minute","hour","day","week","month","year"];function xc(r,t){if(t===0)return["just now","right now"];var e=Cc[Math.floor(t/2)];return r>1&&(e+="s"),[r+" "+e+" ago","in "+r+" "+e]}var $c=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function Ic(r,t){if(t===0)return["\u521A\u521A","\u7247\u523B\u540E"];var e=$c[~~(t/2)];return[r+" "+e+"\u524D",r+" "+e+"\u540E"]}var fn={},vo=function(r,t){fn[r]=t},Tc=function(r){return fn[r]||fn.en_US},hn=[60,60,24,7,365/7/12,12];function bo(r){return r instanceof Date?r:!isNaN(r)||/^\d+$/.test(r)?new Date(parseInt(r)):(r=(r||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(r))}function Mc(r,t){var e=r<0?1:0;r=Math.abs(r);for(var n=r,i=0;r>=hn[i]&&i<hn.length;i++)r/=hn[i];return r=Math.floor(r),i*=2,r>(i===0?9:1)&&(i+=1),t(r,i,n)[e].replace("%s",r.toString())}function Dc(r,t){var e=t?bo(t):new Date;return(+e-+bo(r))/1e3}var wo=function(r,t,e){var n=Dc(r,e&&e.relativeDate);return Mc(n,Tc(t))};vo("en_US",xc),vo("zh_CN",Ic);var pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bc(r){var t=r.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),e}var dn="__autosizeInputGhost",Pc={" ":"nbsp","<":"lt",">":"gt"};function Nc(r){return"&"+Pc[r]+";"}function Rc(r){return r.replace(/\s|<|>/g,Nc)}function Lc(){var r=document.createElement("div");return r.id=dn,r.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(r),r}var Uc=function(r,t){var e=window.getComputedStyle(r),n="box-sizing:"+e.boxSizing+";border-left:"+e.borderLeftWidth+" solid red;border-right:"+e.borderRightWidth+" solid red;font-family:"+e.fontFamily+";font-feature-settings:"+e.fontFeatureSettings+";font-kerning:"+e.fontKerning+";font-size:"+e.fontSize+";font-stretch:"+e.fontStretch+";font-style:"+e.fontStyle+";font-variant:"+e.fontVariant+";font-variant-caps:"+e.fontVariantCaps+";font-variant-ligatures:"+e.fontVariantLigatures+";font-variant-numeric:"+e.fontVariantNumeric+";font-weight:"+e.fontWeight+";letter-spacing:"+e.letterSpacing+";margin-left:"+e.marginLeft+";margin-right:"+e.marginRight+";padding-left:"+e.paddingLeft+";padding-right:"+e.paddingRight+";text-indent:"+e.textIndent+";text-transform:"+e.textTransform;function i(){var s=r.value||r.getAttribute("placeholder")||"",l=document.getElementById(dn)||Lc();l.style.cssText+=n,l.innerHTML=Rc(s);var a=window.getComputedStyle(l).width;return r.style.width=a,a}r.addEventListener("input",i);var o=i();return t&&t.minWidth&&o!=="0px"&&(r.style.minWidth=o),function(){r.removeEventListener("input",i);var s=document.getElementById(dn);s&&s.parentNode.removeChild(s)}};const Jg="";function So(r,t,e){const n=r.slice();return n[14]=t[e],n}function jc(r){var u,f,p;let t,e=((u=r[4])==null?void 0:u.value)+"",n,i,o,s,l,a,c=((p=(f=r[4])==null?void 0:f.creator)==null?void 0:p.type)==="Person"&&_o();return{c(){t=W("span"),n=P(e),i=Ht(),c&&c.c(),o=no(),D(t,"class","transcription svelte-fqpb4d")},m(h,d){U(h,t,d),C(t,n),U(h,i,d),c&&c.m(h,d),U(h,o,d),s=!0,l||(a=de(t,"click",r[9]),l=!0)},p(h,d){var y,g,m;(!s||d&16)&&e!==(e=((y=h[4])==null?void 0:y.value)+"")&&Yt(n,e),((m=(g=h[4])==null?void 0:g.creator)==null?void 0:m.type)==="Person"?c?(c.p(h,d),d&16&&$(c,1)):(c=_o(),c.c(),$(c,1),c.m(o.parentNode,o)):c&&(Tt(),N(c,1,1,()=>{c=null}),Mt())},i(h){s||($(c),s=!0)},o(h){N(c),s=!1},d(h){h&&B(t),h&&B(i),c&&c.d(h),h&&B(o),l=!1,a()}}}function Fc(r){let t,e,n,i;return{c(){var o;t=W("input"),t.value=e=(o=r[4])==null?void 0:o.value,D(t,"spellcheck",!1),D(t,"class","svelte-fqpb4d")},m(o,s){U(o,t,s),r[8](t),n||(i=de(t,"keydown",r[7]),n=!0)},p(o,s){var l;s&16&&e!==(e=(l=o[4])==null?void 0:l.value)&&t.value!==e&&(t.value=e)},i:x,o:x,d(o){o&&B(t),r[8](null),n=!1,i()}}}function _o(r){let t,e;return t=new un({props:{className:"verified-transcription",src:Oc}}),{c(){qe(t.$$.fragment)},m(n,i){we(t,n,i),e=!0},p:x,i(n){e||($(t.$$.fragment,n),e=!0)},o(n){N(t.$$.fragment,n),e=!1},d(n){Se(t,n)}}}function Wc(r){let t,e,n,i,o,s,l,a,c,u;const f=[Gc,Yc],p=[];function h(d,y){return d[5]?0:1}return n=h(r),i=p[n]=f[n](r),{c(){t=W("p"),e=P("Transcribed by "),i.c(),o=P("  \xB7 [ "),s=W("button"),s.textContent="Edit",l=P(" ]"),D(s,"class","add-transcription svelte-fqpb4d"),D(t,"class","transcription-details transcribed-by svelte-fqpb4d")},m(d,y){U(d,t,y),C(t,e),p[n].m(t,null),C(t,o),C(t,s),C(t,l),a=!0,c||(u=de(s,"click",r[12]),c=!0)},p(d,y){let g=n;n=h(d),n===g?p[n].p(d,y):(Tt(),N(p[g],1,1,()=>{p[g]=null}),Mt(),i=p[n],i?i.p(d,y):(i=p[n]=f[n](d),i.c()),$(i,1),i.m(t,o))},i(d){a||($(i),a=!0)},o(d){N(i),a=!1},d(d){d&&B(t),p[n].d(),c=!1,u()}}}function Hc(r){let t,e,n,i=r[0].length-1+"",o,s,l,a,c,u,f,p,h,d,y=r[6]&&Eo(r);return{c(){t=W("p"),e=W("button"),n=P("+ "),o=P(i),s=P(" more transcriptions"),l=P(" \xB7 [ "),a=W("button"),a.textContent="Edit",c=P(" ]"),u=Ht(),y&&y.c(),f=no(),D(e,"class","show-all svelte-fqpb4d"),D(a,"class","add-transcription svelte-fqpb4d"),D(t,"class","transcription-details transcription-count svelte-fqpb4d")},m(g,m){U(g,t,m),C(t,e),C(e,n),C(e,o),C(e,s),C(t,l),C(t,a),C(t,c),U(g,u,m),y&&y.m(g,m),U(g,f,m),p=!0,h||(d=[de(e,"click",r[10]),de(a,"click",r[11])],h=!0)},p(g,m){(!p||m&1)&&i!==(i=g[0].length-1+"")&&Yt(o,i),g[6]?y?(y.p(g,m),m&64&&$(y,1)):(y=Eo(g),y.c(),$(y,1),y.m(f.parentNode,f)):y&&(Tt(),N(y,1,1,()=>{y=null}),Mt())},i(g){p||($(y),p=!0)},o(g){N(y),p=!1},d(g){g&&B(t),g&&B(u),y&&y.d(g),g&&B(f),h=!1,It(d)}}}function Yc(r){var n,i;let t=((i=(n=r[4])==null?void 0:n.creator)==null?void 0:i.name)+"",e;return{c(){e=P(t)},m(o,s){U(o,e,s)},p(o,s){var l,a;s&16&&t!==(t=((a=(l=o[4])==null?void 0:l.creator)==null?void 0:a.name)+"")&&Yt(e,t)},i:x,o:x,d(o){o&&B(e)}}}function Gc(r){let t,e,n;return t=new un({props:{src:mo}}),{c(){qe(t.$$.fragment),e=P(" mapKurator")},m(i,o){we(t,i,o),U(i,e,o),n=!0},p:x,i(i){n||($(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){Se(t,i),i&&B(e)}}}function Eo(r){let t,e,n,i=r[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=ko(So(r,i,l));const s=l=>N(o[l],1,1,()=>{o[l]=null});return{c(){t=W("ul");for(let l=0;l<o.length;l+=1)o[l].c();D(t,"class","all-transcriptions svelte-fqpb4d")},m(l,a){U(l,t,a);for(let c=0;c<o.length;c+=1)o[c].m(t,null);n=!0},p(l,a){if(a&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const u=So(l,i,c);o[c]?(o[c].p(u,a),$(o[c],1)):(o[c]=ko(u),o[c].c(),$(o[c],1),o[c].m(t,null))}for(Tt(),c=i.length;c<o.length;c+=1)s(c);Mt()}},i(l){if(!n){for(let a=0;a<i.length;a+=1)$(o[a]);ve(()=>{e||(e=ho(t,yo,{duration:120},!0)),e.run(1)}),n=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)N(o[a]);e||(e=ho(t,yo,{duration:120},!1)),e.run(0),n=!1},d(l){l&&B(t),lc(o,l),l&&e&&e.end()}}}function Vc(r){let t=r[14].creator.name+"",e;return{c(){e=P(t)},m(n,i){U(n,e,i)},p(n,i){i&2&&t!==(t=n[14].creator.name+"")&&Yt(e,t)},i:x,o:x,d(n){n&&B(e)}}}function Xc(r){let t,e,n;return t=new un({props:{src:mo}}),{c(){qe(t.$$.fragment),e=P(" mapKurator")},m(i,o){we(t,i,o),U(i,e,o),n=!0},p:x,i(i){n||($(t.$$.fragment,i),n=!0)},o(i){N(t.$$.fragment,i),n=!1},d(i){Se(t,i),i&&B(e)}}}function ko(r){let t,e=r[14].value+"",n,i,o,s=wo(r[14].created)+"",l,a,c,u,f,p;const h=[Xc,Vc],d=[];function y(g,m){var v;return((v=g[14].creator)==null?void 0:v.type)==="Software"?0:1}return c=y(r),u=d[c]=h[c](r),{c(){t=W("li"),n=P(e),i=Ht(),o=W("span"),l=P(s),a=P(" by "),u.c(),f=Ht(),D(o,"class","transcribed-by svelte-fqpb4d"),D(t,"class","svelte-fqpb4d")},m(g,m){U(g,t,m),C(t,n),C(t,i),C(t,o),C(o,l),C(o,a),d[c].m(o,null),C(t,f),p=!0},p(g,m){(!p||m&2)&&e!==(e=g[14].value+"")&&Yt(n,e),(!p||m&2)&&s!==(s=wo(g[14].created)+"")&&Yt(l,s);let v=c;c=y(g),c===v?d[c].p(g,m):(Tt(),N(d[v],1,1,()=>{d[v]=null}),Mt(),u=d[c],u?u.p(g,m):(u=d[c]=h[c](g),u.c()),$(u,1),u.m(o,null))},i(g){p||($(u),p=!0)},o(g){N(u),p=!1},d(g){g&&B(t),d[c].d()}}}function zc(r){let t,e,n,i,o,s,l;const a=[Fc,jc],c=[];function u(d,y){return d[3]?0:1}e=u(r),n=c[e]=a[e](r);const f=[Hc,Wc],p=[];function h(d,y){return d[0].length>1?0:1}return o=h(r),s=p[o]=f[o](r),{c(){t=W("div"),n.c(),i=Ht(),s.c(),D(t,"class","transcription-container")},m(d,y){U(d,t,y),c[e].m(t,null),C(t,i),p[o].m(t,null),l=!0},p(d,[y]){let g=e;e=u(d),e===g?c[e].p(d,y):(Tt(),N(c[g],1,1,()=>{c[g]=null}),Mt(),n=c[e],n?n.p(d,y):(n=c[e]=a[e](d),n.c()),$(n,1),n.m(t,i));let m=o;o=h(d),o===m?p[o].p(d,y):(Tt(),N(p[m],1,1,()=>{p[m]=null}),Mt(),s=p[o],s?s.p(d,y):(s=p[o]=f[o](d),s.c()),$(s,1),s.m(t,null))},i(d){l||($(n),$(s),l=!0)},o(d){N(n),N(s),l=!1},d(d){d&&B(t),c[e].d(),p[o].d()}}}function qc(r,t,e){const n=lo();let{data:i}=t,o,s,l=!1,a,c,u=!1;const f=m=>{if(m.key==="Enter"){const{value:v}=s;v!==(a==null?void 0:a.value)&&n("addTranscription",s.value),e(3,l=!1)}else m.key==="Escape"&&e(3,l=!1)};function p(m){Qr[m?"unshift":"push"](()=>{s=m,e(2,s)})}const h=()=>e(6,u=!u),d=()=>e(6,u=!u),y=()=>e(3,l=!0),g=()=>e(3,l=!0);return r.$$set=m=>{"data"in m&&e(0,i=m.data)},r.$$.update=()=>{if(r.$$.dirty&3){e(1,o=i.slice().sort((v,w)=>v.created<w.created?1:-1));const m=o.filter(v=>{var w;return((w=v.creator)==null?void 0:w.type)==="Person"});if(m.length>0)e(4,a=m[0]);else{const v=o.find(w=>{var _,T;return((_=w.creator)==null?void 0:_.type)==="Software"&&((T=w.creator)==null?void 0:T.name)==="mapKurator:ocr"});v?(e(4,a=v),e(5,c=!0)):e(4,a=o.length>0?o[0]:null)}}r.$$.dirty&12&&l&&gc().then(()=>{Uc(s),s.focus()})},[i,o,s,l,a,c,u,f,p,h,d,y,g]}class Jc extends on{constructor(t){super(),nn(this,t,qc,zc,He,{data:0})}}var Ke=(r=>(r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r))(Ke||{}),Ao=Object.prototype.toString,Oo=function(t){var e=Ao.call(t),n=e==="[object Arguments]";return n||(n=e!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Ao.call(t.callee)==="[object Function]"),n},gn,Co;function Kc(){if(Co)return gn;Co=1;var r;if(!Object.keys){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Oo,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),s=i.call(function(){},"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=function(p){var h=p.constructor;return h&&h.prototype===p},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},u=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!c["$"+p]&&t.call(window,p)&&window[p]!==null&&typeof window[p]=="object")try{a(window[p])}catch{return!0}}catch{return!0}return!1}(),f=function(p){if(typeof window>"u"||!u)return a(p);try{return a(p)}catch{return!1}};r=function(h){var d=h!==null&&typeof h=="object",y=e.call(h)==="[object Function]",g=n(h),m=d&&e.call(h)==="[object String]",v=[];if(!d&&!y&&!g)throw new TypeError("Object.keys called on a non-object");var w=s&&y;if(m&&h.length>0&&!t.call(h,0))for(var _=0;_<h.length;++_)v.push(String(_));if(g&&h.length>0)for(var T=0;T<h.length;++T)v.push(String(T));else for(var q in h)!(w&&q==="prototype")&&t.call(h,q)&&v.push(String(q));if(o)for(var lt=f(h),J=0;J<l.length;++J)!(lt&&l[J]==="constructor")&&t.call(h,l[J])&&v.push(l[J]);return v}}return gn=r,gn}var Zc=Array.prototype.slice,Qc=Oo,xo=Object.keys,Ze=xo?function(t){return xo(t)}:Kc(),$o=Object.keys;Ze.shim=function(){if(Object.keys){var t=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);t||(Object.keys=function(n){return Qc(n)?$o(Zc.call(n)):$o(n)})}else Object.keys=Ze;return Object.keys||Ze};var yn=Ze,Qe=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),n=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[e]=i;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(t,e);if(s.value!==i||s.enumerable!==!0)return!1}return!0},tu=Qe,bt=function(){return tu()&&!!Symbol.toStringTag},Io=typeof Symbol<"u"&&Symbol,eu=Qe,mn=function(){return typeof Io!="function"||typeof Symbol!="function"||typeof Io("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:eu()},ru="Function.prototype.bind called on incompatible ",vn=Array.prototype.slice,nu=Object.prototype.toString,iu="[object Function]",ou=function(t){var e=this;if(typeof e!="function"||nu.call(e)!==iu)throw new TypeError(ru+e);for(var n=vn.call(arguments,1),i,o=function(){if(this instanceof i){var u=e.apply(this,n.concat(vn.call(arguments)));return Object(u)===u?u:this}else return e.apply(t,n.concat(vn.call(arguments)))},s=Math.max(0,e.length-n.length),l=[],a=0;a<s;a++)l.push("$"+a);if(i=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var c=function(){};c.prototype=e.prototype,i.prototype=new c,c.prototype=null}return i},su=ou,bn=Function.prototype.bind||su,lu=bn,au=lu.call(Function.call,Object.prototype.hasOwnProperty),S,Gt=SyntaxError,To=Function,Vt=TypeError,wn=function(r){try{return To('"use strict"; return ('+r+").constructor;")()}catch{}},Dt=Object.getOwnPropertyDescriptor;if(Dt)try{Dt({},"")}catch{Dt=null}var Sn=function(){throw new Vt},cu=Dt?function(){try{return arguments.callee,Sn}catch{try{return Dt(arguments,"callee").get}catch{return Sn}}}():Sn,Xt=mn(),wt=Object.getPrototypeOf||function(r){return r.__proto__},zt={},uu=typeof Uint8Array>"u"?S:wt(Uint8Array),qt={"%AggregateError%":typeof AggregateError>"u"?S:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?S:ArrayBuffer,"%ArrayIteratorPrototype%":Xt?wt([][Symbol.iterator]()):S,"%AsyncFromSyncIteratorPrototype%":S,"%AsyncFunction%":zt,"%AsyncGenerator%":zt,"%AsyncGeneratorFunction%":zt,"%AsyncIteratorPrototype%":zt,"%Atomics%":typeof Atomics>"u"?S:Atomics,"%BigInt%":typeof BigInt>"u"?S:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?S:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?S:Float32Array,"%Float64Array%":typeof Float64Array>"u"?S:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?S:FinalizationRegistry,"%Function%":To,"%GeneratorFunction%":zt,"%Int8Array%":typeof Int8Array>"u"?S:Int8Array,"%Int16Array%":typeof Int16Array>"u"?S:Int16Array,"%Int32Array%":typeof Int32Array>"u"?S:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Xt?wt(wt([][Symbol.iterator]())):S,"%JSON%":typeof JSON=="object"?JSON:S,"%Map%":typeof Map>"u"?S:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Xt?S:wt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?S:Promise,"%Proxy%":typeof Proxy>"u"?S:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?S:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?S:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Xt?S:wt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?S:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Xt?wt(""[Symbol.iterator]()):S,"%Symbol%":Xt?Symbol:S,"%SyntaxError%":Gt,"%ThrowTypeError%":cu,"%TypedArray%":uu,"%TypeError%":Vt,"%Uint8Array%":typeof Uint8Array>"u"?S:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?S:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?S:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?S:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?S:WeakMap,"%WeakRef%":typeof WeakRef>"u"?S:WeakRef,"%WeakSet%":typeof WeakSet>"u"?S:WeakSet},fu=function r(t){var e;if(t==="%AsyncFunction%")e=wn("async function () {}");else if(t==="%GeneratorFunction%")e=wn("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=wn("async function* () {}");else if(t==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(e=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&(e=wt(i.prototype))}return qt[t]=e,e},Mo={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_e=bn,tr=au,hu=_e.call(Function.call,Array.prototype.concat),pu=_e.call(Function.apply,Array.prototype.splice),Do=_e.call(Function.call,String.prototype.replace),er=_e.call(Function.call,String.prototype.slice),du=_e.call(Function.call,RegExp.prototype.exec),gu=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,yu=/\\(\\)?/g,mu=function(t){var e=er(t,0,1),n=er(t,-1);if(e==="%"&&n!=="%")throw new Gt("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&e!=="%")throw new Gt("invalid intrinsic syntax, expected opening `%`");var i=[];return Do(t,gu,function(o,s,l,a){i[i.length]=l?Do(a,yu,"$1"):s||o}),i},vu=function(t,e){var n=t,i;if(tr(Mo,n)&&(i=Mo[n],n="%"+i[0]+"%"),tr(qt,n)){var o=qt[n];if(o===zt&&(o=fu(n)),typeof o>"u"&&!e)throw new Vt("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Gt("intrinsic "+t+" does not exist!")},St=function(t,e){if(typeof t!="string"||t.length===0)throw new Vt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new Vt('"allowMissing" argument must be a boolean');if(du(/^%?[^%]*%?$/,t)===null)throw new Gt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=mu(t),i=n.length>0?n[0]:"",o=vu("%"+i+"%",e),s=o.name,l=o.value,a=!1,c=o.alias;c&&(i=c[0],pu(n,hu([0,1],c)));for(var u=1,f=!0;u<n.length;u+=1){var p=n[u],h=er(p,0,1),d=er(p,-1);if((h==='"'||h==="'"||h==="`"||d==='"'||d==="'"||d==="`")&&h!==d)throw new Gt("property names with quotes must have matching quotes");if((p==="constructor"||!f)&&(a=!0),i+="."+p,s="%"+i+"%",tr(qt,s))l=qt[s];else if(l!=null){if(!(p in l)){if(!e)throw new Vt("base intrinsic for "+t+" exists, but the property is not available.");return}if(Dt&&u+1>=n.length){var y=Dt(l,p);f=!!y,f&&"get"in y&&!("originalValue"in y.get)?l=y.get:l=l[p]}else f=tr(l,p),l=l[p];f&&!a&&(qt[s]=l)}}return l},Ee={exports:{}};(function(r){var t=bn,e=St,n=e("%Function.prototype.apply%"),i=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||t.call(i,n),s=e("%Object.getOwnPropertyDescriptor%",!0),l=e("%Object.defineProperty%",!0),a=e("%Math.max%");if(l)try{l({},"a",{value:1})}catch{l=null}r.exports=function(f){var p=o(t,i,arguments);if(s&&l){var h=s(p,"length");h.configurable&&l(p,"length",{value:1+a(0,f.length-(arguments.length-1))})}return p};var c=function(){return o(t,n,arguments)};l?l(r.exports,"apply",{value:c}):r.exports.apply=c})(Ee);var Bo=St,Po=Ee.exports,bu=Po(Bo("String.prototype.indexOf")),et=function(t,e){var n=Bo(t,!!e);return typeof n=="function"&&bu(t,".prototype.")>-1?Po(n):n},wu=bt(),Su=et,_n=Su("Object.prototype.toString"),rr=function(t){return wu&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:_n(t)==="[object Arguments]"},No=function(t){return rr(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&_n(t)!=="[object Array]"&&_n(t.callee)==="[object Function]"},_u=function(){return rr(arguments)}();rr.isLegacyArguments=No;var Ro=_u?rr:No,Eu=St,En=Eu("%Object.defineProperty%",!0),kn=function(){if(En)try{return En({},"a",{value:1}),!0}catch{return!1}return!1};kn.hasArrayLengthDefineBug=function(){if(!kn())return null;try{return En([],"length",{value:1}).length!==1}catch{return!0}};var ku=kn,Au=yn,Ou=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Cu=Object.prototype.toString,xu=Array.prototype.concat,Lo=Object.defineProperty,$u=function(r){return typeof r=="function"&&Cu.call(r)==="[object Function]"},Iu=ku(),Uo=Lo&&Iu,Tu=function(r,t,e,n){t in r&&(!$u(n)||!n())||(Uo?Lo(r,t,{configurable:!0,enumerable:!1,value:e,writable:!0}):r[t]=e)},jo=function(r,t){var e=arguments.length>2?arguments[2]:{},n=Au(t);Ou&&(n=xu.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)Tu(r,n[i],t[n[i]],e[n[i]])};jo.supportsDescriptors=!!Uo;var Bt=jo,Fo=function(r){return r!==r},Wo=function(t,e){return t===0&&e===0?1/t===1/e:!!(t===e||Fo(t)&&Fo(e))},Mu=Wo,Ho=function(){return typeof Object.is=="function"?Object.is:Mu},Du=Ho,Bu=Bt,Pu=function(){var t=Du();return Bu(Object,{is:t},{is:function(){return Object.is!==t}}),t},Nu=Bt,Ru=Ee.exports,Lu=Wo,Yo=Ho,Uu=Pu,Go=Ru(Yo(),Object);Nu(Go,{getPolyfill:Yo,implementation:Lu,shim:Uu});var ju=Go,An=et,Vo=bt(),Xo,zo,On,Cn;if(Vo){Xo=An("Object.prototype.hasOwnProperty"),zo=An("RegExp.prototype.exec"),On={};var xn=function(){throw On};Cn={toString:xn,valueOf:xn},typeof Symbol.toPrimitive=="symbol"&&(Cn[Symbol.toPrimitive]=xn)}var Fu=An("Object.prototype.toString"),Wu=Object.getOwnPropertyDescriptor,Hu="[object RegExp]",Yu=Vo?function(t){if(!t||typeof t!="object")return!1;var e=Wu(t,"lastIndex"),n=e&&Xo(e,"value");if(!n)return!1;try{zo(t,Cn)}catch(i){return i===On}}:function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:Fu(t)===Hu},$n={exports:{}},ke=function(){return typeof function(){}.name=="string"},Ae=Object.getOwnPropertyDescriptor;if(Ae)try{Ae([],"length")}catch{Ae=null}ke.functionsHaveConfigurableNames=function(){if(!ke()||!Ae)return!1;var t=Ae(function(){},"name");return!!t&&!!t.configurable};var Gu=Function.prototype.bind;ke.boundFunctionsHaveNames=function(){return ke()&&typeof Gu=="function"&&function(){}.bind().name!==""};var Vu=ke;(function(r){var t=Vu.functionsHaveConfigurableNames(),e=Object,n=TypeError;r.exports=function(){if(this!=null&&this!==e(this))throw new n("RegExp.prototype.flags getter called on non-object");var o="";return this.hasIndices&&(o+="d"),this.global&&(o+="g"),this.ignoreCase&&(o+="i"),this.multiline&&(o+="m"),this.dotAll&&(o+="s"),this.unicode&&(o+="u"),this.sticky&&(o+="y"),o},t&&Object.defineProperty&&Object.defineProperty(r.exports,"name",{value:"get flags"})})($n);var Xu=$n.exports,zu=Bt.supportsDescriptors,qu=Object.getOwnPropertyDescriptor,qo=function(){if(zu&&/a/mig.flags==="gim"){var t=qu(RegExp.prototype,"flags");if(t&&typeof t.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var e="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(n,"sticky",{get:function(){e+="y"}}),e==="dy")return t.get}}return Xu},Ju=Bt.supportsDescriptors,Ku=qo,Zu=Object.getOwnPropertyDescriptor,Qu=Object.defineProperty,tf=TypeError,Jo=Object.getPrototypeOf,ef=/a/,rf=function(){if(!Ju||!Jo)throw new tf("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Ku(),e=Jo(ef),n=Zu(e,"flags");return(!n||n.get!==t)&&Qu(e,"flags",{configurable:!0,enumerable:!1,get:t}),t},nf=Bt,of=Ee.exports,sf=$n.exports,Ko=qo,lf=rf,Zo=of(Ko());nf(Zo,{getPolyfill:Ko,implementation:sf,shim:lf});var af=Zo,cf={}.toString,Qo=Array.isArray||function(r){return cf.call(r)=="[object Array]"},uf=Date.prototype.getDay,ff=function(t){try{return uf.call(t),!0}catch{return!1}},hf=Object.prototype.toString,pf="[object Date]",df=bt(),gf=function(t){return typeof t!="object"||t===null?!1:df?ff(t):hf.call(t)===pf},yf=String.prototype.valueOf,mf=function(t){try{return yf.call(t),!0}catch{return!1}},vf=Object.prototype.toString,bf="[object String]",wf=bt(),ts=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:wf?mf(t):vf.call(t)===bf},Sf=Number.prototype.toString,_f=function(t){try{return Sf.call(t),!0}catch{return!1}},Ef=Object.prototype.toString,kf="[object Number]",Af=bt(),Of=function(t){return typeof t=="number"?!0:typeof t!="object"?!1:Af?_f(t):Ef.call(t)===kf},es=et,Cf=es("Boolean.prototype.toString"),xf=es("Object.prototype.toString"),$f=function(t){try{return Cf(t),!0}catch{return!1}},If="[object Boolean]",Tf=bt(),Mf=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:Tf&&Symbol.toStringTag in t?$f(t):xf(t)===If},In={exports:{}},Df=Object.prototype.toString,Bf=mn();if(Bf){var Pf=Symbol.prototype.toString,Nf=/^Symbol\(.*\)$/,Rf=function(t){return typeof t.valueOf()!="symbol"?!1:Nf.test(Pf.call(t))};In.exports=function(t){if(typeof t=="symbol")return!0;if(Df.call(t)!=="[object Symbol]")return!1;try{return Rf(t)}catch{return!1}}}else In.exports=function(t){return!1};var Tn={exports:{}},rs=typeof BigInt<"u"&&BigInt,Lf=function(){return typeof rs=="function"&&typeof BigInt=="function"&&typeof rs(42)=="bigint"&&typeof BigInt(42)=="bigint"},Uf=Lf();if(Uf){var jf=BigInt.prototype.valueOf,Ff=function(t){try{return jf.call(t),!0}catch{}return!1};Tn.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:Ff(t)}}else Tn.exports=function(t){return!1};var Wf=ts,Hf=Of,Yf=Mf,Gf=In.exports,Vf=Tn.exports,Xf=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(Wf(t))return"String";if(Hf(t))return"Number";if(Yf(t))return"Boolean";if(Gf(t))return"Symbol";if(Vf(t))return"BigInt"},Mn=typeof Map=="function"&&Map.prototype?Map:null,zf=typeof Set=="function"&&Set.prototype?Set:null,nr;Mn||(nr=function(t){return!1});var ns=Mn?Map.prototype.has:null,is=zf?Set.prototype.has:null;!nr&&!ns&&(nr=function(t){return!1});var os=nr||function(t){if(!t||typeof t!="object")return!1;try{if(ns.call(t),is)try{is.call(t)}catch{return!0}return t instanceof Mn}catch{}return!1},qf=typeof Map=="function"&&Map.prototype?Map:null,Dn=typeof Set=="function"&&Set.prototype?Set:null,ir;Dn||(ir=function(t){return!1});var ss=qf?Map.prototype.has:null,ls=Dn?Set.prototype.has:null;!ir&&!ls&&(ir=function(t){return!1});var as=ir||function(t){if(!t||typeof t!="object")return!1;try{if(ls.call(t),ss)try{ss.call(t)}catch{return!0}return t instanceof Dn}catch{}return!1},or=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,cs=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,sr;or||(sr=function(t){return!1});var Bn=or?or.prototype.has:null,Pn=cs?cs.prototype.has:null;!sr&&!Bn&&(sr=function(t){return!1});var Jf=sr||function(t){if(!t||typeof t!="object")return!1;try{if(Bn.call(t,Bn),Pn)try{Pn.call(t,Pn)}catch{return!0}return t instanceof or}catch{}return!1},Nn={exports:{}},Kf=St,us=et,Zf=Kf("%WeakSet%",!0),Rn=us("WeakSet.prototype.has",!0);if(Rn){var Ln=us("WeakMap.prototype.has",!0);Nn.exports=function(t){if(!t||typeof t!="object")return!1;try{if(Rn(t,Rn),Ln)try{Ln(t,Ln)}catch{return!0}return t instanceof Zf}catch{}return!1}}else Nn.exports=function(t){return!1};var Qf=os,th=as,eh=Jf,rh=Nn.exports,nh=function(t){if(t&&typeof t=="object"){if(Qf(t))return"Map";if(th(t))return"Set";if(eh(t))return"WeakMap";if(rh(t))return"WeakSet"}return!1},lr={exports:{}},fs=Ro;if(mn()||Qe()){var Un=Symbol.iterator;lr.exports=function(t){if(t!=null&&typeof t[Un]<"u")return t[Un]();if(fs(t))return Array.prototype[Un].call(t)}}else{var ih=Qo,oh=ts,hs=St,sh=hs("%Map%",!0),lh=hs("%Set%",!0),Q=et,ps=Q("Array.prototype.push"),ds=Q("String.prototype.charCodeAt"),ah=Q("String.prototype.slice"),ch=function(t,e){var n=t.length;if(e+1>=n)return e+1;var i=ds(t,e);if(i<55296||i>56319)return e+1;var o=ds(t,e+1);return o<56320||o>57343?e+1:e+2},jn=function(t){var e=0;return{next:function(){var i=e>=t.length,o;return i||(o=t[e],e+=1),{done:i,value:o}}}},gs=function(t,e){if(ih(t)||fs(t))return jn(t);if(oh(t)){var n=0;return{next:function(){var o=ch(t,n),s=ah(t,n,o);return n=o,{done:o>t.length,value:s}}}}if(e&&typeof t["_es6-shim iterator_"]<"u")return t["_es6-shim iterator_"]()};if(!sh&&!lh)lr.exports=function(t){if(t!=null)return gs(t,!0)};else{var uh=os,fh=as,ys=Q("Map.prototype.forEach",!0),ms=Q("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var vs=Q("Map.prototype.iterator",!0),bs=Q("Set.prototype.iterator",!0),ws=function(r){var t=!1;return{next:function(){try{return{done:t,value:t?void 0:r.next()}}catch{return t=!0,{done:!0,value:void 0}}}}};var Ss=Q("Map.prototype.@@iterator",!0)||Q("Map.prototype._es6-shim iterator_",!0),_s=Q("Set.prototype.@@iterator",!0)||Q("Set.prototype._es6-shim iterator_",!0),hh=function(t){if(uh(t)){if(vs)return ws(vs(t));if(Ss)return Ss(t);if(ys){var e=[];return ys(t,function(i,o){ps(e,[o,i])}),jn(e)}}if(fh(t)){if(bs)return ws(bs(t));if(_s)return _s(t);if(ms){var n=[];return ms(t,function(i){ps(n,i)}),jn(n)}}};lr.exports=function(t){return hh(t)||gs(t)}}}const ph=Bc(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Fn=typeof Map=="function"&&Map.prototype,Wn=Object.getOwnPropertyDescriptor&&Fn?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,ar=Fn&&Wn&&typeof Wn.get=="function"?Wn.get:null,dh=Fn&&Map.prototype.forEach,Hn=typeof Set=="function"&&Set.prototype,Yn=Object.getOwnPropertyDescriptor&&Hn?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,cr=Hn&&Yn&&typeof Yn.get=="function"?Yn.get:null,gh=Hn&&Set.prototype.forEach,yh=typeof WeakMap=="function"&&WeakMap.prototype,Oe=yh?WeakMap.prototype.has:null,mh=typeof WeakSet=="function"&&WeakSet.prototype,Ce=mh?WeakSet.prototype.has:null,vh=typeof WeakRef=="function"&&WeakRef.prototype,Es=vh?WeakRef.prototype.deref:null,bh=Boolean.prototype.valueOf,wh=Object.prototype.toString,Sh=Function.prototype.toString,_h=String.prototype.match,Gn=String.prototype.slice,_t=String.prototype.replace,Eh=String.prototype.toUpperCase,ks=String.prototype.toLowerCase,As=RegExp.prototype.test,Os=Array.prototype.concat,rt=Array.prototype.join,kh=Array.prototype.slice,Cs=Math.floor,Vn=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Xn=Object.getOwnPropertySymbols,zn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",H=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Jt?"object":"symbol")?Symbol.toStringTag:null,xs=Object.prototype.propertyIsEnumerable,$s=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Is(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||As.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-Cs(-r):Cs(r);if(n!==r){var i=String(n),o=Gn.call(t,i.length+1);return _t.call(i,e,"$&_")+"."+_t.call(_t.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _t.call(t,e,"$&_")}var qn=ph,Ts=qn.custom,Ms=Ps(Ts)?Ts:null,Ah=function r(t,e,n,i){var o=e||{};if(Et(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Et(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Et(o,"customInspect")?o.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Et(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Et(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Rs(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var a=String(t);return l?Is(t,a):a}if(typeof t=="bigint"){var c=String(t)+"n";return l?Is(t,c):c}var u=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=u&&u>0&&typeof t=="object")return Jn(t)?"[Array]":"[Object]";var f=Hh(o,n);if(typeof i>"u")i=[];else if(Ns(i,t)>=0)return"[Circular]";function p(ct,xt,he){if(xt&&(i=kh.call(i),i.push(xt)),he){var jt={depth:o.depth};return Et(o,"quoteStyle")&&(jt.quoteStyle=o.quoteStyle),r(ct,jt,n+1,i)}return r(ct,o,n+1,i)}if(typeof t=="function"&&!Bs(t)){var h=Bh(t),d=ur(t,p);return"[Function"+(h?": "+h:" (anonymous)")+"]"+(d.length>0?" { "+rt.call(d,", ")+" }":"")}if(Ps(t)){var y=Jt?_t.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):zn.call(t);return typeof t=="object"&&!Jt?xe(y):y}if(jh(t)){for(var g="<"+ks.call(String(t.nodeName)),m=t.attributes||[],v=0;v<m.length;v++)g+=" "+m[v].name+"="+Ds(Oh(m[v].value),"double",o);return g+=">",t.childNodes&&t.childNodes.length&&(g+="..."),g+="</"+ks.call(String(t.nodeName))+">",g}if(Jn(t)){if(t.length===0)return"[]";var w=ur(t,p);return f&&!Wh(w)?"["+Zn(w,f)+"]":"[ "+rt.call(w,", ")+" ]"}if(xh(t)){var _=ur(t,p);return!("cause"in Error.prototype)&&"cause"in t&&!xs.call(t,"cause")?"{ ["+String(t)+"] "+rt.call(Os.call("[cause]: "+p(t.cause),_),", ")+" }":_.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+rt.call(_,", ")+" }"}if(typeof t=="object"&&s){if(Ms&&typeof t[Ms]=="function"&&qn)return qn(t,{depth:u-n});if(s!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Ph(t)){var T=[];return dh.call(t,function(ct,xt){T.push(p(xt,t,!0)+" => "+p(ct,t))}),Ls("Map",ar.call(t),T,f)}if(Lh(t)){var q=[];return gh.call(t,function(ct){q.push(p(ct,t))}),Ls("Set",cr.call(t),q,f)}if(Nh(t))return Kn("WeakMap");if(Uh(t))return Kn("WeakSet");if(Rh(t))return Kn("WeakRef");if(Ih(t))return xe(p(Number(t)));if(Mh(t))return xe(p(Vn.call(t)));if(Th(t))return xe(bh.call(t));if($h(t))return xe(p(String(t)));if(!Ch(t)&&!Bs(t)){var lt=ur(t,p),J=$s?$s(t)===Object.prototype:t instanceof Object||t.constructor===Object,tt=t instanceof Object?"":"null prototype",at=!J&&H&&Object(t)===t&&H in t?Gn.call(kt(t),8,-1):tt?"Object":"",Ut=J||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",mt=Ut+(at||tt?"["+rt.call(Os.call([],at||[],tt||[]),": ")+"] ":"");return lt.length===0?mt+"{}":f?mt+"{"+Zn(lt,f)+"}":mt+"{ "+rt.call(lt,", ")+" }"}return String(t)};function Ds(r,t,e){var n=(e.quoteStyle||t)==="double"?'"':"'";return n+r+n}function Oh(r){return _t.call(String(r),/"/g,"&quot;")}function Jn(r){return kt(r)==="[object Array]"&&(!H||!(typeof r=="object"&&H in r))}function Ch(r){return kt(r)==="[object Date]"&&(!H||!(typeof r=="object"&&H in r))}function Bs(r){return kt(r)==="[object RegExp]"&&(!H||!(typeof r=="object"&&H in r))}function xh(r){return kt(r)==="[object Error]"&&(!H||!(typeof r=="object"&&H in r))}function $h(r){return kt(r)==="[object String]"&&(!H||!(typeof r=="object"&&H in r))}function Ih(r){return kt(r)==="[object Number]"&&(!H||!(typeof r=="object"&&H in r))}function Th(r){return kt(r)==="[object Boolean]"&&(!H||!(typeof r=="object"&&H in r))}function Ps(r){if(Jt)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!zn)return!1;try{return zn.call(r),!0}catch{}return!1}function Mh(r){if(!r||typeof r!="object"||!Vn)return!1;try{return Vn.call(r),!0}catch{}return!1}var Dh=Object.prototype.hasOwnProperty||function(r){return r in this};function Et(r,t){return Dh.call(r,t)}function kt(r){return wh.call(r)}function Bh(r){if(r.name)return r.name;var t=_h.call(Sh.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function Ns(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,n=r.length;e<n;e++)if(r[e]===t)return e;return-1}function Ph(r){if(!ar||!r||typeof r!="object")return!1;try{ar.call(r);try{cr.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Nh(r){if(!Oe||!r||typeof r!="object")return!1;try{Oe.call(r,Oe);try{Ce.call(r,Ce)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Rh(r){if(!Es||!r||typeof r!="object")return!1;try{return Es.call(r),!0}catch{}return!1}function Lh(r){if(!cr||!r||typeof r!="object")return!1;try{cr.call(r);try{ar.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function Uh(r){if(!Ce||!r||typeof r!="object")return!1;try{Ce.call(r,Ce);try{Oe.call(r,Oe)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function jh(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Rs(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,n="... "+e+" more character"+(e>1?"s":"");return Rs(Gn.call(r,0,t.maxStringLength),t)+n}var i=_t.call(_t.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Fh);return Ds(i,"single",t)}function Fh(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Eh.call(t.toString(16))}function xe(r){return"Object("+r+")"}function Kn(r){return r+" { ? }"}function Ls(r,t,e,n){var i=n?Zn(e,n):rt.call(e,", ");return r+" ("+t+") {"+i+"}"}function Wh(r){for(var t=0;t<r.length;t++)if(Ns(r[t],`
`)>=0)return!1;return!0}function Hh(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=rt.call(Array(r.indent+1)," ");else return null;return{base:e,prev:rt.call(Array(t+1),e)}}function Zn(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+rt.call(r,","+e)+`
`+t.prev}function ur(r,t){var e=Jn(r),n=[];if(e){n.length=r.length;for(var i=0;i<r.length;i++)n[i]=Et(r,i)?t(r[i],r):""}var o=typeof Xn=="function"?Xn(r):[],s;if(Jt){s={};for(var l=0;l<o.length;l++)s["$"+o[l]]=o[l]}for(var a in r)!Et(r,a)||e&&String(Number(a))===a&&a<r.length||Jt&&s["$"+a]instanceof Symbol||(As.call(/[^\w$]/,a)?n.push(t(a,r)+": "+t(r[a],r)):n.push(a+": "+t(r[a],r)));if(typeof Xn=="function")for(var c=0;c<o.length;c++)xs.call(r,o[c])&&n.push("["+t(o[c])+"]: "+t(r[o[c]],r));return n}var Qn=St,Kt=et,Yh=Ah,Gh=Qn("%TypeError%"),fr=Qn("%WeakMap%",!0),hr=Qn("%Map%",!0),Vh=Kt("WeakMap.prototype.get",!0),Xh=Kt("WeakMap.prototype.set",!0),zh=Kt("WeakMap.prototype.has",!0),qh=Kt("Map.prototype.get",!0),Jh=Kt("Map.prototype.set",!0),Kh=Kt("Map.prototype.has",!0),ti=function(r,t){for(var e=r,n;(n=e.next)!==null;e=n)if(n.key===t)return e.next=n.next,n.next=r.next,r.next=n,n},Zh=function(r,t){var e=ti(r,t);return e&&e.value},Qh=function(r,t,e){var n=ti(r,t);n?n.value=e:r.next={key:t,next:r.next,value:e}},tp=function(r,t){return!!ti(r,t)},ep=function(){var t,e,n,i={assert:function(o){if(!i.has(o))throw new Gh("Side channel does not contain "+Yh(o))},get:function(o){if(fr&&o&&(typeof o=="object"||typeof o=="function")){if(t)return Vh(t,o)}else if(hr){if(e)return qh(e,o)}else if(n)return Zh(n,o)},has:function(o){if(fr&&o&&(typeof o=="object"||typeof o=="function")){if(t)return zh(t,o)}else if(hr){if(e)return Kh(e,o)}else if(n)return tp(n,o);return!1},set:function(o,s){fr&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new fr),Xh(t,o,s)):hr?(e||(e=new hr),Jh(e,o,s)):(n||(n={key:{},next:null}),Qh(n,o,s))}};return i},Us=Function.prototype.toString,Zt=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,ei,pr;if(typeof Zt=="function"&&typeof Object.defineProperty=="function")try{ei=Object.defineProperty({},"length",{get:function(){throw pr}}),pr={},Zt(function(){throw 42},null,ei)}catch(r){r!==pr&&(Zt=null)}else Zt=null;var rp=/^\s*class\b/,ri=function(t){try{var e=Us.call(t);return rp.test(e)}catch{return!1}},ni=function(t){try{return ri(t)?!1:(Us.call(t),!0)}catch{return!1}},dr=Object.prototype.toString,np="[object Object]",ip="[object Function]",op="[object GeneratorFunction]",sp="[object HTMLAllCollection]",lp="[object HTML document.all class]",ap="[object HTMLCollection]",cp=typeof Symbol=="function"&&!!Symbol.toStringTag,up=!(0 in[,]),ii=function(){return!1};if(typeof document=="object"){var fp=document.all;dr.call(fp)===dr.call(document.all)&&(ii=function(t){if((up||!t)&&(typeof t>"u"||typeof t=="object"))try{var e=dr.call(t);return(e===sp||e===lp||e===ap||e===np)&&t("")==null}catch{}return!1})}var hp=Zt?function(t){if(ii(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{Zt(t,null,ei)}catch(e){if(e!==pr)return!1}return!ri(t)&&ni(t)}:function(t){if(ii(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(cp)return ni(t);if(ri(t))return!1;var e=dr.call(t);return e!==ip&&e!==op&&!/^\[object HTML/.test(e)?!1:ni(t)},pp=hp,dp=Object.prototype.toString,js=Object.prototype.hasOwnProperty,gp=function(t,e,n){for(var i=0,o=t.length;i<o;i++)js.call(t,i)&&(n==null?e(t[i],i,t):e.call(n,t[i],i,t))},yp=function(t,e,n){for(var i=0,o=t.length;i<o;i++)n==null?e(t.charAt(i),i,t):e.call(n,t.charAt(i),i,t)},mp=function(t,e,n){for(var i in t)js.call(t,i)&&(n==null?e(t[i],i,t):e.call(n,t[i],i,t))},vp=function(t,e,n){if(!pp(e))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),dp.call(t)==="[object Array]"?gp(t,e,i):typeof t=="string"?yp(t,e,i):mp(t,e,i)},Fs=vp,oi=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],bp=typeof globalThis>"u"?pn:globalThis,Ws=function(){for(var t=[],e=0;e<oi.length;e++)typeof bp[oi[e]]=="function"&&(t[t.length]=oi[e]);return t},wp=St,gr=wp("%Object.getOwnPropertyDescriptor%",!0);if(gr)try{gr([],"length")}catch{gr=null}var Hs=gr,si,Ys;function Sp(){if(Ys)return si;Ys=1;var r=Fs,t=Ws,e=et,n=e("Object.prototype.toString"),i=bt(),o=Hs,s=typeof globalThis>"u"?pn:globalThis,l=t(),a=e("Array.prototype.indexOf",!0)||function(d,y){for(var g=0;g<d.length;g+=1)if(d[g]===y)return g;return-1},c=e("String.prototype.slice"),u={},f=Object.getPrototypeOf;i&&o&&f&&r(l,function(h){var d=new s[h];if(Symbol.toStringTag in d){var y=f(d),g=o(y,Symbol.toStringTag);if(!g){var m=f(y);g=o(m,Symbol.toStringTag)}u[h]=g.get}});var p=function(d){var y=!1;return r(u,function(g,m){if(!y)try{y=g.call(d)===m}catch{}}),y};return si=function(d){if(!d||typeof d!="object")return!1;if(!i||!(Symbol.toStringTag in d)){var y=c(n(d),8,-1);return a(l,y)>-1}return o?p(d):!1},si}var Gs=Fs,_p=Ws,Vs=et,li=Hs,Ep=Vs("Object.prototype.toString"),Xs=bt(),zs=typeof globalThis>"u"?pn:globalThis,kp=_p(),Ap=Vs("String.prototype.slice"),qs={},ai=Object.getPrototypeOf;Xs&&li&&ai&&Gs(kp,function(r){if(typeof zs[r]=="function"){var t=new zs[r];if(Symbol.toStringTag in t){var e=ai(t),n=li(e,Symbol.toStringTag);if(!n){var i=ai(e);n=li(i,Symbol.toStringTag)}qs[r]=n.get}}});var Op=function(t){var e=!1;return Gs(qs,function(n,i){if(!e)try{var o=n.call(t);o===i&&(e=o)}catch{}}),e},Cp=Sp(),xp=function(t){return Cp(t)?!Xs||!(Symbol.toStringTag in t)?Ap(Ep(t),8,-1):Op(t):!1},$p=yn,Js=Qe(),Ks=et,Zs=Object,Ip=Ks("Array.prototype.push"),Qs=Ks("Object.prototype.propertyIsEnumerable"),Tp=Js?Object.getOwnPropertySymbols:null,tl=function(t,e){if(t==null)throw new TypeError("target must be an object");var n=Zs(t);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=Zs(arguments[i]),s=$p(o),l=Js&&(Object.getOwnPropertySymbols||Tp);if(l)for(var a=l(o),c=0;c<a.length;++c){var u=a[c];Qs(o,u)&&Ip(s,u)}for(var f=0;f<s.length;++f){var p=s[f];if(Qs(o,p)){var h=o[p];n[p]=h}}}return n},ci=tl,Mp=function(){if(!Object.assign)return!1;for(var r="abcdefghijklmnopqrst",t=r.split(""),e={},n=0;n<t.length;++n)e[t[n]]=t[n];var i=Object.assign({},e),o="";for(var s in i)o+=s;return r!==o},Dp=function(){if(!Object.assign||!Object.preventExtensions)return!1;var r=Object.preventExtensions({1:2});try{Object.assign(r,"xy")}catch{return r[1]==="y"}return!1},el=function(){return!Object.assign||Mp()||Dp()?ci:Object.assign},Bp=Bt,Pp=el,Np=function(){var t=Pp();return Bp(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t},Rp=Bt,Lp=Ee.exports,Up=tl,rl=el,jp=Np,Fp=Lp.apply(rl()),nl=function(t,e){return Fp(Object,arguments)};Rp(nl,{getPolyfill:rl,implementation:Up,shim:jp});var Wp=nl,il=yn,ol=Ro,sl=ju,ll=Yu,al=af,cl=Qo,ul=gf,fl=Xf,Hp=St,nt=et,hl=nh,Qt=lr.exports,Yp=ep,pl=xp,dl=Wp,yr=nt("ArrayBuffer.prototype.byteLength",!0);function gl(r){if(!r||typeof r!="object"||!yr)return!1;try{return yr(r),!0}catch{return!1}}var yl=nt("Date.prototype.getTime"),ui=Object.getPrototypeOf,ml=nt("Object.prototype.toString"),mr=Hp("%Set%",!0),fi=nt("Map.prototype.has",!0),vr=nt("Map.prototype.get",!0),vl=nt("Map.prototype.size",!0),br=nt("Set.prototype.add",!0),bl=nt("Set.prototype.delete",!0),wr=nt("Set.prototype.has",!0),Sr=nt("Set.prototype.size",!0);function wl(r,t,e,n){for(var i=Qt(r),o;(o=i.next())&&!o.done;)if(it(t,o.value,e,n))return bl(r,o.value),!0;return!1}function Sl(r){if(typeof r>"u")return null;if(typeof r!="object")return typeof r=="symbol"?!1:typeof r=="string"||typeof r=="number"?+r==+r:!0}function Gp(r,t,e,n,i,o){var s=Sl(e);if(s!=null)return s;var l=vr(t,s),a=dl({},i,{strict:!1});return typeof l>"u"&&!fi(t,s)||!it(n,l,a,o)?!1:!fi(r,s)&&it(n,l,a,o)}function Vp(r,t,e){var n=Sl(e);return n!=null?n:wr(t,n)&&!wr(r,n)}function _l(r,t,e,n,i,o){for(var s=Qt(r),l,a;(l=s.next())&&!l.done;)if(a=l.value,it(e,a,i,o)&&it(n,vr(t,a),i,o))return bl(r,a),!0;return!1}function it(r,t,e,n){var i=e||{};if(i.strict?sl(r,t):r===t)return!0;var o=fl(r),s=fl(t);if(o!==s)return!1;if(!r||!t||typeof r!="object"&&typeof t!="object")return i.strict?sl(r,t):r==t;var l=n.has(r),a=n.has(t),c;if(l&&a){if(n.get(r)===n.get(t))return!0}else c={};return l||n.set(r,c),a||n.set(t,c),qp(r,t,i,n)}function El(r){return!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Xp(r,t,e,n){if(Sr(r)!==Sr(t))return!1;for(var i=Qt(r),o=Qt(t),s,l,a;(s=i.next())&&!s.done;)if(s.value&&typeof s.value=="object")a||(a=new mr),br(a,s.value);else if(!wr(t,s.value)){if(e.strict||!Vp(r,t,s.value))return!1;a||(a=new mr),br(a,s.value)}if(a){for(;(l=o.next())&&!l.done;)if(l.value&&typeof l.value=="object"){if(!wl(a,l.value,e.strict,n))return!1}else if(!e.strict&&!wr(r,l.value)&&!wl(a,l.value,e.strict,n))return!1;return Sr(a)===0}return!0}function zp(r,t,e,n){if(vl(r)!==vl(t))return!1;for(var i=Qt(r),o=Qt(t),s,l,a,c,u,f;(s=i.next())&&!s.done;)if(c=s.value[0],u=s.value[1],c&&typeof c=="object")a||(a=new mr),br(a,c);else if(f=vr(t,c),typeof f>"u"&&!fi(t,c)||!it(u,f,e,n)){if(e.strict||!Gp(r,t,c,u,e,n))return!1;a||(a=new mr),br(a,c)}if(a){for(;(l=o.next())&&!l.done;)if(c=l.value[0],f=l.value[1],c&&typeof c=="object"){if(!_l(a,r,c,f,e,n))return!1}else if(!e.strict&&(!r.has(c)||!it(vr(r,c),f,e,n))&&!_l(a,r,c,f,dl({},e,{strict:!1}),n))return!1;return Sr(a)===0}return!0}function qp(r,t,e,n){var i,o;if(typeof r!=typeof t||r==null||t==null||ml(r)!==ml(t)||ol(r)!==ol(t))return!1;var s=cl(r),l=cl(t);if(s!==l)return!1;var a=r instanceof Error,c=t instanceof Error;if(a!==c||(a||c)&&(r.name!==t.name||r.message!==t.message))return!1;var u=ll(r),f=ll(t);if(u!==f||(u||f)&&(r.source!==t.source||al(r)!==al(t)))return!1;var p=ul(r),h=ul(t);if(p!==h||(p||h)&&yl(r)!==yl(t)||e.strict&&ui&&ui(r)!==ui(t)||pl(r)!==pl(t))return!1;var d=El(r),y=El(t);if(d!==y)return!1;if(d||y){if(r.length!==t.length)return!1;for(i=0;i<r.length;i++)if(r[i]!==t[i])return!1;return!0}var g=gl(r),m=gl(t);if(g!==m)return!1;if(g||m)return yr(r)!==yr(t)?!1:typeof Uint8Array=="function"&&it(new Uint8Array(r),new Uint8Array(t),e,n);if(typeof r!=typeof t)return!1;var v=il(r),w=il(t);if(v.length!==w.length)return!1;for(v.sort(),w.sort(),i=v.length-1;i>=0;i--)if(v[i]!=w[i])return!1;for(i=v.length-1;i>=0;i--)if(o=v[i],!it(r[o],t[o],e,n))return!1;var _=hl(r),T=hl(t);return _!==T?!1:_==="Set"||T==="Set"?Xp(r,t,e,n):_==="Map"?zp(r,t,e,n):!0}var Jp=function(t,e,n){return it(t,e,n,Yp())};const hi={},kl=(r,t)=>hi[r]=t,Al=r=>hi[r.type].area(r),Kp=(r,t,e)=>hi[r.type].intersects(r,t,e);var Zp={exports:{}};(function(r){(function(){function t(l,a){var c=l.x-a.x,u=l.y-a.y;return c*c+u*u}function e(l,a,c){var u=a.x,f=a.y,p=c.x-u,h=c.y-f;if(p!==0||h!==0){var d=((l.x-u)*p+(l.y-f)*h)/(p*p+h*h);d>1?(u=c.x,f=c.y):d>0&&(u+=p*d,f+=h*d)}return p=l.x-u,h=l.y-f,p*p+h*h}function n(l,a){for(var c=l[0],u=[c],f,p=1,h=l.length;p<h;p++)f=l[p],t(f,c)>a&&(u.push(f),c=f);return c!==f&&u.push(f),u}function i(l,a,c,u,f){for(var p=u,h,d=a+1;d<c;d++){var y=e(l[d],l[a],l[c]);y>p&&(h=d,p=y)}p>u&&(h-a>1&&i(l,a,h,u,f),f.push(l[h]),c-h>1&&i(l,h,c,u,f))}function o(l,a){var c=l.length-1,u=[l[0]];return i(l,0,c,a,u),u.push(l[c]),u}function s(l,a,c){if(l.length<=2)return l;var u=a!==void 0?a*a:1;return l=c?l:n(l,u),l=o(l,u),l}r.exports=s,r.exports.default=s})()})(Zp);const Qp={area:r=>{const{points:t}=r.geometry;let e=0,n=t.length-1;for(let i=0;i<t.length;i++)e+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(.5*e)},intersects:(r,t,e)=>{const{points:n}=r.geometry;let i=!1;for(let o=0,s=n.length-1;o<n.length;s=o++){const l=n[o][0],a=n[o][1],c=n[s][0],u=n[s][1];a>e!=u>e&&t<(c-l)*(e-a)/(u-a)+l&&(i=!i)}return i}};kl(Ke.POLYGON,Qp);const td={area:r=>r.geometry.w*r.geometry.h,intersects:(r,t,e)=>t>=r.geometry.x&&t<=r.geometry.x+r.geometry.w&&e>=r.geometry.y&&e<=r.geometry.y+r.geometry.h};kl(Ke.RECTANGLE,td);const Qg="";let ed=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((t,e)=>(e&=63,e<36?t+=e.toString(36):e<62?t+=(e-26).toString(36).toUpperCase():e>62?t+="-":t+="_",t),"");const te=[];function rd(r,t=x){let e;const n=new Set;function i(l){if(He(r,l)&&(r=l,e)){const a=!te.length;for(const c of n)c[1](),te.push(c,r);if(a){for(let c=0;c<te.length;c+=2)te[c][0](te[c+1]);te.length=0}}}function o(l){i(l(r))}function s(l,a=x){const c=[l,a];return n.add(c),n.size===1&&(e=t(i)||x),l(r),()=>{n.delete(c),n.size===0&&(e(),e=null)}}return{set:i,update:o,subscribe:s}}const ft=()=>new Map,_r=r=>{const t=ft();return r.forEach((e,n)=>{t.set(n,e)}),t},ee=(r,t,e)=>{let n=r.get(t);return n===void 0&&r.set(t,n=e()),n},nd=(r,t)=>{const e=[];for(const[n,i]of r)e.push(t(i,n));return e},id=(r,t)=>{for(const[e,n]of r)if(t(n,e))return!0;return!1},$e=()=>new Set,pi=r=>r[r.length-1],od=(r,t)=>{for(let e=0;e<t.length;e++)r.push(t[e])},Ol=Array.from,Cl=Array.isArray;class di{constructor(){this._observers=ft()}on(t,e){ee(this._observers,t,$e).add(e)}once(t,e){const n=(...i)=>{this.off(t,n),e(...i)};this.on(t,n)}off(t,e){const n=this._observers.get(t);n!==void 0&&(n.delete(e),n.size===0&&this._observers.delete(t))}emit(t,e){return Ol((this._observers.get(t)||ft()).values()).forEach(n=>n(...e))}destroy(){this._observers=ft()}}const Pt=Math.floor,Er=Math.abs,xl=(r,t)=>r<t?r:t,re=(r,t)=>r>t?r:t,sd=r=>r!==0?r<0:1/r<0,ld=r=>r.toLowerCase(),ad=/^\s*/g,cd=r=>r.replace(ad,""),ud=/([A-Z])/g,$l=(r,t)=>cd(r.replace(ud,e=>`${t}${ld(e)}`)),fd=r=>{const t=unescape(encodeURIComponent(r)),e=t.length,n=new Uint8Array(e);for(let i=0;i<e;i++)n[i]=t.codePointAt(i);return n},Ie=typeof TextEncoder<"u"?new TextEncoder:null,hd=Ie?r=>Ie.encode(r):fd;let gi=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});gi&&gi.decode(new Uint8Array).length===1&&(gi=null);const Il=r=>r===void 0?null:r;class pd{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Tl=new pd,dd=!0;try{typeof localStorage<"u"&&(Tl=localStorage,dd=!1)}catch{}const gd=Tl,yd=Object.keys,Ml=r=>yd(r).length,md=(r,t)=>{for(const e in r)if(!t(r[e],e))return!1;return!0},vd=(r,t)=>Object.prototype.hasOwnProperty.call(r,t),bd=(r,t)=>r===t||Ml(r)===Ml(t)&&md(r,(e,n)=>(e!==void 0||vd(t,n))&&t[n]===e),yi=(r,t,e=0)=>{try{for(;e<r.length;e++)r[e](...t)}finally{e<r.length&&yi(r,t,e+1)}},wd=(r,t)=>t.includes(r),ne=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);typeof navigator<"u"&&/Mac/.test(navigator.platform);let ot;const Sd=()=>{if(ot===void 0)if(ne){ot=ft();const r=process.argv;let t=null;for(let e=0;e<r.length;e++){const n=r[e];n[0]==="-"?(t!==null&&ot.set(t,""),t=n):t!==null&&(ot.set(t,n),t=null)}t!==null&&ot.set(t,"")}else typeof location=="object"?(ot=ft(),(location.search||"?").slice(1).split("&").forEach(r=>{if(r.length!==0){const[t,e]=r.split("=");ot.set(`--${$l(t,"-")}`,e),ot.set(`-${$l(t,"-")}`,e)}})):ot=ft();return ot},mi=r=>Sd().has(r),vi=r=>Il(ne?process.env[r.toUpperCase()]:gd.getItem(r));(r=>mi("--"+r)||vi(r)!==null)("production");const Dl=ne&&wd(process.env.FORCE_COLOR,["true","1","2"]),_d=!mi("no-colors")&&(!ne||process.stdout.isTTY||Dl)&&(!ne||mi("color")||Dl||vi("COLORTERM")!==null||(vi("TERM")||"").includes("color")),Bl=1,Pl=2,bi=4,wi=8,Ed=32,Nl=64,kr=128,kd=31,Rl=63,Te=127,Ad=2147483647,Od=Number.isInteger||(r=>typeof r=="number"&&isFinite(r)&&Pt(r)===r),Ll=(r,t,e)=>new Uint8Array(r,t,e);class Me{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Si=()=>new Me,Cd=r=>{let t=r.cpos;for(let e=0;e<r.bufs.length;e++)t+=r.bufs[e].length;return t},ht=r=>{const t=new Uint8Array(Cd(r));let e=0;for(let n=0;n<r.bufs.length;n++){const i=r.bufs[n];t.set(i,e),e+=i.length}return t.set(Ll(r.cbuf.buffer,0,r.cpos),e),t},xd=(r,t)=>{const e=r.cbuf.length;e-r.cpos<t&&(r.bufs.push(Ll(r.cbuf.buffer,0,r.cpos)),r.cbuf=new Uint8Array(re(e,t)*2),r.cpos=0)},R=(r,t)=>{const e=r.cbuf.length;r.cpos===e&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(e*2),r.cpos=0),r.cbuf[r.cpos++]=t},_i=R,E=(r,t)=>{for(;t>Te;)R(r,kr|Te&t),t=Pt(t/128);R(r,Te&t)},Ei=(r,t)=>{const e=sd(t);for(e&&(t=-t),R(r,(t>Rl?kr:0)|(e?Nl:0)|Rl&t),t=Pt(t/64);t>0;)R(r,(t>Te?kr:0)|Te&t),t=Pt(t/128)},ki=new Uint8Array(3e4),$d=ki.length/3,Id=(r,t)=>{if(t.length<$d){const e=Ie.encodeInto(t,ki).written||0;E(r,e);for(let n=0;n<e;n++)R(r,ki[n])}else z(r,hd(t))},Td=(r,t)=>{const e=unescape(encodeURIComponent(t)),n=e.length;E(r,n);for(let i=0;i<n;i++)R(r,e.codePointAt(i))},ie=Ie&&Ie.encodeInto?Id:Td,Ai=(r,t)=>{const e=r.cbuf.length,n=r.cpos,i=xl(e-n,t.length),o=t.length-i;r.cbuf.set(t.subarray(0,i),n),r.cpos+=i,o>0&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(re(e*2,o)),r.cbuf.set(t.subarray(i)),r.cpos=o)},z=(r,t)=>{E(r,t.byteLength),Ai(r,t)},Oi=(r,t)=>{xd(r,t);const e=new DataView(r.cbuf.buffer,r.cpos,t);return r.cpos+=t,e},Md=(r,t)=>Oi(r,4).setFloat32(0,t,!1),Dd=(r,t)=>Oi(r,8).setFloat64(0,t,!1),Bd=(r,t)=>Oi(r,8).setBigInt64(0,t,!1),Ul=new DataView(new ArrayBuffer(4)),Pd=r=>(Ul.setFloat32(0,r),Ul.getFloat32(0)===r),De=(r,t)=>{switch(typeof t){case"string":R(r,119),ie(r,t);break;case"number":Od(t)&&Er(t)<=Ad?(R(r,125),Ei(r,t)):Pd(t)?(R(r,124),Md(r,t)):(R(r,123),Dd(r,t));break;case"bigint":R(r,122),Bd(r,t);break;case"object":if(t===null)R(r,126);else if(t instanceof Array){R(r,117),E(r,t.length);for(let e=0;e<t.length;e++)De(r,t[e])}else if(t instanceof Uint8Array)R(r,116),z(r,t);else{R(r,118);const e=Object.keys(t);E(r,e.length);for(let n=0;n<e.length;n++){const i=e[n];ie(r,i),De(r,t[i])}}break;case"boolean":R(r,t?120:121);break;default:R(r,127)}};class jl extends Me{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&E(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Fl=r=>{r.count>0&&(Ei(r.encoder,r.count===1?r.s:-r.s),r.count>1&&E(r.encoder,r.count-2))};class Ar{constructor(){this.encoder=new Me,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Fl(this),this.count=1,this.s=t)}toUint8Array(){return Fl(this),ht(this.encoder)}}const Wl=r=>{if(r.count>0){const t=r.diff*2+(r.count===1?0:1);Ei(r.encoder,t),r.count>1&&E(r.encoder,r.count-2)}};class Ci{constructor(){this.encoder=new Me,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Wl(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Wl(this),ht(this.encoder)}}class Nd{constructor(){this.sarr=[],this.s="",this.lensE=new Ar}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Me;return this.sarr.push(this.s),this.s="",ie(t,this.sarr.join("")),Ai(t,this.lensE.toUint8Array()),ht(t)}}const Hl=typeof crypto>"u"?null:crypto,Rd=Hl!==null?r=>{const t=new ArrayBuffer(r),e=new Uint8Array(t);return Hl.getRandomValues(e),t}:r=>{const t=new ArrayBuffer(r),e=new Uint8Array(t);for(let n=0;n<r;n++)e[n]=Math.ceil(Math.random()*4294967295>>>0);return t},Yl=()=>new Uint32Array(Rd(4))[0],Ld=[1e7]+-1e3+-4e3+-8e3+-1e11,Ud=()=>Ld.replace(/[018]/g,r=>(r^Yl()&15>>r/4).toString(16)),jd=Date.now,Fd=r=>new Promise(r),Or=r=>new Error(r),st=()=>{throw Or("Method unimplemented")},Nt=()=>{throw Or("Unexpected case")},pt=Symbol;class Wd{constructor(t,e){this.left=t,this.right=e}}const dt=(r,t)=>new Wd(r,t),Rt=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;const Hd=r=>nd(r,(t,e)=>`${e}:${t};`).join("");Rt.ELEMENT_NODE,Rt.TEXT_NODE,Rt.CDATA_SECTION_NODE,Rt.COMMENT_NODE,Rt.DOCUMENT_NODE,Rt.DOCUMENT_TYPE_NODE,Rt.DOCUMENT_FRAGMENT_NODE;const xi=pt(),$i=pt(),Gl=pt(),Vl=pt(),Xl=pt(),Ii=pt(),zl=pt(),Ti=pt(),ql=pt(),Yd={[xi]:dt("font-weight","bold"),[$i]:dt("font-weight","normal"),[Gl]:dt("color","blue"),[Xl]:dt("color","green"),[Vl]:dt("color","grey"),[Ii]:dt("color","red"),[zl]:dt("color","purple"),[Ti]:dt("color","orange"),[ql]:dt("color","black")},Jl={[xi]:"\x1B[1m",[$i]:"\x1B[2m",[Gl]:"\x1B[34m",[Xl]:"\x1B[32m",[Vl]:"\x1B[37m",[Ii]:"\x1B[31m",[zl]:"\x1B[35m",[Ti]:"\x1B[38;5;208m",[ql]:"\x1B[0m"},Gd=_d?ne?r=>{const t=[],e=[];let n=0;for(;n<r.length;n++){const i=r[n],o=Jl[i];if(o!==void 0)t.push(o);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&(t.push("\x1B[0m"),e.push(t.join("")));n<r.length;n++){const i=r[n];i instanceof Symbol||e.push(i)}return e}:r=>{const t=[],e=[],n=ft();let i=[],o=0;for(;o<r.length;o++){const s=r[o],l=Yd[s];if(l!==void 0)n.set(l.left,l.right);else if(s.constructor===String||s.constructor===Number){const a=Hd(n);o>0||a.length>0?(t.push("%c"+s),e.push(a)):t.push(s)}else break}for(o>0&&(i=e,i.unshift(t.join("")));o<r.length;o++){const s=r[o];s instanceof Symbol||i.push(s)}return i}:r=>{const t=[],e=[];let n=0;for(;n<r.length;n++){const i=r[n];if(Jl[i]===void 0)if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&e.push(t.join(""));n<r.length;n++){const i=r[n];i instanceof Symbol||(i.constructor===Object?e.push(JSON.stringify(i)):e.push(i))}return e},Vd=(...r)=>{console.log(...Gd(r)),Xd.forEach(t=>t.print(r))},Xd=new Set,Kl=r=>({[Symbol.iterator](){return this},next:r}),zd=(r,t)=>Kl(()=>{let e;do e=r.next();while(!e.done&&!t(e.value));return e}),Mi=(r,t)=>Kl(()=>{const{done:e,value:n}=r.next();return{done:e,value:e?void 0:t(n)}});class oy extends di{constructor(t,e){super(),this.doc=t,this.awareness=e}}class qd{constructor(t,e){this.clock=t,this.len=e}}class Cr{constructor(){this.clients=new Map}}const Lt=(r,t,e)=>t.clients.forEach((n,i)=>{const o=r.doc.store.clients.get(i);for(let s=0;s<n.length;s++){const l=n[s];sa(r,o,l.clock,l.len,e)}}),Jd=(r,t)=>{let e=0,n=r.length-1;for(;e<=n;){const i=Pt((e+n)/2),o=r[i],s=o.clock;if(s<=t){if(t<s+o.len)return i;e=i+1}else n=i-1}return null},xr=(r,t)=>{const e=r.clients.get(t.client);return e!==void 0&&Jd(e,t.clock)!==null},Di=r=>{r.clients.forEach(t=>{t.sort((i,o)=>i.clock-o.clock);let e,n;for(e=1,n=1;e<t.length;e++){const i=t[n-1],o=t[e];i.clock+i.len>=o.clock?i.len=re(i.len,o.clock+o.len-i.clock):(n<e&&(t[n]=o),n++)}t.length=n})},Zl=r=>{const t=new Cr;for(let e=0;e<r.length;e++)r[e].clients.forEach((n,i)=>{if(!t.clients.has(i)){const o=n.slice();for(let s=e+1;s<r.length;s++)od(o,r[s].clients.get(i)||[]);t.clients.set(i,o)}});return Di(t),t},Bi=(r,t,e,n)=>{ee(r.clients,t,()=>[]).push(new qd(e,n))},Kd=()=>new Cr,Zd=(r,t)=>{E(r.restEncoder,t.clients.size),t.clients.forEach((e,n)=>{r.resetDsCurVal(),E(r.restEncoder,n);const i=e.length;E(r.restEncoder,i);for(let o=0;o<i;o++){const s=e[o];r.writeDsClock(s.clock),r.writeDsLen(s.len)}})},Ql=Yl;class oe extends di{constructor({guid:t=Ud(),collectionid:e=null,gc:n=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:s=!1,shouldLoad:l=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=Ql(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new cg,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=s,this.meta=o,this.isLoaded=!1,this.whenLoaded=Fd(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})})}load(){const t=this._item;t!==null&&!this.shouldLoad&&k(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,e=null){k(this,t,e)}get(t,e=j){const n=ee(this.share,t,()=>{const o=new e;return o._integrate(this,null),o}),i=n.constructor;if(e!==j&&i!==e)if(i===j){const o=new e;o._map=n._map,n._map.forEach(s=>{for(;s!==null;s=s.left)s.parent=o}),o._start=n._start;for(let s=o._start;s!==null;s=s.right)s.parent=o;return o._length=n._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,Re)}getText(t=""){return this.get(t,Hr)}getMap(t=""){return this.get(t,Fr)}getXmlFragment(t=""){return this.get(t,le)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){Ol(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new oe({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,k(t.parent.doc,n=>{const i=e.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class Qd{constructor(){this.restEncoder=Si()}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){E(this.restEncoder,t)}writeDsLen(t){E(this.restEncoder,t)}}class tg extends Qd{writeLeftID(t){E(this.restEncoder,t.client),E(this.restEncoder,t.clock)}writeRightID(t){E(this.restEncoder,t.client),E(this.restEncoder,t.clock)}writeClient(t){E(this.restEncoder,t)}writeInfo(t){_i(this.restEncoder,t)}writeString(t){ie(this.restEncoder,t)}writeParentInfo(t){E(this.restEncoder,t?1:0)}writeTypeRef(t){E(this.restEncoder,t)}writeLen(t){E(this.restEncoder,t)}writeAny(t){De(this.restEncoder,t)}writeBuf(t){z(this.restEncoder,t)}writeJSON(t){ie(this.restEncoder,JSON.stringify(t))}writeKey(t){ie(this.restEncoder,t)}}class eg{constructor(){this.restEncoder=Si(),this.dsCurrVal=0}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,E(this.restEncoder,e)}writeDsLen(t){t===0&&Nt(),E(this.restEncoder,t-1),this.dsCurrVal+=t}}class rg extends eg{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Ci,this.clientEncoder=new Ar,this.leftClockEncoder=new Ci,this.rightClockEncoder=new Ci,this.infoEncoder=new jl(_i),this.stringEncoder=new Nd,this.parentInfoEncoder=new jl(_i),this.typeRefEncoder=new Ar,this.lenEncoder=new Ar}toUint8Array(){const t=Si();return E(t,0),z(t,this.keyClockEncoder.toUint8Array()),z(t,this.clientEncoder.toUint8Array()),z(t,this.leftClockEncoder.toUint8Array()),z(t,this.rightClockEncoder.toUint8Array()),z(t,ht(this.infoEncoder)),z(t,this.stringEncoder.toUint8Array()),z(t,ht(this.parentInfoEncoder)),z(t,this.typeRefEncoder.toUint8Array()),z(t,this.lenEncoder.toUint8Array()),Ai(t,ht(this.restEncoder)),ht(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){De(this.restEncoder,t)}writeBuf(t){z(this.restEncoder,t)}writeJSON(t){De(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const ng=(r,t,e,n)=>{n=re(n,t[0].id.clock);const i=gt(t,n);E(r.restEncoder,t.length-i),r.writeClient(e),E(r.restEncoder,n);const o=t[i];o.write(r,n-o.id.clock);for(let s=i+1;s<t.length;s++)t[s].write(r,0)},ig=(r,t,e)=>{const n=new Map;e.forEach((i,o)=>{Y(t,o)>i&&n.set(o,i)}),Pi(t).forEach((i,o)=>{e.has(o)||n.set(o,0)}),E(r.restEncoder,n.size),Array.from(n.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{ng(r,t.clients.get(i),i,o)})},og=(r,t)=>ig(r,t.doc.store,t.beforeState);class sg{constructor(){this.l=[]}}const ta=()=>new sg,ea=(r,t)=>r.l.push(t),ra=(r,t)=>{const e=r.l,n=e.length;r.l=e.filter(i=>t!==i),n===r.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},na=(r,t,e)=>yi(r.l,[t,e]);class $r{constructor(t,e){this.client=t,this.clock=e}}const Ir=(r,t)=>r===t||r!==null&&t!==null&&r.client===t.client&&r.clock===t.clock,A=(r,t)=>new $r(r,t),lg=r=>{for(const[t,e]of r.doc.share.entries())if(e===r)return t;throw Nt()},Tr=(r,t)=>{for(;t!==null;){if(t.parent===r)return!0;t=t.parent._item}return!1};class ag{constructor(t,e){this.ds=t,this.sv=e}}((r,t)=>new ag(r,t))(Kd(),new Map);const Be=(r,t)=>t===void 0?!r.deleted:t.sv.has(r.id.client)&&(t.sv.get(r.id.client)||0)>r.id.clock&&!xr(t.ds,r.id),Mr=(r,t)=>{const e=ee(r.meta,Mr,$e),n=r.doc.store;e.has(t)||(t.sv.forEach((i,o)=>{i<Y(n,o)&&G(r,A(o,i))}),Lt(r,t.ds,i=>{}),e.add(t))};class cg{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Pi=r=>{const t=new Map;return r.clients.forEach((e,n)=>{const i=e[e.length-1];t.set(n,i.id.clock+i.length)}),t},Y=(r,t)=>{const e=r.clients.get(t);if(e===void 0)return 0;const n=e[e.length-1];return n.id.clock+n.length},ia=(r,t)=>{let e=r.clients.get(t.id.client);if(e===void 0)e=[],r.clients.set(t.id.client,e);else{const n=e[e.length-1];if(n.id.clock+n.length!==t.id.clock)throw Nt()}e.push(t)},gt=(r,t)=>{let e=0,n=r.length-1,i=r[n],o=i.id.clock;if(o===t)return n;let s=Pt(t/(o+i.length-1)*n);for(;e<=n;){if(i=r[s],o=i.id.clock,o<=t){if(t<o+i.length)return s;e=s+1}else n=s-1;s=Pt((e+n)/2)}throw Nt()},Dr=(r,t)=>{const e=r.clients.get(t.client);return e[gt(e,t.clock)]},Ni=(r,t,e)=>{const n=gt(t,e),i=t[n];return i.id.clock<e&&i instanceof I?(t.splice(n+1,0,Ta(r,i,e-i.id.clock)),n+1):n},G=(r,t)=>{const e=r.doc.store.clients.get(t.client);return e[Ni(r,e,t.clock)]},oa=(r,t,e)=>{const n=t.clients.get(e.client),i=gt(n,e.clock),o=n[i];return e.clock!==o.id.clock+o.length-1&&o.constructor!==Ot&&n.splice(i+1,0,Ta(r,o,e.clock-o.id.clock+1)),o},ug=(r,t,e)=>{const n=r.clients.get(t.id.client);n[gt(n,t.id.clock)]=e},sa=(r,t,e,n,i)=>{if(n===0)return;const o=e+n;let s=Ni(r,t,e),l;do l=t[s++],o<l.id.clock+l.length&&Ni(r,t,o),i(l);while(s<t.length&&t[s].id.clock<o)};class fg{constructor(t,e,n){this.doc=t,this.deleteSet=new Cr,this.beforeState=Pi(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const la=(r,t)=>t.deleteSet.clients.size===0&&!id(t.afterState,(e,n)=>t.beforeState.get(n)!==e)?!1:(Di(t.deleteSet),og(r,t),Zd(r,t.deleteSet),!0),aa=(r,t,e)=>{const n=t._item;(n===null||n.id.clock<(r.beforeState.get(n.id.client)||0)&&!n.deleted)&&ee(r.changed,t,$e).add(e)},Br=(r,t)=>{const e=r[t-1],n=r[t];e.deleted===n.deleted&&e.constructor===n.constructor&&e.mergeWith(n)&&(r.splice(t,1),n instanceof I&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,e))},hg=(r,t,e)=>{for(const[n,i]of r.clients.entries()){const o=t.clients.get(n);for(let s=i.length-1;s>=0;s--){const l=i[s],a=l.clock+l.len;for(let c=gt(o,l.clock),u=o[c];c<o.length&&u.id.clock<a;u=o[++c]){const f=o[c];if(l.clock+l.len<=f.id.clock)break;f instanceof I&&f.deleted&&!f.keep&&e(f)&&f.gc(t,!1)}}}},pg=(r,t)=>{r.clients.forEach((e,n)=>{const i=t.clients.get(n);for(let o=e.length-1;o>=0;o--){const s=e[o],l=xl(i.length-1,1+gt(i,s.clock+s.len-1));for(let a=l,c=i[a];a>0&&c.id.clock>=s.clock;c=i[--a])Br(i,a)}})},ca=(r,t)=>{if(t<r.length){const e=r[t],n=e.doc,i=n.store,o=e.deleteSet,s=e._mergeStructs;try{Di(o),e.afterState=Pi(e.doc.store),n._transaction=null,n.emit("beforeObserverCalls",[e,n]);const l=[];e.changed.forEach((a,c)=>l.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(e,a)})),l.push(()=>{e.changedParentTypes.forEach((a,c)=>l.push(()=>{(c._item===null||!c._item.deleted)&&(a=a.filter(u=>u.target._item===null||!u.target._item.deleted),a.forEach(u=>{u.currentTarget=c}),a.sort((u,f)=>u.path.length-f.path.length),na(c._dEH,a,e))})),l.push(()=>n.emit("afterTransaction",[e,n]))}),yi(l,[])}finally{n.gc&&hg(o,i,n.gcFilter),pg(o,i),e.afterState.forEach((u,f)=>{const p=e.beforeState.get(f)||0;if(p!==u){const h=i.clients.get(f),d=re(gt(h,p),1);for(let y=h.length-1;y>=d;y--)Br(h,y)}});for(let u=0;u<s.length;u++){const{client:f,clock:p}=s[u].id,h=i.clients.get(f),d=gt(h,p);d+1<h.length&&Br(h,d+1),d>0&&Br(h,d)}if(!e.local&&e.afterState.get(n.clientID)!==e.beforeState.get(n.clientID)&&(Vd(Ti,xi,"[yjs] ",$i,Ii,"Changed the client-id because another client seems to be using it."),n.clientID=Ql()),n.emit("afterTransactionCleanup",[e,n]),n._observers.has("update")){const u=new tg;la(u,e)&&n.emit("update",[u.toUint8Array(),e.origin,n,e])}if(n._observers.has("updateV2")){const u=new rg;la(u,e)&&n.emit("updateV2",[u.toUint8Array(),e.origin,n,e])}const{subdocsAdded:l,subdocsLoaded:a,subdocsRemoved:c}=e;(l.size>0||c.size>0||a.size>0)&&(l.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),c.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:a,added:l,removed:c},n,e]),c.forEach(u=>u.destroy())),r.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,r])):ca(r,t+1)}}},k=(r,t,e=null,n=!0)=>{const i=r._transactionCleanups;let o=!1;r._transaction===null&&(o=!0,r._transaction=new fg(r,e,n),i.push(r._transaction),i.length===1&&r.emit("beforeAllTransactions",[r]),r.emit("beforeTransaction",[r._transaction,r]));try{t(r._transaction)}finally{o&&i[0]===r._transaction&&ca(i,0)}};class dg{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const ua=(r,t,e)=>{Lt(r,e.deletions,n=>{n instanceof I&&t.scope.some(i=>Tr(i,n))&&Hi(n,!1)})},fa=(r,t,e)=>{let n=null,i=null;const o=r.doc,s=r.scope;if(k(o,l=>{for(;t.length>0&&n===null;){const a=o.store,c=t.pop(),u=new Set,f=[];let p=!1;Lt(l,c.insertions,h=>{if(h instanceof I){if(h.redone!==null){let{item:d,diff:y}=Bg(a,h.id);y>0&&(d=G(l,A(d.id.client,d.id.clock+y))),h=d}!h.deleted&&s.some(d=>Tr(d,h))&&f.push(h)}}),Lt(l,c.deletions,h=>{h instanceof I&&s.some(d=>Tr(d,h))&&!xr(c.insertions,h.id)&&u.add(h)}),u.forEach(h=>{p=Ma(l,h,u,c.insertions,r.ignoreRemoteMapChanges)!==null||p});for(let h=f.length-1;h>=0;h--){const d=f[h];r.deleteFilter(d)&&(d.delete(l),p=!0)}n=p?c:null}l.changed.forEach((a,c)=>{a.has(null)&&c._searchMarker&&(c._searchMarker.length=0)}),i=l},r),n!=null){const l=i.changedParentTypes;r.emit("stack-item-popped",[{stackItem:n,type:e,changedParentTypes:l},r])}return n};class ay extends di{constructor(t,{captureTimeout:e=500,captureTransaction:n=a=>!0,deleteFilter:i=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:s=!1,doc:l=Cl(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=i,o.add(this),this.trackedOrigins=o,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=l,this.lastChange=0,this.ignoreRemoteMapChanges=s,this.captureTimeout=e,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(g=>a.changedParentTypes.has(g))||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;const c=this.undoing,u=this.redoing,f=c?this.redoStack:this.undoStack;c?this.stopCapturing():u||this.clear(!1,!0);const p=new Cr;a.afterState.forEach((g,m)=>{const v=a.beforeState.get(m)||0,w=g-v;w>0&&Bi(p,m,v,w)});const h=jd();let d=!1;if(this.lastChange>0&&h-this.lastChange<this.captureTimeout&&f.length>0&&!c&&!u){const g=f[f.length-1];g.deletions=Zl([g.deletions,a.deleteSet]),g.insertions=Zl([g.insertions,p])}else f.push(new dg(a.deleteSet,p)),d=!0;!c&&!u&&(this.lastChange=h),Lt(a,a.deleteSet,g=>{g instanceof I&&this.scope.some(m=>Tr(m,g))&&Hi(g,!0)});const y=[{stackItem:f[f.length-1],origin:a.origin,type:c?"redo":"undo",changedParentTypes:a.changedParentTypes},this];d?this.emit("stack-item-added",y):this.emit("stack-item-updated",y)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=Cl(t)?t:[t],t.forEach(e=>{this.scope.every(n=>n!==e)&&this.scope.push(e)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{t&&(this.undoStack.forEach(i=>ua(n,this,i)),this.undoStack=[]),e&&(this.redoStack.forEach(i=>ua(n,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=fa(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=fa(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class Pr{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return gg(this.currentTarget,this.target)}deletes(t){return xr(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(i=>{if(i!==null){const o=e._map.get(i);let s,l;if(this.adds(o)){let a=o.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(o))if(a!==null&&this.deletes(a))s="delete",l=pi(a.content.getContent());else return;else a!==null&&this.deletes(a)?(s="update",l=pi(a.content.getContent())):(s="add",l=void 0)}else if(this.deletes(o))s="delete",l=pi(o.content.getContent());else return;t.set(i,{action:s,oldValue:l})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const e=this.target,n=$e(),i=$e(),o=[];if(t={added:n,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(e).has(null)){let l=null;const a=()=>{l&&o.push(l)};for(let c=e._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((l===null||l.delete===void 0)&&(a(),l={delete:0}),l.delete+=c.length,i.add(c)):this.adds(c)?((l===null||l.insert===void 0)&&(a(),l={insert:[]}),l.insert=l.insert.concat(c.content.getContent()),n.add(c)):((l===null||l.retain===void 0)&&(a(),l={retain:0}),l.retain+=c.length);l!==null&&l.retain===void 0&&a()}this._changes=t}return t}}const gg=(r,t)=>{const e=[];for(;t._item!==null&&t!==r;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||n++,i=i.right;e.unshift(n)}t=t._item.parent}return e},ha=80;let Ri=0;class yg{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=Ri++}}const mg=r=>{r.timestamp=Ri++},pa=(r,t,e)=>{r.p.marker=!1,r.p=t,t.marker=!0,r.index=e,r.timestamp=Ri++},vg=(r,t,e)=>{if(r.length>=ha){const n=r.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return pa(n,t,e),n}else{const n=new yg(t,e);return r.push(n),n}},Nr=(r,t)=>{if(r._start===null||t===0||r._searchMarker===null)return null;const e=r._searchMarker.length===0?null:r._searchMarker.reduce((o,s)=>Er(t-o.index)<Er(t-s.index)?o:s);let n=r._start,i=0;for(e!==null&&(n=e.p,i=e.index,mg(e));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return e!==null&&Er(e.index-i)<n.parent.length/ha?(pa(e,n,i),e):vg(r._searchMarker,n,i)},Pe=(r,t,e)=>{for(let n=r.length-1;n>=0;n--){const i=r[n];if(e>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){r.splice(n,1);continue}i.p=o,o.marker=!0}(t<i.index||e>0&&t===i.index)&&(i.index=re(t,i.index+e))}},Rr=(r,t,e)=>{const n=r,i=t.changedParentTypes;for(;ee(i,r,()=>[]).push(e),r._item!==null;)r=r._item.parent;na(n._eH,e,t)};class j{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ta(),this._dEH=ta(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw st()}clone(){throw st()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ea(this._eH,t)}observeDeep(t){ea(this._dEH,t)}unobserve(t){ra(this._eH,t)}unobserveDeep(t){ra(this._dEH,t)}toJSON(){}}const da=(r,t,e)=>{t<0&&(t=r._length+t),e<0&&(e=r._length+e);let n=e-t;const i=[];let o=r._start;for(;o!==null&&n>0;){if(o.countable&&!o.deleted){const s=o.content.getContent();if(s.length<=t)t-=s.length;else{for(let l=t;l<s.length&&n>0;l++)i.push(s[l]),n--;t=0}}o=o.right}return i},ga=r=>{const t=[];let e=r._start;for(;e!==null;){if(e.countable&&!e.deleted){const n=e.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}e=e.right}return t},Ne=(r,t)=>{let e=0,n=r._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let o=0;o<i.length;o++)t(i[o],e++,r)}n=n.right}},ya=(r,t)=>{const e=[];return Ne(r,(n,i)=>{e.push(t(n,i,r))}),e},bg=r=>{let t=r._start,e=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),n=0,t=t.right}const i=e[n++];return e.length<=n&&(e=null),{done:!1,value:i}}}},ma=(r,t)=>{const e=Nr(r,t);let n=r._start;for(e!==null&&(n=e.p,t-=e.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Lr=(r,t,e,n)=>{let i=e;const o=r.doc,s=o.clientID,l=o.store,a=e===null?t._start:e.right;let c=[];const u=()=>{c.length>0&&(i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new ce(c)),i.integrate(r,0),c=[])};n.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new Gr(new Uint8Array(f))),i.integrate(r,0);break;case oe:i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new Xr(f)),i.integrate(r,0);break;default:if(f instanceof j)i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new Ct(f)),i.integrate(r,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},va=Or("Length exceeded!"),ba=(r,t,e,n)=>{if(e>t._length)throw va;if(e===0)return t._searchMarker&&Pe(t._searchMarker,e,n.length),Lr(r,t,null,n);const i=e,o=Nr(t,e);let s=t._start;for(o!==null&&(s=o.p,e-=o.index,e===0&&(s=s.prev,e+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(e<=s.length){e<s.length&&G(r,A(s.id.client,s.id.clock+e));break}e-=s.length}return t._searchMarker&&Pe(t._searchMarker,i,n.length),Lr(r,t,s,n)},wg=(r,t,e)=>{let i=(t._searchMarker||[]).reduce((o,s)=>s.index>o.index?s:o,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Lr(r,t,i,e)},wa=(r,t,e,n)=>{if(n===0)return;const i=e,o=n,s=Nr(t,e);let l=t._start;for(s!==null&&(l=s.p,e-=s.index);l!==null&&e>0;l=l.right)!l.deleted&&l.countable&&(e<l.length&&G(r,A(l.id.client,l.id.clock+e)),e-=l.length);for(;n>0&&l!==null;)l.deleted||(n<l.length&&G(r,A(l.id.client,l.id.clock+n)),l.delete(r),n-=l.length),l=l.right;if(n>0)throw va;t._searchMarker&&Pe(t._searchMarker,i,-o+n)},Ur=(r,t,e)=>{const n=t._map.get(e);n!==void 0&&n.delete(r)},Li=(r,t,e,n)=>{const i=t._map.get(e)||null,o=r.doc,s=o.clientID;let l;if(n==null)l=new ce([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:l=new ce([n]);break;case Uint8Array:l=new Gr(n);break;case oe:l=new Xr(n);break;default:if(n instanceof j)l=new Ct(n);else throw new Error("Unexpected content type")}new I(A(s,Y(o.store,s)),i,i&&i.lastId,null,null,t,e,l).integrate(r,0)},Ui=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},Sa=r=>{const t={};return r._map.forEach((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])}),t},_a=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted},jr=r=>zd(r.entries(),t=>!t[1].deleted);class Sg extends Pr{constructor(t,e){super(t,e),this._transaction=e}}class Re extends j{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Re;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Re}clone(){const t=new Re;return t.insert(0,this.toArray().map(e=>e instanceof j?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Rr(this,t,new Sg(this,t))}insert(t,e){this.doc!==null?k(this.doc,n=>{ba(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?k(this.doc,e=>{wg(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?k(this.doc,n=>{wa(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return ma(this,t)}toArray(){return ga(this)}slice(t=0,e=this.length){return da(this,t,e)}toJSON(){return this.map(t=>t instanceof j?t.toJSON():t)}map(t){return ya(this,t)}forEach(t){Ne(this,t)}[Symbol.iterator](){return bg(this)}_write(t){t.writeTypeRef($g)}}class _g extends Pr{constructor(t,e,n){super(t,e),this.keysChanged=n}}class Fr extends j{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new Fr}clone(){const t=new Fr;return this.forEach((e,n)=>{t.set(n,e instanceof j?e.clone():e)}),t}_callObserver(t,e){Rr(this,t,new _g(this,t,e))}toJSON(){const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const i=e.content.getContent()[e.length-1];t[n]=i instanceof j?i.toJSON():i}}),t}get size(){return[...jr(this._map)].length}keys(){return Mi(jr(this._map),t=>t[0])}values(){return Mi(jr(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Mi(jr(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?k(this.doc,e=>{Ur(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?k(this.doc,n=>{Li(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return Ui(this,t)}has(t){return _a(this,t)}clear(){this.doc!==null?k(this.doc,t=>{this.forEach(function(e,n,i){Ur(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ig)}}const At=(r,t)=>r===t||typeof r=="object"&&typeof t=="object"&&r&&t&&bd(r,t);class ji{constructor(t,e,n,i){this.left=t,this.right=e,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Nt(),this.right.content.constructor){case L:this.right.deleted||se(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ea=(r,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case L:t.right.deleted||se(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&G(r,A(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Wr=(r,t,e)=>{const n=new Map,i=Nr(t,e);if(i){const o=new ji(i.p.left,i.p,i.index,n);return Ea(r,o,e-i.index)}else{const o=new ji(null,t._start,0,n);return Ea(r,o,e)}},ka=(r,t,e,n)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===L&&At(n.get(e.right.content.key),e.right.content.value));)e.right.deleted||n.delete(e.right.content.key),e.forward();const i=r.doc,o=i.clientID;n.forEach((s,l)=>{const a=e.left,c=e.right,u=new I(A(o,Y(i.store,o)),a,a&&a.lastId,c,c&&c.id,t,null,new L(l,s));u.integrate(r,0),e.right=u,e.forward()})},se=(r,t)=>{const{key:e,value:n}=t;n===null?r.delete(e):r.set(e,n)},Aa=(r,t)=>{for(;r.right!==null;){if(!(r.right.deleted||r.right.content.constructor===L&&At(t[r.right.content.key]||null,r.right.content.value)))break;r.forward()}},Oa=(r,t,e,n)=>{const i=r.doc,o=i.clientID,s=new Map;for(const l in n){const a=n[l],c=e.currentAttributes.get(l)||null;if(!At(c,a)){s.set(l,c);const{left:u,right:f}=e;e.right=new I(A(o,Y(i.store,o)),u,u&&u.lastId,f,f&&f.id,t,null,new L(l,a)),e.right.integrate(r,0),e.forward()}}return s},Fi=(r,t,e,n,i)=>{e.currentAttributes.forEach((p,h)=>{i[h]===void 0&&(i[h]=null)});const o=r.doc,s=o.clientID;Aa(e,i);const l=Oa(r,t,e,i),a=n.constructor===String?new yt(n):n instanceof j?new Ct(n):new ae(n);let{left:c,right:u,index:f}=e;t._searchMarker&&Pe(t._searchMarker,e.index,a.getLength()),u=new I(A(s,Y(o.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,a),u.integrate(r,0),e.right=u,e.index=f,e.forward(),ka(r,t,e,l)},Ca=(r,t,e,n,i)=>{const o=r.doc,s=o.clientID;Aa(e,i);const l=Oa(r,t,e,i);t:for(;e.right!==null&&(n>0||l.size>0&&(e.right.deleted||e.right.content.constructor===L));){if(!e.right.deleted)switch(e.right.content.constructor){case L:{const{key:a,value:c}=e.right.content,u=i[a];if(u!==void 0){if(At(u,c))l.delete(a);else{if(n===0)break t;l.set(a,c)}e.right.delete(r)}else e.currentAttributes.set(a,c);break}default:n<e.right.length&&G(r,A(e.right.id.client,e.right.id.clock+n)),n-=e.right.length;break}e.forward()}if(n>0){let a="";for(;n>0;n--)a+=`
`;e.right=new I(A(s,Y(o.store,s)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new yt(a)),e.right.integrate(r,0),e.forward()}ka(r,t,e,l)},xa=(r,t,e,n,i)=>{let o=e;const s=_r(i);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===L&&se(s,o.content),o=o.right;let l=0,a=!1;for(;t!==o;){if(e===t&&(a=!0),!t.deleted){const c=t.content;switch(c.constructor){case L:{const{key:u,value:f}=c;((s.get(u)||null)!==f||(n.get(u)||null)===f)&&(t.delete(r),l++,!a&&(i.get(u)||null)===f&&(n.get(u)||null)!==f&&i.delete(u));break}}}t=t.right}return l},Eg=(r,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===L){const n=t.content.key;e.has(n)?t.delete(r):e.add(n)}t=t.left}},kg=r=>{let t=0;return k(r.doc,e=>{let n=r._start,i=r._start,o=ft();const s=_r(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case L:se(s,i.content);break;default:t+=xa(e,n,i,o,s),o=_r(s),n=i;break}i=i.right}}),t},$a=(r,t,e)=>{const n=e,i=_r(t.currentAttributes),o=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ct:case ae:case yt:e<t.right.length&&G(r,A(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(r);break}t.forward()}o&&xa(r,o,t.right,i,t.currentAttributes);const s=(t.left||t.right).parent;return s._searchMarker&&Pe(s._searchMarker,t.index,-n+e),t};class Ag extends Pr{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];k(t,n=>{const i=new Map,o=new Map;let s=this.target._start,l=null;const a={};let c="",u=0,f=0;const p=()=>{if(l!==null){let h;switch(l){case"delete":h={delete:f},f=0;break;case"insert":h={insert:c},i.size>0&&(h.attributes={},i.forEach((d,y)=>{d!==null&&(h.attributes[y]=d)})),c="";break;case"retain":if(h={retain:u},Object.keys(a).length>0){h.attributes={};for(const d in a)h.attributes[d]=a[d]}u=0;break}e.push(h),l=null}};for(;s!==null;){switch(s.content.constructor){case Ct:case ae:this.adds(s)?this.deletes(s)||(p(),l="insert",c=s.content.getContent()[0],p()):this.deletes(s)?(l!=="delete"&&(p(),l="delete"),f+=1):s.deleted||(l!=="retain"&&(p(),l="retain"),u+=1);break;case yt:this.adds(s)?this.deletes(s)||(l!=="insert"&&(p(),l="insert"),c+=s.content.str):this.deletes(s)?(l!=="delete"&&(p(),l="delete"),f+=s.length):s.deleted||(l!=="retain"&&(p(),l="retain"),u+=s.length);break;case L:{const{key:h,value:d}=s.content;if(this.adds(s)){if(!this.deletes(s)){const y=i.get(h)||null;At(y,d)?d!==null&&s.delete(n):(l==="retain"&&p(),At(d,o.get(h)||null)?delete a[h]:a[h]=d)}}else if(this.deletes(s)){o.set(h,d);const y=i.get(h)||null;At(y,d)||(l==="retain"&&p(),a[h]=y)}else if(!s.deleted){o.set(h,d);const y=a[h];y!==void 0&&(At(y,d)?y!==null&&s.delete(n):(l==="retain"&&p(),d===null?delete a[h]:a[h]=d))}s.deleted||(l==="insert"&&p(),se(i,s.content));break}}s=s.right}for(p();e.length>0;){const h=e[e.length-1];if(h.retain!==void 0&&h.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Hr extends j{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new Hr}clone(){const t=new Hr;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Ag(this,t,e),i=t.doc;if(Rr(this,t,n),!t.local){let o=!1;for(const[s,l]of t.afterState.entries()){const a=t.beforeState.get(s)||0;if(l!==a&&(sa(t,i.store.clients.get(s),a,l,c=>{!c.deleted&&c.content.constructor===L&&(o=!0)}),o))break}o||Lt(t,t.deleteSet,s=>{s instanceof Ot||o||s.parent===this&&s.content.constructor===L&&(o=!0)}),k(i,s=>{o?kg(this):Lt(s,s.deleteSet,l=>{l instanceof Ot||l.parent===this&&Eg(s,l)})})}}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===yt&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?k(this.doc,n=>{const i=new ji(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const s=t[o];if(s.insert!==void 0){const l=!e&&typeof s.insert=="string"&&o===t.length-1&&i.right===null&&s.insert.slice(-1)===`
`?s.insert.slice(0,-1):s.insert;(typeof l!="string"||l.length>0)&&Fi(n,this,i,l,s.attributes||{})}else s.retain!==void 0?Ca(n,this,i,s.retain,s.attributes||{}):s.delete!==void 0&&$a(n,i,s.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){const i=[],o=new Map,s=this.doc;let l="",a=this._start;function c(){if(l.length>0){const u={};let f=!1;o.forEach((h,d)=>{f=!0,u[d]=h});const p={insert:l};f&&(p.attributes=u),i.push(p),l=""}}return k(s,u=>{for(t&&Mr(u,t),e&&Mr(u,e);a!==null;){if(Be(a,t)||e!==void 0&&Be(a,e))switch(a.content.constructor){case yt:{const f=o.get("ychange");t!==void 0&&!Be(a,t)?(f===void 0||f.user!==a.id.client||f.type!=="removed")&&(c(),o.set("ychange",n?n("removed",a.id):{type:"removed"})):e!==void 0&&!Be(a,e)?(f===void 0||f.user!==a.id.client||f.type!=="added")&&(c(),o.set("ychange",n?n("added",a.id):{type:"added"})):f!==void 0&&(c(),o.delete("ychange")),l+=a.content.str;break}case Ct:case ae:{c();const f={insert:a.content.getContent()[0]};if(o.size>0){const p={};f.attributes=p,o.forEach((h,d)=>{p[d]=h})}i.push(f);break}case L:Be(a,t)&&(c(),se(o,a.content));break}a=a.right}c()},Mr),i}insert(t,e,n){if(e.length<=0)return;const i=this.doc;i!==null?k(i,o=>{const s=Wr(o,this,t);n||(n={},s.currentAttributes.forEach((l,a)=>{n[a]=l})),Fi(o,this,s,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n={}){const i=this.doc;i!==null?k(i,o=>{const s=Wr(o,this,t);Fi(o,this,s,e,n)}):this._pending.push(()=>this.insertEmbed(t,e,n))}delete(t,e){if(e===0)return;const n=this.doc;n!==null?k(n,i=>{$a(i,Wr(i,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(e===0)return;const i=this.doc;i!==null?k(i,o=>{const s=Wr(o,this,t);s.right!==null&&Ca(o,this,s,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){this.doc!==null?k(this.doc,e=>{Ur(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?k(this.doc,n=>{Li(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return Ui(this,t)}getAttributes(t){return Sa(this)}_write(t){t.writeTypeRef(Tg)}}class Wi{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Yr||e.constructor===le)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class le extends j{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new le}clone(){const t=new le;return t.insert(0,this.toArray().map(e=>e instanceof j?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Wi(this,t)}querySelector(t){t=t.toUpperCase();const n=new Wi(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Wi(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Rr(this,t,new Og(this,e,t))}toString(){return ya(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),Ne(this,o=>{i.insertBefore(o.toDOM(t,e,n),null)}),i}insert(t,e){this.doc!==null?k(this.doc,n=>{ba(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)k(this.doc,n=>{const i=t&&t instanceof j?t._item:t;Lr(n,this,i,e)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(o=>o===t)+1;if(i===0&&t!==null)throw Or("Reference item not found");n.splice(i,0,...e)}}delete(t,e=1){this.doc!==null?k(this.doc,n=>{wa(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return ga(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return ma(this,t)}slice(t=0,e=this.length){return da(this,t,e)}forEach(t){Ne(this,t)}_write(t){t.writeTypeRef(Dg)}}class Yr extends le{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new Yr(this.nodeName)}clone(){const t=new Yr(this.nodeName),e=this.getAttributes();for(const n in e)t.setAttribute(n,e[n]);return t.insert(0,this.toArray().map(n=>n instanceof j?n.clone():n)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const l in t)n.push(l);n.sort();const i=n.length;for(let l=0;l<i;l++){const a=n[l];e.push(a+'="'+t[a]+'"')}const o=this.nodeName.toLocaleLowerCase(),s=e.length>0?" "+e.join(" "):"";return`<${o}${s}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?k(this.doc,e=>{Ur(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?k(this.doc,n=>{Li(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return Ui(this,t)}hasAttribute(t){return _a(this,t)}getAttributes(t){return Sa(this)}toDOM(t=document,e={},n){const i=t.createElement(this.nodeName),o=this.getAttributes();for(const s in o)i.setAttribute(s,o[s]);return Ne(this,s=>{i.appendChild(s.toDOM(t,e,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(Mg),t.writeKey(this.nodeName)}}class Og extends Pr{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Ia{constructor(t,e){this.id=t,this.length=e}get deleted(){throw st()}mergeWith(t){return!1}write(t,e,n){throw st()}integrate(t,e){throw st()}}const Cg=0;class Ot extends Ia{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),ia(t.doc.store,this)}write(t,e){t.writeInfo(Cg),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Gr{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Gr(this.content)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class Vr{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Vr(this.len)}splice(t){const e=new Vr(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){Bi(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const xg=(r,t)=>new oe({guid:r,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Xr{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Xr(xg(this.doc.guid,this.opts))}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class ae{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ae(this.embed)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class L{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new L(this.key,this.value)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class ce{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ce(this.arr)}splice(t){const e=new ce(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let i=e;i<n;i++){const o=this.arr[i];t.writeAny(o)}}getRef(){return 8}}class yt{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new yt(this.str)}splice(t){const e=new yt(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",e.str="\uFFFD"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const $g=0,Ig=1,Tg=2,Mg=3,Dg=4;class Ct{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ct(this.type._copy())}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(n=>{n.deleted?t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Bg=(r,t)=>{let e=t,n=0,i;do n>0&&(e=A(e.client,e.clock+n)),i=Dr(r,e),n=e.clock-i.id.clock,e=i.redone;while(e!==null&&i instanceof I);return{item:i,diff:n}},Hi=(r,t)=>{for(;r!==null&&r.keep!==t;)r.keep=t,r=r.parent._item},Ta=(r,t,e)=>{const{client:n,clock:i}=t.id,o=new I(A(n,i+e),t,A(n,i+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=A(t.redone.client,t.redone.clock+e)),t.right=o,o.right!==null&&(o.right.left=o),r._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=e,o},Ma=(r,t,e,n,i)=>{const o=r.doc,s=o.store,l=o.clientID,a=t.redone;if(a!==null)return G(r,a);let c=t.parent._item,u=null,f;if(c!==null&&c.deleted===!0){if(c.redone===null&&(!e.has(c)||Ma(r,c,e,n,i)===null))return null;for(;c.redone!==null;)c=G(r,c.redone)}const p=c===null?t.parent:c.content.type;if(t.parentSub===null){for(u=t.left,f=t;u!==null;){let g=u;for(;g!==null&&g.parent._item!==c;)g=g.redone===null?null:G(r,g.redone);if(g!==null&&g.parent._item===c){u=g;break}u=u.left}for(;f!==null;){let g=f;for(;g!==null&&g.parent._item!==c;)g=g.redone===null?null:G(r,g.redone);if(g!==null&&g.parent._item===c){f=g;break}f=f.right}}else if(f=null,t.right&&!i){for(u=t;u!==null&&u.right!==null&&xr(n,u.right.id);)u=u.right;for(;u!==null&&u.redone!==null;)u=G(r,u.redone);if(u&&u.right!==null)return null}else u=p._map.get(t.parentSub)||null;const h=Y(s,l),d=A(l,h),y=new I(d,u,u&&u.lastId,f,f&&f.id,p,t.parentSub,t.content.copy());return t.redone=d,Hi(y,!0),y.integrate(r,0),y};class I extends Ia{constructor(t,e,n,i,o,s,l,a){super(t,a.getLength()),this.origin=n,this.left=e,this.right=i,this.rightOrigin=o,this.parent=s,this.parentSub=l,this.redone=null,this.content=a,this.info=this.content.isCountable()?Pl:0}set marker(t){(this.info&wi)>0!==t&&(this.info^=wi)}get marker(){return(this.info&wi)>0}get keep(){return(this.info&Bl)>0}set keep(t){this.keep!==t&&(this.info^=Bl)}get countable(){return(this.info&Pl)>0}get deleted(){return(this.info&bi)>0}set deleted(t){this.deleted!==t&&(this.info^=bi)}markDeleted(){this.info|=bi}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Y(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Y(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===$r&&this.id.client!==this.parent.client&&this.parent.clock>=Y(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=oa(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=G(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===Ot||this.right&&this.right.constructor===Ot)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===I&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===I&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===$r){const n=Dr(e,this.parent);n.constructor===Ot?this.parent=null:this.parent=n.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=oa(t,t.doc.store,A(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,s=new Set;for(;i!==null&&i!==this.right;){if(s.add(i),o.add(i),Ir(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,o.clear();else if(Ir(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&s.has(Dr(t.doc.store,i.origin)))o.has(Dr(t.doc.store,i.origin))||(n=i,o.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ia(t.doc.store,this),this.content.integrate(t,this),aa(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Ot(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:A(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ir(t.origin,this.lastId)&&this.right===t&&Ir(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),Bi(t.deleteSet,this.id.client,this.id.clock,this.length),aa(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw Nt();this.content.gc(t),e?ug(t,this,new Ot(this.id,this.length)):this.content=new Vr(this.length)}write(t,e){const n=e>0?A(this.id.client,this.id.clock+e-1):this.origin,i=this.rightOrigin,o=this.parentSub,s=this.content.getRef()&kd|(n===null?0:kr)|(i===null?0:Nl)|(o===null?0:Ed);if(t.writeInfo(s),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const l=this.parent;if(l._item!==void 0){const a=l._item;if(a===null){const c=lg(l);t.writeParentInfo(!0),t.writeString(c)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else l.constructor===String?(t.writeParentInfo(!0),t.writeString(l)):l.constructor===$r?(t.writeParentInfo(!1),t.writeLeftID(l)):Nt();o!==null&&t.writeString(o)}this.content.write(t,e)}}const Da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Ba="__ $YJS$ __";Da[Ba]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Da[Ba]=!0;class Pg{constructor(){this.clear=()=>{const{size:t}=this.map;t!==0&&this.doc.transact(()=>this.map.forEach((e,n)=>this.map.delete(n)))},this.set=(t,e=!0)=>{e&&this.clear(),this.doc.transact(()=>t.forEach(n=>this.map.set(n.id,n)))},this.add=t=>this.map.set(t.id,t),this.all=()=>Array.from(this.map.values()),this.update=(t,e)=>{const n=typeof t=="string"?t:t.id;n===e.id?this.map.set(e.id,e):this.doc.transact(()=>{this.map.delete(n),this.map.set(e.id,e)})},this.bulkUpsert=t=>{this.doc.transact(()=>{t.forEach(e=>{this.map.set(e.id,e)})})},this.remove=t=>{typeof t=="string"?this.map.delete(t):this.map.delete(t.id)},this.get=t=>this.map.get(t),this.size=()=>this.map.size,this.observe=t=>this.map.observe(t),this.doc=new oe,this.map=this.doc.getMap()}}function Ng(r,t,e,n,i){Pa(r,t,e||0,n||r.length-1,i||Rg)}function Pa(r,t,e,n,i){for(;n>e;){if(n-e>600){var o=n-e+1,s=t-e+1,l=Math.log(o),a=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*a*(o-a)/o)*(s-o/2<0?-1:1),u=Math.max(e,Math.floor(t-s*a/o+c)),f=Math.min(n,Math.floor(t+(o-s)*a/o+c));Pa(r,t,u,f,i)}var p=r[t],h=e,d=n;for(Le(r,e,t),i(r[n],p)>0&&Le(r,e,n);h<d;){for(Le(r,h,d),h++,d--;i(r[h],p)<0;)h++;for(;i(r[d],p)>0;)d--}i(r[e],p)===0?Le(r,e,d):(d++,Le(r,d,n)),d<=t&&(e=d+1),t<=d&&(n=d-1)}}function Le(r,t,e){var n=r[t];r[t]=r[e],r[e]=n}function Rg(r,t){return r<t?-1:r>t?1:0}class Lg{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!qr(t,e))return n;const i=this.toBBox,o=[];for(;e;){for(let s=0;s<e.children.length;s++){const l=e.children[s],a=e.leaf?i(l):l;qr(t,a)&&(e.leaf?n.push(l):Gi(t,a)?this._all(l,n):o.push(l))}e=o.pop()}return n}collides(t){let e=this.data;if(!qr(t,e))return!1;const n=[];for(;e;){for(let i=0;i<e.children.length;i++){const o=e.children[i],s=e.leaf?this.toBBox(o):o;if(qr(t,s)){if(e.leaf||Gi(t,s))return!0;n.push(o)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=fe([]),this}remove(t,e){if(!t)return this;let n=this.data;const i=this.toBBox(t),o=[],s=[];let l,a,c;for(;n||o.length;){if(n||(n=o.pop(),a=o[o.length-1],l=s.pop(),c=!0),n.leaf){const u=Ug(t,n.children,e);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}!c&&!n.leaf&&Gi(n,i)?(o.push(n),s.push(l),l=0,a=n,n=n.children[0]):a?(l++,n=a.children[l],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,i){const o=n-e+1;let s=this._maxEntries,l;if(o<=s)return l=fe(t.slice(e,n+1)),ue(l,this.toBBox),l;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),l=fe([]),l.leaf=!1,l.height=i;const a=Math.ceil(o/s),c=a*Math.ceil(Math.sqrt(s));Na(t,e,n,c,this.compareMinX);for(let u=e;u<=n;u+=c){const f=Math.min(u+c-1,n);Na(t,u,f,a,this.compareMinY);for(let p=u;p<=f;p+=a){const h=Math.min(p+a-1,f);l.children.push(this._build(t,p,h,i-1))}}return ue(l,this.toBBox),l}_chooseSubtree(t,e,n,i){for(;i.push(e),!(e.leaf||i.length-1===n);){let o=1/0,s=1/0,l;for(let a=0;a<e.children.length;a++){const c=e.children[a],u=Yi(c),f=Wg(t,c)-u;f<s?(s=f,o=u<o?u:o,l=c):f===s&&u<o&&(o=u,l=c)}e=l||e.children[0]}return e}_insert(t,e,n){const i=n?t:this.toBBox(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),je(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)}_split(t,e){const n=t[e],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);const s=this._chooseSplitIndex(n,o,i),l=fe(n.children.splice(s,n.children.length-s));l.height=n.height,l.leaf=n.leaf,ue(n,this.toBBox),ue(l,this.toBBox),e?t[e-1].children.push(l):this._splitRoot(n,l)}_splitRoot(t,e){this.data=fe([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ue(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let i,o=1/0,s=1/0;for(let l=e;l<=n-e;l++){const a=Ue(t,0,l,this.toBBox),c=Ue(t,l,n,this.toBBox),u=Hg(a,c),f=Yi(a)+Yi(c);u<o?(o=u,i=l,s=f<s?f:s):u===o&&f<s&&(s=f,i=l)}return i||n-e}_chooseSplitAxis(t,e,n){const i=t.leaf?this.compareMinX:jg,o=t.leaf?this.compareMinY:Fg,s=this._allDistMargin(t,e,n,i),l=this._allDistMargin(t,e,n,o);s<l&&t.children.sort(i)}_allDistMargin(t,e,n,i){t.children.sort(i);const o=this.toBBox,s=Ue(t,0,e,o),l=Ue(t,n-e,n,o);let a=zr(s)+zr(l);for(let c=e;c<n-e;c++){const u=t.children[c];je(s,t.leaf?o(u):u),a+=zr(s)}for(let c=n-e-1;c>=e;c--){const u=t.children[c];je(l,t.leaf?o(u):u),a+=zr(l)}return a}_adjustParentBBoxes(t,e,n){for(let i=n;i>=0;i--)je(e[i],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():ue(t[e],this.toBBox)}}function Ug(r,t,e){if(!e)return t.indexOf(r);for(let n=0;n<t.length;n++)if(e(r,t[n]))return n;return-1}function ue(r,t){Ue(r,0,r.children.length,t,r)}function Ue(r,t,e,n,i){i||(i=fe(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=t;o<e;o++){const s=r.children[o];je(i,r.leaf?n(s):s)}return i}function je(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function jg(r,t){return r.minX-t.minX}function Fg(r,t){return r.minY-t.minY}function Yi(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function zr(r){return r.maxX-r.minX+(r.maxY-r.minY)}function Wg(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function Hg(r,t){const e=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),i=Math.min(r.maxX,t.maxX),o=Math.min(r.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,o-n)}function Gi(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function qr(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function fe(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Na(r,t,e,n,i){const o=[t,e];for(;o.length;){if(e=o.pop(),t=o.pop(),e-t<=n)continue;const s=t+Math.ceil((e-t)/n/2)*n;Ng(r,s,t,e,i),o.push(t,s,s,e)}}class Yg{constructor(){this.all=()=>this.tree.all().map(t=>t.shape),this.clear=()=>this.tree.clear(),this.insert=t=>{const{minX:e,minY:n,maxX:i,maxY:o}=t.geometry.bounds;this.tree.insert({minX:e,minY:n,maxX:i,maxY:o,shape:t})},this.remove=t=>{const e={...t.geometry.bounds,shape:t};this.tree.remove(e,(n,i)=>n.shape.id===i.shape.id)},this.update=(t,e)=>{this.remove(t),this.insert(e)},this.set=(t,e=!0)=>{e&&this.tree.clear(),this.tree.load(t.map(n=>{const{minX:i,minY:o,maxX:s,maxY:l}=n.geometry.bounds;return{minX:i,minY:o,maxX:s,maxY:l,shape:n}}))},this.getAt=(t,e)=>{const i=this.tree.search({minX:t,minY:e,maxX:t,maxY:e}).map(o=>o.shape).filter(o=>o.type===Ke.RECTANGLE?!0:Kp(o,t,e));if(i.length>0)return i.sort((o,s)=>Al(o)-Al(s)),i[0]},this.size=()=>this.tree.all().length,this.tree=new Lg}}class Vi{constructor(t,e,n){this.isEmpty=()=>this.added.length+this.deleted.length+this.updated.length===0,this.removeStateChanges=(i=[])=>{const{added:o,deleted:s,updated:l}=this,a=u=>{const{state:f,...p}=u;return i.length===0?p:(i.forEach(h=>{delete f[h]}),{...p,state:f})},c=l.filter(({oldValue:u,newValue:f})=>{const p=a(u),h=a(f);return!Jp(p,h)});return new Vi(o,s,c)},this.added=t,this.deleted=e,this.updated=n}}const Fe=(()=>{const r=new Yg,t=new Pg,e=[];return t.observe(d=>{const{keys:y}=d.changes,g=[],m=[],v=[];for(const[_,T]of y.entries()){const{action:q,oldValue:lt}=T;q==="add"?g.push(t.get(_)):q==="update"?v.push({oldValue:lt,newValue:t.get(_)}):q==="delete"&&m.push(lt)}r.set(g,!1),m.forEach(_=>r.remove(_)),v.forEach(({oldValue:_,newValue:T})=>r.update(_,T));const w=new Vi(g,m,v);e.forEach(({callback:_,ignoreHoverStateChanges:T})=>{T&&w.removeStateChanges(["isHovered"]).isEmpty()||_(w)})}),{add:d=>t.add(d),all:()=>t.all(),bulkUpsert:d=>t.bulkUpsert(d),clear:()=>t.clear(),get:d=>t.get(d),getAt:(d,y)=>r.getAt(d,y),observe:(d,y=!1)=>e.push({callback:d,ignoreHoverStateChanges:y}),remove:d=>t.remove(d),set:(d,y=!0)=>t.set(d,y),setState:(d,y)=>{const g=t.get(d);if(g){const m={...g,state:{...g.state,...y}};t.add(m)}},update:(d,y)=>{const g=typeof d=="string"?t.get(d):d;t.update(g,y)},doc:t.doc}})();var Ra=(r=>(r[r.GUEST=0]="GUEST",r[r.USER=1]="USER",r))(Ra||{});const La={type:Ra.GUEST,id:ed()},Jr=(()=>{let r,t=La;return{get currentUser(){return t},set currentUser(e){e?t=e:t=La},setServerTime:e=>{const n=Date.now();r=e-n},getCurrentTimeAdjusted:()=>r?new Date(Date.now()+r).toISOString():new Date().toISOString(),toClientTime:e=>Date.parse(e)-r}})();(()=>{const{subscribe:r,update:t}=rd([]);return Fe.observe(({added:i,deleted:o,updated:s})=>{const l=s.filter(({oldValue:c,newValue:u})=>c.state.isSelectedBy!==u.state.isSelectedBy).map(({newValue:c})=>c),a=i.filter(c=>c.state.isSelectedBy);l.length+o.length+a.length>0&&t(c=>{const u=[...l.filter(p=>p.state.isSelectedBy===Jr.currentUser.id),...a],f=new Set([...l.filter(p=>!p.state.isSelectedBy).map(p=>p.id),...o.filter(p=>c.find(h=>h.id===p.id)).map(p=>p.id)]);return u.length+f.size>0?[...c.filter(h=>!f.has(h.id)),...u].map(h=>Fe.get(h.id)):c.map(p=>Fe.get(p.id))})},!0),{subscribe:r,select:i=>{const o=typeof i=="string"?i:i.id;Fe.setState(o,{isSelectedBy:Jr.currentUser.id})},deselect:i=>{const o=typeof i=="string"?i:i.id;Fe.setState(o,{isSelectedBy:void 0})}}})();const hy="",py="",dy="",gy="";function Gg(r){let t,e,n,i,o,s,l,a,c,u;return i=new Jc({props:{data:r[1]}}),i.$on("addTranscription",r[2]),{c(){t=W("div"),e=W("div"),n=W("div"),qe(i.$$.fragment),o=Ht(),s=W("div"),D(n,"class","r8s-hover-content svelte-nj7tr3"),D(e,"class","r8s-hover-main svelte-nj7tr3"),D(s,"class","mousetrap svelte-nj7tr3"),D(t,"class","r8s-hover-container svelte-nj7tr3"),D(t,"style",l=`top: ${r[0].offsetY}px; left: ${r[0].offsetX}px`)},m(f,p){U(f,t,p),C(t,e),C(e,n),we(i,n,null),C(t,o),C(t,s),a=!0,c||(u=rc(_c.call(null,e)),c=!0)},p(f,[p]){const h={};p&2&&(h.data=f[1]),i.$set(h),(!a||p&1&&l!==(l=`top: ${f[0].offsetY}px; left: ${f[0].offsetX}px`))&&D(t,"style",l)},i(f){a||($(i.$$.fragment,f),a=!0)},o(f){N(i.$$.fragment,f),a=!1},d(f){f&&B(t),Se(i),c=!1,u()}}}function Vg(r,t,e){const n=lo();let{annotation:i}=t,{originalEvent:o}=t,s=[];const l=a=>{const u=[...Array.isArray(i.body)?i.body:[i.body],{type:"TextualBody",purpose:"transcribing",value:a.detail,creator:{type:"Person",name:Jr.currentUser.id},created:Jr.getCurrentTimeAdjusted()}];e(3,i={...i,body:u}),n("transcriptionChanged",i)};return r.$$set=a=>{"annotation"in a&&e(3,i=a.annotation),"originalEvent"in a&&e(0,o=a.originalEvent)},r.$$.update=()=>{if(r.$$.dirty&8){const a=i.body?Array.isArray(i.body)?i.body:[i.body]:[];e(1,s=a.filter(c=>{var u;return(!c.purpose||c.purpose==="transcribing")&&((u=c.creator)==null?void 0:u.name)!=="mapKurator:post-ocr"}))}},[o,s,l,i]}class Xg extends on{constructor(t){super(),nn(this,t,Vg,Gg,He,{annotation:3,originalEvent:0})}}class zg{constructor(t,e){this.showPopup=(n,i)=>{this.popup=new Xg({target:document.body,props:{annotation:n,originalEvent:i}}),this.popup.$on("transcriptionChanged",o=>this.anno.updateAnnotation(o.detail.id,o.detail)),this.popup.$on("editShape",o=>this.anno.selectAnnotation(o.detail.id))},this.hidePopup=()=>{this.popup.$destroy(),this.popup=null},this.anno=t,this.viewer=e,t.on("mouseEnterAnnotation",(n,i)=>{this.showPopup(n,i)}),t.on("mouseLeaveAnnotation",()=>{this.hidePopup()})}}return zg});
//# sourceMappingURL=luna-annotorious.js.map
