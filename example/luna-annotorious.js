(function(P,ue){typeof exports=="object"&&typeof module<"u"?module.exports=ue():typeof define=="function"&&define.amd?define(ue):(P=typeof globalThis<"u"?globalThis:P||self,P.LunaAnnotorious=ue())})(this,function(){"use strict";function P(){}const ue=t=>t;function Ut(t,e){for(const n in e)t[n]=e[n];return t}function qe(t){return t()}function Xe(){return Object.create(null)}function te(t){t.forEach(qe)}function Ne(t){return typeof t=="function"}function oe(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Zt(t){return Object.keys(t).length===0}function Wt(t){return t&&Ne(t.destroy)?t.destroy:P}const Ge=typeof window<"u";let Kt=Ge?()=>window.performance.now():()=>Date.now(),Te=Ge?t=>requestAnimationFrame(t):P;const le=new Set;function Je(t){le.forEach(e=>{e.c(t)||(le.delete(e),e.f())}),le.size!==0&&Te(Je)}function Yt(t){let e;return le.size===0&&Te(Je),{promise:new Promise(n=>{le.add(e={c:t,f:n})}),abort(){le.delete(e)}}}function w(t,e){t.appendChild(e)}function Qe(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function qt(t){const e=N("style");return Xt(Qe(t),e),e.sheet}function Xt(t,e){w(t.head||t,e)}function E(t,e,n){t.insertBefore(e,n||null)}function v(t){t.parentNode.removeChild(t)}function Gt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function N(t){return document.createElement(t)}function xe(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function D(t){return document.createTextNode(t)}function V(){return D(" ")}function se(){return D("")}function I(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function A(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function et(t,e){for(const n in e)A(t,n,e[n])}function Jt(t){return Array.from(t.childNodes)}function ne(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function be(t,e,n){t.classList[n?"add":"remove"](e)}function tt(t,e,{bubbles:n=!1,cancelable:i=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,i,e),r}class Qt{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,i=null){this.e||(this.is_svg?this.e=xe(n.nodeName):this.e=N(n.nodeName),this.t=n,this.c(e)),this.i(i)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)E(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(v)}}const ve=new Map;let ye=0;function xt(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function en(t,e){const n={stylesheet:qt(e),rules:{}};return ve.set(t,n),n}function nt(t,e,n,i,r,o,l,s=0){const a=16.666/i;let c=`{
`;for(let h=0;h<=1;h+=a){const T=e+(n-e)*o(h);c+=h*100+`%{${l(T,1-T)}}
`}const u=c+`100% {${l(n,1-n)}}
}`,f=`__svelte_${xt(u)}_${s}`,d=Qe(t),{stylesheet:m,rules:p}=ve.get(d)||en(d,t);p[f]||(p[f]=!0,m.insertRule(`@keyframes ${f} ${u}`,m.cssRules.length));const _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${f} ${i}ms linear ${r}ms 1 both`,ye+=1,f}function tn(t,e){const n=(t.style.animation||"").split(", "),i=n.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),r=n.length-i.length;r&&(t.style.animation=i.join(", "),ye-=r,ye||nn())}function nn(){Te(()=>{ye||(ve.forEach(t=>{const{stylesheet:e}=t;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.rules={}}),ve.clear())})}let de;function pe(t){de=t}function rn(){if(!de)throw new Error("Function called outside component initialization");return de}function Le(){const t=rn();return(e,n,{cancelable:i=!1}={})=>{const r=t.$$.callbacks[e];if(r){const o=tt(e,n,{cancelable:i});return r.slice().forEach(l=>{l.call(t,o)}),!o.defaultPrevented}return!0}}function on(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(i=>i.call(this,e))}const me=[],Pe=[],ke=[],it=[],rt=Promise.resolve();let $e=!1;function ot(){$e||($e=!0,rt.then(lt))}function ln(){return ot(),rt}function he(t){ke.push(t)}const Me=new Set;let we=0;function lt(){const t=de;do{for(;we<me.length;){const e=me[we];we++,pe(e),sn(e.$$)}for(pe(null),me.length=0,we=0;Pe.length;)Pe.pop()();for(let e=0;e<ke.length;e+=1){const n=ke[e];Me.has(n)||(Me.add(n),n())}ke.length=0}while(me.length);for(;it.length;)it.pop()();$e=!1,Me.clear(),pe(t)}function sn(t){if(t.fragment!==null){t.update(),te(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(he)}}let _e;function cn(){return _e||(_e=Promise.resolve(),_e.then(()=>{_e=null})),_e}function He(t,e,n){t.dispatchEvent(tt(`${e?"intro":"outro"}${n}`))}const Ee=new Set;let J;function Y(){J={r:0,c:[],p:J}}function q(){J.r||te(J.c),J=J.p}function C(t,e){t&&t.i&&(Ee.delete(t),t.i(e))}function L(t,e,n,i){if(t&&t.o){if(Ee.has(t))return;Ee.add(t),J.c.push(()=>{Ee.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}else i&&i()}const an={duration:0};function st(t,e,n,i){let r=e(t,n),o=i?0:1,l=null,s=null,a=null;function c(){a&&tn(t,a)}function u(d,m){const p=d.b-o;return m*=Math.abs(p),{a:o,b:d.b,d:p,duration:m,start:d.start,end:d.start+m,group:d.group}}function f(d){const{delay:m=0,duration:p=300,easing:_=ue,tick:h=P,css:T}=r||an,y={start:Kt()+m,b:d};d||(y.group=J,J.r+=1),l||s?s=y:(T&&(c(),a=nt(t,o,d,p,m,_,T)),d&&h(0,1),l=u(y,p),he(()=>He(t,d,"start")),Yt(b=>{if(s&&b>s.start&&(l=u(s,p),s=null,He(t,l.b,"start"),T&&(c(),a=nt(t,o,l.b,l.duration,0,_,r.css))),l){if(b>=l.end)h(o=l.b,1-o),He(t,l.b,"end"),s||(l.b?c():--l.group.r||te(l.group.c)),l=null;else if(b>=l.start){const $=b-l.start;o=l.a+l.d*_($/l.duration),h(o,1-o)}}return!!(l||s)}))}return{run(d){Ne(r)?cn().then(()=>{r=r(),f(d)}):f(d)},end(){c(),l=s=null}}}function fn(t,e){const n={},i={},r={$$scope:1};let o=t.length;for(;o--;){const l=t[o],s=e[o];if(s){for(const a in l)a in s||(i[a]=1);for(const a in s)r[a]||(n[a]=s[a],r[a]=1);t[o]=s}else for(const a in l)r[a]=1}for(const l in i)l in n||(n[l]=void 0);return n}function X(t){t&&t.c()}function W(t,e,n,i){const{fragment:r,on_mount:o,on_destroy:l,after_update:s}=t.$$;r&&r.m(e,n),i||he(()=>{const a=o.map(qe).filter(Ne);l?l.push(...a):te(a),t.$$.on_mount=[]}),s.forEach(he)}function K(t,e){const n=t.$$;n.fragment!==null&&(te(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function un(t,e){t.$$.dirty[0]===-1&&(me.push(t),ot(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ce(t,e,n,i,r,o,l,s=[-1]){const a=de;pe(t);const c=t.$$={fragment:null,ctx:null,props:o,update:P,not_equal:r,bound:Xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Xe(),dirty:s,skip_bound:!1,root:e.target||a.$$.root};l&&l(c.root);let u=!1;if(c.ctx=n?n(t,e.props||{},(f,d,...m)=>{const p=m.length?m[0]:d;return c.ctx&&r(c.ctx[f],c.ctx[f]=p)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](p),u&&un(t,f)),d}):[],c.update(),u=!0,te(c.before_update),c.fragment=i?i(c.ctx):!1,e.target){if(e.hydrate){const f=Jt(e.target);c.fragment&&c.fragment.l(f),f.forEach(v)}else c.fragment&&c.fragment.c();e.intro&&C(t.$$.fragment),W(t,e.target,e.anchor,e.customElement),lt()}pe(a)}class ae{$destroy(){K(this,1),this.$destroy=P}$on(e,n){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Zt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var De={dragStart:!0},ct=(t,e,n)=>Math.min(Math.max(t,e),n),Be=t=>typeof t=="string",dn=([t,e],n,i)=>{const r=(o,l)=>l===0?0:Math.ceil(o/l)*l;return[r(n,t),r(i,e)]},at=(t,e)=>t.some(n=>e.some(i=>n.contains(i)));function je(t,e){if(t===void 0)return;if(Ve(t))return t.getBoundingClientRect();if(typeof t=="object"){const{top:i=0,left:r=0,right:o=0,bottom:l=0}=t;return{top:i,right:window.innerWidth-o,bottom:window.innerHeight-l,left:r}}if(t==="parent")return e.parentNode.getBoundingClientRect();const n=document.querySelector(t);if(n===null)throw new Error("The selector provided for bound doesn't exists in the document.");return n.getBoundingClientRect()}var Ce=(t,e,n)=>t.style.setProperty(e,n),Ve=t=>t instanceof HTMLElement,pn=(t,e={})=>{var Dt,Bt;let n,i,{bounds:r,axis:o="both",gpuAcceleration:l=!0,legacyTranslate:s=!0,transform:a,applyUserSelectHack:c=!0,disabled:u=!1,ignoreMultitouch:f=!1,recomputeBounds:d=De,grid:m,position:p,cancel:_,handle:h,defaultClass:T="neodrag",defaultClassDragging:y="neodrag-dragging",defaultClassDragged:b="neodrag-dragged",defaultPosition:$={x:0,y:0},onDragStart:g,onDrag:S,onDragEnd:M}=e,z=!1,Q=0,B=0,x=0,G=0,Fe=0,Oe=0,{x:Ae,y:Se}=p?{x:(Dt=p==null?void 0:p.x)!=null?Dt:0,y:(Bt=p==null?void 0:p.y)!=null?Bt:0}:$;We(Ae,Se);let ee,re,ge,Ue,Tt,Lt="",fi=!!p;d={...De,...d};const Ze=document.body.style,ie=t.classList;function We(k=Q,j=B){if(!a){if(s){let U=`${+k}px, ${+j}px`;return Ce(t,"transform",l?`translate3d(${U}, 0)`:`translate(${U})`)}return Ce(t,"translate",`${+k}px ${+j}px ${l?"1px":""}`)}const R=a({offsetX:k,offsetY:j,rootNode:t});Be(R)&&Ce(t,"transform",R)}const Ke=(k,j)=>{const R={offsetX:Q,offsetY:B,rootNode:t,currentNode:Tt};t.dispatchEvent(new CustomEvent(k,{detail:R})),j==null||j(R)},Ye=addEventListener;Ye("pointerdown",$t,!1),Ye("pointerup",Mt,!1),Ye("pointermove",Ht,!1),Ce(t,"touch-action","none");const Pt=()=>{let k=t.offsetWidth/re.width;return isNaN(k)&&(k=1),k};function $t(k){if(u||k.button===2||f&&!k.isPrimary)return;if(d.dragStart&&(ee=je(r,t)),Be(h)&&Be(_)&&h===_)throw new Error("`handle` selector can't be same as `cancel` selector");if(ie.add(T),ge=function(H,O){if(!H)return[O];if(Ve(H))return[H];if(Array.isArray(H))return H;const Z=O.querySelectorAll(H);if(Z===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(Z.values())}(h,t),Ue=function(H,O){if(!H)return[];if(Ve(H))return[H];if(Array.isArray(H))return H;const Z=O.querySelectorAll(H);if(Z===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(Z.values())}(_,t),n=/(both|x)/.test(o),i=/(both|y)/.test(o),at(Ue,ge))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const j=k.composedPath()[0];if(!ge.some(H=>{var O;return H.contains(j)||((O=H.shadowRoot)==null?void 0:O.contains(j))})||at(Ue,[j]))return;Tt=ge.length===1?t:ge.find(H=>H.contains(j)),z=!0,re=t.getBoundingClientRect(),c&&(Lt=Ze.userSelect,Ze.userSelect="none"),Ke("neodrag:start",g);const{clientX:R,clientY:U}=k,F=Pt();n&&(x=R-Ae/F),i&&(G=U-Se/F),ee&&(Fe=R-re.left,Oe=U-re.top)}function Mt(){z&&(d.dragEnd&&(ee=je(r,t)),ie.remove(y),ie.add(b),c&&(Ze.userSelect=Lt),Ke("neodrag:end",M),n&&(x=Q),i&&(G=B),z=!1)}function Ht(k){if(!z)return;d.drag&&(ee=je(r,t)),ie.add(y),k.preventDefault(),re=t.getBoundingClientRect();let j=k.clientX,R=k.clientY;const U=Pt();if(ee){const F={left:ee.left+Fe,top:ee.top+Oe,right:ee.right+Fe-re.width,bottom:ee.bottom+Oe-re.height};j=ct(j,F.left,F.right),R=ct(R,F.top,F.bottom)}if(Array.isArray(m)){let[F,H]=m;if(isNaN(+F)||F<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+H)||H<0)throw new Error("2nd argument of `grid` must be a valid positive number");let O=j-x,Z=R-G;[O,Z]=dn([F/U,H/U],O,Z),j=x+O,R=G+Z}n&&(Q=Math.round((j-x)*U)),i&&(B=Math.round((R-G)*U)),Ae=Q,Se=B,Ke("neodrag",S),We()}return{destroy:()=>{const k=removeEventListener;k("pointerdown",$t,!1),k("pointerup",Mt,!1),k("pointermove",Ht,!1)},update:k=>{var R,U,F,H,O,Z,jt,Vt,zt,Rt,It,Ft,Ot;o=k.axis||"both",u=(R=k.disabled)!=null?R:!1,f=(U=k.ignoreMultitouch)!=null?U:!1,h=k.handle,r=k.bounds,d=(F=k.recomputeBounds)!=null?F:De,_=k.cancel,c=(H=k.applyUserSelectHack)!=null?H:!0,m=k.grid,l=(O=k.gpuAcceleration)!=null?O:!0,s=(Z=k.legacyTranslate)!=null?Z:!0,a=k.transform;const j=ie.contains(b);ie.remove(T,b),T=(jt=k.defaultClass)!=null?jt:"neodrag",y=(Vt=k.defaultClassDragging)!=null?Vt:"neodrag-dragging",b=(zt=k.defaultClassDragged)!=null?zt:"neodrag-dragged",ie.add(T),j&&ie.add(b),fi&&(Ae=Q=(It=(Rt=k.position)==null?void 0:Rt.x)!=null?It:Q,Se=B=(Ot=(Ft=k.position)==null?void 0:Ft.y)!=null?Ot:B,We())}}};function mn(t){let e,n=[{width:t[1]},{height:t[1]},{"stroke-width":"0"},{class:t[2]},t[0].a,t[4],{xmlns:"http://www.w3.org/2000/svg"}],i={};for(let r=0;r<n.length;r+=1)i=Ut(i,n[r]);return{c(){e=xe("svg"),et(e,i)},m(r,o){E(r,e,o),e.innerHTML=t[3]},p(r,[o]){o&8&&(e.innerHTML=r[3]),et(e,i=fn(n,[o&2&&{width:r[1]},o&2&&{height:r[1]},{"stroke-width":"0"},o&4&&{class:r[2]},o&1&&r[0].a,o&16&&r[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:P,o:P,d(r){r&&v(e)}}}function hn(t,e,n){let{src:i}=e,{size:r="1em"}=e,{color:o=void 0}=e,{title:l=void 0}=e,{className:s=""}=e,a,c;return t.$$set=u=>{"src"in u&&n(0,i=u.src),"size"in u&&n(1,r=u.size),"color"in u&&n(5,o=u.color),"title"in u&&n(6,l=u.title),"className"in u&&n(2,s=u.className)},t.$$.update=()=>{t.$$.dirty&33&&(n(4,c={}),o&&(i.a.stroke!=="none"&&n(4,c.stroke=o,c),i.a.fill!=="none"&&n(4,c.fill=o,c))),t.$$.dirty&65&&n(3,a=(l?`<title>${l}</title>`:"")+i.c)},[i,r,s,a,c,o,l]}class fe extends ae{constructor(e){super(),ce(this,e,hn,mn,oe,{src:0,size:1,color:5,title:6,className:2})}}const ft={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'},_n={a:{viewBox:"0 0 448 512"},c:'<path d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path>'},gn={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="6 9 12 15 18 9"></polyline>'};var ze="__autosizeInputGhost",bn={" ":"nbsp","<":"lt",">":"gt"};function vn(t){return"&"+bn[t]+";"}function yn(t){return t.replace(/\s|<|>/g,vn)}function kn(){var t=document.createElement("div");return t.id=ze,t.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(t),t}var wn=function(t,e){var n=window.getComputedStyle(t),i="box-sizing:"+n.boxSizing+";border-left:"+n.borderLeftWidth+" solid red;border-right:"+n.borderRightWidth+" solid red;font-family:"+n.fontFamily+";font-feature-settings:"+n.fontFeatureSettings+";font-kerning:"+n.fontKerning+";font-size:"+n.fontSize+";font-stretch:"+n.fontStretch+";font-style:"+n.fontStyle+";font-variant:"+n.fontVariant+";font-variant-caps:"+n.fontVariantCaps+";font-variant-ligatures:"+n.fontVariantLigatures+";font-variant-numeric:"+n.fontVariantNumeric+";font-weight:"+n.fontWeight+";letter-spacing:"+n.letterSpacing+";margin-left:"+n.marginLeft+";margin-right:"+n.marginRight+";padding-left:"+n.paddingLeft+";padding-right:"+n.paddingRight+";text-indent:"+n.textIndent+";text-transform:"+n.textTransform;function r(){var l=t.value||t.getAttribute("placeholder")||"",s=document.getElementById(ze)||kn();s.style.cssText+=i,s.innerHTML=yn(l);var a=window.getComputedStyle(s).width;return t.style.width=a,a}t.addEventListener("input",r);var o=r();return e&&e.minWidth&&o!=="0px"&&(t.style.minWidth=o),function(){t.removeEventListener("input",r);var l=document.getElementById(ze);l&&l.parentNode.removeChild(l)}};const En={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'},ui="";function Cn(t){var u;let e,n=((u=t[0])==null?void 0:u.value)+"",i,r,o,l,s,a,c=t[2]&&ut();return{c(){e=N("span"),i=D(n),r=V(),c&&c.c(),o=se(),A(e,"class","transcription svelte-jmvim5")},m(f,d){E(f,e,d),w(e,i),E(f,r,d),c&&c.m(f,d),E(f,o,d),l=!0,s||(a=I(e,"click",t[5]),s=!0)},p(f,d){var m;(!l||d&1)&&n!==(n=((m=f[0])==null?void 0:m.value)+"")&&ne(i,n),f[2]?c?(c.p(f,d),d&4&&C(c,1)):(c=ut(),c.c(),C(c,1),c.m(o.parentNode,o)):c&&(Y(),L(c,1,1,()=>{c=null}),q())},i(f){l||(C(c),l=!0)},o(f){L(c),l=!1},d(f){f&&v(e),f&&v(r),c&&c.d(f),f&&v(o),s=!1,a()}}}function An(t){let e,n,i,r;return{c(){var o;e=N("input"),e.value=n=(o=t[0])==null?void 0:o.value,A(e,"spellcheck",!1),A(e,"class","svelte-jmvim5")},m(o,l){E(o,e,l),t[6](e),i||(r=I(e,"keyup",t[4]),i=!0)},p(o,l){var s;l&1&&n!==(n=(s=o[0])==null?void 0:s.value)&&e.value!==n&&(e.value=n)},i:P,o:P,d(o){o&&v(e),t[6](null),i=!1,r()}}}function ut(t){let e,n;return e=new fe({props:{className:"verified-mark",src:En}}),{c(){X(e.$$.fragment)},m(i,r){W(e,i,r),n=!0},p:P,i(i){n||(C(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){K(e,i)}}}function Sn(t){let e,n,i,r;const o=[An,Cn],l=[];function s(a,c){return a[1]?0:1}return e=s(t),n=l[e]=o[e](t),{c(){n.c(),i=se()},m(a,c){l[e].m(a,c),E(a,i,c),r=!0},p(a,[c]){let u=e;e=s(a),e===u?l[e].p(a,c):(Y(),L(l[u],1,1,()=>{l[u]=null}),q(),n=l[e],n?n.p(a,c):(n=l[e]=o[e](a),n.c()),C(n,1),n.m(i.parentNode,i))},i(a){r||(C(n),r=!0)},o(a){L(n),r=!1},d(a){l[e].d(a),a&&v(i)}}}function Nn(t,e,n){const i=Le();let{transcription:r}=e,{isEditable:o}=e,{isVerified:l}=e,s;const a=f=>{const{value:d}=s;f.key==="Enter"?i("save"):f.key==="Escape"?i("cancel"):i("change",d)};function c(f){on.call(this,t,f)}function u(f){Pe[f?"unshift":"push"](()=>{s=f,n(3,s)})}return t.$$set=f=>{"transcription"in f&&n(0,r=f.transcription),"isEditable"in f&&n(1,o=f.isEditable),"isVerified"in f&&n(2,l=f.isVerified)},t.$$.update=()=>{t.$$.dirty&10&&o&&ln().then(()=>{wn(s),s.focus(),s.select()})},[r,o,l,s,a,c,u]}class Tn extends ae{constructor(e){super(),ce(this,e,Nn,Sn,oe,{transcription:0,isEditable:1,isVerified:2})}}function Ln(t){const e=t-1;return e*e*e+1}function dt(t,{delay:e=0,duration:n=400,easing:i=Ln}={}){const r=getComputedStyle(t),o=+r.opacity,l=parseFloat(r.height),s=parseFloat(r.paddingTop),a=parseFloat(r.paddingBottom),c=parseFloat(r.marginTop),u=parseFloat(r.marginBottom),f=parseFloat(r.borderTopWidth),d=parseFloat(r.borderBottomWidth);return{delay:e,duration:n,easing:i,css:m=>`overflow: hidden;opacity: ${Math.min(m*20,1)*o};height: ${m*l}px;padding-top: ${m*s}px;padding-bottom: ${m*a}px;margin-top: ${m*c}px;margin-bottom: ${m*u}px;border-top-width: ${m*f}px;border-bottom-width: ${m*d}px;`}}var Pn=["second","minute","hour","day","week","month","year"];function $n(t,e){if(e===0)return["just now","right now"];var n=Pn[Math.floor(e/2)];return t>1&&(n+="s"),[t+" "+n+" ago","in "+t+" "+n]}var Mn=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function Hn(t,e){if(e===0)return["\u521A\u521A","\u7247\u523B\u540E"];var n=Mn[~~(e/2)];return[t+" "+n+"\u524D",t+" "+n+"\u540E"]}var Re={},pt=function(t,e){Re[t]=e},Dn=function(t){return Re[t]||Re.en_US},Ie=[60,60,24,7,365/7/12,12];function mt(t){return t instanceof Date?t:!isNaN(t)||/^\d+$/.test(t)?new Date(parseInt(t)):(t=(t||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(t))}function Bn(t,e){var n=t<0?1:0;t=Math.abs(t);for(var i=t,r=0;t>=Ie[r]&&r<Ie.length;r++)t/=Ie[r];return t=Math.floor(t),r*=2,t>(r===0?9:1)&&(r+=1),e(t,r,i)[n].replace("%s",t.toString())}function jn(t,e){var n=e?mt(e):new Date;return(+n-+mt(t))/1e3}var ht=function(t,e,n){var i=jn(t,n&&n.relativeDate);return Bn(i,Dn(e))};pt("en_US",$n),pt("zh_CN",Hn);const di="";function _t(t,e,n){const i=t.slice();return i[2]=e[n],i}function gt(t){let e,n,i,r=t[0],o=[];for(let s=0;s<r.length;s+=1)o[s]=bt(_t(t,r,s));const l=s=>L(o[s],1,1,()=>{o[s]=null});return{c(){e=N("ul");for(let s=0;s<o.length;s+=1)o[s].c();A(e,"class","all-transcriptions svelte-f8q5bo")},m(s,a){E(s,e,a);for(let c=0;c<o.length;c+=1)o[c].m(e,null);i=!0},p(s,a){if(a&1){r=s[0];let c;for(c=0;c<r.length;c+=1){const u=_t(s,r,c);o[c]?(o[c].p(u,a),C(o[c],1)):(o[c]=bt(u),o[c].c(),C(o[c],1),o[c].m(e,null))}for(Y(),c=r.length;c<o.length;c+=1)l(c);q()}},i(s){if(!i){for(let a=0;a<r.length;a+=1)C(o[a]);he(()=>{n||(n=st(e,dt,{duration:120},!0)),n.run(1)}),i=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)L(o[a]);n||(n=st(e,dt,{duration:120},!1)),n.run(0),i=!1},d(s){s&&v(e),Gt(o,s),s&&n&&n.end()}}}function Vn(t){let e=t[2].creator.name+"",n;return{c(){n=D(e)},m(i,r){E(i,n,r)},p(i,r){r&1&&e!==(e=i[2].creator.name+"")&&ne(n,e)},i:P,o:P,d(i){i&&v(n)}}}function zn(t){let e,n,i;return e=new fe({props:{src:ft}}),{c(){X(e.$$.fragment),n=D(" mapKurator")},m(r,o){W(e,r,o),E(r,n,o),i=!0},p:P,i(r){i||(C(e.$$.fragment,r),i=!0)},o(r){L(e.$$.fragment,r),i=!1},d(r){K(e,r),r&&v(n)}}}function bt(t){let e,n=t[2].value+"",i,r,o,l=ht(t[2].created)+"",s,a,c,u,f,d;const m=[zn,Vn],p=[];function _(h,T){var y;return((y=h[2].creator)==null?void 0:y.type)==="Software"?0:1}return c=_(t),u=p[c]=m[c](t),{c(){e=N("li"),i=D(n),r=V(),o=N("span"),s=D(l),a=D(" by "),u.c(),f=V(),A(o,"class","transcribed-by"),A(e,"class","svelte-f8q5bo")},m(h,T){E(h,e,T),w(e,i),w(e,r),w(e,o),w(o,s),w(o,a),p[c].m(o,null),w(e,f),d=!0},p(h,T){(!d||T&1)&&n!==(n=h[2].value+"")&&ne(i,n),(!d||T&1)&&l!==(l=ht(h[2].created)+"")&&ne(s,l);let y=c;c=_(h),c===y?p[c].p(h,T):(Y(),L(p[y],1,1,()=>{p[y]=null}),q(),u=p[c],u?u.p(h,T):(u=p[c]=m[c](h),u.c()),C(u,1),u.m(o,null))},i(h){d||(C(u),d=!0)},o(h){L(u),d=!1},d(h){h&&v(e),p[c].d()}}}function Rn(t){let e,n,i=t[1]&&gt(t);return{c(){i&&i.c(),e=se()},m(r,o){i&&i.m(r,o),E(r,e,o),n=!0},p(r,[o]){r[1]?i?(i.p(r,o),o&2&&C(i,1)):(i=gt(r),i.c(),C(i,1),i.m(e.parentNode,e)):i&&(Y(),L(i,1,1,()=>{i=null}),q())},i(r){n||(C(i),n=!0)},o(r){L(i),n=!1},d(r){i&&i.d(r),r&&v(e)}}}function In(t,e,n){let{transcriptions:i}=e,{open:r}=e;return t.$$set=o=>{"transcriptions"in o&&n(0,i=o.transcriptions),"open"in o&&n(1,r=o.open)},[i,r]}class Fn extends ae{constructor(e){super(),ce(this,e,In,Rn,oe,{transcriptions:0,open:1})}}const On={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path>'},pi="";function Un(t){let e;return{c(){e=D("Confirm Delete")},m(n,i){E(n,e,i)},p:P,d(n){n&&v(e)}}}function Zn(t){let e=t[0].deletePromptHeading+"",n;return{c(){n=D(e)},m(i,r){E(i,n,r)},p(i,r){r&1&&e!==(e=i[0].deletePromptHeading+"")&&ne(n,e)},d(i){i&&v(n)}}}function Wn(t){let e;return{c(){e=D("Are you sure you want to delete this transcription?")},m(n,i){E(n,e,i)},p:P,d(n){n&&v(e)}}}function Kn(t){let e=t[0].deletePromptText+"",n;return{c(){n=D(e)},m(i,r){E(i,n,r)},p(i,r){r&1&&e!==(e=i[0].deletePromptText+"")&&ne(n,e)},d(i){i&&v(n)}}}function Yn(t){let e,n,i,r,o,l,s,a,c,u,f,d,m,p,_,h;r=new fe({props:{src:On}});function T(M,z){return M[0].deletePromptHeading?Zn:Un}let y=T(t),b=y(t);function $(M,z){return M[0].deletePromptText?Kn:Wn}let g=$(t),S=g(t);return{c(){e=N("div"),n=N("div"),i=N("button"),X(r.$$.fragment),o=V(),l=N("h1"),b.c(),s=V(),a=N("p"),S.c(),c=V(),u=N("div"),f=N("button"),f.textContent="Cancel",d=V(),m=N("button"),m.textContent="Delete",A(i,"class","close svelte-8tsm9c"),A(l,"class","svelte-8tsm9c"),A(a,"class","svelte-8tsm9c"),A(f,"class","cancel svelte-8tsm9c"),A(m,"class","delete svelte-8tsm9c"),A(u,"class","buttons svelte-8tsm9c"),A(n,"class","modal svelte-8tsm9c"),A(e,"class","modal-wrapper svelte-8tsm9c")},m(M,z){E(M,e,z),w(e,n),w(n,i),W(r,i,null),w(n,o),w(n,l),b.m(l,null),w(n,s),w(n,a),S.m(a,null),w(n,c),w(n,u),w(u,f),w(u,d),w(u,m),p=!0,_||(h=[I(i,"click",t[2]),I(f,"click",t[2]),I(m,"click",t[1])],_=!0)},p(M,[z]){y===(y=T(M))&&b?b.p(M,z):(b.d(1),b=y(M),b&&(b.c(),b.m(l,null))),g===(g=$(M))&&S?S.p(M,z):(S.d(1),S=g(M),S&&(S.c(),S.m(a,null)))},i(M){p||(C(r.$$.fragment,M),p=!0)},o(M){L(r.$$.fragment,M),p=!1},d(M){M&&v(e),K(r),b.d(),S.d(),_=!1,te(h)}}}function qn(t,e,n){let{opts:i}=e;const r=Le(),o=()=>r("delete"),l=()=>r("cancel");return t.$$set=s=>{"opts"in s&&n(0,i=s.opts)},[i,o,l]}class Xn extends ae{constructor(e){super(),ce(this,e,qn,Yn,oe,{opts:0})}}const mi="";function vt(t){let e,n,i,r,o,l;return{c(){e=N("div"),n=new Qt(!1),i=D(" \xB7 "),r=N("button"),r.textContent="Hide message",n.a=i,A(r,"class","svelte-rt6s8e"),A(e,"class","r8s-edit-instructions svelte-rt6s8e")},m(s,a){E(s,e,a),n.m(t[0],e),w(e,i),w(e,r),o||(l=I(r,"click",t[2]),o=!0)},p(s,a){a&1&&n.p(s[0])},d(s){s&&v(e),o=!1,l()}}}function Gn(t){let e,n=t[1]&&vt(t);return{c(){n&&n.c(),e=se()},m(i,r){n&&n.m(i,r),E(i,e,r)},p(i,[r]){i[1]?n?n.p(i,r):(n=vt(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:P,o:P,d(i){n&&n.d(i),i&&v(e)}}}function Jn(t,e,n){let{text:i=`<strong>Transcribed by Artificial Intelligence.</strong> Please 
    help improve our data by confirming or 
    correcting. <a href="#">Learn more</a>`}=e,r=!Boolean(localStorage.getItem("r8s-disable-ai-prompt"));const o=()=>{localStorage.setItem("r8s-disable-ai-prompt","true"),n(1,r=!1)};return t.$$set=l=>{"text"in l&&n(0,i=l.text)},[i,r,o]}class Qn extends ae{constructor(e){super(),ce(this,e,Jn,Gn,oe,{text:0})}}const xn=t=>(t.body?Array.isArray(t.body)?t.body:[t.body]:[]).filter(i=>!i.purpose||i.purpose==="transcribing").slice().sort((i,r)=>i.created<r.created?1:-1),ei=t=>{let e;const n=t.slice().sort((r,o)=>r.created<o.created?1:-1),i=n.filter(r=>{var o;return((o=r.creator)==null?void 0:o.type)==="Person"});if(i.length>0)e=i[0];else{const r=n.find(o=>{var l,s;return((l=o.creator)==null?void 0:l.type)==="Software"&&((s=o.creator)==null?void 0:s.name)==="mapKurator:ocr"});r?e=r:e=n.length>0?n[0]:null}return e},yt=t=>{var e,n;return((e=t.creator)==null?void 0:e.type)==="Software"&&((n=t.creator)==null?void 0:n.name)=="mapKurator:ocr"},ti=t=>{const n=(t.body?Array.isArray(t.body)?t.body:[t.body]:[]).find(i=>i.purpose==="verifying");return Boolean(n)},hi="";function ni(t){let e,n,i,r,o=t[4].length-1+"",l,s,a,c,u,f,d,m;i=new fe({props:{src:gn}});let p=!t[1].readOnly&&kt(t);return u=new Fn({props:{open:t[6],transcriptions:t[4]}}),{c(){e=N("p"),n=N("button"),X(i.$$.fragment),r=V(),l=D(o),s=D(" more transcriptions"),a=V(),p&&p.c(),c=V(),X(u.$$.fragment),A(n,"class","show-all svelte-avjcue"),be(n,"open",t[6]),A(e,"class","transcription-details transcription-count svelte-avjcue")},m(_,h){E(_,e,h),w(e,n),W(i,n,null),w(n,r),w(n,l),w(n,s),w(e,a),p&&p.m(e,null),E(_,c,h),W(u,_,h),f=!0,d||(m=I(n,"click",t[19]),d=!0)},p(_,h){(!f||h&16)&&o!==(o=_[4].length-1+"")&&ne(l,o),h&64&&be(n,"open",_[6]),_[1].readOnly?p&&(p.d(1),p=null):p?p.p(_,h):(p=kt(_),p.c(),p.m(e,null));const T={};h&64&&(T.open=_[6]),h&16&&(T.transcriptions=_[4]),u.$set(T)},i(_){f||(C(i.$$.fragment,_),C(u.$$.fragment,_),f=!0)},o(_){L(i.$$.fragment,_),L(u.$$.fragment,_),f=!1},d(_){_&&v(e),K(i),p&&p.d(),_&&v(c),K(u,_),d=!1,m()}}}function ii(t){let e,n,i,r,o,l,s;const a=[oi,ri],c=[];function u(d,m){var p;return m&4&&(i=null),i==null&&(i=!!yt(d[2])),i?0:(p=d[2].creator)!=null&&p.name?1:-1}~(r=u(t,-1))&&(o=c[r]=a[r](t));let f=!t[1].readOnly&&Et(t);return{c(){e=N("p"),n=D("Transcribed by "),o&&o.c(),l=se(),f&&f.c(),A(e,"class","transcription-details transcribed-by svelte-avjcue")},m(d,m){E(d,e,m),w(e,n),~r&&c[r].m(e,null),w(e,l),f&&f.m(e,null),s=!0},p(d,m){let p=r;r=u(d,m),r===p?~r&&c[r].p(d,m):(o&&(Y(),L(c[p],1,1,()=>{c[p]=null}),q()),~r?(o=c[r],o?o.p(d,m):(o=c[r]=a[r](d),o.c()),C(o,1),o.m(e,l)):o=null),d[1].readOnly?f&&(f.d(1),f=null):f?f.p(d,m):(f=Et(d),f.c(),f.m(e,null))},i(d){s||(C(o),s=!0)},o(d){L(o),s=!1},d(d){d&&v(e),~r&&c[r].d(),f&&f.d()}}}function kt(t){let e,n,i,r,o,l=!t[3]&&wt(t);return{c(){e=D(`\xB7 [ 
          `),n=N("button"),n.textContent="Edit",l&&l.c(),i=D(`
        ]`),A(n,"class","action add-transcription svelte-avjcue")},m(s,a){E(s,e,a),E(s,n,a),l&&l.m(s,a),E(s,i,a),r||(o=I(n,"click",t[13]),r=!0)},p(s,a){s[3]?l&&(l.d(1),l=null):l?l.p(s,a):(l=wt(s),l.c(),l.m(i.parentNode,i))},d(s){s&&v(e),s&&v(n),l&&l.d(s),s&&v(i),r=!1,o()}}}function wt(t){let e,n,i,r;return{c(){e=D("\xA0|\xA0"),n=N("button"),n.textContent="Confirm",A(n,"class","action confirm svelte-avjcue")},m(o,l){E(o,e,l),E(o,n,l),i||(r=I(n,"click",t[14]),i=!0)},p:P,d(o){o&&v(e),o&&v(n),i=!1,r()}}}function ri(t){var r;let e=((r=t[2].creator)==null?void 0:r.name)+"",n,i;return{c(){n=D(e),i=V()},m(o,l){E(o,n,l),E(o,i,l)},p(o,l){var s;l&4&&e!==(e=((s=o[2].creator)==null?void 0:s.name)+"")&&ne(n,e)},i:P,o:P,d(o){o&&v(n),o&&v(i)}}}function oi(t){let e,n,i;return e=new fe({props:{src:ft}}),{c(){X(e.$$.fragment),n=D(" mapKurator ")},m(r,o){W(e,r,o),E(r,n,o),i=!0},p:P,i(r){i||(C(e.$$.fragment,r),i=!0)},o(r){L(e.$$.fragment,r),i=!1},d(r){K(e,r),r&&v(n)}}}function Et(t){let e,n,i,r,o,l=!t[3]&&Ct(t);return{c(){e=D(`\xB7 [ 
          `),n=N("button"),n.textContent="Edit",l&&l.c(),i=D(`
        ]`),A(n,"class","action add-transcription svelte-avjcue")},m(s,a){E(s,e,a),E(s,n,a),l&&l.m(s,a),E(s,i,a),r||(o=I(n,"click",t[13]),r=!0)},p(s,a){s[3]?l&&(l.d(1),l=null):l?l.p(s,a):(l=Ct(s),l.c(),l.m(i.parentNode,i))},d(s){s&&v(e),s&&v(n),l&&l.d(s),s&&v(i),r=!1,o()}}}function Ct(t){let e,n,i,r;return{c(){e=D("\xA0|\xA0"),n=N("button"),n.textContent="Confirm",A(n,"class","action confirm svelte-avjcue")},m(o,l){E(o,e,l),E(o,n,l),i||(r=I(n,"click",t[14]),i=!0)},p:P,d(o){o&&v(e),o&&v(n),i=!1,r()}}}function At(t){let e,n,i,r,o,l,s,a,c,u,f,d;return r=new fe({props:{src:_n}}),{c(){e=N("div"),n=N("div"),i=N("button"),X(r.$$.fragment),o=V(),l=N("div"),s=N("button"),s.textContent="Cancel",a=V(),c=N("button"),c.textContent="Save Edits",A(i,"class","delete svelte-avjcue"),A(n,"class","left"),A(s,"class","cancel svelte-avjcue"),A(c,"class","ok svelte-avjcue"),A(l,"class","right-slot"),A(e,"class","r8s-hover-buttons svelte-avjcue")},m(m,p){E(m,e,p),w(e,n),w(n,i),W(r,i,null),w(e,o),w(e,l),w(l,s),w(l,a),w(l,c),u=!0,f||(d=[I(i,"click",t[20]),I(s,"click",t[11]),I(c,"click",t[10])],f=!0)},p:P,i(m){u||(C(r.$$.fragment,m),u=!0)},o(m){L(r.$$.fragment,m),u=!1},d(m){m&&v(e),K(r),f=!1,te(d)}}}function St(t){let e,n;return e=new Qn({props:{text:t[1].crowdsourcePrompt}}),{c(){X(e.$$.fragment)},m(i,r){W(e,i,r),n=!0},p(i,r){const o={};r&2&&(o.text=i[1].crowdsourcePrompt),e.$set(o)},i(i){n||(C(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){K(e,i)}}}function Nt(t){let e,n;return e=new Xn({props:{opts:t[1]}}),e.$on("cancel",t[21]),e.$on("delete",t[12]),{c(){X(e.$$.fragment)},m(i,r){W(e,i,r),n=!0},p(i,r){const o={};r&2&&(o.opts=i[1]),e.$set(o)},i(i){n||(C(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){K(e,i)}}}function li(t){let e,n,i,r,o,l,s,a,c,u,f,d,m,p;i=new Tn({props:{isEditable:t[1].readOnly?!1:t[5],isVerified:t[3],transcription:t[2]}}),i.$on("click",t[18]),i.$on("change",t[9]),i.$on("save",t[10]),i.$on("cancel",t[11]);const _=[ii,ni],h=[];function T(g,S){return g[4].length===1?0:g[4].length>1?1:-1}~(o=T(t))&&(l=h[o]=_[o](t));let y=t[5]&&At(t),b=t[8]&&St(t),$=t[7]&&Nt(t);return{c(){e=N("div"),n=N("div"),X(i.$$.fragment),r=V(),l&&l.c(),s=V(),y&&y.c(),a=V(),b&&b.c(),u=V(),$&&$.c(),f=se(),A(n,"class","r8s-hover-content svelte-avjcue"),A(e,"class","r8s-hover svelte-avjcue"),A(e,"style",c=`top: ${t[0].offsetY}px; left: ${t[0].offsetX}px`),be(e,"editable",t[5])},m(g,S){E(g,e,S),w(e,n),W(i,n,null),w(n,r),~o&&h[o].m(n,null),w(e,s),y&&y.m(e,null),w(e,a),b&&b.m(e,null),E(g,u,S),$&&$.m(g,S),E(g,f,S),d=!0,m||(p=Wt(pn.call(null,e)),m=!0)},p(g,[S]){const M={};S&34&&(M.isEditable=g[1].readOnly?!1:g[5]),S&8&&(M.isVerified=g[3]),S&4&&(M.transcription=g[2]),i.$set(M);let z=o;o=T(g),o===z?~o&&h[o].p(g,S):(l&&(Y(),L(h[z],1,1,()=>{h[z]=null}),q()),~o?(l=h[o],l?l.p(g,S):(l=h[o]=_[o](g),l.c()),C(l,1),l.m(n,null)):l=null),g[5]?y?(y.p(g,S),S&32&&C(y,1)):(y=At(g),y.c(),C(y,1),y.m(e,a)):y&&(Y(),L(y,1,1,()=>{y=null}),q()),g[8]?b?(b.p(g,S),S&256&&C(b,1)):(b=St(g),b.c(),C(b,1),b.m(e,null)):b&&(Y(),L(b,1,1,()=>{b=null}),q()),(!d||S&1&&c!==(c=`top: ${g[0].offsetY}px; left: ${g[0].offsetX}px`))&&A(e,"style",c),S&32&&be(e,"editable",g[5]),g[7]?$?($.p(g,S),S&128&&C($,1)):($=Nt(g),$.c(),C($,1),$.m(f.parentNode,f)):$&&(Y(),L($,1,1,()=>{$=null}),q())},i(g){d||(C(i.$$.fragment,g),C(l),C(y),C(b),C($),d=!0)},o(g){L(i.$$.fragment,g),L(l),L(y),L(b),L($),d=!1},d(g){g&&v(e),K(i),~o&&h[o].d(),y&&y.d(),b&&b.d(),g&&v(u),$&&$.d(g),g&&v(f),m=!1,p()}}}function si(t,e,n){let i,r,o,l;const s=Le();let{annotation:a}=e,{originalEvent:c}=e,{env:u}=e,{opts:f}=e,d=!1,m=!1,p=a,_=!1;const h=B=>{const x=Array.isArray(p.body)?p.body:[p.body],G={type:"TextualBody",purpose:"transcribing",value:B.detail,creator:{type:"Person",name:"displayName"in u.currentUser?u.currentUser.displayName:u.currentUser.id},created:u.getCurrentTimeAdjusted()};n(15,a={...p,body:[...x,G]})},T=()=>{s("save",a),n(17,p=a),n(5,d=!1)},y=()=>{s("cancel",a),n(15,a=p),n(5,d=!1)},b=()=>s("delete"),$=()=>{n(5,d=!0),s("edit")},g=()=>{const B=Array.isArray(p.body)?p.body:[p.body],x={type:"TextualBody",purpose:"verifying",value:r==null?void 0:r.value,creator:{type:"Person",name:"displayName"in u.currentUser?u.currentUser.displayName:u.currentUser.id},created:u.getCurrentTimeAdjusted()},G={...p,body:[...B,x]};n(17,p=G),n(5,d=!1),s("confirm",G)},S=()=>n(6,m=!m),M=()=>n(6,m=!m),z=()=>n(7,_=!0),Q=()=>n(7,_=!1);return t.$$set=B=>{"annotation"in B&&n(15,a=B.annotation),"originalEvent"in B&&n(0,c=B.originalEvent),"env"in B&&n(16,u=B.env),"opts"in B&&n(1,f=B.opts)},t.$$.update=()=>{t.$$.dirty&131072&&n(4,i=xn(p)),t.$$.dirty&16&&n(2,r=ei(i)),t.$$.dirty&131072&&n(3,o=ti(p)),t.$$.dirty&14&&n(8,l=!(f.readOnly||o||!yt(r)))},[c,f,r,o,i,d,m,_,l,h,T,y,b,$,g,a,u,p,S,M,z,Q]}class ci extends ae{constructor(e){super(),ce(this,e,si,li,oe,{annotation:15,originalEvent:0,env:16,opts:1})}}class ai{constructor(e,n={}){this.showPopup=(i,r)=>{this.popup&&this.hidePopup(),this.popup=new ci({target:document.body,props:{annotation:i,originalEvent:r,env:this.anno.env,opts:this.opts}}),this.popup.$on("confirm",o=>{this.isEditing=!1,this.hidePopup(),this.anno.updateAnnotation(o.detail.id,o.detail)}),this.popup.$on("save",o=>{this.isEditing=!1,this.hidePopup();const l=this.anno.getAnnotationById(i.id),s={...o.detail,target:{...l.target}};this.anno.updateAnnotation(o.detail.id,s)}),this.popup.$on("cancel",()=>{this.isEditing=!1,this.hidePopup(),this.anno.deselectAll()}),this.popup.$on("edit",()=>{this.isEditing=!0,this.anno.selectAnnotation(i)}),this.popup.$on("delete",()=>{this.isEditing=!1,this.hidePopup(),this.anno.removeAnnotation(i)})},this.hidePopup=()=>{this.popup&&(this.popup.$destroy(),this.popup=null)},this.anno=e,this.opts=n,e.on("pointerdown",(i,r)=>{this.isEditing||(i?this.showPopup(i,r):this.hidePopup())}),document.addEventListener("keydown",i=>{i.key==="Escape"&&(this.isEditing=!1,this.hidePopup(),this.anno.deselectAll())})}}const _i="";return ai});
//# sourceMappingURL=luna-annotorious.js.map
