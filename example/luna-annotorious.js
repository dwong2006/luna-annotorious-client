(function(L,ie){typeof exports=="object"&&typeof module<"u"?module.exports=ie():typeof define=="function"&&define.amd?define(ie):(L=typeof globalThis<"u"?globalThis:L||self,L.LunaAnnotorious=ie())})(this,function(){"use strict";function L(){}const ie=e=>e;function jt(e,t){for(const n in t)e[n]=t[n];return e}function qe(e){return e()}function Xe(){return Object.create(null)}function I(e){e.forEach(qe)}function Se(e){return typeof e=="function"}function re(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Rt(e){return Object.keys(e).length===0}function Vt(e){return e&&Se(e.destroy)?e.destroy:L}const Ge=typeof window<"u";let Ft=Ge?()=>window.performance.now():()=>Date.now(),Te=Ge?e=>requestAnimationFrame(e):L;const te=new Set;function xe(e){te.forEach(t=>{t.c(e)||(te.delete(t),t.f())}),te.size!==0&&Te(xe)}function Ot(e){let t;return te.size===0&&Te(xe),{promise:new Promise(n=>{te.add(t={c:e,f:n})}),abort(){te.delete(t)}}}function k(e,t){e.appendChild(t)}function Je(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function Zt(e){const t=S("style");return It(Je(e),t),t.sheet}function It(e,t){k(e.head||e,t)}function C(e,t,n){e.insertBefore(t,n||null)}function w(e){e.parentNode.removeChild(e)}function Ut(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function S(e){return document.createElement(e)}function Wt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function M(e){return document.createTextNode(e)}function H(){return M(" ")}function le(){return M("")}function R(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function A(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Qe(e,t){for(const n in t)A(e,n,t[n])}function Kt(e){return Array.from(e.childNodes)}function ne(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ge(e,t,n){e.classList[n?"add":"remove"](t)}function et(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n,o,t),i}const be=new Map;let ve=0;function Yt(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function qt(e,t){const n={stylesheet:Zt(t),rules:{}};return be.set(e,n),n}function tt(e,t,n,o,i,r,l,c=0){const a=16.666/o;let s=`{
`;for(let g=0;g<=1;g+=a){const h=t+(n-t)*r(g);s+=g*100+`%{${l(h,1-h)}}
`}const u=s+`100% {${l(n,1-n)}}
}`,p=`__svelte_${Yt(u)}_${c}`,f=Je(e),{stylesheet:d,rules:m}=be.get(f)||qt(f,e);m[p]||(m[p]=!0,d.insertRule(`@keyframes ${p} ${u}`,d.cssRules.length));const _=e.style.animation||"";return e.style.animation=`${_?`${_}, `:""}${p} ${o}ms linear ${i}ms 1 both`,ve+=1,p}function Xt(e,t){const n=(e.style.animation||"").split(", "),o=n.filter(t?r=>r.indexOf(t)<0:r=>r.indexOf("__svelte")===-1),i=n.length-o.length;i&&(e.style.animation=o.join(", "),ve-=i,ve||Gt())}function Gt(){Te(()=>{ve||(be.forEach(e=>{const{stylesheet:t}=e;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.rules={}}),be.clear())})}let se;function ae(e){se=e}function xt(){if(!se)throw new Error("Function called outside component initialization");return se}function Le(){const e=xt();return(t,n,{cancelable:o=!1}={})=>{const i=e.$$.callbacks[t];if(i){const r=et(t,n,{cancelable:o});return i.slice().forEach(l=>{l.call(e,r)}),!r.defaultPrevented}return!0}}function Jt(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const ce=[],$e=[],ye=[],nt=[],ot=Promise.resolve();let Ne=!1;function it(){Ne||(Ne=!0,ot.then(rt))}function Qt(){return it(),ot}function ue(e){ye.push(e)}const De=new Set;let ke=0;function rt(){const e=se;do{for(;ke<ce.length;){const t=ce[ke];ke++,ae(t),en(t.$$)}for(ae(null),ce.length=0,ke=0;$e.length;)$e.pop()();for(let t=0;t<ye.length;t+=1){const n=ye[t];De.has(n)||(De.add(n),n())}ye.length=0}while(ce.length);for(;nt.length;)nt.pop()();Ne=!1,De.clear(),ae(e)}function en(e){if(e.fragment!==null){e.update(),I(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ue)}}let fe;function tn(){return fe||(fe=Promise.resolve(),fe.then(()=>{fe=null})),fe}function Me(e,t,n){e.dispatchEvent(et(`${t?"intro":"outro"}${n}`))}const we=new Set;let K;function Y(){K={r:0,c:[],p:K}}function q(){K.r||I(K.c),K=K.p}function E(e,t){e&&e.i&&(we.delete(e),e.i(t))}function T(e,t,n,o){if(e&&e.o){if(we.has(e))return;we.add(e),K.c.push(()=>{we.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}const nn={duration:0};function lt(e,t,n,o){let i=t(e,n),r=o?0:1,l=null,c=null,a=null;function s(){a&&Xt(e,a)}function u(f,d){const m=f.b-r;return d*=Math.abs(m),{a:r,b:f.b,d:m,duration:d,start:f.start,end:f.start+d,group:f.group}}function p(f){const{delay:d=0,duration:m=300,easing:_=ie,tick:g=L,css:h}=i||nn,y={start:Ft()+d,b:f};f||(y.group=K,K.r+=1),l||c?c=y:(h&&(s(),a=tt(e,r,f,m,d,_,h)),f&&g(0,1),l=u(y,m),ue(()=>Me(e,f,"start")),Ot(b=>{if(c&&b>c.start&&(l=u(c,m),c=null,Me(e,l.b,"start"),h&&(s(),a=tt(e,r,l.b,l.duration,0,_,i.css))),l){if(b>=l.end)g(r=l.b,1-r),Me(e,l.b,"end"),c||(l.b?s():--l.group.r||I(l.group.c)),l=null;else if(b>=l.start){const N=b-l.start;r=l.a+l.d*_(N/l.duration),g(r,1-r)}}return!!(l||c)}))}return{run(f){Se(i)?tn().then(()=>{i=i(),p(f)}):p(f)},end(){s(),l=c=null}}}function on(e,t){const n={},o={},i={$$scope:1};let r=e.length;for(;r--;){const l=e[r],c=t[r];if(c){for(const a in l)a in c||(o[a]=1);for(const a in c)i[a]||(n[a]=c[a],i[a]=1);e[r]=c}else for(const a in l)i[a]=1}for(const l in o)l in n||(n[l]=void 0);return n}function X(e){e&&e.c()}function U(e,t,n,o){const{fragment:i,on_mount:r,on_destroy:l,after_update:c}=e.$$;i&&i.m(t,n),o||ue(()=>{const a=r.map(qe).filter(Se);l?l.push(...a):I(a),e.$$.on_mount=[]}),c.forEach(ue)}function W(e,t){const n=e.$$;n.fragment!==null&&(I(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function rn(e,t){e.$$.dirty[0]===-1&&(ce.push(e),it(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function de(e,t,n,o,i,r,l,c=[-1]){const a=se;ae(e);const s=e.$$={fragment:null,ctx:null,props:r,update:L,not_equal:i,bound:Xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Xe(),dirty:c,skip_bound:!1,root:t.target||a.$$.root};l&&l(s.root);let u=!1;if(s.ctx=n?n(e,t.props||{},(p,f,...d)=>{const m=d.length?d[0]:f;return s.ctx&&i(s.ctx[p],s.ctx[p]=m)&&(!s.skip_bound&&s.bound[p]&&s.bound[p](m),u&&rn(e,p)),f}):[],s.update(),u=!0,I(s.before_update),s.fragment=o?o(s.ctx):!1,t.target){if(t.hydrate){const p=Kt(t.target);s.fragment&&s.fragment.l(p),p.forEach(w)}else s.fragment&&s.fragment.c();t.intro&&E(e.$$.fragment),U(e,t.target,t.anchor,t.customElement),rt()}ae(a)}class pe{$destroy(){W(this,1),this.$destroy=L}$on(t,n){const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const i=o.indexOf(n);i!==-1&&o.splice(i,1)}}$set(t){this.$$set&&!Rt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var Pe={dragStart:!0},st=(e,t,n)=>Math.min(Math.max(e,t),n),Be=e=>typeof e=="string",ln=([e,t],n,o)=>{const i=(r,l)=>l===0?0:Math.ceil(r/l)*l;return[i(n,e),i(o,t)]},at=(e,t)=>e.some(n=>t.some(o=>n.contains(o)));function He(e,t){if(e===void 0)return;if(ze(e))return e.getBoundingClientRect();if(typeof e=="object"){const{top:o=0,left:i=0,right:r=0,bottom:l=0}=e;return{top:o,right:window.innerWidth-r,bottom:window.innerHeight-l,left:i}}if(e==="parent")return t.parentNode.getBoundingClientRect();const n=document.querySelector(e);if(n===null)throw new Error("The selector provided for bound doesn't exists in the document.");return n.getBoundingClientRect()}var Ee=(e,t,n)=>e.style.setProperty(t,n),ze=e=>e instanceof HTMLElement,sn=(e,t={})=>{var Lt,$t;let n,o,{bounds:i,axis:r="both",gpuAcceleration:l=!0,legacyTranslate:c=!0,transform:a,applyUserSelectHack:s=!0,disabled:u=!1,ignoreMultitouch:p=!1,recomputeBounds:f=Pe,grid:d,position:m,cancel:_,handle:g,defaultClass:h="neodrag",defaultClassDragging:y="neodrag-dragging",defaultClassDragged:b="neodrag-dragged",defaultPosition:N={x:0,y:0},onDragStart:J,onDrag:Q,onDragEnd:Fe}=t,P=!1,Z=0,F=0,me=0,he=0,Oe=0,Ze=0,{x:Ce,y:Ae}=m?{x:(Lt=m==null?void 0:m.x)!=null?Lt:0,y:($t=m==null?void 0:m.y)!=null?$t:0}:N;We(Ce,Ae);let G,ee,_e,Ie,wt,Et="",xn=!!m;f={...Pe,...f};const Ue=document.body.style,x=e.classList;function We(v=Z,D=F){if(!a){if(c){let V=`${+v}px, ${+D}px`;return Ee(e,"transform",l?`translate3d(${V}, 0)`:`translate(${V})`)}return Ee(e,"translate",`${+v}px ${+D}px ${l?"1px":""}`)}const B=a({offsetX:v,offsetY:D,rootNode:e});Be(B)&&Ee(e,"transform",B)}const Ke=(v,D)=>{const B={offsetX:Z,offsetY:F,rootNode:e,currentNode:wt};e.dispatchEvent(new CustomEvent(v,{detail:B})),D==null||D(B)},Ye=addEventListener;Ye("pointerdown",At,!1),Ye("pointerup",St,!1),Ye("pointermove",Tt,!1),Ee(e,"touch-action","none");const Ct=()=>{let v=e.offsetWidth/ee.width;return isNaN(v)&&(v=1),v};function At(v){if(u||v.button===2||p&&!v.isPrimary)return;if(f.dragStart&&(G=He(i,e)),Be(g)&&Be(_)&&g===_)throw new Error("`handle` selector can't be same as `cancel` selector");if(x.add(h),_e=function($,j){if(!$)return[j];if(ze($))return[$];if(Array.isArray($))return $;const O=j.querySelectorAll($);if(O===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(O.values())}(g,e),Ie=function($,j){if(!$)return[];if(ze($))return[$];if(Array.isArray($))return $;const O=j.querySelectorAll($);if(O===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(O.values())}(_,e),n=/(both|x)/.test(r),o=/(both|y)/.test(r),at(Ie,_e))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const D=v.composedPath()[0];if(!_e.some($=>{var j;return $.contains(D)||((j=$.shadowRoot)==null?void 0:j.contains(D))})||at(Ie,[D]))return;wt=_e.length===1?e:_e.find($=>$.contains(D)),P=!0,ee=e.getBoundingClientRect(),s&&(Et=Ue.userSelect,Ue.userSelect="none"),Ke("neodrag:start",J);const{clientX:B,clientY:V}=v,z=Ct();n&&(me=B-Ce/z),o&&(he=V-Ae/z),G&&(Oe=B-ee.left,Ze=V-ee.top)}function St(){P&&(f.dragEnd&&(G=He(i,e)),x.remove(y),x.add(b),s&&(Ue.userSelect=Et),Ke("neodrag:end",Fe),n&&(me=Z),o&&(he=F),P=!1)}function Tt(v){if(!P)return;f.drag&&(G=He(i,e)),x.add(y),v.preventDefault(),ee=e.getBoundingClientRect();let D=v.clientX,B=v.clientY;const V=Ct();if(G){const z={left:G.left+Oe,top:G.top+Ze,right:G.right+Oe-ee.width,bottom:G.bottom+Ze-ee.height};D=st(D,z.left,z.right),B=st(B,z.top,z.bottom)}if(Array.isArray(d)){let[z,$]=d;if(isNaN(+z)||z<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+$)||$<0)throw new Error("2nd argument of `grid` must be a valid positive number");let j=D-me,O=B-he;[j,O]=ln([z/V,$/V],j,O),D=me+j,B=he+O}n&&(Z=Math.round((D-me)*V)),o&&(F=Math.round((B-he)*V)),Ce=Z,Ae=F,Ke("neodrag",Q),We()}return{destroy:()=>{const v=removeEventListener;v("pointerdown",At,!1),v("pointerup",St,!1),v("pointermove",Tt,!1)},update:v=>{var B,V,z,$,j,O,Nt,Dt,Mt,Pt,Bt,Ht,zt;r=v.axis||"both",u=(B=v.disabled)!=null?B:!1,p=(V=v.ignoreMultitouch)!=null?V:!1,g=v.handle,i=v.bounds,f=(z=v.recomputeBounds)!=null?z:Pe,_=v.cancel,s=($=v.applyUserSelectHack)!=null?$:!0,d=v.grid,l=(j=v.gpuAcceleration)!=null?j:!0,c=(O=v.legacyTranslate)!=null?O:!0,a=v.transform;const D=x.contains(b);x.remove(h,b),h=(Nt=v.defaultClass)!=null?Nt:"neodrag",y=(Dt=v.defaultClassDragging)!=null?Dt:"neodrag-dragging",b=(Mt=v.defaultClassDragged)!=null?Mt:"neodrag-dragged",x.add(h),D&&x.add(b),xn&&(Ce=Z=(Bt=(Pt=v.position)==null?void 0:Pt.x)!=null?Bt:Z,Ae=F=(zt=(Ht=v.position)==null?void 0:Ht.y)!=null?zt:F,We())}}};function an(e){let t,n=[{width:e[1]},{height:e[1]},{"stroke-width":"0"},{class:e[2]},e[0].a,e[4],{xmlns:"http://www.w3.org/2000/svg"}],o={};for(let i=0;i<n.length;i+=1)o=jt(o,n[i]);return{c(){t=Wt("svg"),Qe(t,o)},m(i,r){C(i,t,r),t.innerHTML=e[3]},p(i,[r]){r&8&&(t.innerHTML=i[3]),Qe(t,o=on(n,[r&2&&{width:i[1]},r&2&&{height:i[1]},{"stroke-width":"0"},r&4&&{class:i[2]},r&1&&i[0].a,r&16&&i[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:L,o:L,d(i){i&&w(t)}}}function cn(e,t,n){let{src:o}=t,{size:i="1em"}=t,{color:r=void 0}=t,{title:l=void 0}=t,{className:c=""}=t,a,s;return e.$$set=u=>{"src"in u&&n(0,o=u.src),"size"in u&&n(1,i=u.size),"color"in u&&n(5,r=u.color),"title"in u&&n(6,l=u.title),"className"in u&&n(2,c=u.className)},e.$$.update=()=>{e.$$.dirty&33&&(n(4,s={}),r&&(o.a.stroke!=="none"&&n(4,s.stroke=r,s),o.a.fill!=="none"&&n(4,s.fill=r,s))),e.$$.dirty&65&&n(3,a=(l?`<title>${l}</title>`:"")+o.c)},[o,i,c,a,s,r,l]}class oe extends pe{constructor(t){super(),de(this,t,cn,an,re,{src:0,size:1,color:5,title:6,className:2})}}const ct={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'},un={a:{viewBox:"0 0 448 512"},c:'<path d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"></path>'},fn={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="6 9 12 15 18 9"></polyline>'};var je="__autosizeInputGhost",dn={" ":"nbsp","<":"lt",">":"gt"};function pn(e){return"&"+dn[e]+";"}function mn(e){return e.replace(/\s|<|>/g,pn)}function hn(){var e=document.createElement("div");return e.id=je,e.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(e),e}var _n=function(e,t){var n=window.getComputedStyle(e),o="box-sizing:"+n.boxSizing+";border-left:"+n.borderLeftWidth+" solid red;border-right:"+n.borderRightWidth+" solid red;font-family:"+n.fontFamily+";font-feature-settings:"+n.fontFeatureSettings+";font-kerning:"+n.fontKerning+";font-size:"+n.fontSize+";font-stretch:"+n.fontStretch+";font-style:"+n.fontStyle+";font-variant:"+n.fontVariant+";font-variant-caps:"+n.fontVariantCaps+";font-variant-ligatures:"+n.fontVariantLigatures+";font-variant-numeric:"+n.fontVariantNumeric+";font-weight:"+n.fontWeight+";letter-spacing:"+n.letterSpacing+";margin-left:"+n.marginLeft+";margin-right:"+n.marginRight+";padding-left:"+n.paddingLeft+";padding-right:"+n.paddingRight+";text-indent:"+n.textIndent+";text-transform:"+n.textTransform;function i(){var l=e.value||e.getAttribute("placeholder")||"",c=document.getElementById(je)||hn();c.style.cssText+=o,c.innerHTML=mn(l);var a=window.getComputedStyle(c).width;return e.style.width=a,a}e.addEventListener("input",i);var r=i();return t&&t.minWidth&&r!=="0px"&&(e.style.minWidth=r),function(){e.removeEventListener("input",i);var l=document.getElementById(je);l&&l.parentNode.removeChild(l)}};const gn={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'},Jn="";function bn(e){var u,p,f;let t,n=((u=e[0])==null?void 0:u.value)+"",o,i,r,l,c,a,s=((f=(p=e[0])==null?void 0:p.creator)==null?void 0:f.type)==="Person"&&ut();return{c(){t=S("span"),o=M(n),i=H(),s&&s.c(),r=le(),A(t,"class","transcription svelte-jmvim5")},m(d,m){C(d,t,m),k(t,o),C(d,i,m),s&&s.m(d,m),C(d,r,m),l=!0,c||(a=R(t,"click",e[4]),c=!0)},p(d,m){var _,g,h;(!l||m&1)&&n!==(n=((_=d[0])==null?void 0:_.value)+"")&&ne(o,n),((h=(g=d[0])==null?void 0:g.creator)==null?void 0:h.type)==="Person"?s?(s.p(d,m),m&1&&E(s,1)):(s=ut(),s.c(),E(s,1),s.m(r.parentNode,r)):s&&(Y(),T(s,1,1,()=>{s=null}),q())},i(d){l||(E(s),l=!0)},o(d){T(s),l=!1},d(d){d&&w(t),d&&w(i),s&&s.d(d),d&&w(r),c=!1,a()}}}function vn(e){let t,n,o,i;return{c(){var r;t=S("input"),t.value=n=(r=e[0])==null?void 0:r.value,A(t,"spellcheck",!1),A(t,"class","svelte-jmvim5")},m(r,l){C(r,t,l),e[5](t),o||(i=R(t,"keyup",e[3]),o=!0)},p(r,l){var c;l&1&&n!==(n=(c=r[0])==null?void 0:c.value)&&t.value!==n&&(t.value=n)},i:L,o:L,d(r){r&&w(t),e[5](null),o=!1,i()}}}function ut(e){let t,n;return t=new oe({props:{className:"verified-mark",src:gn}}),{c(){X(t.$$.fragment)},m(o,i){U(t,o,i),n=!0},p:L,i(o){n||(E(t.$$.fragment,o),n=!0)},o(o){T(t.$$.fragment,o),n=!1},d(o){W(t,o)}}}function yn(e){let t,n,o,i;const r=[vn,bn],l=[];function c(a,s){return a[1]?0:1}return t=c(e),n=l[t]=r[t](e),{c(){n.c(),o=le()},m(a,s){l[t].m(a,s),C(a,o,s),i=!0},p(a,[s]){let u=t;t=c(a),t===u?l[t].p(a,s):(Y(),T(l[u],1,1,()=>{l[u]=null}),q(),n=l[t],n?n.p(a,s):(n=l[t]=r[t](a),n.c()),E(n,1),n.m(o.parentNode,o))},i(a){i||(E(n),i=!0)},o(a){T(n),i=!1},d(a){l[t].d(a),a&&w(o)}}}function kn(e,t,n){const o=Le();let{transcription:i}=t,{isEditable:r}=t,l;const c=u=>{const{value:p}=l;u.key==="Enter"?o("save"):u.key==="Escape"?o("cancel"):o("change",p)};function a(u){Jt.call(this,e,u)}function s(u){$e[u?"unshift":"push"](()=>{l=u,n(2,l)})}return e.$$set=u=>{"transcription"in u&&n(0,i=u.transcription),"isEditable"in u&&n(1,r=u.isEditable)},e.$$.update=()=>{e.$$.dirty&6&&r&&Qt().then(()=>{_n(l),l.focus(),l.select()})},[i,r,l,c,a,s]}class wn extends pe{constructor(t){super(),de(this,t,kn,yn,re,{transcription:0,isEditable:1})}}function En(e){const t=e-1;return t*t*t+1}function ft(e,{delay:t=0,duration:n=400,easing:o=En}={}){const i=getComputedStyle(e),r=+i.opacity,l=parseFloat(i.height),c=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),s=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),p=parseFloat(i.borderTopWidth),f=parseFloat(i.borderBottomWidth);return{delay:t,duration:n,easing:o,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*r};height: ${d*l}px;padding-top: ${d*c}px;padding-bottom: ${d*a}px;margin-top: ${d*s}px;margin-bottom: ${d*u}px;border-top-width: ${d*p}px;border-bottom-width: ${d*f}px;`}}var Cn=["second","minute","hour","day","week","month","year"];function An(e,t){if(t===0)return["just now","right now"];var n=Cn[Math.floor(t/2)];return e>1&&(n+="s"),[e+" "+n+" ago","in "+e+" "+n]}var Sn=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function Tn(e,t){if(t===0)return["\u521A\u521A","\u7247\u523B\u540E"];var n=Sn[~~(t/2)];return[e+" "+n+"\u524D",e+" "+n+"\u540E"]}var Re={},dt=function(e,t){Re[e]=t},Ln=function(e){return Re[e]||Re.en_US},Ve=[60,60,24,7,365/7/12,12];function pt(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function $n(e,t){var n=e<0?1:0;e=Math.abs(e);for(var o=e,i=0;e>=Ve[i]&&i<Ve.length;i++)e/=Ve[i];return e=Math.floor(e),i*=2,e>(i===0?9:1)&&(i+=1),t(e,i,o)[n].replace("%s",e.toString())}function Nn(e,t){var n=t?pt(t):new Date;return(+n-+pt(e))/1e3}var mt=function(e,t,n){var o=Nn(e,n&&n.relativeDate);return $n(o,Ln(t))};dt("en_US",An),dt("zh_CN",Tn);const Qn="";function ht(e,t,n){const o=e.slice();return o[2]=t[n],o}function _t(e){let t,n,o,i=e[0],r=[];for(let c=0;c<i.length;c+=1)r[c]=gt(ht(e,i,c));const l=c=>T(r[c],1,1,()=>{r[c]=null});return{c(){t=S("ul");for(let c=0;c<r.length;c+=1)r[c].c();A(t,"class","all-transcriptions svelte-f8q5bo")},m(c,a){C(c,t,a);for(let s=0;s<r.length;s+=1)r[s].m(t,null);o=!0},p(c,a){if(a&1){i=c[0];let s;for(s=0;s<i.length;s+=1){const u=ht(c,i,s);r[s]?(r[s].p(u,a),E(r[s],1)):(r[s]=gt(u),r[s].c(),E(r[s],1),r[s].m(t,null))}for(Y(),s=i.length;s<r.length;s+=1)l(s);q()}},i(c){if(!o){for(let a=0;a<i.length;a+=1)E(r[a]);ue(()=>{n||(n=lt(t,ft,{duration:120},!0)),n.run(1)}),o=!0}},o(c){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)T(r[a]);n||(n=lt(t,ft,{duration:120},!1)),n.run(0),o=!1},d(c){c&&w(t),Ut(r,c),c&&n&&n.end()}}}function Dn(e){let t=e[2].creator.name+"",n;return{c(){n=M(t)},m(o,i){C(o,n,i)},p(o,i){i&1&&t!==(t=o[2].creator.name+"")&&ne(n,t)},i:L,o:L,d(o){o&&w(n)}}}function Mn(e){let t,n,o;return t=new oe({props:{src:ct}}),{c(){X(t.$$.fragment),n=M(" mapKurator")},m(i,r){U(t,i,r),C(i,n,r),o=!0},p:L,i(i){o||(E(t.$$.fragment,i),o=!0)},o(i){T(t.$$.fragment,i),o=!1},d(i){W(t,i),i&&w(n)}}}function gt(e){let t,n=e[2].value+"",o,i,r,l=mt(e[2].created)+"",c,a,s,u,p,f;const d=[Mn,Dn],m=[];function _(g,h){var y;return((y=g[2].creator)==null?void 0:y.type)==="Software"?0:1}return s=_(e),u=m[s]=d[s](e),{c(){t=S("li"),o=M(n),i=H(),r=S("span"),c=M(l),a=M(" by "),u.c(),p=H(),A(r,"class","transcribed-by"),A(t,"class","svelte-f8q5bo")},m(g,h){C(g,t,h),k(t,o),k(t,i),k(t,r),k(r,c),k(r,a),m[s].m(r,null),k(t,p),f=!0},p(g,h){(!f||h&1)&&n!==(n=g[2].value+"")&&ne(o,n),(!f||h&1)&&l!==(l=mt(g[2].created)+"")&&ne(c,l);let y=s;s=_(g),s===y?m[s].p(g,h):(Y(),T(m[y],1,1,()=>{m[y]=null}),q(),u=m[s],u?u.p(g,h):(u=m[s]=d[s](g),u.c()),E(u,1),u.m(r,null))},i(g){f||(E(u),f=!0)},o(g){T(u),f=!1},d(g){g&&w(t),m[s].d()}}}function Pn(e){let t,n,o=e[1]&&_t(e);return{c(){o&&o.c(),t=le()},m(i,r){o&&o.m(i,r),C(i,t,r),n=!0},p(i,[r]){i[1]?o?(o.p(i,r),r&2&&E(o,1)):(o=_t(i),o.c(),E(o,1),o.m(t.parentNode,t)):o&&(Y(),T(o,1,1,()=>{o=null}),q())},i(i){n||(E(o),n=!0)},o(i){T(o),n=!1},d(i){o&&o.d(i),i&&w(t)}}}function Bn(e,t,n){let{transcriptions:o}=t,{open:i}=t;return e.$$set=r=>{"transcriptions"in r&&n(0,o=r.transcriptions),"open"in r&&n(1,i=r.open)},[o,i]}class Hn extends pe{constructor(t){super(),de(this,t,Bn,Pn,re,{transcriptions:0,open:1})}}const zn={a:{viewBox:"0 0 24 24",fill:"none"},c:'<path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path>'},eo="";function jn(e){let t,n,o,i,r,l,c,a,s,u,p,f,d,m,_,g;return i=new oe({props:{src:zn}}),{c(){t=S("div"),n=S("div"),o=S("button"),X(i.$$.fragment),r=H(),l=S("h1"),l.textContent="Confirm Delete",c=H(),a=S("p"),a.textContent="Are you sure you want to delete this transcription?",s=H(),u=S("div"),p=S("button"),p.textContent="Cancel",f=H(),d=S("button"),d.textContent="Delete",A(o,"class","close svelte-1bunj60"),A(l,"class","svelte-1bunj60"),A(a,"class","svelte-1bunj60"),A(p,"class","cancel svelte-1bunj60"),A(d,"class","delete svelte-1bunj60"),A(u,"class","buttons svelte-1bunj60"),A(n,"class","modal svelte-1bunj60"),A(t,"class","modal-wrapper svelte-1bunj60")},m(h,y){C(h,t,y),k(t,n),k(n,o),U(i,o,null),k(n,r),k(n,l),k(n,c),k(n,a),k(n,s),k(n,u),k(u,p),k(u,f),k(u,d),m=!0,_||(g=[R(o,"click",e[1]),R(p,"click",e[1]),R(d,"click",e[0])],_=!0)},p:L,i(h){m||(E(i.$$.fragment,h),m=!0)},o(h){T(i.$$.fragment,h),m=!1},d(h){h&&w(t),W(i),_=!1,I(g)}}}function Rn(e){const t=Le();return[()=>t("delete"),()=>t("cancel")]}class Vn extends pe{constructor(t){super(),de(this,t,Rn,jn,re,{})}}const Fn=e=>(e.body?Array.isArray(e.body)?e.body:[e.body]:[]).filter(o=>!o.purpose||o.purpose==="transcribing").slice().sort((o,i)=>o.created<i.created?1:-1),On=e=>{let t;const n=e.slice().sort((i,r)=>i.created<r.created?1:-1),o=n.filter(i=>{var r;return((r=i.creator)==null?void 0:r.type)==="Person"});if(o.length>0)t=o[0];else{const i=n.find(r=>{var l,c;return((l=r.creator)==null?void 0:l.type)==="Software"&&((c=r.creator)==null?void 0:c.name)==="mapKurator:ocr"});i?t=i:t=n.length>0?n[0]:null}return t},Zn=e=>{var t,n;return((t=e.creator)==null?void 0:t.type)==="Software"&&((n=e.creator)==null?void 0:n.name)=="mapKurator:ocr"},to="";function In(e){let t,n,o,i,r=e[2].length-1+"",l,c,a,s,u,p,f,d;o=new oe({props:{src:fn}});let m=!e[1]&&bt(e);return u=new Hn({props:{open:e[4],transcriptions:e[2]}}),{c(){t=S("p"),n=S("button"),X(o.$$.fragment),i=H(),l=M(r),c=M(" more transcriptions"),a=H(),m&&m.c(),s=H(),X(u.$$.fragment),A(n,"class","show-all svelte-7mctke"),ge(n,"open",e[4]),A(t,"class","transcription-details transcription-count svelte-7mctke")},m(_,g){C(_,t,g),k(t,n),U(o,n,null),k(n,i),k(n,l),k(n,c),k(t,a),m&&m.m(t,null),C(_,s,g),U(u,_,g),p=!0,f||(d=R(n,"click",e[17]),f=!0)},p(_,g){(!p||g&4)&&r!==(r=_[2].length-1+"")&&ne(l,r),g&16&&ge(n,"open",_[4]),_[1]?m&&(m.d(1),m=null):m?m.p(_,g):(m=bt(_),m.c(),m.m(t,null));const h={};g&16&&(h.open=_[4]),g&4&&(h.transcriptions=_[2]),u.$set(h)},i(_){p||(E(o.$$.fragment,_),E(u.$$.fragment,_),p=!0)},o(_){T(o.$$.fragment,_),T(u.$$.fragment,_),p=!1},d(_){_&&w(t),W(o),m&&m.d(),_&&w(s),W(u,_),f=!1,d()}}}function Un(e){let t,n,o,i,r,l,c;const a=[Kn,Wn],s=[];function u(f,d){var m;return d&64&&(o=null),o==null&&(o=!!Zn(f[6])),o?0:(m=f[6].creator)!=null&&m.name?1:-1}~(i=u(e,-1))&&(r=s[i]=a[i](e));let p=!e[1]&&vt(e);return{c(){t=S("p"),n=M("Transcribed by "),r&&r.c(),l=le(),p&&p.c(),A(t,"class","transcription-details transcribed-by svelte-7mctke")},m(f,d){C(f,t,d),k(t,n),~i&&s[i].m(t,null),k(t,l),p&&p.m(t,null),c=!0},p(f,d){let m=i;i=u(f,d),i===m?~i&&s[i].p(f,d):(r&&(Y(),T(s[m],1,1,()=>{s[m]=null}),q()),~i?(r=s[i],r?r.p(f,d):(r=s[i]=a[i](f),r.c()),E(r,1),r.m(t,l)):r=null),f[1]?p&&(p.d(1),p=null):p?p.p(f,d):(p=vt(f),p.c(),p.m(t,null))},i(f){c||(E(r),c=!0)},o(f){T(r),c=!1},d(f){f&&w(t),~i&&s[i].d(),p&&p.d()}}}function bt(e){let t,n,o,i,r,l,c;return{c(){t=M(`\xB7 [ 
            `),n=S("button"),n.textContent="Edit",o=M(` |
            `),i=S("button"),i.textContent="Confirm",r=M(`
          ]`),A(n,"class","action add-transcription svelte-7mctke"),A(i,"class","action confirm svelte-7mctke")},m(a,s){C(a,t,s),C(a,n,s),C(a,o,s),C(a,i,s),C(a,r,s),l||(c=[R(n,"click",e[11]),R(i,"click",e[12])],l=!0)},p:L,d(a){a&&w(t),a&&w(n),a&&w(o),a&&w(i),a&&w(r),l=!1,I(c)}}}function Wn(e){var i;let t=((i=e[6].creator)==null?void 0:i.name)+"",n,o;return{c(){n=M(t),o=H()},m(r,l){C(r,n,l),C(r,o,l)},p(r,l){var c;l&64&&t!==(t=((c=r[6].creator)==null?void 0:c.name)+"")&&ne(n,t)},i:L,o:L,d(r){r&&w(n),r&&w(o)}}}function Kn(e){let t,n,o;return t=new oe({props:{src:ct}}),{c(){X(t.$$.fragment),n=M(" mapKurator ")},m(i,r){U(t,i,r),C(i,n,r),o=!0},p:L,i(i){o||(E(t.$$.fragment,i),o=!0)},o(i){T(t.$$.fragment,i),o=!1},d(i){W(t,i),i&&w(n)}}}function vt(e){let t,n,o,i,r,l,c;return{c(){t=M(`\xB7 [ 
            `),n=S("button"),n.textContent="Edit",o=M(` | 
            `),i=S("button"),i.textContent="Confirm",r=M(`
          ]`),A(n,"class","action add-transcription svelte-7mctke"),A(i,"class","action confirm svelte-7mctke")},m(a,s){C(a,t,s),C(a,n,s),C(a,o,s),C(a,i,s),C(a,r,s),l||(c=[R(n,"click",e[11]),R(i,"click",e[12])],l=!0)},p:L,d(a){a&&w(t),a&&w(n),a&&w(o),a&&w(i),a&&w(r),l=!1,I(c)}}}function yt(e){let t,n,o,i,r,l,c,a,s,u,p,f;return i=new oe({props:{src:un}}),{c(){t=S("div"),n=S("div"),o=S("button"),X(i.$$.fragment),r=H(),l=S("div"),c=S("button"),c.textContent="Cancel",a=H(),s=S("button"),s.textContent="Save Edits",A(o,"class","delete svelte-7mctke"),A(n,"class","left"),A(c,"class","cancel svelte-7mctke"),A(s,"class","ok svelte-7mctke"),A(l,"class","right-slot"),A(t,"class","r8s-hover-buttons svelte-7mctke")},m(d,m){C(d,t,m),k(t,n),k(n,o),U(i,o,null),k(t,r),k(t,l),k(l,c),k(l,a),k(l,s),u=!0,p||(f=[R(o,"click",e[18]),R(c,"click",e[9]),R(s,"click",e[8])],p=!0)},p:L,i(d){u||(E(i.$$.fragment,d),u=!0)},o(d){T(i.$$.fragment,d),u=!1},d(d){d&&w(t),W(i),p=!1,I(f)}}}function kt(e){let t,n;return t=new Vn({}),t.$on("cancel",e[19]),t.$on("delete",e[10]),{c(){X(t.$$.fragment)},m(o,i){U(t,o,i),n=!0},p:L,i(o){n||(E(t.$$.fragment,o),n=!0)},o(o){T(t.$$.fragment,o),n=!1},d(o){W(t,o)}}}function Yn(e){let t,n,o,i,r,l,c,a,s,u,p,f,d;o=new wn({props:{isEditable:e[1]?!1:e[3],transcription:e[6]}}),o.$on("click",e[16]),o.$on("change",e[7]),o.$on("save",e[8]),o.$on("cancel",e[9]);const m=[Un,In],_=[];function g(b,N){return b[2].length===1?0:b[2].length>1?1:-1}~(r=g(e))&&(l=_[r]=m[r](e));let h=e[3]&&yt(e),y=e[5]&&kt(e);return{c(){t=S("div"),n=S("div"),X(o.$$.fragment),i=H(),l&&l.c(),c=H(),h&&h.c(),s=H(),y&&y.c(),u=le(),A(n,"class","r8s-hover-content svelte-7mctke"),A(t,"class","r8s-hover svelte-7mctke"),A(t,"style",a=`top: ${e[0].offsetY}px; left: ${e[0].offsetX}px`),ge(t,"editable",e[3])},m(b,N){C(b,t,N),k(t,n),U(o,n,null),k(n,i),~r&&_[r].m(n,null),k(t,c),h&&h.m(t,null),C(b,s,N),y&&y.m(b,N),C(b,u,N),p=!0,f||(d=Vt(sn.call(null,t)),f=!0)},p(b,[N]){const J={};N&10&&(J.isEditable=b[1]?!1:b[3]),N&64&&(J.transcription=b[6]),o.$set(J);let Q=r;r=g(b),r===Q?~r&&_[r].p(b,N):(l&&(Y(),T(_[Q],1,1,()=>{_[Q]=null}),q()),~r?(l=_[r],l?l.p(b,N):(l=_[r]=m[r](b),l.c()),E(l,1),l.m(n,null)):l=null),b[3]?h?(h.p(b,N),N&8&&E(h,1)):(h=yt(b),h.c(),E(h,1),h.m(t,null)):h&&(Y(),T(h,1,1,()=>{h=null}),q()),(!p||N&1&&a!==(a=`top: ${b[0].offsetY}px; left: ${b[0].offsetX}px`))&&A(t,"style",a),N&8&&ge(t,"editable",b[3]),b[5]?y?(y.p(b,N),N&32&&E(y,1)):(y=kt(b),y.c(),E(y,1),y.m(u.parentNode,u)):y&&(Y(),T(y,1,1,()=>{y=null}),q())},i(b){p||(E(o.$$.fragment,b),E(l),E(h),E(y),p=!0)},o(b){T(o.$$.fragment,b),T(l),T(h),T(y),p=!1},d(b){b&&w(t),W(o),~r&&_[r].d(),h&&h.d(),b&&w(s),y&&y.d(b),b&&w(u),f=!1,d()}}}function qn(e,t,n){let o,i;const r=Le();let{annotation:l}=t,{originalEvent:c}=t,{env:a}=t,{readOnly:s}=t,u=!1,p=!1,f=l,d=!1;const m=P=>{const Z=Array.isArray(f.body)?f.body:[f.body],F={type:"TextualBody",purpose:"transcribing",value:P.detail,creator:{type:"Person",name:a.currentUser.id},created:a.getCurrentTimeAdjusted()};n(13,l={...f,body:[...Z,F]})},_=()=>{r("save",l),n(15,f=l),n(3,u=!1)},g=()=>{r("cancel",l),n(13,l=f),n(3,u=!1)},h=()=>r("delete"),y=()=>{n(3,u=!0),r("edit")},b=()=>{const P=Array.isArray(f.body)?f.body:[f.body],Z={type:"TextualBody",purpose:"verifying",value:"verified",creator:{type:"Person",name:a.currentUser.id},created:a.getCurrentTimeAdjusted()},F={...f,body:[...P,Z]};n(15,f=F),n(3,u=!1),r("confirm",F)},N=()=>n(4,p=!p),J=()=>n(4,p=!p),Q=()=>n(5,d=!0),Fe=()=>n(5,d=!1);return e.$$set=P=>{"annotation"in P&&n(13,l=P.annotation),"originalEvent"in P&&n(0,c=P.originalEvent),"env"in P&&n(14,a=P.env),"readOnly"in P&&n(1,s=P.readOnly)},e.$$.update=()=>{e.$$.dirty&32768&&n(2,o=Fn(f)),e.$$.dirty&4&&n(6,i=On(o))},[c,s,o,u,p,d,i,m,_,g,h,y,b,l,a,f,N,J,Q,Fe]}class Xn extends pe{constructor(t){super(),de(this,t,qn,Yn,re,{annotation:13,originalEvent:0,env:14,readOnly:1})}}class Gn{constructor(t,n={}){this.showPopup=(o,i)=>{this.popup&&this.hidePopup(),this.popup=new Xn({target:document.body,props:{annotation:o,originalEvent:i,env:this.anno.env,readOnly:this.opts.readOnly}}),this.popup.$on("confirm",r=>{this.isEditing=!1,this.hidePopup(),this.anno.updateAnnotation(r.detail.id,r.detail)}),this.popup.$on("save",r=>{this.isEditing=!1,this.hidePopup();const l=this.anno.getAnnotationById(o.id),c={...r.detail,target:{...l.target}};this.anno.updateAnnotation(r.detail.id,c)}),this.popup.$on("cancel",()=>{this.isEditing=!1,this.hidePopup(),this.anno.deselectAll()}),this.popup.$on("edit",()=>{this.isEditing=!0,this.anno.selectAnnotation(o)}),this.popup.$on("delete",()=>{this.isEditing=!1,this.hidePopup(),this.anno.removeAnnotation(o)})},this.hidePopup=()=>{this.popup&&(this.popup.$destroy(),this.popup=null)},this.anno=t,this.opts=n,t.on("pointerdown",(o,i)=>{this.isEditing||(o?this.showPopup(o,i):this.hidePopup())}),document.addEventListener("keydown",o=>{o.key==="Escape"&&(this.isEditing=!1,this.hidePopup(),this.anno.deselectAll())})}}const no="";return Gn});
//# sourceMappingURL=luna-annotorious.js.map
