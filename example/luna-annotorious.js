(function(x,ge){typeof exports=="object"&&typeof module<"u"?module.exports=ge():typeof define=="function"&&define.amd?define(ge):(x=typeof globalThis<"u"?globalThis:x||self,x.LunaAnnotorious=ge())})(this,function(){"use strict";function x(){}const ge=r=>r;function ec(r,t){for(const e in t)r[e]=t[e];return r}function Zi(r){return r()}function Qi(){return Object.create(null)}function It(r){r.forEach(Zi)}function Zr(r){return typeof r=="function"}function Ye(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function rc(r){return Object.keys(r).length===0}function nc(r){return r&&Zr(r.destroy)?r.destroy:x}const to=typeof window<"u";let ic=to?()=>window.performance.now():()=>Date.now(),Qr=to?r=>requestAnimationFrame(r):x;const Ht=new Set;function eo(r){Ht.forEach(t=>{t.c(r)||(Ht.delete(t),t.f())}),Ht.size!==0&&Qr(eo)}function oc(r){let t;return Ht.size===0&&Qr(eo),{promise:new Promise(e=>{Ht.add(t={c:r,f:e})}),abort(){Ht.delete(t)}}}function C(r,t){r.appendChild(t)}function ro(r){if(!r)return document;const t=r.getRootNode?r.getRootNode():r.ownerDocument;return t&&t.host?t:r.ownerDocument}function sc(r){const t=W("style");return lc(ro(r),t),t.sheet}function lc(r,t){C(r.head||r,t)}function L(r,t,e){r.insertBefore(t,e||null)}function P(r){r.parentNode.removeChild(r)}function ac(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function W(r){return document.createElement(r)}function cc(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function U(r){return document.createTextNode(r)}function Tt(){return U(" ")}function no(){return U("")}function ye(r,t,e,n){return r.addEventListener(t,e,n),()=>r.removeEventListener(t,e,n)}function D(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function io(r,t){for(const e in t)D(r,e,t[e])}function uc(r){return Array.from(r.childNodes)}function Yt(r,t){t=""+t,r.wholeText!==t&&(r.data=t)}function oo(r,t,e){r.classList[e?"add":"remove"](t)}function so(r,t,{bubbles:e=!1,cancelable:n=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(r,e,n,t),i}const Ge=new Map;let Ve=0;function fc(r){let t=5381,e=r.length;for(;e--;)t=(t<<5)-t^r.charCodeAt(e);return t>>>0}function hc(r,t){const e={stylesheet:sc(t),rules:{}};return Ge.set(r,e),e}function lo(r,t,e,n,i,o,s,l=0){const a=16.666/n;let c=`{
`;for(let g=0;g<=1;g+=a){const m=t+(e-t)*o(g);c+=g*100+`%{${s(m,1-m)}}
`}const u=c+`100% {${s(e,1-e)}}
}`,f=`__svelte_${fc(u)}_${l}`,p=ro(r),{stylesheet:h,rules:d}=Ge.get(p)||hc(p,r);d[f]||(d[f]=!0,h.insertRule(`@keyframes ${f} ${u}`,h.cssRules.length));const y=r.style.animation||"";return r.style.animation=`${y?`${y}, `:""}${f} ${n}ms linear ${i}ms 1 both`,Ve+=1,f}function pc(r,t){const e=(r.style.animation||"").split(", "),n=e.filter(t?o=>o.indexOf(t)<0:o=>o.indexOf("__svelte")===-1),i=e.length-n.length;i&&(r.style.animation=n.join(", "),Ve-=i,Ve||dc())}function dc(){Qr(()=>{Ve||(Ge.forEach(r=>{const{stylesheet:t}=r;let e=t.cssRules.length;for(;e--;)t.deleteRule(e);r.rules={}}),Ge.clear())})}let me;function ve(r){me=r}function gc(){if(!me)throw new Error("Function called outside component initialization");return me}function ao(){const r=gc();return(t,e,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[t];if(i){const o=so(t,e,{cancelable:n});return i.slice().forEach(s=>{s.call(r,o)}),!o.defaultPrevented}return!0}}const be=[],tn=[],Xe=[],co=[],uo=Promise.resolve();let en=!1;function fo(){en||(en=!0,uo.then(ho))}function yc(){return fo(),uo}function we(r){Xe.push(r)}const rn=new Set;let ze=0;function ho(){const r=me;do{for(;ze<be.length;){const t=be[ze];ze++,ve(t),mc(t.$$)}for(ve(null),be.length=0,ze=0;tn.length;)tn.pop()();for(let t=0;t<Xe.length;t+=1){const e=Xe[t];rn.has(e)||(rn.add(e),e())}Xe.length=0}while(be.length);for(;co.length;)co.pop()();en=!1,rn.clear(),ve(r)}function mc(r){if(r.fragment!==null){r.update(),It(r.before_update);const t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(we)}}let Se;function vc(){return Se||(Se=Promise.resolve(),Se.then(()=>{Se=null})),Se}function nn(r,t,e){r.dispatchEvent(so(`${t?"intro":"outro"}${e}`))}const qe=new Set;let ut;function Mt(){ut={r:0,c:[],p:ut}}function Dt(){ut.r||It(ut.c),ut=ut.p}function $(r,t){r&&r.i&&(qe.delete(r),r.i(t))}function B(r,t,e,n){if(r&&r.o){if(qe.has(r))return;qe.add(r),ut.c.push(()=>{qe.delete(r),n&&(e&&r.d(1),n())}),r.o(t)}else n&&n()}const bc={duration:0};function po(r,t,e,n){let i=t(r,e),o=n?0:1,s=null,l=null,a=null;function c(){a&&pc(r,a)}function u(p,h){const d=p.b-o;return h*=Math.abs(d),{a:o,b:p.b,d,duration:h,start:p.start,end:p.start+h,group:p.group}}function f(p){const{delay:h=0,duration:d=300,easing:y=ge,tick:g=x,css:m}=i||bc,v={start:ic()+h,b:p};p||(v.group=ut,ut.r+=1),s||l?l=v:(m&&(c(),a=lo(r,o,p,d,h,y,m)),p&&g(0,1),s=u(v,d),we(()=>nn(r,p,"start")),oc(w=>{if(l&&w>l.start&&(s=u(l,d),l=null,nn(r,s.b,"start"),m&&(c(),a=lo(r,o,s.b,s.duration,0,y,i.css))),s){if(w>=s.end)g(o=s.b,1-o),nn(r,s.b,"end"),l||(s.b?c():--s.group.r||It(s.group.c)),s=null;else if(w>=s.start){const _=w-s.start;o=s.a+s.d*y(_/s.duration),g(o,1-o)}}return!!(s||l)}))}return{run(p){Zr(i)?vc().then(()=>{i=i(),f(p)}):f(p)},end(){c(),s=l=null}}}function wc(r,t){const e={},n={},i={$$scope:1};let o=r.length;for(;o--;){const s=r[o],l=t[o];if(l){for(const a in s)a in l||(n[a]=1);for(const a in l)i[a]||(e[a]=l[a],i[a]=1);r[o]=l}else for(const a in s)i[a]=1}for(const s in n)s in e||(e[s]=void 0);return e}function _e(r){r&&r.c()}function Gt(r,t,e,n){const{fragment:i,on_mount:o,on_destroy:s,after_update:l}=r.$$;i&&i.m(t,e),n||we(()=>{const a=o.map(Zi).filter(Zr);s?s.push(...a):It(a),r.$$.on_mount=[]}),l.forEach(we)}function Vt(r,t){const e=r.$$;e.fragment!==null&&(It(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Sc(r,t){r.$$.dirty[0]===-1&&(be.push(r),fo(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function on(r,t,e,n,i,o,s,l=[-1]){const a=me;ve(r);const c=r.$$={fragment:null,ctx:null,props:o,update:x,not_equal:i,bound:Qi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Qi(),dirty:l,skip_bound:!1,root:t.target||a.$$.root};s&&s(c.root);let u=!1;if(c.ctx=e?e(r,t.props||{},(f,p,...h)=>{const d=h.length?h[0]:p;return c.ctx&&i(c.ctx[f],c.ctx[f]=d)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](d),u&&Sc(r,f)),p}):[],c.update(),u=!0,It(c.before_update),c.fragment=n?n(c.ctx):!1,t.target){if(t.hydrate){const f=uc(t.target);c.fragment&&c.fragment.l(f),f.forEach(P)}else c.fragment&&c.fragment.c();t.intro&&$(r.$$.fragment),Gt(r,t.target,t.anchor,t.customElement),ho()}ve(a)}class sn{$destroy(){Vt(this,1),this.$destroy=x}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const i=n.indexOf(e);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!rc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var ln={dragStart:!0},go=(r,t,e)=>Math.min(Math.max(r,t),e),an=r=>typeof r=="string",_c=([r,t],e,n)=>{const i=(o,s)=>s===0?0:Math.ceil(o/s)*s;return[i(e,r),i(n,t)]},yo=(r,t)=>r.some(e=>t.some(n=>e.contains(n)));function cn(r,t){if(r===void 0)return;if(un(r))return r.getBoundingClientRect();if(typeof r=="object"){const{top:n=0,left:i=0,right:o=0,bottom:s=0}=r;return{top:n,right:window.innerWidth-o,bottom:window.innerHeight-s,left:i}}if(r==="parent")return t.parentNode.getBoundingClientRect();const e=document.querySelector(r);if(e===null)throw new Error("The selector provided for bound doesn't exists in the document.");return e.getBoundingClientRect()}var Je=(r,t,e)=>r.style.setProperty(t,e),un=r=>r instanceof HTMLElement,Ec=(r,t={})=>{var Va,Xa;let e,n,{bounds:i,axis:o="both",gpuAcceleration:s=!0,legacyTranslate:l=!0,transform:a,applyUserSelectHack:c=!0,disabled:u=!1,ignoreMultitouch:f=!1,recomputeBounds:p=ln,grid:h,position:d,cancel:y,handle:g,defaultClass:m="neodrag",defaultClassDragging:v="neodrag-dragging",defaultClassDragged:w="neodrag-dragged",defaultPosition:_={x:0,y:0},onDragStart:T,onDrag:q,onDragEnd:lt}=t,J=!1,tt=0,at=0,jt=0,mt=0,ct=0,xt=0,{x:de,y:Ft}=d?{x:(Va=d==null?void 0:d.x)!=null?Va:0,y:(Xa=d==null?void 0:d.y)!=null?Xa:0}:_;qi(de,Ft);let vt,Wt,He,Xi,ja,Fa="",Kg=!!d;p={...ln,...p};const zi=document.body.style,$t=r.classList;function qi(b=tt,M=at){if(!a){if(l){let K=`${+b}px, ${+M}px`;return Je(r,"transform",s?`translate3d(${K}, 0)`:`translate(${K})`)}return Je(r,"translate",`${+b}px ${+M}px ${s?"1px":""}`)}const F=a({offsetX:b,offsetY:M,rootNode:r});an(F)&&Je(r,"transform",F)}const Ji=(b,M)=>{const F={offsetX:tt,offsetY:at,rootNode:r,currentNode:ja};r.dispatchEvent(new CustomEvent(b,{detail:F})),M==null||M(F)},Ki=addEventListener;Ki("pointerdown",Ha,!1),Ki("pointerup",Ya,!1),Ki("pointermove",Ga,!1),Je(r,"touch-action","none");const Wa=()=>{let b=r.offsetWidth/Wt.width;return isNaN(b)&&(b=1),b};function Ha(b){if(u||b.button===2||f&&!b.isPrimary)return;if(p.dragStart&&(vt=cn(i,r)),an(g)&&an(y)&&g===y)throw new Error("`handle` selector can't be same as `cancel` selector");if($t.add(m),He=function(O,X){if(!O)return[X];if(un(O))return[O];if(Array.isArray(O))return O;const Z=X.querySelectorAll(O);if(Z===null)throw new Error("Selector passed for `handle` option should be child of the element on which the action is applied");return Array.from(Z.values())}(g,r),Xi=function(O,X){if(!O)return[];if(un(O))return[O];if(Array.isArray(O))return O;const Z=X.querySelectorAll(O);if(Z===null)throw new Error("Selector passed for `cancel` option should be child of the element on which the action is applied");return Array.from(Z.values())}(y,r),e=/(both|x)/.test(o),n=/(both|y)/.test(o),yo(Xi,He))throw new Error("Element being dragged can't be a child of the element on which `cancel` is applied");const M=b.composedPath()[0];if(!He.some(O=>{var X;return O.contains(M)||((X=O.shadowRoot)==null?void 0:X.contains(M))})||yo(Xi,[M]))return;ja=He.length===1?r:He.find(O=>O.contains(M)),J=!0,Wt=r.getBoundingClientRect(),c&&(Fa=zi.userSelect,zi.userSelect="none"),Ji("neodrag:start",T);const{clientX:F,clientY:K}=b,V=Wa();e&&(jt=F-de/V),n&&(mt=K-Ft/V),vt&&(ct=F-Wt.left,xt=K-Wt.top)}function Ya(){J&&(p.dragEnd&&(vt=cn(i,r)),$t.remove(v),$t.add(w),c&&(zi.userSelect=Fa),Ji("neodrag:end",lt),e&&(jt=tt),n&&(mt=at),J=!1)}function Ga(b){if(!J)return;p.drag&&(vt=cn(i,r)),$t.add(v),b.preventDefault(),Wt=r.getBoundingClientRect();let M=b.clientX,F=b.clientY;const K=Wa();if(vt){const V={left:vt.left+ct,top:vt.top+xt,right:vt.right+ct-Wt.width,bottom:vt.bottom+xt-Wt.height};M=go(M,V.left,V.right),F=go(F,V.top,V.bottom)}if(Array.isArray(h)){let[V,O]=h;if(isNaN(+V)||V<0)throw new Error("1st argument of `grid` must be a valid positive number");if(isNaN(+O)||O<0)throw new Error("2nd argument of `grid` must be a valid positive number");let X=M-jt,Z=F-mt;[X,Z]=_c([V/K,O/K],X,Z),M=jt+X,F=mt+Z}e&&(tt=Math.round((M-jt)*K)),n&&(at=Math.round((F-mt)*K)),de=tt,Ft=at,Ji("neodrag",q),qi()}return{destroy:()=>{const b=removeEventListener;b("pointerdown",Ha,!1),b("pointerup",Ya,!1),b("pointermove",Ga,!1)},update:b=>{var F,K,V,O,X,Z,za,qa,Ja,Ka,Za,Qa,tc;o=b.axis||"both",u=(F=b.disabled)!=null?F:!1,f=(K=b.ignoreMultitouch)!=null?K:!1,g=b.handle,i=b.bounds,p=(V=b.recomputeBounds)!=null?V:ln,y=b.cancel,c=(O=b.applyUserSelectHack)!=null?O:!0,h=b.grid,s=(X=b.gpuAcceleration)!=null?X:!0,l=(Z=b.legacyTranslate)!=null?Z:!0,a=b.transform;const M=$t.contains(w);$t.remove(m,w),m=(za=b.defaultClass)!=null?za:"neodrag",v=(qa=b.defaultClassDragging)!=null?qa:"neodrag-dragging",w=(Ja=b.defaultClassDragged)!=null?Ja:"neodrag-dragged",$t.add(m),M&&$t.add(w),Kg&&(de=tt=(Za=(Ka=b.position)==null?void 0:Ka.x)!=null?Za:tt,Ft=at=(tc=(Qa=b.position)==null?void 0:Qa.y)!=null?tc:at,qi())}}};function kc(r){const t=r-1;return t*t*t+1}function mo(r,{delay:t=0,duration:e=400,easing:n=kc}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),l=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),f=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:t,duration:e,easing:n,css:h=>`overflow: hidden;opacity: ${Math.min(h*20,1)*o};height: ${h*s}px;padding-top: ${h*l}px;padding-bottom: ${h*a}px;margin-top: ${h*c}px;margin-bottom: ${h*u}px;border-top-width: ${h*f}px;border-bottom-width: ${h*p}px;`}}function Ac(r){let t,e=[{width:r[1]},{height:r[1]},{"stroke-width":"0"},{class:r[2]},r[0].a,r[4],{xmlns:"http://www.w3.org/2000/svg"}],n={};for(let i=0;i<e.length;i+=1)n=ec(n,e[i]);return{c(){t=cc("svg"),io(t,n)},m(i,o){L(i,t,o),t.innerHTML=r[3]},p(i,[o]){o&8&&(t.innerHTML=i[3]),io(t,n=wc(e,[o&2&&{width:i[1]},o&2&&{height:i[1]},{"stroke-width":"0"},o&4&&{class:i[2]},o&1&&i[0].a,o&16&&i[4],{xmlns:"http://www.w3.org/2000/svg"}]))},i:x,o:x,d(i){i&&P(t)}}}function Oc(r,t,e){let{src:n}=t,{size:i="1em"}=t,{color:o=void 0}=t,{title:s=void 0}=t,{className:l=""}=t,a,c;return r.$$set=u=>{"src"in u&&e(0,n=u.src),"size"in u&&e(1,i=u.size),"color"in u&&e(5,o=u.color),"title"in u&&e(6,s=u.title),"className"in u&&e(2,l=u.className)},r.$$.update=()=>{r.$$.dirty&33&&(e(4,c={}),o&&(n.a.stroke!=="none"&&e(4,c.stroke=o,c),n.a.fill!=="none"&&e(4,c.fill=o,c))),r.$$.dirty&65&&e(3,a=(s?`<title>${s}</title>`:"")+n.c)},[n,i,l,a,c,o,s]}class Ke extends sn{constructor(t){super(),on(this,t,Oc,Ac,Ye,{src:0,size:1,color:5,title:6,className:2})}}const Cc={a:{fill:"currentColor",viewBox:"0 0 16 16"},c:'<path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"></path>'},xc={a:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},c:'<polyline points="6 9 12 15 18 9"></polyline>'},vo={a:{viewBox:"0 0 640 512"},c:'<path d="M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"></path>'};var $c=["second","minute","hour","day","week","month","year"];function Ic(r,t){if(t===0)return["just now","right now"];var e=$c[Math.floor(t/2)];return r>1&&(e+="s"),[r+" "+e+" ago","in "+r+" "+e]}var Tc=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function Mc(r,t){if(t===0)return["\u521A\u521A","\u7247\u523B\u540E"];var e=Tc[~~(t/2)];return[r+" "+e+"\u524D",r+" "+e+"\u540E"]}var fn={},bo=function(r,t){fn[r]=t},Dc=function(r){return fn[r]||fn.en_US},hn=[60,60,24,7,365/7/12,12];function wo(r){return r instanceof Date?r:!isNaN(r)||/^\d+$/.test(r)?new Date(parseInt(r)):(r=(r||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(r))}function Bc(r,t){var e=r<0?1:0;r=Math.abs(r);for(var n=r,i=0;r>=hn[i]&&i<hn.length;i++)r/=hn[i];return r=Math.floor(r),i*=2,r>(i===0?9:1)&&(i+=1),t(r,i,n)[e].replace("%s",r.toString())}function Pc(r,t){var e=t?wo(t):new Date;return(+e-+wo(r))/1e3}var So=function(r,t,e){var n=Pc(r,e&&e.relativeDate);return Bc(n,Dc(t))};bo("en_US",Ic),bo("zh_CN",Mc);var pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nc(r){var t=r.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),e}var dn="__autosizeInputGhost",Rc={" ":"nbsp","<":"lt",">":"gt"};function Lc(r){return"&"+Rc[r]+";"}function Uc(r){return r.replace(/\s|<|>/g,Lc)}function jc(){var r=document.createElement("div");return r.id=dn,r.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(r),r}var Fc=function(r,t){var e=window.getComputedStyle(r),n="box-sizing:"+e.boxSizing+";border-left:"+e.borderLeftWidth+" solid red;border-right:"+e.borderRightWidth+" solid red;font-family:"+e.fontFamily+";font-feature-settings:"+e.fontFeatureSettings+";font-kerning:"+e.fontKerning+";font-size:"+e.fontSize+";font-stretch:"+e.fontStretch+";font-style:"+e.fontStyle+";font-variant:"+e.fontVariant+";font-variant-caps:"+e.fontVariantCaps+";font-variant-ligatures:"+e.fontVariantLigatures+";font-variant-numeric:"+e.fontVariantNumeric+";font-weight:"+e.fontWeight+";letter-spacing:"+e.letterSpacing+";margin-left:"+e.marginLeft+";margin-right:"+e.marginRight+";padding-left:"+e.paddingLeft+";padding-right:"+e.paddingRight+";text-indent:"+e.textIndent+";text-transform:"+e.textTransform;function i(){var s=r.value||r.getAttribute("placeholder")||"",l=document.getElementById(dn)||jc();l.style.cssText+=n,l.innerHTML=Uc(s);var a=window.getComputedStyle(l).width;return r.style.width=a,a}r.addEventListener("input",i);var o=i();return t&&t.minWidth&&o!=="0px"&&(r.style.minWidth=o),function(){r.removeEventListener("input",i);var s=document.getElementById(dn);s&&s.parentNode.removeChild(s)}};const Zg="";function _o(r,t,e){const n=r.slice();return n[14]=t[e],n}function Wc(r){var u,f,p;let t,e=((u=r[4])==null?void 0:u.value)+"",n,i,o,s,l,a,c=((p=(f=r[4])==null?void 0:f.creator)==null?void 0:p.type)==="Person"&&Eo();return{c(){t=W("span"),n=U(e),i=Tt(),c&&c.c(),o=no(),D(t,"class","transcription svelte-1usy2uv")},m(h,d){L(h,t,d),C(t,n),L(h,i,d),c&&c.m(h,d),L(h,o,d),s=!0,l||(a=ye(t,"click",r[9]),l=!0)},p(h,d){var y,g,m;(!s||d&16)&&e!==(e=((y=h[4])==null?void 0:y.value)+"")&&Yt(n,e),((m=(g=h[4])==null?void 0:g.creator)==null?void 0:m.type)==="Person"?c?(c.p(h,d),d&16&&$(c,1)):(c=Eo(),c.c(),$(c,1),c.m(o.parentNode,o)):c&&(Mt(),B(c,1,1,()=>{c=null}),Dt())},i(h){s||($(c),s=!0)},o(h){B(c),s=!1},d(h){h&&P(t),h&&P(i),c&&c.d(h),h&&P(o),l=!1,a()}}}function Hc(r){let t,e,n,i;return{c(){var o;t=W("input"),t.value=e=(o=r[4])==null?void 0:o.value,D(t,"spellcheck",!1),D(t,"class","svelte-1usy2uv")},m(o,s){L(o,t,s),r[8](t),n||(i=ye(t,"keydown",r[7]),n=!0)},p(o,s){var l;s&16&&e!==(e=(l=o[4])==null?void 0:l.value)&&t.value!==e&&(t.value=e)},i:x,o:x,d(o){o&&P(t),r[8](null),n=!1,i()}}}function Eo(r){let t,e;return t=new Ke({props:{className:"verified-transcription",src:Cc}}),{c(){_e(t.$$.fragment)},m(n,i){Gt(t,n,i),e=!0},p:x,i(n){e||($(t.$$.fragment,n),e=!0)},o(n){B(t.$$.fragment,n),e=!1},d(n){Vt(t,n)}}}function Yc(r){let t,e,n,i,o,s,l,a,c,u;const f=[Xc,Vc],p=[];function h(d,y){var g,m;return d[5]?0:(m=(g=d[4])==null?void 0:g.creator)!=null&&m.name?1:-1}return~(n=h(r))&&(i=p[n]=f[n](r)),{c(){t=W("p"),e=U("Transcribed by "),i&&i.c(),o=U("  \xB7 [ "),s=W("button"),s.textContent="Edit",l=U(" ]"),D(s,"class","add-transcription svelte-1usy2uv"),D(t,"class","transcription-details transcribed-by svelte-1usy2uv")},m(d,y){L(d,t,y),C(t,e),~n&&p[n].m(t,null),C(t,o),C(t,s),C(t,l),a=!0,c||(u=ye(s,"click",r[12]),c=!0)},p(d,y){let g=n;n=h(d),n===g?~n&&p[n].p(d,y):(i&&(Mt(),B(p[g],1,1,()=>{p[g]=null}),Dt()),~n?(i=p[n],i?i.p(d,y):(i=p[n]=f[n](d),i.c()),$(i,1),i.m(t,o)):i=null)},i(d){a||($(i),a=!0)},o(d){B(i),a=!1},d(d){d&&P(t),~n&&p[n].d(),c=!1,u()}}}function Gc(r){let t,e,n,i,o=r[0].length-1+"",s,l,a,c,u,f,p,h,d,y;n=new Ke({props:{src:xc}});let g=r[6]&&ko(r);return{c(){t=W("p"),e=W("button"),_e(n.$$.fragment),i=Tt(),s=U(o),l=U(" more transcriptions"),a=U(" \xB7 [ "),c=W("button"),c.textContent="Edit",u=U(" ]"),f=Tt(),g&&g.c(),p=no(),D(e,"class","show-all svelte-1usy2uv"),oo(e,"open",r[6]),D(c,"class","add-transcription svelte-1usy2uv"),D(t,"class","transcription-details transcription-count svelte-1usy2uv")},m(m,v){L(m,t,v),C(t,e),Gt(n,e,null),C(e,i),C(e,s),C(e,l),C(t,a),C(t,c),C(t,u),L(m,f,v),g&&g.m(m,v),L(m,p,v),h=!0,d||(y=[ye(e,"click",r[10]),ye(c,"click",r[11])],d=!0)},p(m,v){(!h||v&1)&&o!==(o=m[0].length-1+"")&&Yt(s,o),v&64&&oo(e,"open",m[6]),m[6]?g?(g.p(m,v),v&64&&$(g,1)):(g=ko(m),g.c(),$(g,1),g.m(p.parentNode,p)):g&&(Mt(),B(g,1,1,()=>{g=null}),Dt())},i(m){h||($(n.$$.fragment,m),$(g),h=!0)},o(m){B(n.$$.fragment,m),B(g),h=!1},d(m){m&&P(t),Vt(n),m&&P(f),g&&g.d(m),m&&P(p),d=!1,It(y)}}}function Vc(r){var n,i;let t=((i=(n=r[4])==null?void 0:n.creator)==null?void 0:i.name)+"",e;return{c(){e=U(t)},m(o,s){L(o,e,s)},p(o,s){var l,a;s&16&&t!==(t=((a=(l=o[4])==null?void 0:l.creator)==null?void 0:a.name)+"")&&Yt(e,t)},i:x,o:x,d(o){o&&P(e)}}}function Xc(r){let t,e,n;return t=new Ke({props:{src:vo}}),{c(){_e(t.$$.fragment),e=U(" mapKurator")},m(i,o){Gt(t,i,o),L(i,e,o),n=!0},p:x,i(i){n||($(t.$$.fragment,i),n=!0)},o(i){B(t.$$.fragment,i),n=!1},d(i){Vt(t,i),i&&P(e)}}}function ko(r){let t,e,n,i=r[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=Ao(_o(r,i,l));const s=l=>B(o[l],1,1,()=>{o[l]=null});return{c(){t=W("ul");for(let l=0;l<o.length;l+=1)o[l].c();D(t,"class","all-transcriptions svelte-1usy2uv")},m(l,a){L(l,t,a);for(let c=0;c<o.length;c+=1)o[c].m(t,null);n=!0},p(l,a){if(a&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const u=_o(l,i,c);o[c]?(o[c].p(u,a),$(o[c],1)):(o[c]=Ao(u),o[c].c(),$(o[c],1),o[c].m(t,null))}for(Mt(),c=i.length;c<o.length;c+=1)s(c);Dt()}},i(l){if(!n){for(let a=0;a<i.length;a+=1)$(o[a]);we(()=>{e||(e=po(t,mo,{duration:120},!0)),e.run(1)}),n=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)B(o[a]);e||(e=po(t,mo,{duration:120},!1)),e.run(0),n=!1},d(l){l&&P(t),ac(o,l),l&&e&&e.end()}}}function zc(r){let t=r[14].creator.name+"",e;return{c(){e=U(t)},m(n,i){L(n,e,i)},p(n,i){i&2&&t!==(t=n[14].creator.name+"")&&Yt(e,t)},i:x,o:x,d(n){n&&P(e)}}}function qc(r){let t,e,n;return t=new Ke({props:{src:vo}}),{c(){_e(t.$$.fragment),e=U(" mapKurator")},m(i,o){Gt(t,i,o),L(i,e,o),n=!0},p:x,i(i){n||($(t.$$.fragment,i),n=!0)},o(i){B(t.$$.fragment,i),n=!1},d(i){Vt(t,i),i&&P(e)}}}function Ao(r){let t,e=r[14].value+"",n,i,o,s=So(r[14].created)+"",l,a,c,u,f,p;const h=[qc,zc],d=[];function y(g,m){var v;return((v=g[14].creator)==null?void 0:v.type)==="Software"?0:1}return c=y(r),u=d[c]=h[c](r),{c(){t=W("li"),n=U(e),i=Tt(),o=W("span"),l=U(s),a=U(" by "),u.c(),f=Tt(),D(o,"class","transcribed-by svelte-1usy2uv"),D(t,"class","svelte-1usy2uv")},m(g,m){L(g,t,m),C(t,n),C(t,i),C(t,o),C(o,l),C(o,a),d[c].m(o,null),C(t,f),p=!0},p(g,m){(!p||m&2)&&e!==(e=g[14].value+"")&&Yt(n,e),(!p||m&2)&&s!==(s=So(g[14].created)+"")&&Yt(l,s);let v=c;c=y(g),c===v?d[c].p(g,m):(Mt(),B(d[v],1,1,()=>{d[v]=null}),Dt(),u=d[c],u?u.p(g,m):(u=d[c]=h[c](g),u.c()),$(u,1),u.m(o,null))},i(g){p||($(u),p=!0)},o(g){B(u),p=!1},d(g){g&&P(t),d[c].d()}}}function Jc(r){let t,e,n,i,o,s,l;const a=[Hc,Wc],c=[];function u(d,y){return d[3]?0:1}e=u(r),n=c[e]=a[e](r);const f=[Gc,Yc],p=[];function h(d,y){return d[0].length>1?0:1}return o=h(r),s=p[o]=f[o](r),{c(){t=W("div"),n.c(),i=Tt(),s.c(),D(t,"class","transcription-container")},m(d,y){L(d,t,y),c[e].m(t,null),C(t,i),p[o].m(t,null),l=!0},p(d,[y]){let g=e;e=u(d),e===g?c[e].p(d,y):(Mt(),B(c[g],1,1,()=>{c[g]=null}),Dt(),n=c[e],n?n.p(d,y):(n=c[e]=a[e](d),n.c()),$(n,1),n.m(t,i));let m=o;o=h(d),o===m?p[o].p(d,y):(Mt(),B(p[m],1,1,()=>{p[m]=null}),Dt(),s=p[o],s?s.p(d,y):(s=p[o]=f[o](d),s.c()),$(s,1),s.m(t,null))},i(d){l||($(n),$(s),l=!0)},o(d){B(n),B(s),l=!1},d(d){d&&P(t),c[e].d(),p[o].d()}}}function Kc(r,t,e){const n=ao();let{data:i}=t,o,s,l=!1,a,c,u=!1;const f=m=>{if(m.key==="Enter"){const{value:v}=s;v!==(a==null?void 0:a.value)&&n("addTranscription",s.value),e(3,l=!1)}else m.key==="Escape"&&e(3,l=!1)};function p(m){tn[m?"unshift":"push"](()=>{s=m,e(2,s)})}const h=()=>e(6,u=!u),d=()=>e(6,u=!u),y=()=>e(3,l=!0),g=()=>e(3,l=!0);return r.$$set=m=>{"data"in m&&e(0,i=m.data)},r.$$.update=()=>{if(r.$$.dirty&3){e(1,o=i.slice().sort((v,w)=>v.created<w.created?1:-1));const m=o.filter(v=>{var w;return((w=v.creator)==null?void 0:w.type)==="Person"});if(m.length>0)e(4,a=m[0]);else{const v=o.find(w=>{var _,T;return((_=w.creator)==null?void 0:_.type)==="Software"&&((T=w.creator)==null?void 0:T.name)==="mapKurator:ocr"});v?(e(4,a=v),e(5,c=!0)):e(4,a=o.length>0?o[0]:null)}}r.$$.dirty&12&&l&&yc().then(()=>{Fc(s),s.focus()})},[i,o,s,l,a,c,u,f,p,h,d,y,g]}class Zc extends sn{constructor(t){super(),on(this,t,Kc,Jc,Ye,{data:0})}}var Ze=(r=>(r.POLYGON="POLYGON",r.RECTANGLE="RECTANGLE",r))(Ze||{}),Oo=Object.prototype.toString,Co=function(t){var e=Oo.call(t),n=e==="[object Arguments]";return n||(n=e!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Oo.call(t.callee)==="[object Function]"),n},gn,xo;function Qc(){if(xo)return gn;xo=1;var r;if(!Object.keys){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Co,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),s=i.call(function(){},"prototype"),l=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=function(p){var h=p.constructor;return h&&h.prototype===p},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},u=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!c["$"+p]&&t.call(window,p)&&window[p]!==null&&typeof window[p]=="object")try{a(window[p])}catch{return!0}}catch{return!0}return!1}(),f=function(p){if(typeof window>"u"||!u)return a(p);try{return a(p)}catch{return!1}};r=function(h){var d=h!==null&&typeof h=="object",y=e.call(h)==="[object Function]",g=n(h),m=d&&e.call(h)==="[object String]",v=[];if(!d&&!y&&!g)throw new TypeError("Object.keys called on a non-object");var w=s&&y;if(m&&h.length>0&&!t.call(h,0))for(var _=0;_<h.length;++_)v.push(String(_));if(g&&h.length>0)for(var T=0;T<h.length;++T)v.push(String(T));else for(var q in h)!(w&&q==="prototype")&&t.call(h,q)&&v.push(String(q));if(o)for(var lt=f(h),J=0;J<l.length;++J)!(lt&&l[J]==="constructor")&&t.call(h,l[J])&&v.push(l[J]);return v}}return gn=r,gn}var tu=Array.prototype.slice,eu=Co,$o=Object.keys,Qe=$o?function(t){return $o(t)}:Qc(),Io=Object.keys;Qe.shim=function(){if(Object.keys){var t=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);t||(Object.keys=function(n){return eu(n)?Io(tu.call(n)):Io(n)})}else Object.keys=Qe;return Object.keys||Qe};var yn=Qe,tr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),n=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[e]=i;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(t,e);if(s.value!==i||s.enumerable!==!0)return!1}return!0},ru=tr,bt=function(){return ru()&&!!Symbol.toStringTag},To=typeof Symbol<"u"&&Symbol,nu=tr,mn=function(){return typeof To!="function"||typeof Symbol!="function"||typeof To("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:nu()},iu="Function.prototype.bind called on incompatible ",vn=Array.prototype.slice,ou=Object.prototype.toString,su="[object Function]",lu=function(t){var e=this;if(typeof e!="function"||ou.call(e)!==su)throw new TypeError(iu+e);for(var n=vn.call(arguments,1),i,o=function(){if(this instanceof i){var u=e.apply(this,n.concat(vn.call(arguments)));return Object(u)===u?u:this}else return e.apply(t,n.concat(vn.call(arguments)))},s=Math.max(0,e.length-n.length),l=[],a=0;a<s;a++)l.push("$"+a);if(i=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var c=function(){};c.prototype=e.prototype,i.prototype=new c,c.prototype=null}return i},au=lu,bn=Function.prototype.bind||au,cu=bn,uu=cu.call(Function.call,Object.prototype.hasOwnProperty),S,Xt=SyntaxError,Mo=Function,zt=TypeError,wn=function(r){try{return Mo('"use strict"; return ('+r+").constructor;")()}catch{}},Bt=Object.getOwnPropertyDescriptor;if(Bt)try{Bt({},"")}catch{Bt=null}var Sn=function(){throw new zt},fu=Bt?function(){try{return arguments.callee,Sn}catch{try{return Bt(arguments,"callee").get}catch{return Sn}}}():Sn,qt=mn(),wt=Object.getPrototypeOf||function(r){return r.__proto__},Jt={},hu=typeof Uint8Array>"u"?S:wt(Uint8Array),Kt={"%AggregateError%":typeof AggregateError>"u"?S:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?S:ArrayBuffer,"%ArrayIteratorPrototype%":qt?wt([][Symbol.iterator]()):S,"%AsyncFromSyncIteratorPrototype%":S,"%AsyncFunction%":Jt,"%AsyncGenerator%":Jt,"%AsyncGeneratorFunction%":Jt,"%AsyncIteratorPrototype%":Jt,"%Atomics%":typeof Atomics>"u"?S:Atomics,"%BigInt%":typeof BigInt>"u"?S:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?S:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?S:Float32Array,"%Float64Array%":typeof Float64Array>"u"?S:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?S:FinalizationRegistry,"%Function%":Mo,"%GeneratorFunction%":Jt,"%Int8Array%":typeof Int8Array>"u"?S:Int8Array,"%Int16Array%":typeof Int16Array>"u"?S:Int16Array,"%Int32Array%":typeof Int32Array>"u"?S:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":qt?wt(wt([][Symbol.iterator]())):S,"%JSON%":typeof JSON=="object"?JSON:S,"%Map%":typeof Map>"u"?S:Map,"%MapIteratorPrototype%":typeof Map>"u"||!qt?S:wt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?S:Promise,"%Proxy%":typeof Proxy>"u"?S:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?S:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?S:Set,"%SetIteratorPrototype%":typeof Set>"u"||!qt?S:wt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?S:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":qt?wt(""[Symbol.iterator]()):S,"%Symbol%":qt?Symbol:S,"%SyntaxError%":Xt,"%ThrowTypeError%":fu,"%TypedArray%":hu,"%TypeError%":zt,"%Uint8Array%":typeof Uint8Array>"u"?S:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?S:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?S:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?S:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?S:WeakMap,"%WeakRef%":typeof WeakRef>"u"?S:WeakRef,"%WeakSet%":typeof WeakSet>"u"?S:WeakSet},pu=function r(t){var e;if(t==="%AsyncFunction%")e=wn("async function () {}");else if(t==="%GeneratorFunction%")e=wn("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=wn("async function* () {}");else if(t==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(e=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&(e=wt(i.prototype))}return Kt[t]=e,e},Do={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ee=bn,er=uu,du=Ee.call(Function.call,Array.prototype.concat),gu=Ee.call(Function.apply,Array.prototype.splice),Bo=Ee.call(Function.call,String.prototype.replace),rr=Ee.call(Function.call,String.prototype.slice),yu=Ee.call(Function.call,RegExp.prototype.exec),mu=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,vu=/\\(\\)?/g,bu=function(t){var e=rr(t,0,1),n=rr(t,-1);if(e==="%"&&n!=="%")throw new Xt("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&e!=="%")throw new Xt("invalid intrinsic syntax, expected opening `%`");var i=[];return Bo(t,mu,function(o,s,l,a){i[i.length]=l?Bo(a,vu,"$1"):s||o}),i},wu=function(t,e){var n=t,i;if(er(Do,n)&&(i=Do[n],n="%"+i[0]+"%"),er(Kt,n)){var o=Kt[n];if(o===Jt&&(o=pu(n)),typeof o>"u"&&!e)throw new zt("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Xt("intrinsic "+t+" does not exist!")},St=function(t,e){if(typeof t!="string"||t.length===0)throw new zt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new zt('"allowMissing" argument must be a boolean');if(yu(/^%?[^%]*%?$/,t)===null)throw new Xt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=bu(t),i=n.length>0?n[0]:"",o=wu("%"+i+"%",e),s=o.name,l=o.value,a=!1,c=o.alias;c&&(i=c[0],gu(n,du([0,1],c)));for(var u=1,f=!0;u<n.length;u+=1){var p=n[u],h=rr(p,0,1),d=rr(p,-1);if((h==='"'||h==="'"||h==="`"||d==='"'||d==="'"||d==="`")&&h!==d)throw new Xt("property names with quotes must have matching quotes");if((p==="constructor"||!f)&&(a=!0),i+="."+p,s="%"+i+"%",er(Kt,s))l=Kt[s];else if(l!=null){if(!(p in l)){if(!e)throw new zt("base intrinsic for "+t+" exists, but the property is not available.");return}if(Bt&&u+1>=n.length){var y=Bt(l,p);f=!!y,f&&"get"in y&&!("originalValue"in y.get)?l=y.get:l=l[p]}else f=er(l,p),l=l[p];f&&!a&&(Kt[s]=l)}}return l},ke={exports:{}};(function(r){var t=bn,e=St,n=e("%Function.prototype.apply%"),i=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||t.call(i,n),s=e("%Object.getOwnPropertyDescriptor%",!0),l=e("%Object.defineProperty%",!0),a=e("%Math.max%");if(l)try{l({},"a",{value:1})}catch{l=null}r.exports=function(f){var p=o(t,i,arguments);if(s&&l){var h=s(p,"length");h.configurable&&l(p,"length",{value:1+a(0,f.length-(arguments.length-1))})}return p};var c=function(){return o(t,n,arguments)};l?l(r.exports,"apply",{value:c}):r.exports.apply=c})(ke);var Po=St,No=ke.exports,Su=No(Po("String.prototype.indexOf")),et=function(t,e){var n=Po(t,!!e);return typeof n=="function"&&Su(t,".prototype.")>-1?No(n):n},_u=bt(),Eu=et,_n=Eu("Object.prototype.toString"),nr=function(t){return _u&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:_n(t)==="[object Arguments]"},Ro=function(t){return nr(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&_n(t)!=="[object Array]"&&_n(t.callee)==="[object Function]"},ku=function(){return nr(arguments)}();nr.isLegacyArguments=Ro;var Lo=ku?nr:Ro,Au=St,En=Au("%Object.defineProperty%",!0),kn=function(){if(En)try{return En({},"a",{value:1}),!0}catch{return!1}return!1};kn.hasArrayLengthDefineBug=function(){if(!kn())return null;try{return En([],"length",{value:1}).length!==1}catch{return!0}};var Ou=kn,Cu=yn,xu=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",$u=Object.prototype.toString,Iu=Array.prototype.concat,Uo=Object.defineProperty,Tu=function(r){return typeof r=="function"&&$u.call(r)==="[object Function]"},Mu=Ou(),jo=Uo&&Mu,Du=function(r,t,e,n){t in r&&(!Tu(n)||!n())||(jo?Uo(r,t,{configurable:!0,enumerable:!1,value:e,writable:!0}):r[t]=e)},Fo=function(r,t){var e=arguments.length>2?arguments[2]:{},n=Cu(t);xu&&(n=Iu.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)Du(r,n[i],t[n[i]],e[n[i]])};Fo.supportsDescriptors=!!jo;var Pt=Fo,Wo=function(r){return r!==r},Ho=function(t,e){return t===0&&e===0?1/t===1/e:!!(t===e||Wo(t)&&Wo(e))},Bu=Ho,Yo=function(){return typeof Object.is=="function"?Object.is:Bu},Pu=Yo,Nu=Pt,Ru=function(){var t=Pu();return Nu(Object,{is:t},{is:function(){return Object.is!==t}}),t},Lu=Pt,Uu=ke.exports,ju=Ho,Go=Yo,Fu=Ru,Vo=Uu(Go(),Object);Lu(Vo,{getPolyfill:Go,implementation:ju,shim:Fu});var Wu=Vo,An=et,Xo=bt(),zo,qo,On,Cn;if(Xo){zo=An("Object.prototype.hasOwnProperty"),qo=An("RegExp.prototype.exec"),On={};var xn=function(){throw On};Cn={toString:xn,valueOf:xn},typeof Symbol.toPrimitive=="symbol"&&(Cn[Symbol.toPrimitive]=xn)}var Hu=An("Object.prototype.toString"),Yu=Object.getOwnPropertyDescriptor,Gu="[object RegExp]",Vu=Xo?function(t){if(!t||typeof t!="object")return!1;var e=Yu(t,"lastIndex"),n=e&&zo(e,"value");if(!n)return!1;try{qo(t,Cn)}catch(i){return i===On}}:function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:Hu(t)===Gu},$n={exports:{}},Ae=function(){return typeof function(){}.name=="string"},Oe=Object.getOwnPropertyDescriptor;if(Oe)try{Oe([],"length")}catch{Oe=null}Ae.functionsHaveConfigurableNames=function(){if(!Ae()||!Oe)return!1;var t=Oe(function(){},"name");return!!t&&!!t.configurable};var Xu=Function.prototype.bind;Ae.boundFunctionsHaveNames=function(){return Ae()&&typeof Xu=="function"&&function(){}.bind().name!==""};var zu=Ae;(function(r){var t=zu.functionsHaveConfigurableNames(),e=Object,n=TypeError;r.exports=function(){if(this!=null&&this!==e(this))throw new n("RegExp.prototype.flags getter called on non-object");var o="";return this.hasIndices&&(o+="d"),this.global&&(o+="g"),this.ignoreCase&&(o+="i"),this.multiline&&(o+="m"),this.dotAll&&(o+="s"),this.unicode&&(o+="u"),this.sticky&&(o+="y"),o},t&&Object.defineProperty&&Object.defineProperty(r.exports,"name",{value:"get flags"})})($n);var qu=$n.exports,Ju=Pt.supportsDescriptors,Ku=Object.getOwnPropertyDescriptor,Jo=function(){if(Ju&&/a/mig.flags==="gim"){var t=Ku(RegExp.prototype,"flags");if(t&&typeof t.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var e="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(n,"sticky",{get:function(){e+="y"}}),e==="dy")return t.get}}return qu},Zu=Pt.supportsDescriptors,Qu=Jo,tf=Object.getOwnPropertyDescriptor,ef=Object.defineProperty,rf=TypeError,Ko=Object.getPrototypeOf,nf=/a/,of=function(){if(!Zu||!Ko)throw new rf("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Qu(),e=Ko(nf),n=tf(e,"flags");return(!n||n.get!==t)&&ef(e,"flags",{configurable:!0,enumerable:!1,get:t}),t},sf=Pt,lf=ke.exports,af=$n.exports,Zo=Jo,cf=of,Qo=lf(Zo());sf(Qo,{getPolyfill:Zo,implementation:af,shim:cf});var uf=Qo,ff={}.toString,ts=Array.isArray||function(r){return ff.call(r)=="[object Array]"},hf=Date.prototype.getDay,pf=function(t){try{return hf.call(t),!0}catch{return!1}},df=Object.prototype.toString,gf="[object Date]",yf=bt(),mf=function(t){return typeof t!="object"||t===null?!1:yf?pf(t):df.call(t)===gf},vf=String.prototype.valueOf,bf=function(t){try{return vf.call(t),!0}catch{return!1}},wf=Object.prototype.toString,Sf="[object String]",_f=bt(),es=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:_f?bf(t):wf.call(t)===Sf},Ef=Number.prototype.toString,kf=function(t){try{return Ef.call(t),!0}catch{return!1}},Af=Object.prototype.toString,Of="[object Number]",Cf=bt(),xf=function(t){return typeof t=="number"?!0:typeof t!="object"?!1:Cf?kf(t):Af.call(t)===Of},rs=et,$f=rs("Boolean.prototype.toString"),If=rs("Object.prototype.toString"),Tf=function(t){try{return $f(t),!0}catch{return!1}},Mf="[object Boolean]",Df=bt(),Bf=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:Df&&Symbol.toStringTag in t?Tf(t):If(t)===Mf},In={exports:{}},Pf=Object.prototype.toString,Nf=mn();if(Nf){var Rf=Symbol.prototype.toString,Lf=/^Symbol\(.*\)$/,Uf=function(t){return typeof t.valueOf()!="symbol"?!1:Lf.test(Rf.call(t))};In.exports=function(t){if(typeof t=="symbol")return!0;if(Pf.call(t)!=="[object Symbol]")return!1;try{return Uf(t)}catch{return!1}}}else In.exports=function(t){return!1};var Tn={exports:{}},ns=typeof BigInt<"u"&&BigInt,jf=function(){return typeof ns=="function"&&typeof BigInt=="function"&&typeof ns(42)=="bigint"&&typeof BigInt(42)=="bigint"},Ff=jf();if(Ff){var Wf=BigInt.prototype.valueOf,Hf=function(t){try{return Wf.call(t),!0}catch{}return!1};Tn.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:Hf(t)}}else Tn.exports=function(t){return!1};var Yf=es,Gf=xf,Vf=Bf,Xf=In.exports,zf=Tn.exports,qf=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(Yf(t))return"String";if(Gf(t))return"Number";if(Vf(t))return"Boolean";if(Xf(t))return"Symbol";if(zf(t))return"BigInt"},Mn=typeof Map=="function"&&Map.prototype?Map:null,Jf=typeof Set=="function"&&Set.prototype?Set:null,ir;Mn||(ir=function(t){return!1});var is=Mn?Map.prototype.has:null,os=Jf?Set.prototype.has:null;!ir&&!is&&(ir=function(t){return!1});var ss=ir||function(t){if(!t||typeof t!="object")return!1;try{if(is.call(t),os)try{os.call(t)}catch{return!0}return t instanceof Mn}catch{}return!1},Kf=typeof Map=="function"&&Map.prototype?Map:null,Dn=typeof Set=="function"&&Set.prototype?Set:null,or;Dn||(or=function(t){return!1});var ls=Kf?Map.prototype.has:null,as=Dn?Set.prototype.has:null;!or&&!as&&(or=function(t){return!1});var cs=or||function(t){if(!t||typeof t!="object")return!1;try{if(as.call(t),ls)try{ls.call(t)}catch{return!0}return t instanceof Dn}catch{}return!1},sr=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,us=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,lr;sr||(lr=function(t){return!1});var Bn=sr?sr.prototype.has:null,Pn=us?us.prototype.has:null;!lr&&!Bn&&(lr=function(t){return!1});var Zf=lr||function(t){if(!t||typeof t!="object")return!1;try{if(Bn.call(t,Bn),Pn)try{Pn.call(t,Pn)}catch{return!0}return t instanceof sr}catch{}return!1},Nn={exports:{}},Qf=St,fs=et,th=Qf("%WeakSet%",!0),Rn=fs("WeakSet.prototype.has",!0);if(Rn){var Ln=fs("WeakMap.prototype.has",!0);Nn.exports=function(t){if(!t||typeof t!="object")return!1;try{if(Rn(t,Rn),Ln)try{Ln(t,Ln)}catch{return!0}return t instanceof th}catch{}return!1}}else Nn.exports=function(t){return!1};var eh=ss,rh=cs,nh=Zf,ih=Nn.exports,oh=function(t){if(t&&typeof t=="object"){if(eh(t))return"Map";if(rh(t))return"Set";if(nh(t))return"WeakMap";if(ih(t))return"WeakSet"}return!1},ar={exports:{}},hs=Lo;if(mn()||tr()){var Un=Symbol.iterator;ar.exports=function(t){if(t!=null&&typeof t[Un]<"u")return t[Un]();if(hs(t))return Array.prototype[Un].call(t)}}else{var sh=ts,lh=es,ps=St,ah=ps("%Map%",!0),ch=ps("%Set%",!0),Q=et,ds=Q("Array.prototype.push"),gs=Q("String.prototype.charCodeAt"),uh=Q("String.prototype.slice"),fh=function(t,e){var n=t.length;if(e+1>=n)return e+1;var i=gs(t,e);if(i<55296||i>56319)return e+1;var o=gs(t,e+1);return o<56320||o>57343?e+1:e+2},jn=function(t){var e=0;return{next:function(){var i=e>=t.length,o;return i||(o=t[e],e+=1),{done:i,value:o}}}},ys=function(t,e){if(sh(t)||hs(t))return jn(t);if(lh(t)){var n=0;return{next:function(){var o=fh(t,n),s=uh(t,n,o);return n=o,{done:o>t.length,value:s}}}}if(e&&typeof t["_es6-shim iterator_"]<"u")return t["_es6-shim iterator_"]()};if(!ah&&!ch)ar.exports=function(t){if(t!=null)return ys(t,!0)};else{var hh=ss,ph=cs,ms=Q("Map.prototype.forEach",!0),vs=Q("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var bs=Q("Map.prototype.iterator",!0),ws=Q("Set.prototype.iterator",!0),Ss=function(r){var t=!1;return{next:function(){try{return{done:t,value:t?void 0:r.next()}}catch{return t=!0,{done:!0,value:void 0}}}}};var _s=Q("Map.prototype.@@iterator",!0)||Q("Map.prototype._es6-shim iterator_",!0),Es=Q("Set.prototype.@@iterator",!0)||Q("Set.prototype._es6-shim iterator_",!0),dh=function(t){if(hh(t)){if(bs)return Ss(bs(t));if(_s)return _s(t);if(ms){var e=[];return ms(t,function(i,o){ds(e,[o,i])}),jn(e)}}if(ph(t)){if(ws)return Ss(ws(t));if(Es)return Es(t);if(vs){var n=[];return vs(t,function(i){ds(n,i)}),jn(n)}}};ar.exports=function(t){return dh(t)||ys(t)}}}const gh=Nc(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Fn=typeof Map=="function"&&Map.prototype,Wn=Object.getOwnPropertyDescriptor&&Fn?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,cr=Fn&&Wn&&typeof Wn.get=="function"?Wn.get:null,yh=Fn&&Map.prototype.forEach,Hn=typeof Set=="function"&&Set.prototype,Yn=Object.getOwnPropertyDescriptor&&Hn?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ur=Hn&&Yn&&typeof Yn.get=="function"?Yn.get:null,mh=Hn&&Set.prototype.forEach,vh=typeof WeakMap=="function"&&WeakMap.prototype,Ce=vh?WeakMap.prototype.has:null,bh=typeof WeakSet=="function"&&WeakSet.prototype,xe=bh?WeakSet.prototype.has:null,wh=typeof WeakRef=="function"&&WeakRef.prototype,ks=wh?WeakRef.prototype.deref:null,Sh=Boolean.prototype.valueOf,_h=Object.prototype.toString,Eh=Function.prototype.toString,kh=String.prototype.match,Gn=String.prototype.slice,_t=String.prototype.replace,Ah=String.prototype.toUpperCase,As=String.prototype.toLowerCase,Os=RegExp.prototype.test,Cs=Array.prototype.concat,rt=Array.prototype.join,Oh=Array.prototype.slice,xs=Math.floor,Vn=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Xn=Object.getOwnPropertySymbols,zn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Zt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",H=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Zt?"object":"symbol")?Symbol.toStringTag:null,$s=Object.prototype.propertyIsEnumerable,Is=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Ts(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Os.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-xs(-r):xs(r);if(n!==r){var i=String(n),o=Gn.call(t,i.length+1);return _t.call(i,e,"$&_")+"."+_t.call(_t.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _t.call(t,e,"$&_")}var qn=gh,Ms=qn.custom,Ds=Ns(Ms)?Ms:null,Ch=function r(t,e,n,i){var o=e||{};if(Et(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Et(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Et(o,"customInspect")?o.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Et(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Et(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Ls(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var a=String(t);return l?Ts(t,a):a}if(typeof t=="bigint"){var c=String(t)+"n";return l?Ts(t,c):c}var u=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=u&&u>0&&typeof t=="object")return Jn(t)?"[Array]":"[Object]";var f=Gh(o,n);if(typeof i>"u")i=[];else if(Rs(i,t)>=0)return"[Circular]";function p(ct,xt,de){if(xt&&(i=Oh.call(i),i.push(xt)),de){var Ft={depth:o.depth};return Et(o,"quoteStyle")&&(Ft.quoteStyle=o.quoteStyle),r(ct,Ft,n+1,i)}return r(ct,o,n+1,i)}if(typeof t=="function"&&!Ps(t)){var h=Nh(t),d=fr(t,p);return"[Function"+(h?": "+h:" (anonymous)")+"]"+(d.length>0?" { "+rt.call(d,", ")+" }":"")}if(Ns(t)){var y=Zt?_t.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):zn.call(t);return typeof t=="object"&&!Zt?$e(y):y}if(Wh(t)){for(var g="<"+As.call(String(t.nodeName)),m=t.attributes||[],v=0;v<m.length;v++)g+=" "+m[v].name+"="+Bs(xh(m[v].value),"double",o);return g+=">",t.childNodes&&t.childNodes.length&&(g+="..."),g+="</"+As.call(String(t.nodeName))+">",g}if(Jn(t)){if(t.length===0)return"[]";var w=fr(t,p);return f&&!Yh(w)?"["+Zn(w,f)+"]":"[ "+rt.call(w,", ")+" ]"}if(Ih(t)){var _=fr(t,p);return!("cause"in Error.prototype)&&"cause"in t&&!$s.call(t,"cause")?"{ ["+String(t)+"] "+rt.call(Cs.call("[cause]: "+p(t.cause),_),", ")+" }":_.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+rt.call(_,", ")+" }"}if(typeof t=="object"&&s){if(Ds&&typeof t[Ds]=="function"&&qn)return qn(t,{depth:u-n});if(s!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Rh(t)){var T=[];return yh.call(t,function(ct,xt){T.push(p(xt,t,!0)+" => "+p(ct,t))}),Us("Map",cr.call(t),T,f)}if(jh(t)){var q=[];return mh.call(t,function(ct){q.push(p(ct,t))}),Us("Set",ur.call(t),q,f)}if(Lh(t))return Kn("WeakMap");if(Fh(t))return Kn("WeakSet");if(Uh(t))return Kn("WeakRef");if(Mh(t))return $e(p(Number(t)));if(Bh(t))return $e(p(Vn.call(t)));if(Dh(t))return $e(Sh.call(t));if(Th(t))return $e(p(String(t)));if(!$h(t)&&!Ps(t)){var lt=fr(t,p),J=Is?Is(t)===Object.prototype:t instanceof Object||t.constructor===Object,tt=t instanceof Object?"":"null prototype",at=!J&&H&&Object(t)===t&&H in t?Gn.call(kt(t),8,-1):tt?"Object":"",jt=J||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",mt=jt+(at||tt?"["+rt.call(Cs.call([],at||[],tt||[]),": ")+"] ":"");return lt.length===0?mt+"{}":f?mt+"{"+Zn(lt,f)+"}":mt+"{ "+rt.call(lt,", ")+" }"}return String(t)};function Bs(r,t,e){var n=(e.quoteStyle||t)==="double"?'"':"'";return n+r+n}function xh(r){return _t.call(String(r),/"/g,"&quot;")}function Jn(r){return kt(r)==="[object Array]"&&(!H||!(typeof r=="object"&&H in r))}function $h(r){return kt(r)==="[object Date]"&&(!H||!(typeof r=="object"&&H in r))}function Ps(r){return kt(r)==="[object RegExp]"&&(!H||!(typeof r=="object"&&H in r))}function Ih(r){return kt(r)==="[object Error]"&&(!H||!(typeof r=="object"&&H in r))}function Th(r){return kt(r)==="[object String]"&&(!H||!(typeof r=="object"&&H in r))}function Mh(r){return kt(r)==="[object Number]"&&(!H||!(typeof r=="object"&&H in r))}function Dh(r){return kt(r)==="[object Boolean]"&&(!H||!(typeof r=="object"&&H in r))}function Ns(r){if(Zt)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!zn)return!1;try{return zn.call(r),!0}catch{}return!1}function Bh(r){if(!r||typeof r!="object"||!Vn)return!1;try{return Vn.call(r),!0}catch{}return!1}var Ph=Object.prototype.hasOwnProperty||function(r){return r in this};function Et(r,t){return Ph.call(r,t)}function kt(r){return _h.call(r)}function Nh(r){if(r.name)return r.name;var t=kh.call(Eh.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function Rs(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,n=r.length;e<n;e++)if(r[e]===t)return e;return-1}function Rh(r){if(!cr||!r||typeof r!="object")return!1;try{cr.call(r);try{ur.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Lh(r){if(!Ce||!r||typeof r!="object")return!1;try{Ce.call(r,Ce);try{xe.call(r,xe)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Uh(r){if(!ks||!r||typeof r!="object")return!1;try{return ks.call(r),!0}catch{}return!1}function jh(r){if(!ur||!r||typeof r!="object")return!1;try{ur.call(r);try{cr.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function Fh(r){if(!xe||!r||typeof r!="object")return!1;try{xe.call(r,xe);try{Ce.call(r,Ce)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function Wh(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Ls(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,n="... "+e+" more character"+(e>1?"s":"");return Ls(Gn.call(r,0,t.maxStringLength),t)+n}var i=_t.call(_t.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Hh);return Bs(i,"single",t)}function Hh(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Ah.call(t.toString(16))}function $e(r){return"Object("+r+")"}function Kn(r){return r+" { ? }"}function Us(r,t,e,n){var i=n?Zn(e,n):rt.call(e,", ");return r+" ("+t+") {"+i+"}"}function Yh(r){for(var t=0;t<r.length;t++)if(Rs(r[t],`
`)>=0)return!1;return!0}function Gh(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=rt.call(Array(r.indent+1)," ");else return null;return{base:e,prev:rt.call(Array(t+1),e)}}function Zn(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+rt.call(r,","+e)+`
`+t.prev}function fr(r,t){var e=Jn(r),n=[];if(e){n.length=r.length;for(var i=0;i<r.length;i++)n[i]=Et(r,i)?t(r[i],r):""}var o=typeof Xn=="function"?Xn(r):[],s;if(Zt){s={};for(var l=0;l<o.length;l++)s["$"+o[l]]=o[l]}for(var a in r)!Et(r,a)||e&&String(Number(a))===a&&a<r.length||Zt&&s["$"+a]instanceof Symbol||(Os.call(/[^\w$]/,a)?n.push(t(a,r)+": "+t(r[a],r)):n.push(a+": "+t(r[a],r)));if(typeof Xn=="function")for(var c=0;c<o.length;c++)$s.call(r,o[c])&&n.push("["+t(o[c])+"]: "+t(r[o[c]],r));return n}var Qn=St,Qt=et,Vh=Ch,Xh=Qn("%TypeError%"),hr=Qn("%WeakMap%",!0),pr=Qn("%Map%",!0),zh=Qt("WeakMap.prototype.get",!0),qh=Qt("WeakMap.prototype.set",!0),Jh=Qt("WeakMap.prototype.has",!0),Kh=Qt("Map.prototype.get",!0),Zh=Qt("Map.prototype.set",!0),Qh=Qt("Map.prototype.has",!0),ti=function(r,t){for(var e=r,n;(n=e.next)!==null;e=n)if(n.key===t)return e.next=n.next,n.next=r.next,r.next=n,n},tp=function(r,t){var e=ti(r,t);return e&&e.value},ep=function(r,t,e){var n=ti(r,t);n?n.value=e:r.next={key:t,next:r.next,value:e}},rp=function(r,t){return!!ti(r,t)},np=function(){var t,e,n,i={assert:function(o){if(!i.has(o))throw new Xh("Side channel does not contain "+Vh(o))},get:function(o){if(hr&&o&&(typeof o=="object"||typeof o=="function")){if(t)return zh(t,o)}else if(pr){if(e)return Kh(e,o)}else if(n)return tp(n,o)},has:function(o){if(hr&&o&&(typeof o=="object"||typeof o=="function")){if(t)return Jh(t,o)}else if(pr){if(e)return Qh(e,o)}else if(n)return rp(n,o);return!1},set:function(o,s){hr&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new hr),qh(t,o,s)):pr?(e||(e=new pr),Zh(e,o,s)):(n||(n={key:{},next:null}),ep(n,o,s))}};return i},js=Function.prototype.toString,te=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,ei,dr;if(typeof te=="function"&&typeof Object.defineProperty=="function")try{ei=Object.defineProperty({},"length",{get:function(){throw dr}}),dr={},te(function(){throw 42},null,ei)}catch(r){r!==dr&&(te=null)}else te=null;var ip=/^\s*class\b/,ri=function(t){try{var e=js.call(t);return ip.test(e)}catch{return!1}},ni=function(t){try{return ri(t)?!1:(js.call(t),!0)}catch{return!1}},gr=Object.prototype.toString,op="[object Object]",sp="[object Function]",lp="[object GeneratorFunction]",ap="[object HTMLAllCollection]",cp="[object HTML document.all class]",up="[object HTMLCollection]",fp=typeof Symbol=="function"&&!!Symbol.toStringTag,hp=!(0 in[,]),ii=function(){return!1};if(typeof document=="object"){var pp=document.all;gr.call(pp)===gr.call(document.all)&&(ii=function(t){if((hp||!t)&&(typeof t>"u"||typeof t=="object"))try{var e=gr.call(t);return(e===ap||e===cp||e===up||e===op)&&t("")==null}catch{}return!1})}var dp=te?function(t){if(ii(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{te(t,null,ei)}catch(e){if(e!==dr)return!1}return!ri(t)&&ni(t)}:function(t){if(ii(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(fp)return ni(t);if(ri(t))return!1;var e=gr.call(t);return e!==sp&&e!==lp&&!/^\[object HTML/.test(e)?!1:ni(t)},gp=dp,yp=Object.prototype.toString,Fs=Object.prototype.hasOwnProperty,mp=function(t,e,n){for(var i=0,o=t.length;i<o;i++)Fs.call(t,i)&&(n==null?e(t[i],i,t):e.call(n,t[i],i,t))},vp=function(t,e,n){for(var i=0,o=t.length;i<o;i++)n==null?e(t.charAt(i),i,t):e.call(n,t.charAt(i),i,t)},bp=function(t,e,n){for(var i in t)Fs.call(t,i)&&(n==null?e(t[i],i,t):e.call(n,t[i],i,t))},wp=function(t,e,n){if(!gp(e))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),yp.call(t)==="[object Array]"?mp(t,e,i):typeof t=="string"?vp(t,e,i):bp(t,e,i)},Ws=wp,oi=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],Sp=typeof globalThis>"u"?pn:globalThis,Hs=function(){for(var t=[],e=0;e<oi.length;e++)typeof Sp[oi[e]]=="function"&&(t[t.length]=oi[e]);return t},_p=St,yr=_p("%Object.getOwnPropertyDescriptor%",!0);if(yr)try{yr([],"length")}catch{yr=null}var Ys=yr,si,Gs;function Ep(){if(Gs)return si;Gs=1;var r=Ws,t=Hs,e=et,n=e("Object.prototype.toString"),i=bt(),o=Ys,s=typeof globalThis>"u"?pn:globalThis,l=t(),a=e("Array.prototype.indexOf",!0)||function(d,y){for(var g=0;g<d.length;g+=1)if(d[g]===y)return g;return-1},c=e("String.prototype.slice"),u={},f=Object.getPrototypeOf;i&&o&&f&&r(l,function(h){var d=new s[h];if(Symbol.toStringTag in d){var y=f(d),g=o(y,Symbol.toStringTag);if(!g){var m=f(y);g=o(m,Symbol.toStringTag)}u[h]=g.get}});var p=function(d){var y=!1;return r(u,function(g,m){if(!y)try{y=g.call(d)===m}catch{}}),y};return si=function(d){if(!d||typeof d!="object")return!1;if(!i||!(Symbol.toStringTag in d)){var y=c(n(d),8,-1);return a(l,y)>-1}return o?p(d):!1},si}var Vs=Ws,kp=Hs,Xs=et,li=Ys,Ap=Xs("Object.prototype.toString"),zs=bt(),qs=typeof globalThis>"u"?pn:globalThis,Op=kp(),Cp=Xs("String.prototype.slice"),Js={},ai=Object.getPrototypeOf;zs&&li&&ai&&Vs(Op,function(r){if(typeof qs[r]=="function"){var t=new qs[r];if(Symbol.toStringTag in t){var e=ai(t),n=li(e,Symbol.toStringTag);if(!n){var i=ai(e);n=li(i,Symbol.toStringTag)}Js[r]=n.get}}});var xp=function(t){var e=!1;return Vs(Js,function(n,i){if(!e)try{var o=n.call(t);o===i&&(e=o)}catch{}}),e},$p=Ep(),Ip=function(t){return $p(t)?!zs||!(Symbol.toStringTag in t)?Cp(Ap(t),8,-1):xp(t):!1},Tp=yn,Ks=tr(),Zs=et,Qs=Object,Mp=Zs("Array.prototype.push"),tl=Zs("Object.prototype.propertyIsEnumerable"),Dp=Ks?Object.getOwnPropertySymbols:null,el=function(t,e){if(t==null)throw new TypeError("target must be an object");var n=Qs(t);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=Qs(arguments[i]),s=Tp(o),l=Ks&&(Object.getOwnPropertySymbols||Dp);if(l)for(var a=l(o),c=0;c<a.length;++c){var u=a[c];tl(o,u)&&Mp(s,u)}for(var f=0;f<s.length;++f){var p=s[f];if(tl(o,p)){var h=o[p];n[p]=h}}}return n},ci=el,Bp=function(){if(!Object.assign)return!1;for(var r="abcdefghijklmnopqrst",t=r.split(""),e={},n=0;n<t.length;++n)e[t[n]]=t[n];var i=Object.assign({},e),o="";for(var s in i)o+=s;return r!==o},Pp=function(){if(!Object.assign||!Object.preventExtensions)return!1;var r=Object.preventExtensions({1:2});try{Object.assign(r,"xy")}catch{return r[1]==="y"}return!1},rl=function(){return!Object.assign||Bp()||Pp()?ci:Object.assign},Np=Pt,Rp=rl,Lp=function(){var t=Rp();return Np(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t},Up=Pt,jp=ke.exports,Fp=el,nl=rl,Wp=Lp,Hp=jp.apply(nl()),il=function(t,e){return Hp(Object,arguments)};Up(il,{getPolyfill:nl,implementation:Fp,shim:Wp});var Yp=il,ol=yn,sl=Lo,ll=Wu,al=Vu,cl=uf,ul=ts,fl=mf,hl=qf,Gp=St,nt=et,pl=oh,ee=ar.exports,Vp=np,dl=Ip,gl=Yp,mr=nt("ArrayBuffer.prototype.byteLength",!0);function yl(r){if(!r||typeof r!="object"||!mr)return!1;try{return mr(r),!0}catch{return!1}}var ml=nt("Date.prototype.getTime"),ui=Object.getPrototypeOf,vl=nt("Object.prototype.toString"),vr=Gp("%Set%",!0),fi=nt("Map.prototype.has",!0),br=nt("Map.prototype.get",!0),bl=nt("Map.prototype.size",!0),wr=nt("Set.prototype.add",!0),wl=nt("Set.prototype.delete",!0),Sr=nt("Set.prototype.has",!0),_r=nt("Set.prototype.size",!0);function Sl(r,t,e,n){for(var i=ee(r),o;(o=i.next())&&!o.done;)if(it(t,o.value,e,n))return wl(r,o.value),!0;return!1}function _l(r){if(typeof r>"u")return null;if(typeof r!="object")return typeof r=="symbol"?!1:typeof r=="string"||typeof r=="number"?+r==+r:!0}function Xp(r,t,e,n,i,o){var s=_l(e);if(s!=null)return s;var l=br(t,s),a=gl({},i,{strict:!1});return typeof l>"u"&&!fi(t,s)||!it(n,l,a,o)?!1:!fi(r,s)&&it(n,l,a,o)}function zp(r,t,e){var n=_l(e);return n!=null?n:Sr(t,n)&&!Sr(r,n)}function El(r,t,e,n,i,o){for(var s=ee(r),l,a;(l=s.next())&&!l.done;)if(a=l.value,it(e,a,i,o)&&it(n,br(t,a),i,o))return wl(r,a),!0;return!1}function it(r,t,e,n){var i=e||{};if(i.strict?ll(r,t):r===t)return!0;var o=hl(r),s=hl(t);if(o!==s)return!1;if(!r||!t||typeof r!="object"&&typeof t!="object")return i.strict?ll(r,t):r==t;var l=n.has(r),a=n.has(t),c;if(l&&a){if(n.get(r)===n.get(t))return!0}else c={};return l||n.set(r,c),a||n.set(t,c),Kp(r,t,i,n)}function kl(r){return!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function qp(r,t,e,n){if(_r(r)!==_r(t))return!1;for(var i=ee(r),o=ee(t),s,l,a;(s=i.next())&&!s.done;)if(s.value&&typeof s.value=="object")a||(a=new vr),wr(a,s.value);else if(!Sr(t,s.value)){if(e.strict||!zp(r,t,s.value))return!1;a||(a=new vr),wr(a,s.value)}if(a){for(;(l=o.next())&&!l.done;)if(l.value&&typeof l.value=="object"){if(!Sl(a,l.value,e.strict,n))return!1}else if(!e.strict&&!Sr(r,l.value)&&!Sl(a,l.value,e.strict,n))return!1;return _r(a)===0}return!0}function Jp(r,t,e,n){if(bl(r)!==bl(t))return!1;for(var i=ee(r),o=ee(t),s,l,a,c,u,f;(s=i.next())&&!s.done;)if(c=s.value[0],u=s.value[1],c&&typeof c=="object")a||(a=new vr),wr(a,c);else if(f=br(t,c),typeof f>"u"&&!fi(t,c)||!it(u,f,e,n)){if(e.strict||!Xp(r,t,c,u,e,n))return!1;a||(a=new vr),wr(a,c)}if(a){for(;(l=o.next())&&!l.done;)if(c=l.value[0],f=l.value[1],c&&typeof c=="object"){if(!El(a,r,c,f,e,n))return!1}else if(!e.strict&&(!r.has(c)||!it(br(r,c),f,e,n))&&!El(a,r,c,f,gl({},e,{strict:!1}),n))return!1;return _r(a)===0}return!0}function Kp(r,t,e,n){var i,o;if(typeof r!=typeof t||r==null||t==null||vl(r)!==vl(t)||sl(r)!==sl(t))return!1;var s=ul(r),l=ul(t);if(s!==l)return!1;var a=r instanceof Error,c=t instanceof Error;if(a!==c||(a||c)&&(r.name!==t.name||r.message!==t.message))return!1;var u=al(r),f=al(t);if(u!==f||(u||f)&&(r.source!==t.source||cl(r)!==cl(t)))return!1;var p=fl(r),h=fl(t);if(p!==h||(p||h)&&ml(r)!==ml(t)||e.strict&&ui&&ui(r)!==ui(t)||dl(r)!==dl(t))return!1;var d=kl(r),y=kl(t);if(d!==y)return!1;if(d||y){if(r.length!==t.length)return!1;for(i=0;i<r.length;i++)if(r[i]!==t[i])return!1;return!0}var g=yl(r),m=yl(t);if(g!==m)return!1;if(g||m)return mr(r)!==mr(t)?!1:typeof Uint8Array=="function"&&it(new Uint8Array(r),new Uint8Array(t),e,n);if(typeof r!=typeof t)return!1;var v=ol(r),w=ol(t);if(v.length!==w.length)return!1;for(v.sort(),w.sort(),i=v.length-1;i>=0;i--)if(v[i]!=w[i])return!1;for(i=v.length-1;i>=0;i--)if(o=v[i],!it(r[o],t[o],e,n))return!1;var _=pl(r),T=pl(t);return _!==T?!1:_==="Set"||T==="Set"?qp(r,t,e,n):_==="Map"?Jp(r,t,e,n):!0}var Zp=function(t,e,n){return it(t,e,n,Vp())};const hi={},Al=(r,t)=>hi[r]=t,Ol=r=>hi[r.type].area(r),Qp=(r,t,e)=>hi[r.type].intersects(r,t,e);var td={exports:{}};(function(r){(function(){function t(l,a){var c=l.x-a.x,u=l.y-a.y;return c*c+u*u}function e(l,a,c){var u=a.x,f=a.y,p=c.x-u,h=c.y-f;if(p!==0||h!==0){var d=((l.x-u)*p+(l.y-f)*h)/(p*p+h*h);d>1?(u=c.x,f=c.y):d>0&&(u+=p*d,f+=h*d)}return p=l.x-u,h=l.y-f,p*p+h*h}function n(l,a){for(var c=l[0],u=[c],f,p=1,h=l.length;p<h;p++)f=l[p],t(f,c)>a&&(u.push(f),c=f);return c!==f&&u.push(f),u}function i(l,a,c,u,f){for(var p=u,h,d=a+1;d<c;d++){var y=e(l[d],l[a],l[c]);y>p&&(h=d,p=y)}p>u&&(h-a>1&&i(l,a,h,u,f),f.push(l[h]),c-h>1&&i(l,h,c,u,f))}function o(l,a){var c=l.length-1,u=[l[0]];return i(l,0,c,a,u),u.push(l[c]),u}function s(l,a,c){if(l.length<=2)return l;var u=a!==void 0?a*a:1;return l=c?l:n(l,u),l=o(l,u),l}r.exports=s,r.exports.default=s})()})(td);const ed={area:r=>{const{points:t}=r.geometry;let e=0,n=t.length-1;for(let i=0;i<t.length;i++)e+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(.5*e)},intersects:(r,t,e)=>{const{points:n}=r.geometry;let i=!1;for(let o=0,s=n.length-1;o<n.length;s=o++){const l=n[o][0],a=n[o][1],c=n[s][0],u=n[s][1];a>e!=u>e&&t<(c-l)*(e-a)/(u-a)+l&&(i=!i)}return i}};Al(Ze.POLYGON,ed);const rd={area:r=>r.geometry.w*r.geometry.h,intersects:(r,t,e)=>t>=r.geometry.x&&t<=r.geometry.x+r.geometry.w&&e>=r.geometry.y&&e<=r.geometry.y+r.geometry.h};Al(Ze.RECTANGLE,rd);const ey="";let nd=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((t,e)=>(e&=63,e<36?t+=e.toString(36):e<62?t+=(e-26).toString(36).toUpperCase():e>62?t+="-":t+="_",t),"");const re=[];function id(r,t=x){let e;const n=new Set;function i(l){if(Ye(r,l)&&(r=l,e)){const a=!re.length;for(const c of n)c[1](),re.push(c,r);if(a){for(let c=0;c<re.length;c+=2)re[c][0](re[c+1]);re.length=0}}}function o(l){i(l(r))}function s(l,a=x){const c=[l,a];return n.add(c),n.size===1&&(e=t(i)||x),l(r),()=>{n.delete(c),n.size===0&&(e(),e=null)}}return{set:i,update:o,subscribe:s}}const ft=()=>new Map,Er=r=>{const t=ft();return r.forEach((e,n)=>{t.set(n,e)}),t},ne=(r,t,e)=>{let n=r.get(t);return n===void 0&&r.set(t,n=e()),n},od=(r,t)=>{const e=[];for(const[n,i]of r)e.push(t(i,n));return e},sd=(r,t)=>{for(const[e,n]of r)if(t(n,e))return!0;return!1},Ie=()=>new Set,pi=r=>r[r.length-1],ld=(r,t)=>{for(let e=0;e<t.length;e++)r.push(t[e])},Cl=Array.from,xl=Array.isArray;class di{constructor(){this._observers=ft()}on(t,e){ne(this._observers,t,Ie).add(e)}once(t,e){const n=(...i)=>{this.off(t,n),e(...i)};this.on(t,n)}off(t,e){const n=this._observers.get(t);n!==void 0&&(n.delete(e),n.size===0&&this._observers.delete(t))}emit(t,e){return Cl((this._observers.get(t)||ft()).values()).forEach(n=>n(...e))}destroy(){this._observers=ft()}}const Nt=Math.floor,kr=Math.abs,$l=(r,t)=>r<t?r:t,ie=(r,t)=>r>t?r:t,ad=r=>r!==0?r<0:1/r<0,cd=r=>r.toLowerCase(),ud=/^\s*/g,fd=r=>r.replace(ud,""),hd=/([A-Z])/g,Il=(r,t)=>fd(r.replace(hd,e=>`${t}${cd(e)}`)),pd=r=>{const t=unescape(encodeURIComponent(r)),e=t.length,n=new Uint8Array(e);for(let i=0;i<e;i++)n[i]=t.codePointAt(i);return n},Te=typeof TextEncoder<"u"?new TextEncoder:null,dd=Te?r=>Te.encode(r):pd;let gi=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});gi&&gi.decode(new Uint8Array).length===1&&(gi=null);const Tl=r=>r===void 0?null:r;class gd{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Ml=new gd,yd=!0;try{typeof localStorage<"u"&&(Ml=localStorage,yd=!1)}catch{}const md=Ml,vd=Object.keys,Dl=r=>vd(r).length,bd=(r,t)=>{for(const e in r)if(!t(r[e],e))return!1;return!0},wd=(r,t)=>Object.prototype.hasOwnProperty.call(r,t),Sd=(r,t)=>r===t||Dl(r)===Dl(t)&&bd(r,(e,n)=>(e!==void 0||wd(t,n))&&t[n]===e),yi=(r,t,e=0)=>{try{for(;e<r.length;e++)r[e](...t)}finally{e<r.length&&yi(r,t,e+1)}},_d=(r,t)=>t.includes(r),oe=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);typeof navigator<"u"&&/Mac/.test(navigator.platform);let ot;const Ed=()=>{if(ot===void 0)if(oe){ot=ft();const r=process.argv;let t=null;for(let e=0;e<r.length;e++){const n=r[e];n[0]==="-"?(t!==null&&ot.set(t,""),t=n):t!==null&&(ot.set(t,n),t=null)}t!==null&&ot.set(t,"")}else typeof location=="object"?(ot=ft(),(location.search||"?").slice(1).split("&").forEach(r=>{if(r.length!==0){const[t,e]=r.split("=");ot.set(`--${Il(t,"-")}`,e),ot.set(`-${Il(t,"-")}`,e)}})):ot=ft();return ot},mi=r=>Ed().has(r),vi=r=>Tl(oe?process.env[r.toUpperCase()]:md.getItem(r));(r=>mi("--"+r)||vi(r)!==null)("production");const Bl=oe&&_d(process.env.FORCE_COLOR,["true","1","2"]),kd=!mi("no-colors")&&(!oe||process.stdout.isTTY||Bl)&&(!oe||mi("color")||Bl||vi("COLORTERM")!==null||(vi("TERM")||"").includes("color")),Pl=1,Nl=2,bi=4,wi=8,Ad=32,Rl=64,Ar=128,Od=31,Ll=63,Me=127,Cd=2147483647,xd=Number.isInteger||(r=>typeof r=="number"&&isFinite(r)&&Nt(r)===r),Ul=(r,t,e)=>new Uint8Array(r,t,e);class De{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Si=()=>new De,$d=r=>{let t=r.cpos;for(let e=0;e<r.bufs.length;e++)t+=r.bufs[e].length;return t},ht=r=>{const t=new Uint8Array($d(r));let e=0;for(let n=0;n<r.bufs.length;n++){const i=r.bufs[n];t.set(i,e),e+=i.length}return t.set(Ul(r.cbuf.buffer,0,r.cpos),e),t},Id=(r,t)=>{const e=r.cbuf.length;e-r.cpos<t&&(r.bufs.push(Ul(r.cbuf.buffer,0,r.cpos)),r.cbuf=new Uint8Array(ie(e,t)*2),r.cpos=0)},N=(r,t)=>{const e=r.cbuf.length;r.cpos===e&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(e*2),r.cpos=0),r.cbuf[r.cpos++]=t},_i=N,E=(r,t)=>{for(;t>Me;)N(r,Ar|Me&t),t=Nt(t/128);N(r,Me&t)},Ei=(r,t)=>{const e=ad(t);for(e&&(t=-t),N(r,(t>Ll?Ar:0)|(e?Rl:0)|Ll&t),t=Nt(t/64);t>0;)N(r,(t>Me?Ar:0)|Me&t),t=Nt(t/128)},ki=new Uint8Array(3e4),Td=ki.length/3,Md=(r,t)=>{if(t.length<Td){const e=Te.encodeInto(t,ki).written||0;E(r,e);for(let n=0;n<e;n++)N(r,ki[n])}else z(r,dd(t))},Dd=(r,t)=>{const e=unescape(encodeURIComponent(t)),n=e.length;E(r,n);for(let i=0;i<n;i++)N(r,e.codePointAt(i))},se=Te&&Te.encodeInto?Md:Dd,Ai=(r,t)=>{const e=r.cbuf.length,n=r.cpos,i=$l(e-n,t.length),o=t.length-i;r.cbuf.set(t.subarray(0,i),n),r.cpos+=i,o>0&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(ie(e*2,o)),r.cbuf.set(t.subarray(i)),r.cpos=o)},z=(r,t)=>{E(r,t.byteLength),Ai(r,t)},Oi=(r,t)=>{Id(r,t);const e=new DataView(r.cbuf.buffer,r.cpos,t);return r.cpos+=t,e},Bd=(r,t)=>Oi(r,4).setFloat32(0,t,!1),Pd=(r,t)=>Oi(r,8).setFloat64(0,t,!1),Nd=(r,t)=>Oi(r,8).setBigInt64(0,t,!1),jl=new DataView(new ArrayBuffer(4)),Rd=r=>(jl.setFloat32(0,r),jl.getFloat32(0)===r),Be=(r,t)=>{switch(typeof t){case"string":N(r,119),se(r,t);break;case"number":xd(t)&&kr(t)<=Cd?(N(r,125),Ei(r,t)):Rd(t)?(N(r,124),Bd(r,t)):(N(r,123),Pd(r,t));break;case"bigint":N(r,122),Nd(r,t);break;case"object":if(t===null)N(r,126);else if(t instanceof Array){N(r,117),E(r,t.length);for(let e=0;e<t.length;e++)Be(r,t[e])}else if(t instanceof Uint8Array)N(r,116),z(r,t);else{N(r,118);const e=Object.keys(t);E(r,e.length);for(let n=0;n<e.length;n++){const i=e[n];se(r,i),Be(r,t[i])}}break;case"boolean":N(r,t?120:121);break;default:N(r,127)}};class Fl extends De{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&E(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Wl=r=>{r.count>0&&(Ei(r.encoder,r.count===1?r.s:-r.s),r.count>1&&E(r.encoder,r.count-2))};class Or{constructor(){this.encoder=new De,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Wl(this),this.count=1,this.s=t)}toUint8Array(){return Wl(this),ht(this.encoder)}}const Hl=r=>{if(r.count>0){const t=r.diff*2+(r.count===1?0:1);Ei(r.encoder,t),r.count>1&&E(r.encoder,r.count-2)}};class Ci{constructor(){this.encoder=new De,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Hl(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Hl(this),ht(this.encoder)}}class Ld{constructor(){this.sarr=[],this.s="",this.lensE=new Or}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new De;return this.sarr.push(this.s),this.s="",se(t,this.sarr.join("")),Ai(t,this.lensE.toUint8Array()),ht(t)}}const Yl=typeof crypto>"u"?null:crypto,Ud=Yl!==null?r=>{const t=new ArrayBuffer(r),e=new Uint8Array(t);return Yl.getRandomValues(e),t}:r=>{const t=new ArrayBuffer(r),e=new Uint8Array(t);for(let n=0;n<r;n++)e[n]=Math.ceil(Math.random()*4294967295>>>0);return t},Gl=()=>new Uint32Array(Ud(4))[0],jd=[1e7]+-1e3+-4e3+-8e3+-1e11,Fd=()=>jd.replace(/[018]/g,r=>(r^Gl()&15>>r/4).toString(16)),Wd=Date.now,Hd=r=>new Promise(r),Cr=r=>new Error(r),st=()=>{throw Cr("Method unimplemented")},Rt=()=>{throw Cr("Unexpected case")},pt=Symbol;class Yd{constructor(t,e){this.left=t,this.right=e}}const dt=(r,t)=>new Yd(r,t),Lt=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;const Gd=r=>od(r,(t,e)=>`${e}:${t};`).join("");Lt.ELEMENT_NODE,Lt.TEXT_NODE,Lt.CDATA_SECTION_NODE,Lt.COMMENT_NODE,Lt.DOCUMENT_NODE,Lt.DOCUMENT_TYPE_NODE,Lt.DOCUMENT_FRAGMENT_NODE;const xi=pt(),$i=pt(),Vl=pt(),Xl=pt(),zl=pt(),Ii=pt(),ql=pt(),Ti=pt(),Jl=pt(),Vd={[xi]:dt("font-weight","bold"),[$i]:dt("font-weight","normal"),[Vl]:dt("color","blue"),[zl]:dt("color","green"),[Xl]:dt("color","grey"),[Ii]:dt("color","red"),[ql]:dt("color","purple"),[Ti]:dt("color","orange"),[Jl]:dt("color","black")},Kl={[xi]:"\x1B[1m",[$i]:"\x1B[2m",[Vl]:"\x1B[34m",[zl]:"\x1B[32m",[Xl]:"\x1B[37m",[Ii]:"\x1B[31m",[ql]:"\x1B[35m",[Ti]:"\x1B[38;5;208m",[Jl]:"\x1B[0m"},Xd=kd?oe?r=>{const t=[],e=[];let n=0;for(;n<r.length;n++){const i=r[n],o=Kl[i];if(o!==void 0)t.push(o);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&(t.push("\x1B[0m"),e.push(t.join("")));n<r.length;n++){const i=r[n];i instanceof Symbol||e.push(i)}return e}:r=>{const t=[],e=[],n=ft();let i=[],o=0;for(;o<r.length;o++){const s=r[o],l=Vd[s];if(l!==void 0)n.set(l.left,l.right);else if(s.constructor===String||s.constructor===Number){const a=Gd(n);o>0||a.length>0?(t.push("%c"+s),e.push(a)):t.push(s)}else break}for(o>0&&(i=e,i.unshift(t.join("")));o<r.length;o++){const s=r[o];s instanceof Symbol||i.push(s)}return i}:r=>{const t=[],e=[];let n=0;for(;n<r.length;n++){const i=r[n];if(Kl[i]===void 0)if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&e.push(t.join(""));n<r.length;n++){const i=r[n];i instanceof Symbol||(i.constructor===Object?e.push(JSON.stringify(i)):e.push(i))}return e},zd=(...r)=>{console.log(...Xd(r)),qd.forEach(t=>t.print(r))},qd=new Set,Zl=r=>({[Symbol.iterator](){return this},next:r}),Jd=(r,t)=>Zl(()=>{let e;do e=r.next();while(!e.done&&!t(e.value));return e}),Mi=(r,t)=>Zl(()=>{const{done:e,value:n}=r.next();return{done:e,value:e?void 0:t(n)}});class ly extends di{constructor(t,e){super(),this.doc=t,this.awareness=e}}class Kd{constructor(t,e){this.clock=t,this.len=e}}class xr{constructor(){this.clients=new Map}}const Ut=(r,t,e)=>t.clients.forEach((n,i)=>{const o=r.doc.store.clients.get(i);for(let s=0;s<n.length;s++){const l=n[s];la(r,o,l.clock,l.len,e)}}),Zd=(r,t)=>{let e=0,n=r.length-1;for(;e<=n;){const i=Nt((e+n)/2),o=r[i],s=o.clock;if(s<=t){if(t<s+o.len)return i;e=i+1}else n=i-1}return null},$r=(r,t)=>{const e=r.clients.get(t.client);return e!==void 0&&Zd(e,t.clock)!==null},Di=r=>{r.clients.forEach(t=>{t.sort((i,o)=>i.clock-o.clock);let e,n;for(e=1,n=1;e<t.length;e++){const i=t[n-1],o=t[e];i.clock+i.len>=o.clock?i.len=ie(i.len,o.clock+o.len-i.clock):(n<e&&(t[n]=o),n++)}t.length=n})},Ql=r=>{const t=new xr;for(let e=0;e<r.length;e++)r[e].clients.forEach((n,i)=>{if(!t.clients.has(i)){const o=n.slice();for(let s=e+1;s<r.length;s++)ld(o,r[s].clients.get(i)||[]);t.clients.set(i,o)}});return Di(t),t},Bi=(r,t,e,n)=>{ne(r.clients,t,()=>[]).push(new Kd(e,n))},Qd=()=>new xr,tg=(r,t)=>{E(r.restEncoder,t.clients.size),t.clients.forEach((e,n)=>{r.resetDsCurVal(),E(r.restEncoder,n);const i=e.length;E(r.restEncoder,i);for(let o=0;o<i;o++){const s=e[o];r.writeDsClock(s.clock),r.writeDsLen(s.len)}})},ta=Gl;class le extends di{constructor({guid:t=Fd(),collectionid:e=null,gc:n=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:s=!1,shouldLoad:l=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=ta(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new fg,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=s,this.meta=o,this.isLoaded=!1,this.whenLoaded=Hd(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})})}load(){const t=this._item;t!==null&&!this.shouldLoad&&k(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,e=null){k(this,t,e)}get(t,e=j){const n=ne(this.share,t,()=>{const o=new e;return o._integrate(this,null),o}),i=n.constructor;if(e!==j&&i!==e)if(i===j){const o=new e;o._map=n._map,n._map.forEach(s=>{for(;s!==null;s=s.left)s.parent=o}),o._start=n._start;for(let s=o._start;s!==null;s=s.right)s.parent=o;return o._length=n._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,Le)}getText(t=""){return this.get(t,Yr)}getMap(t=""){return this.get(t,Wr)}getXmlFragment(t=""){return this.get(t,ce)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){Cl(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new le({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,k(t.parent.doc,n=>{const i=e.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class eg{constructor(){this.restEncoder=Si()}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){E(this.restEncoder,t)}writeDsLen(t){E(this.restEncoder,t)}}class rg extends eg{writeLeftID(t){E(this.restEncoder,t.client),E(this.restEncoder,t.clock)}writeRightID(t){E(this.restEncoder,t.client),E(this.restEncoder,t.clock)}writeClient(t){E(this.restEncoder,t)}writeInfo(t){_i(this.restEncoder,t)}writeString(t){se(this.restEncoder,t)}writeParentInfo(t){E(this.restEncoder,t?1:0)}writeTypeRef(t){E(this.restEncoder,t)}writeLen(t){E(this.restEncoder,t)}writeAny(t){Be(this.restEncoder,t)}writeBuf(t){z(this.restEncoder,t)}writeJSON(t){se(this.restEncoder,JSON.stringify(t))}writeKey(t){se(this.restEncoder,t)}}class ng{constructor(){this.restEncoder=Si(),this.dsCurrVal=0}toUint8Array(){return ht(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,E(this.restEncoder,e)}writeDsLen(t){t===0&&Rt(),E(this.restEncoder,t-1),this.dsCurrVal+=t}}class ig extends ng{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Ci,this.clientEncoder=new Or,this.leftClockEncoder=new Ci,this.rightClockEncoder=new Ci,this.infoEncoder=new Fl(_i),this.stringEncoder=new Ld,this.parentInfoEncoder=new Fl(_i),this.typeRefEncoder=new Or,this.lenEncoder=new Or}toUint8Array(){const t=Si();return E(t,0),z(t,this.keyClockEncoder.toUint8Array()),z(t,this.clientEncoder.toUint8Array()),z(t,this.leftClockEncoder.toUint8Array()),z(t,this.rightClockEncoder.toUint8Array()),z(t,ht(this.infoEncoder)),z(t,this.stringEncoder.toUint8Array()),z(t,ht(this.parentInfoEncoder)),z(t,this.typeRefEncoder.toUint8Array()),z(t,this.lenEncoder.toUint8Array()),Ai(t,ht(this.restEncoder)),ht(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Be(this.restEncoder,t)}writeBuf(t){z(this.restEncoder,t)}writeJSON(t){Be(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const og=(r,t,e,n)=>{n=ie(n,t[0].id.clock);const i=gt(t,n);E(r.restEncoder,t.length-i),r.writeClient(e),E(r.restEncoder,n);const o=t[i];o.write(r,n-o.id.clock);for(let s=i+1;s<t.length;s++)t[s].write(r,0)},sg=(r,t,e)=>{const n=new Map;e.forEach((i,o)=>{Y(t,o)>i&&n.set(o,i)}),Pi(t).forEach((i,o)=>{e.has(o)||n.set(o,0)}),E(r.restEncoder,n.size),Array.from(n.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{og(r,t.clients.get(i),i,o)})},lg=(r,t)=>sg(r,t.doc.store,t.beforeState);class ag{constructor(){this.l=[]}}const ea=()=>new ag,ra=(r,t)=>r.l.push(t),na=(r,t)=>{const e=r.l,n=e.length;r.l=e.filter(i=>t!==i),n===r.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ia=(r,t,e)=>yi(r.l,[t,e]);class Ir{constructor(t,e){this.client=t,this.clock=e}}const Tr=(r,t)=>r===t||r!==null&&t!==null&&r.client===t.client&&r.clock===t.clock,A=(r,t)=>new Ir(r,t),cg=r=>{for(const[t,e]of r.doc.share.entries())if(e===r)return t;throw Rt()},Mr=(r,t)=>{for(;t!==null;){if(t.parent===r)return!0;t=t.parent._item}return!1};class ug{constructor(t,e){this.ds=t,this.sv=e}}((r,t)=>new ug(r,t))(Qd(),new Map);const Pe=(r,t)=>t===void 0?!r.deleted:t.sv.has(r.id.client)&&(t.sv.get(r.id.client)||0)>r.id.clock&&!$r(t.ds,r.id),Dr=(r,t)=>{const e=ne(r.meta,Dr,Ie),n=r.doc.store;e.has(t)||(t.sv.forEach((i,o)=>{i<Y(n,o)&&G(r,A(o,i))}),Ut(r,t.ds,i=>{}),e.add(t))};class fg{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Pi=r=>{const t=new Map;return r.clients.forEach((e,n)=>{const i=e[e.length-1];t.set(n,i.id.clock+i.length)}),t},Y=(r,t)=>{const e=r.clients.get(t);if(e===void 0)return 0;const n=e[e.length-1];return n.id.clock+n.length},oa=(r,t)=>{let e=r.clients.get(t.id.client);if(e===void 0)e=[],r.clients.set(t.id.client,e);else{const n=e[e.length-1];if(n.id.clock+n.length!==t.id.clock)throw Rt()}e.push(t)},gt=(r,t)=>{let e=0,n=r.length-1,i=r[n],o=i.id.clock;if(o===t)return n;let s=Nt(t/(o+i.length-1)*n);for(;e<=n;){if(i=r[s],o=i.id.clock,o<=t){if(t<o+i.length)return s;e=s+1}else n=s-1;s=Nt((e+n)/2)}throw Rt()},Br=(r,t)=>{const e=r.clients.get(t.client);return e[gt(e,t.clock)]},Ni=(r,t,e)=>{const n=gt(t,e),i=t[n];return i.id.clock<e&&i instanceof I?(t.splice(n+1,0,Ma(r,i,e-i.id.clock)),n+1):n},G=(r,t)=>{const e=r.doc.store.clients.get(t.client);return e[Ni(r,e,t.clock)]},sa=(r,t,e)=>{const n=t.clients.get(e.client),i=gt(n,e.clock),o=n[i];return e.clock!==o.id.clock+o.length-1&&o.constructor!==Ot&&n.splice(i+1,0,Ma(r,o,e.clock-o.id.clock+1)),o},hg=(r,t,e)=>{const n=r.clients.get(t.id.client);n[gt(n,t.id.clock)]=e},la=(r,t,e,n,i)=>{if(n===0)return;const o=e+n;let s=Ni(r,t,e),l;do l=t[s++],o<l.id.clock+l.length&&Ni(r,t,o),i(l);while(s<t.length&&t[s].id.clock<o)};class pg{constructor(t,e,n){this.doc=t,this.deleteSet=new xr,this.beforeState=Pi(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const aa=(r,t)=>t.deleteSet.clients.size===0&&!sd(t.afterState,(e,n)=>t.beforeState.get(n)!==e)?!1:(Di(t.deleteSet),lg(r,t),tg(r,t.deleteSet),!0),ca=(r,t,e)=>{const n=t._item;(n===null||n.id.clock<(r.beforeState.get(n.id.client)||0)&&!n.deleted)&&ne(r.changed,t,Ie).add(e)},Pr=(r,t)=>{const e=r[t-1],n=r[t];e.deleted===n.deleted&&e.constructor===n.constructor&&e.mergeWith(n)&&(r.splice(t,1),n instanceof I&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,e))},dg=(r,t,e)=>{for(const[n,i]of r.clients.entries()){const o=t.clients.get(n);for(let s=i.length-1;s>=0;s--){const l=i[s],a=l.clock+l.len;for(let c=gt(o,l.clock),u=o[c];c<o.length&&u.id.clock<a;u=o[++c]){const f=o[c];if(l.clock+l.len<=f.id.clock)break;f instanceof I&&f.deleted&&!f.keep&&e(f)&&f.gc(t,!1)}}}},gg=(r,t)=>{r.clients.forEach((e,n)=>{const i=t.clients.get(n);for(let o=e.length-1;o>=0;o--){const s=e[o],l=$l(i.length-1,1+gt(i,s.clock+s.len-1));for(let a=l,c=i[a];a>0&&c.id.clock>=s.clock;c=i[--a])Pr(i,a)}})},ua=(r,t)=>{if(t<r.length){const e=r[t],n=e.doc,i=n.store,o=e.deleteSet,s=e._mergeStructs;try{Di(o),e.afterState=Pi(e.doc.store),n._transaction=null,n.emit("beforeObserverCalls",[e,n]);const l=[];e.changed.forEach((a,c)=>l.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(e,a)})),l.push(()=>{e.changedParentTypes.forEach((a,c)=>l.push(()=>{(c._item===null||!c._item.deleted)&&(a=a.filter(u=>u.target._item===null||!u.target._item.deleted),a.forEach(u=>{u.currentTarget=c}),a.sort((u,f)=>u.path.length-f.path.length),ia(c._dEH,a,e))})),l.push(()=>n.emit("afterTransaction",[e,n]))}),yi(l,[])}finally{n.gc&&dg(o,i,n.gcFilter),gg(o,i),e.afterState.forEach((u,f)=>{const p=e.beforeState.get(f)||0;if(p!==u){const h=i.clients.get(f),d=ie(gt(h,p),1);for(let y=h.length-1;y>=d;y--)Pr(h,y)}});for(let u=0;u<s.length;u++){const{client:f,clock:p}=s[u].id,h=i.clients.get(f),d=gt(h,p);d+1<h.length&&Pr(h,d+1),d>0&&Pr(h,d)}if(!e.local&&e.afterState.get(n.clientID)!==e.beforeState.get(n.clientID)&&(zd(Ti,xi,"[yjs] ",$i,Ii,"Changed the client-id because another client seems to be using it."),n.clientID=ta()),n.emit("afterTransactionCleanup",[e,n]),n._observers.has("update")){const u=new rg;aa(u,e)&&n.emit("update",[u.toUint8Array(),e.origin,n,e])}if(n._observers.has("updateV2")){const u=new ig;aa(u,e)&&n.emit("updateV2",[u.toUint8Array(),e.origin,n,e])}const{subdocsAdded:l,subdocsLoaded:a,subdocsRemoved:c}=e;(l.size>0||c.size>0||a.size>0)&&(l.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),c.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:a,added:l,removed:c},n,e]),c.forEach(u=>u.destroy())),r.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,r])):ua(r,t+1)}}},k=(r,t,e=null,n=!0)=>{const i=r._transactionCleanups;let o=!1;r._transaction===null&&(o=!0,r._transaction=new pg(r,e,n),i.push(r._transaction),i.length===1&&r.emit("beforeAllTransactions",[r]),r.emit("beforeTransaction",[r._transaction,r]));try{t(r._transaction)}finally{o&&i[0]===r._transaction&&ua(i,0)}};class yg{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const fa=(r,t,e)=>{Ut(r,e.deletions,n=>{n instanceof I&&t.scope.some(i=>Mr(i,n))&&Hi(n,!1)})},ha=(r,t,e)=>{let n=null,i=null;const o=r.doc,s=r.scope;if(k(o,l=>{for(;t.length>0&&n===null;){const a=o.store,c=t.pop(),u=new Set,f=[];let p=!1;Ut(l,c.insertions,h=>{if(h instanceof I){if(h.redone!==null){let{item:d,diff:y}=Ng(a,h.id);y>0&&(d=G(l,A(d.id.client,d.id.clock+y))),h=d}!h.deleted&&s.some(d=>Mr(d,h))&&f.push(h)}}),Ut(l,c.deletions,h=>{h instanceof I&&s.some(d=>Mr(d,h))&&!$r(c.insertions,h.id)&&u.add(h)}),u.forEach(h=>{p=Da(l,h,u,c.insertions,r.ignoreRemoteMapChanges)!==null||p});for(let h=f.length-1;h>=0;h--){const d=f[h];r.deleteFilter(d)&&(d.delete(l),p=!0)}n=p?c:null}l.changed.forEach((a,c)=>{a.has(null)&&c._searchMarker&&(c._searchMarker.length=0)}),i=l},r),n!=null){const l=i.changedParentTypes;r.emit("stack-item-popped",[{stackItem:n,type:e,changedParentTypes:l},r])}return n};class uy extends di{constructor(t,{captureTimeout:e=500,captureTransaction:n=a=>!0,deleteFilter:i=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:s=!1,doc:l=xl(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=i,o.add(this),this.trackedOrigins=o,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=l,this.lastChange=0,this.ignoreRemoteMapChanges=s,this.captureTimeout=e,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(g=>a.changedParentTypes.has(g))||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;const c=this.undoing,u=this.redoing,f=c?this.redoStack:this.undoStack;c?this.stopCapturing():u||this.clear(!1,!0);const p=new xr;a.afterState.forEach((g,m)=>{const v=a.beforeState.get(m)||0,w=g-v;w>0&&Bi(p,m,v,w)});const h=Wd();let d=!1;if(this.lastChange>0&&h-this.lastChange<this.captureTimeout&&f.length>0&&!c&&!u){const g=f[f.length-1];g.deletions=Ql([g.deletions,a.deleteSet]),g.insertions=Ql([g.insertions,p])}else f.push(new yg(a.deleteSet,p)),d=!0;!c&&!u&&(this.lastChange=h),Ut(a,a.deleteSet,g=>{g instanceof I&&this.scope.some(m=>Mr(m,g))&&Hi(g,!0)});const y=[{stackItem:f[f.length-1],origin:a.origin,type:c?"redo":"undo",changedParentTypes:a.changedParentTypes},this];d?this.emit("stack-item-added",y):this.emit("stack-item-updated",y)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=xl(t)?t:[t],t.forEach(e=>{this.scope.every(n=>n!==e)&&this.scope.push(e)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{t&&(this.undoStack.forEach(i=>fa(n,this,i)),this.undoStack=[]),e&&(this.redoStack.forEach(i=>fa(n,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=ha(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=ha(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class Nr{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return mg(this.currentTarget,this.target)}deletes(t){return $r(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(i=>{if(i!==null){const o=e._map.get(i);let s,l;if(this.adds(o)){let a=o.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(o))if(a!==null&&this.deletes(a))s="delete",l=pi(a.content.getContent());else return;else a!==null&&this.deletes(a)?(s="update",l=pi(a.content.getContent())):(s="add",l=void 0)}else if(this.deletes(o))s="delete",l=pi(o.content.getContent());else return;t.set(i,{action:s,oldValue:l})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const e=this.target,n=Ie(),i=Ie(),o=[];if(t={added:n,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(e).has(null)){let l=null;const a=()=>{l&&o.push(l)};for(let c=e._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((l===null||l.delete===void 0)&&(a(),l={delete:0}),l.delete+=c.length,i.add(c)):this.adds(c)?((l===null||l.insert===void 0)&&(a(),l={insert:[]}),l.insert=l.insert.concat(c.content.getContent()),n.add(c)):((l===null||l.retain===void 0)&&(a(),l={retain:0}),l.retain+=c.length);l!==null&&l.retain===void 0&&a()}this._changes=t}return t}}const mg=(r,t)=>{const e=[];for(;t._item!==null&&t!==r;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||n++,i=i.right;e.unshift(n)}t=t._item.parent}return e},pa=80;let Ri=0;class vg{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=Ri++}}const bg=r=>{r.timestamp=Ri++},da=(r,t,e)=>{r.p.marker=!1,r.p=t,t.marker=!0,r.index=e,r.timestamp=Ri++},wg=(r,t,e)=>{if(r.length>=pa){const n=r.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return da(n,t,e),n}else{const n=new vg(t,e);return r.push(n),n}},Rr=(r,t)=>{if(r._start===null||t===0||r._searchMarker===null)return null;const e=r._searchMarker.length===0?null:r._searchMarker.reduce((o,s)=>kr(t-o.index)<kr(t-s.index)?o:s);let n=r._start,i=0;for(e!==null&&(n=e.p,i=e.index,bg(e));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return e!==null&&kr(e.index-i)<n.parent.length/pa?(da(e,n,i),e):wg(r._searchMarker,n,i)},Ne=(r,t,e)=>{for(let n=r.length-1;n>=0;n--){const i=r[n];if(e>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){r.splice(n,1);continue}i.p=o,o.marker=!0}(t<i.index||e>0&&t===i.index)&&(i.index=ie(t,i.index+e))}},Lr=(r,t,e)=>{const n=r,i=t.changedParentTypes;for(;ne(i,r,()=>[]).push(e),r._item!==null;)r=r._item.parent;ia(n._eH,e,t)};class j{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ea(),this._dEH=ea(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw st()}clone(){throw st()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ra(this._eH,t)}observeDeep(t){ra(this._dEH,t)}unobserve(t){na(this._eH,t)}unobserveDeep(t){na(this._dEH,t)}toJSON(){}}const ga=(r,t,e)=>{t<0&&(t=r._length+t),e<0&&(e=r._length+e);let n=e-t;const i=[];let o=r._start;for(;o!==null&&n>0;){if(o.countable&&!o.deleted){const s=o.content.getContent();if(s.length<=t)t-=s.length;else{for(let l=t;l<s.length&&n>0;l++)i.push(s[l]),n--;t=0}}o=o.right}return i},ya=r=>{const t=[];let e=r._start;for(;e!==null;){if(e.countable&&!e.deleted){const n=e.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}e=e.right}return t},Re=(r,t)=>{let e=0,n=r._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let o=0;o<i.length;o++)t(i[o],e++,r)}n=n.right}},ma=(r,t)=>{const e=[];return Re(r,(n,i)=>{e.push(t(n,i,r))}),e},Sg=r=>{let t=r._start,e=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),n=0,t=t.right}const i=e[n++];return e.length<=n&&(e=null),{done:!1,value:i}}}},va=(r,t)=>{const e=Rr(r,t);let n=r._start;for(e!==null&&(n=e.p,t-=e.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Ur=(r,t,e,n)=>{let i=e;const o=r.doc,s=o.clientID,l=o.store,a=e===null?t._start:e.right;let c=[];const u=()=>{c.length>0&&(i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new fe(c)),i.integrate(r,0),c=[])};n.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new Vr(new Uint8Array(f))),i.integrate(r,0);break;case le:i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new zr(f)),i.integrate(r,0);break;default:if(f instanceof j)i=new I(A(s,Y(l,s)),i,i&&i.lastId,a,a&&a.id,t,null,new Ct(f)),i.integrate(r,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},ba=Cr("Length exceeded!"),wa=(r,t,e,n)=>{if(e>t._length)throw ba;if(e===0)return t._searchMarker&&Ne(t._searchMarker,e,n.length),Ur(r,t,null,n);const i=e,o=Rr(t,e);let s=t._start;for(o!==null&&(s=o.p,e-=o.index,e===0&&(s=s.prev,e+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(e<=s.length){e<s.length&&G(r,A(s.id.client,s.id.clock+e));break}e-=s.length}return t._searchMarker&&Ne(t._searchMarker,i,n.length),Ur(r,t,s,n)},_g=(r,t,e)=>{let i=(t._searchMarker||[]).reduce((o,s)=>s.index>o.index?s:o,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Ur(r,t,i,e)},Sa=(r,t,e,n)=>{if(n===0)return;const i=e,o=n,s=Rr(t,e);let l=t._start;for(s!==null&&(l=s.p,e-=s.index);l!==null&&e>0;l=l.right)!l.deleted&&l.countable&&(e<l.length&&G(r,A(l.id.client,l.id.clock+e)),e-=l.length);for(;n>0&&l!==null;)l.deleted||(n<l.length&&G(r,A(l.id.client,l.id.clock+n)),l.delete(r),n-=l.length),l=l.right;if(n>0)throw ba;t._searchMarker&&Ne(t._searchMarker,i,-o+n)},jr=(r,t,e)=>{const n=t._map.get(e);n!==void 0&&n.delete(r)},Li=(r,t,e,n)=>{const i=t._map.get(e)||null,o=r.doc,s=o.clientID;let l;if(n==null)l=new fe([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:l=new fe([n]);break;case Uint8Array:l=new Vr(n);break;case le:l=new zr(n);break;default:if(n instanceof j)l=new Ct(n);else throw new Error("Unexpected content type")}new I(A(s,Y(o.store,s)),i,i&&i.lastId,null,null,t,e,l).integrate(r,0)},Ui=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},_a=r=>{const t={};return r._map.forEach((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])}),t},Ea=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted},Fr=r=>Jd(r.entries(),t=>!t[1].deleted);class Eg extends Nr{constructor(t,e){super(t,e),this._transaction=e}}class Le extends j{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Le;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Le}clone(){const t=new Le;return t.insert(0,this.toArray().map(e=>e instanceof j?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Lr(this,t,new Eg(this,t))}insert(t,e){this.doc!==null?k(this.doc,n=>{wa(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?k(this.doc,e=>{_g(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?k(this.doc,n=>{Sa(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return va(this,t)}toArray(){return ya(this)}slice(t=0,e=this.length){return ga(this,t,e)}toJSON(){return this.map(t=>t instanceof j?t.toJSON():t)}map(t){return ma(this,t)}forEach(t){Re(this,t)}[Symbol.iterator](){return Sg(this)}_write(t){t.writeTypeRef(Tg)}}class kg extends Nr{constructor(t,e,n){super(t,e),this.keysChanged=n}}class Wr extends j{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new Wr}clone(){const t=new Wr;return this.forEach((e,n)=>{t.set(n,e instanceof j?e.clone():e)}),t}_callObserver(t,e){Lr(this,t,new kg(this,t,e))}toJSON(){const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const i=e.content.getContent()[e.length-1];t[n]=i instanceof j?i.toJSON():i}}),t}get size(){return[...Fr(this._map)].length}keys(){return Mi(Fr(this._map),t=>t[0])}values(){return Mi(Fr(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Mi(Fr(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?k(this.doc,e=>{jr(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?k(this.doc,n=>{Li(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return Ui(this,t)}has(t){return Ea(this,t)}clear(){this.doc!==null?k(this.doc,t=>{this.forEach(function(e,n,i){jr(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Mg)}}const At=(r,t)=>r===t||typeof r=="object"&&typeof t=="object"&&r&&t&&Sd(r,t);class ji{constructor(t,e,n,i){this.left=t,this.right=e,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Rt(),this.right.content.constructor){case R:this.right.deleted||ae(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ka=(r,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case R:t.right.deleted||ae(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&G(r,A(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Hr=(r,t,e)=>{const n=new Map,i=Rr(t,e);if(i){const o=new ji(i.p.left,i.p,i.index,n);return ka(r,o,e-i.index)}else{const o=new ji(null,t._start,0,n);return ka(r,o,e)}},Aa=(r,t,e,n)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===R&&At(n.get(e.right.content.key),e.right.content.value));)e.right.deleted||n.delete(e.right.content.key),e.forward();const i=r.doc,o=i.clientID;n.forEach((s,l)=>{const a=e.left,c=e.right,u=new I(A(o,Y(i.store,o)),a,a&&a.lastId,c,c&&c.id,t,null,new R(l,s));u.integrate(r,0),e.right=u,e.forward()})},ae=(r,t)=>{const{key:e,value:n}=t;n===null?r.delete(e):r.set(e,n)},Oa=(r,t)=>{for(;r.right!==null;){if(!(r.right.deleted||r.right.content.constructor===R&&At(t[r.right.content.key]||null,r.right.content.value)))break;r.forward()}},Ca=(r,t,e,n)=>{const i=r.doc,o=i.clientID,s=new Map;for(const l in n){const a=n[l],c=e.currentAttributes.get(l)||null;if(!At(c,a)){s.set(l,c);const{left:u,right:f}=e;e.right=new I(A(o,Y(i.store,o)),u,u&&u.lastId,f,f&&f.id,t,null,new R(l,a)),e.right.integrate(r,0),e.forward()}}return s},Fi=(r,t,e,n,i)=>{e.currentAttributes.forEach((p,h)=>{i[h]===void 0&&(i[h]=null)});const o=r.doc,s=o.clientID;Oa(e,i);const l=Ca(r,t,e,i),a=n.constructor===String?new yt(n):n instanceof j?new Ct(n):new ue(n);let{left:c,right:u,index:f}=e;t._searchMarker&&Ne(t._searchMarker,e.index,a.getLength()),u=new I(A(s,Y(o.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,a),u.integrate(r,0),e.right=u,e.index=f,e.forward(),Aa(r,t,e,l)},xa=(r,t,e,n,i)=>{const o=r.doc,s=o.clientID;Oa(e,i);const l=Ca(r,t,e,i);t:for(;e.right!==null&&(n>0||l.size>0&&(e.right.deleted||e.right.content.constructor===R));){if(!e.right.deleted)switch(e.right.content.constructor){case R:{const{key:a,value:c}=e.right.content,u=i[a];if(u!==void 0){if(At(u,c))l.delete(a);else{if(n===0)break t;l.set(a,c)}e.right.delete(r)}else e.currentAttributes.set(a,c);break}default:n<e.right.length&&G(r,A(e.right.id.client,e.right.id.clock+n)),n-=e.right.length;break}e.forward()}if(n>0){let a="";for(;n>0;n--)a+=`
`;e.right=new I(A(s,Y(o.store,s)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new yt(a)),e.right.integrate(r,0),e.forward()}Aa(r,t,e,l)},$a=(r,t,e,n,i)=>{let o=e;const s=Er(i);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===R&&ae(s,o.content),o=o.right;let l=0,a=!1;for(;t!==o;){if(e===t&&(a=!0),!t.deleted){const c=t.content;switch(c.constructor){case R:{const{key:u,value:f}=c;((s.get(u)||null)!==f||(n.get(u)||null)===f)&&(t.delete(r),l++,!a&&(i.get(u)||null)===f&&(n.get(u)||null)!==f&&i.delete(u));break}}}t=t.right}return l},Ag=(r,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===R){const n=t.content.key;e.has(n)?t.delete(r):e.add(n)}t=t.left}},Og=r=>{let t=0;return k(r.doc,e=>{let n=r._start,i=r._start,o=ft();const s=Er(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case R:ae(s,i.content);break;default:t+=$a(e,n,i,o,s),o=Er(s),n=i;break}i=i.right}}),t},Ia=(r,t,e)=>{const n=e,i=Er(t.currentAttributes),o=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ct:case ue:case yt:e<t.right.length&&G(r,A(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(r);break}t.forward()}o&&$a(r,o,t.right,i,t.currentAttributes);const s=(t.left||t.right).parent;return s._searchMarker&&Ne(s._searchMarker,t.index,-n+e),t};class Cg extends Nr{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];k(t,n=>{const i=new Map,o=new Map;let s=this.target._start,l=null;const a={};let c="",u=0,f=0;const p=()=>{if(l!==null){let h;switch(l){case"delete":h={delete:f},f=0;break;case"insert":h={insert:c},i.size>0&&(h.attributes={},i.forEach((d,y)=>{d!==null&&(h.attributes[y]=d)})),c="";break;case"retain":if(h={retain:u},Object.keys(a).length>0){h.attributes={};for(const d in a)h.attributes[d]=a[d]}u=0;break}e.push(h),l=null}};for(;s!==null;){switch(s.content.constructor){case Ct:case ue:this.adds(s)?this.deletes(s)||(p(),l="insert",c=s.content.getContent()[0],p()):this.deletes(s)?(l!=="delete"&&(p(),l="delete"),f+=1):s.deleted||(l!=="retain"&&(p(),l="retain"),u+=1);break;case yt:this.adds(s)?this.deletes(s)||(l!=="insert"&&(p(),l="insert"),c+=s.content.str):this.deletes(s)?(l!=="delete"&&(p(),l="delete"),f+=s.length):s.deleted||(l!=="retain"&&(p(),l="retain"),u+=s.length);break;case R:{const{key:h,value:d}=s.content;if(this.adds(s)){if(!this.deletes(s)){const y=i.get(h)||null;At(y,d)?d!==null&&s.delete(n):(l==="retain"&&p(),At(d,o.get(h)||null)?delete a[h]:a[h]=d)}}else if(this.deletes(s)){o.set(h,d);const y=i.get(h)||null;At(y,d)||(l==="retain"&&p(),a[h]=y)}else if(!s.deleted){o.set(h,d);const y=a[h];y!==void 0&&(At(y,d)?y!==null&&s.delete(n):(l==="retain"&&p(),d===null?delete a[h]:a[h]=d))}s.deleted||(l==="insert"&&p(),ae(i,s.content));break}}s=s.right}for(p();e.length>0;){const h=e[e.length-1];if(h.retain!==void 0&&h.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Yr extends j{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new Yr}clone(){const t=new Yr;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Cg(this,t,e),i=t.doc;if(Lr(this,t,n),!t.local){let o=!1;for(const[s,l]of t.afterState.entries()){const a=t.beforeState.get(s)||0;if(l!==a&&(la(t,i.store.clients.get(s),a,l,c=>{!c.deleted&&c.content.constructor===R&&(o=!0)}),o))break}o||Ut(t,t.deleteSet,s=>{s instanceof Ot||o||s.parent===this&&s.content.constructor===R&&(o=!0)}),k(i,s=>{o?Og(this):Ut(s,s.deleteSet,l=>{l instanceof Ot||l.parent===this&&Ag(s,l)})})}}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===yt&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?k(this.doc,n=>{const i=new ji(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const s=t[o];if(s.insert!==void 0){const l=!e&&typeof s.insert=="string"&&o===t.length-1&&i.right===null&&s.insert.slice(-1)===`
`?s.insert.slice(0,-1):s.insert;(typeof l!="string"||l.length>0)&&Fi(n,this,i,l,s.attributes||{})}else s.retain!==void 0?xa(n,this,i,s.retain,s.attributes||{}):s.delete!==void 0&&Ia(n,i,s.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){const i=[],o=new Map,s=this.doc;let l="",a=this._start;function c(){if(l.length>0){const u={};let f=!1;o.forEach((h,d)=>{f=!0,u[d]=h});const p={insert:l};f&&(p.attributes=u),i.push(p),l=""}}return k(s,u=>{for(t&&Dr(u,t),e&&Dr(u,e);a!==null;){if(Pe(a,t)||e!==void 0&&Pe(a,e))switch(a.content.constructor){case yt:{const f=o.get("ychange");t!==void 0&&!Pe(a,t)?(f===void 0||f.user!==a.id.client||f.type!=="removed")&&(c(),o.set("ychange",n?n("removed",a.id):{type:"removed"})):e!==void 0&&!Pe(a,e)?(f===void 0||f.user!==a.id.client||f.type!=="added")&&(c(),o.set("ychange",n?n("added",a.id):{type:"added"})):f!==void 0&&(c(),o.delete("ychange")),l+=a.content.str;break}case Ct:case ue:{c();const f={insert:a.content.getContent()[0]};if(o.size>0){const p={};f.attributes=p,o.forEach((h,d)=>{p[d]=h})}i.push(f);break}case R:Pe(a,t)&&(c(),ae(o,a.content));break}a=a.right}c()},Dr),i}insert(t,e,n){if(e.length<=0)return;const i=this.doc;i!==null?k(i,o=>{const s=Hr(o,this,t);n||(n={},s.currentAttributes.forEach((l,a)=>{n[a]=l})),Fi(o,this,s,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n={}){const i=this.doc;i!==null?k(i,o=>{const s=Hr(o,this,t);Fi(o,this,s,e,n)}):this._pending.push(()=>this.insertEmbed(t,e,n))}delete(t,e){if(e===0)return;const n=this.doc;n!==null?k(n,i=>{Ia(i,Hr(i,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(e===0)return;const i=this.doc;i!==null?k(i,o=>{const s=Hr(o,this,t);s.right!==null&&xa(o,this,s,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){this.doc!==null?k(this.doc,e=>{jr(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?k(this.doc,n=>{Li(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return Ui(this,t)}getAttributes(t){return _a(this)}_write(t){t.writeTypeRef(Dg)}}class Wi{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===Gr||e.constructor===ce)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ce extends j{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ce}clone(){const t=new ce;return t.insert(0,this.toArray().map(e=>e instanceof j?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Wi(this,t)}querySelector(t){t=t.toUpperCase();const n=new Wi(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Wi(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Lr(this,t,new xg(this,e,t))}toString(){return ma(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),Re(this,o=>{i.insertBefore(o.toDOM(t,e,n),null)}),i}insert(t,e){this.doc!==null?k(this.doc,n=>{wa(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)k(this.doc,n=>{const i=t&&t instanceof j?t._item:t;Ur(n,this,i,e)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(o=>o===t)+1;if(i===0&&t!==null)throw Cr("Reference item not found");n.splice(i,0,...e)}}delete(t,e=1){this.doc!==null?k(this.doc,n=>{Sa(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return ya(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return va(this,t)}slice(t=0,e=this.length){return ga(this,t,e)}forEach(t){Re(this,t)}_write(t){t.writeTypeRef(Pg)}}class Gr extends ce{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new Gr(this.nodeName)}clone(){const t=new Gr(this.nodeName),e=this.getAttributes();for(const n in e)t.setAttribute(n,e[n]);return t.insert(0,this.toArray().map(n=>n instanceof j?n.clone():n)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const l in t)n.push(l);n.sort();const i=n.length;for(let l=0;l<i;l++){const a=n[l];e.push(a+'="'+t[a]+'"')}const o=this.nodeName.toLocaleLowerCase(),s=e.length>0?" "+e.join(" "):"";return`<${o}${s}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?k(this.doc,e=>{jr(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?k(this.doc,n=>{Li(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return Ui(this,t)}hasAttribute(t){return Ea(this,t)}getAttributes(t){return _a(this)}toDOM(t=document,e={},n){const i=t.createElement(this.nodeName),o=this.getAttributes();for(const s in o)i.setAttribute(s,o[s]);return Re(this,s=>{i.appendChild(s.toDOM(t,e,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(Bg),t.writeKey(this.nodeName)}}class xg extends Nr{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Ta{constructor(t,e){this.id=t,this.length=e}get deleted(){throw st()}mergeWith(t){return!1}write(t,e,n){throw st()}integrate(t,e){throw st()}}const $g=0;class Ot extends Ta{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),oa(t.doc.store,this)}write(t,e){t.writeInfo($g),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Vr{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Vr(this.content)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class Xr{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Xr(this.len)}splice(t){const e=new Xr(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){Bi(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Ig=(r,t)=>new le({guid:r,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class zr{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new zr(Ig(this.doc.guid,this.opts))}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class ue{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ue(this.embed)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class R{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new R(this.key,this.value)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class fe{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fe(this.arr)}splice(t){const e=new fe(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let i=e;i<n;i++){const o=this.arr[i];t.writeAny(o)}}getRef(){return 8}}class yt{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new yt(this.str)}splice(t){const e=new yt(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",e.str="\uFFFD"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Tg=0,Mg=1,Dg=2,Bg=3,Pg=4;class Ct{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ct(this.type._copy())}splice(t){throw st()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(n=>{n.deleted?t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Ng=(r,t)=>{let e=t,n=0,i;do n>0&&(e=A(e.client,e.clock+n)),i=Br(r,e),n=e.clock-i.id.clock,e=i.redone;while(e!==null&&i instanceof I);return{item:i,diff:n}},Hi=(r,t)=>{for(;r!==null&&r.keep!==t;)r.keep=t,r=r.parent._item},Ma=(r,t,e)=>{const{client:n,clock:i}=t.id,o=new I(A(n,i+e),t,A(n,i+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=A(t.redone.client,t.redone.clock+e)),t.right=o,o.right!==null&&(o.right.left=o),r._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=e,o},Da=(r,t,e,n,i)=>{const o=r.doc,s=o.store,l=o.clientID,a=t.redone;if(a!==null)return G(r,a);let c=t.parent._item,u=null,f;if(c!==null&&c.deleted===!0){if(c.redone===null&&(!e.has(c)||Da(r,c,e,n,i)===null))return null;for(;c.redone!==null;)c=G(r,c.redone)}const p=c===null?t.parent:c.content.type;if(t.parentSub===null){for(u=t.left,f=t;u!==null;){let g=u;for(;g!==null&&g.parent._item!==c;)g=g.redone===null?null:G(r,g.redone);if(g!==null&&g.parent._item===c){u=g;break}u=u.left}for(;f!==null;){let g=f;for(;g!==null&&g.parent._item!==c;)g=g.redone===null?null:G(r,g.redone);if(g!==null&&g.parent._item===c){f=g;break}f=f.right}}else if(f=null,t.right&&!i){for(u=t;u!==null&&u.right!==null&&$r(n,u.right.id);)u=u.right;for(;u!==null&&u.redone!==null;)u=G(r,u.redone);if(u&&u.right!==null)return null}else u=p._map.get(t.parentSub)||null;const h=Y(s,l),d=A(l,h),y=new I(d,u,u&&u.lastId,f,f&&f.id,p,t.parentSub,t.content.copy());return t.redone=d,Hi(y,!0),y.integrate(r,0),y};class I extends Ta{constructor(t,e,n,i,o,s,l,a){super(t,a.getLength()),this.origin=n,this.left=e,this.right=i,this.rightOrigin=o,this.parent=s,this.parentSub=l,this.redone=null,this.content=a,this.info=this.content.isCountable()?Nl:0}set marker(t){(this.info&wi)>0!==t&&(this.info^=wi)}get marker(){return(this.info&wi)>0}get keep(){return(this.info&Pl)>0}set keep(t){this.keep!==t&&(this.info^=Pl)}get countable(){return(this.info&Nl)>0}get deleted(){return(this.info&bi)>0}set deleted(t){this.deleted!==t&&(this.info^=bi)}markDeleted(){this.info|=bi}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Y(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Y(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ir&&this.id.client!==this.parent.client&&this.parent.clock>=Y(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=sa(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=G(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===Ot||this.right&&this.right.constructor===Ot)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===I&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===I&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ir){const n=Br(e,this.parent);n.constructor===Ot?this.parent=null:this.parent=n.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=sa(t,t.doc.store,A(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,s=new Set;for(;i!==null&&i!==this.right;){if(s.add(i),o.add(i),Tr(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,o.clear();else if(Tr(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&s.has(Br(t.doc.store,i.origin)))o.has(Br(t.doc.store,i.origin))||(n=i,o.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),oa(t.doc.store,this),this.content.integrate(t,this),ca(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Ot(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:A(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Tr(t.origin,this.lastId)&&this.right===t&&Tr(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),Bi(t.deleteSet,this.id.client,this.id.clock,this.length),ca(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw Rt();this.content.gc(t),e?hg(t,this,new Ot(this.id,this.length)):this.content=new Xr(this.length)}write(t,e){const n=e>0?A(this.id.client,this.id.clock+e-1):this.origin,i=this.rightOrigin,o=this.parentSub,s=this.content.getRef()&Od|(n===null?0:Ar)|(i===null?0:Rl)|(o===null?0:Ad);if(t.writeInfo(s),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const l=this.parent;if(l._item!==void 0){const a=l._item;if(a===null){const c=cg(l);t.writeParentInfo(!0),t.writeString(c)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else l.constructor===String?(t.writeParentInfo(!0),t.writeString(l)):l.constructor===Ir?(t.writeParentInfo(!1),t.writeLeftID(l)):Rt();o!==null&&t.writeString(o)}this.content.write(t,e)}}const Ba=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Pa="__ $YJS$ __";Ba[Pa]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Ba[Pa]=!0;class Rg{constructor(){this.clear=()=>{const{size:t}=this.map;t!==0&&this.doc.transact(()=>this.map.forEach((e,n)=>this.map.delete(n)))},this.set=(t,e=!0)=>{e&&this.clear(),this.doc.transact(()=>t.forEach(n=>this.map.set(n.id,n)))},this.add=t=>this.map.set(t.id,t),this.all=()=>Array.from(this.map.values()),this.update=(t,e)=>{const n=typeof t=="string"?t:t.id;n===e.id?this.map.set(e.id,e):this.doc.transact(()=>{this.map.delete(n),this.map.set(e.id,e)})},this.bulkUpsert=t=>{this.doc.transact(()=>{t.forEach(e=>{this.map.set(e.id,e)})})},this.remove=t=>{typeof t=="string"?this.map.delete(t):this.map.delete(t.id)},this.get=t=>this.map.get(t),this.size=()=>this.map.size,this.observe=t=>this.map.observe(t),this.doc=new le,this.map=this.doc.getMap()}}function Lg(r,t,e,n,i){Na(r,t,e||0,n||r.length-1,i||Ug)}function Na(r,t,e,n,i){for(;n>e;){if(n-e>600){var o=n-e+1,s=t-e+1,l=Math.log(o),a=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*a*(o-a)/o)*(s-o/2<0?-1:1),u=Math.max(e,Math.floor(t-s*a/o+c)),f=Math.min(n,Math.floor(t+(o-s)*a/o+c));Na(r,t,u,f,i)}var p=r[t],h=e,d=n;for(Ue(r,e,t),i(r[n],p)>0&&Ue(r,e,n);h<d;){for(Ue(r,h,d),h++,d--;i(r[h],p)<0;)h++;for(;i(r[d],p)>0;)d--}i(r[e],p)===0?Ue(r,e,d):(d++,Ue(r,d,n)),d<=t&&(e=d+1),t<=d&&(n=d-1)}}function Ue(r,t,e){var n=r[t];r[t]=r[e],r[e]=n}function Ug(r,t){return r<t?-1:r>t?1:0}class jg{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Jr(t,e))return n;const i=this.toBBox,o=[];for(;e;){for(let s=0;s<e.children.length;s++){const l=e.children[s],a=e.leaf?i(l):l;Jr(t,a)&&(e.leaf?n.push(l):Gi(t,a)?this._all(l,n):o.push(l))}e=o.pop()}return n}collides(t){let e=this.data;if(!Jr(t,e))return!1;const n=[];for(;e;){for(let i=0;i<e.children.length;i++){const o=e.children[i],s=e.leaf?this.toBBox(o):o;if(Jr(t,s)){if(e.leaf||Gi(t,s))return!0;n.push(o)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=pe([]),this}remove(t,e){if(!t)return this;let n=this.data;const i=this.toBBox(t),o=[],s=[];let l,a,c;for(;n||o.length;){if(n||(n=o.pop(),a=o[o.length-1],l=s.pop(),c=!0),n.leaf){const u=Fg(t,n.children,e);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}!c&&!n.leaf&&Gi(n,i)?(o.push(n),s.push(l),l=0,a=n,n=n.children[0]):a?(l++,n=a.children[l],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,i){const o=n-e+1;let s=this._maxEntries,l;if(o<=s)return l=pe(t.slice(e,n+1)),he(l,this.toBBox),l;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),l=pe([]),l.leaf=!1,l.height=i;const a=Math.ceil(o/s),c=a*Math.ceil(Math.sqrt(s));Ra(t,e,n,c,this.compareMinX);for(let u=e;u<=n;u+=c){const f=Math.min(u+c-1,n);Ra(t,u,f,a,this.compareMinY);for(let p=u;p<=f;p+=a){const h=Math.min(p+a-1,f);l.children.push(this._build(t,p,h,i-1))}}return he(l,this.toBBox),l}_chooseSubtree(t,e,n,i){for(;i.push(e),!(e.leaf||i.length-1===n);){let o=1/0,s=1/0,l;for(let a=0;a<e.children.length;a++){const c=e.children[a],u=Yi(c),f=Yg(t,c)-u;f<s?(s=f,o=u<o?u:o,l=c):f===s&&u<o&&(o=u,l=c)}e=l||e.children[0]}return e}_insert(t,e,n){const i=n?t:this.toBBox(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),Fe(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)}_split(t,e){const n=t[e],i=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,i);const s=this._chooseSplitIndex(n,o,i),l=pe(n.children.splice(s,n.children.length-s));l.height=n.height,l.leaf=n.leaf,he(n,this.toBBox),he(l,this.toBBox),e?t[e-1].children.push(l):this._splitRoot(n,l)}_splitRoot(t,e){this.data=pe([t,e]),this.data.height=t.height+1,this.data.leaf=!1,he(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let i,o=1/0,s=1/0;for(let l=e;l<=n-e;l++){const a=je(t,0,l,this.toBBox),c=je(t,l,n,this.toBBox),u=Gg(a,c),f=Yi(a)+Yi(c);u<o?(o=u,i=l,s=f<s?f:s):u===o&&f<s&&(s=f,i=l)}return i||n-e}_chooseSplitAxis(t,e,n){const i=t.leaf?this.compareMinX:Wg,o=t.leaf?this.compareMinY:Hg,s=this._allDistMargin(t,e,n,i),l=this._allDistMargin(t,e,n,o);s<l&&t.children.sort(i)}_allDistMargin(t,e,n,i){t.children.sort(i);const o=this.toBBox,s=je(t,0,e,o),l=je(t,n-e,n,o);let a=qr(s)+qr(l);for(let c=e;c<n-e;c++){const u=t.children[c];Fe(s,t.leaf?o(u):u),a+=qr(s)}for(let c=n-e-1;c>=e;c--){const u=t.children[c];Fe(l,t.leaf?o(u):u),a+=qr(l)}return a}_adjustParentBBoxes(t,e,n){for(let i=n;i>=0;i--)Fe(e[i],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():he(t[e],this.toBBox)}}function Fg(r,t,e){if(!e)return t.indexOf(r);for(let n=0;n<t.length;n++)if(e(r,t[n]))return n;return-1}function he(r,t){je(r,0,r.children.length,t,r)}function je(r,t,e,n,i){i||(i=pe(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=t;o<e;o++){const s=r.children[o];Fe(i,r.leaf?n(s):s)}return i}function Fe(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function Wg(r,t){return r.minX-t.minX}function Hg(r,t){return r.minY-t.minY}function Yi(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function qr(r){return r.maxX-r.minX+(r.maxY-r.minY)}function Yg(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function Gg(r,t){const e=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),i=Math.min(r.maxX,t.maxX),o=Math.min(r.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,o-n)}function Gi(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function Jr(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function pe(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ra(r,t,e,n,i){const o=[t,e];for(;o.length;){if(e=o.pop(),t=o.pop(),e-t<=n)continue;const s=t+Math.ceil((e-t)/n/2)*n;Lg(r,s,t,e,i),o.push(t,s,s,e)}}class Vg{constructor(){this.all=()=>this.tree.all().map(t=>t.shape),this.clear=()=>this.tree.clear(),this.insert=t=>{const{minX:e,minY:n,maxX:i,maxY:o}=t.geometry.bounds;this.tree.insert({minX:e,minY:n,maxX:i,maxY:o,shape:t})},this.remove=t=>{const e={...t.geometry.bounds,shape:t};this.tree.remove(e,(n,i)=>n.shape.id===i.shape.id)},this.update=(t,e)=>{this.remove(t),this.insert(e)},this.set=(t,e=!0)=>{e&&this.tree.clear(),this.tree.load(t.map(n=>{const{minX:i,minY:o,maxX:s,maxY:l}=n.geometry.bounds;return{minX:i,minY:o,maxX:s,maxY:l,shape:n}}))},this.getAt=(t,e)=>{const i=this.tree.search({minX:t,minY:e,maxX:t,maxY:e}).map(o=>o.shape).filter(o=>o.type===Ze.RECTANGLE?!0:Qp(o,t,e));if(i.length>0)return i.sort((o,s)=>Ol(o)-Ol(s)),i[0]},this.size=()=>this.tree.all().length,this.tree=new jg}}class Vi{constructor(t,e,n){this.isEmpty=()=>this.added.length+this.deleted.length+this.updated.length===0,this.removeStateChanges=(i=[])=>{const{added:o,deleted:s,updated:l}=this,a=u=>{const{state:f,...p}=u;return i.length===0?p:(i.forEach(h=>{delete f[h]}),{...p,state:f})},c=l.filter(({oldValue:u,newValue:f})=>{const p=a(u),h=a(f);return!Zp(p,h)});return new Vi(o,s,c)},this.added=t,this.deleted=e,this.updated=n}}const We=(()=>{const r=new Vg,t=new Rg,e=[];return t.observe(d=>{const{keys:y}=d.changes,g=[],m=[],v=[];for(const[_,T]of y.entries()){const{action:q,oldValue:lt}=T;q==="add"?g.push(t.get(_)):q==="update"?v.push({oldValue:lt,newValue:t.get(_)}):q==="delete"&&m.push(lt)}r.set(g,!1),m.forEach(_=>r.remove(_)),v.forEach(({oldValue:_,newValue:T})=>r.update(_,T));const w=new Vi(g,m,v);e.forEach(({callback:_,ignoreHoverStateChanges:T})=>{T&&w.removeStateChanges(["isHovered"]).isEmpty()||_(w)})}),{add:d=>t.add(d),all:()=>t.all(),bulkUpsert:d=>t.bulkUpsert(d),clear:()=>t.clear(),get:d=>t.get(d),getAt:(d,y)=>r.getAt(d,y),observe:(d,y=!1)=>e.push({callback:d,ignoreHoverStateChanges:y}),remove:d=>t.remove(d),set:(d,y=!0)=>t.set(d,y),setState:(d,y)=>{const g=t.get(d);if(g){const m={...g,state:{...g.state,...y}};t.add(m)}},update:(d,y)=>{const g=typeof d=="string"?t.get(d):d;t.update(g,y)},doc:t.doc}})();var La=(r=>(r[r.GUEST=0]="GUEST",r[r.USER=1]="USER",r))(La||{});const Ua={type:La.GUEST,id:nd()},Kr=(()=>{let r,t=Ua;return{get currentUser(){return t},set currentUser(e){e?t=e:t=Ua},setServerTime:e=>{const n=Date.now();r=e-n},getCurrentTimeAdjusted:()=>r?new Date(Date.now()+r).toISOString():new Date().toISOString(),toClientTime:e=>Date.parse(e)-r}})();(()=>{const{subscribe:r,update:t}=id([]);return We.observe(({added:i,deleted:o,updated:s})=>{const l=s.filter(({oldValue:c,newValue:u})=>c.state.isSelectedBy!==u.state.isSelectedBy).map(({newValue:c})=>c),a=i.filter(c=>c.state.isSelectedBy);l.length+o.length+a.length>0&&t(c=>{const u=[...l.filter(p=>p.state.isSelectedBy===Kr.currentUser.id),...a],f=new Set([...l.filter(p=>!p.state.isSelectedBy).map(p=>p.id),...o.filter(p=>c.find(h=>h.id===p.id)).map(p=>p.id)]);return u.length+f.size>0?[...c.filter(h=>!f.has(h.id)),...u].map(h=>We.get(h.id)):c.map(p=>We.get(p.id))})},!0),{subscribe:r,select:i=>{const o=typeof i=="string"?i:i.id;We.setState(o,{isSelectedBy:Kr.currentUser.id})},deselect:i=>{const o=typeof i=="string"?i:i.id;We.setState(o,{isSelectedBy:void 0})}}})();const dy="",gy="",yy="",my="";function Xg(r){let t,e,n,i,o,s,l,a,c,u;return i=new Zc({props:{data:r[1]}}),i.$on("addTranscription",r[2]),{c(){t=W("div"),e=W("div"),n=W("div"),_e(i.$$.fragment),o=Tt(),s=W("div"),D(n,"class","r8s-hover-content svelte-nj7tr3"),D(e,"class","r8s-hover-main svelte-nj7tr3"),D(s,"class","mousetrap svelte-nj7tr3"),D(t,"class","r8s-hover-container svelte-nj7tr3"),D(t,"style",l=`top: ${r[0].offsetY}px; left: ${r[0].offsetX}px`)},m(f,p){L(f,t,p),C(t,e),C(e,n),Gt(i,n,null),C(t,o),C(t,s),a=!0,c||(u=nc(Ec.call(null,e)),c=!0)},p(f,[p]){const h={};p&2&&(h.data=f[1]),i.$set(h),(!a||p&1&&l!==(l=`top: ${f[0].offsetY}px; left: ${f[0].offsetX}px`))&&D(t,"style",l)},i(f){a||($(i.$$.fragment,f),a=!0)},o(f){B(i.$$.fragment,f),a=!1},d(f){f&&P(t),Vt(i),c=!1,u()}}}function zg(r,t,e){const n=ao();let{annotation:i}=t,{originalEvent:o}=t,s=[];const l=a=>{const u=[...Array.isArray(i.body)?i.body:[i.body],{type:"TextualBody",purpose:"transcribing",value:a.detail,creator:{type:"Person",name:Kr.currentUser.id},created:Kr.getCurrentTimeAdjusted()}];e(3,i={...i,body:u}),n("transcriptionChanged",i)};return r.$$set=a=>{"annotation"in a&&e(3,i=a.annotation),"originalEvent"in a&&e(0,o=a.originalEvent)},r.$$.update=()=>{if(r.$$.dirty&8){const a=i.body?Array.isArray(i.body)?i.body:[i.body]:[];e(1,s=a.filter(c=>{var u;return(!c.purpose||c.purpose==="transcribing")&&((u=c.creator)==null?void 0:u.name)!=="mapKurator:post-ocr"}))}},[o,s,l,i]}class qg extends sn{constructor(t){super(),on(this,t,zg,Xg,Ye,{annotation:3,originalEvent:0})}}class Jg{constructor(t,e){this.showPopup=(n,i)=>{this.popup=new qg({target:document.body,props:{annotation:n,originalEvent:i}}),this.popup.$on("transcriptionChanged",o=>this.anno.updateAnnotation(o.detail.id,o.detail)),this.popup.$on("editShape",o=>this.anno.selectAnnotation(o.detail.id))},this.hidePopup=()=>{this.popup.$destroy(),this.popup=null},this.anno=t,this.viewer=e,t.on("mouseEnterAnnotation",(n,i)=>{this.showPopup(n,i)}),t.on("mouseLeaveAnnotation",()=>{this.hidePopup()})}}return Jg});
//# sourceMappingURL=luna-annotorious.js.map
